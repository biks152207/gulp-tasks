var todoZuModules=["angucomplete-alt","angularMoment","btford.socket-io","ionic","ionMdInput","matchMedia","monospaced.elastic","ng-mfb","ngAnimate","ngCropper","ngCordova","ngFileUpload","ngSanitize","toastr","ui.bootstrap.datetimepicker","ui.router"],app=angular.module("app",todoZuModules);ionic.Platform.ready(function(){app.run(["$rootScope","$state","$templateCache","$ionicSideMenuDelegate","$ionicScrollDelegate","$cordovaStatusbar","screenSize","pushNotification","connectivity","sharedData","socket","orientation","TodoZuDB","userModel","taskService","$location","date","sortService","taskListView","platformService","user","loggingService","$ionicPopup","message","stringService","$window","gAnalytics","reminderService","popupService","$timeout",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g,v,h,E,k,T,S,b,_,I,y,w,D,O,A){function R(){T.registerDeviceInfo()}if(window.StatusBar&&(StatusBar.overlaysWebView(!0),StatusBar.styleDefault()),y.cordova&&y.TestFairy&&(console.log("initializing test fairy sdk"),y.TestFairy.begin("63c43cf0d18d04c9b9673e532c6075c842d8381a")),w.init(),c.checkConnection())try{i.init().then(function(){i.getDeviceUniqueId().then(function(){if(e.isLoginProgress||!p.isAuthenticated())var t=e.$on("login-success",function(){t(),R()});else R()})})}catch(e){console.log(e)}if(S.init(),e.isMobile=k.isMobileDevice(),r.scrollTop(),f.createDatabase(),c.startMonitor(),e.desktop=a.is("md, lg"),e.mobile=a.is("xs, sm"),e.toastInstance=n.get("directives/toast/toast.html"),d.setOrientation(),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!0),p.isAuthenticated()){u.connect();var M=e.$on("pull-from-server-complete",function(){M(),A(function(){D.cleanUpReminders()},1e3)});e.$emit("push-to-server",!0,!0)}e.$on("$stateChangeStart",function(n,r,o){e.loggedIn=p.isAuthenticated(),s.isOpen()&&s.toggleLeft();var a=r.requireLogin;r.name,p.isAuthenticated()&&0==a?(n.preventDefault(),l.home()):p.isAuthenticated()||1!=a||(n.preventDefault(),t.go("/login",{returnUrl:r.name,params:o.id},{reload:!0}),u.disconnect())}),e.getActiveReminders=function(e){if(void 0!==e)return m.getActiveReminders(e)},e.countActiveReminders=function(e){if(void 0!==e)return m.countActiveReminders(e)},e.isReminderActive=function(e,t){if(void 0!==t&&void 0!=e)return m.isReminderActive(e,t)},e.$on("$stateChangeSuccess",function(t,n,s,r,o){e.currentPathHash="#"+g.url()}),e.dateDisplayText=function(e){if(p.isAuthenticated())return e?v.getDateTime(new Date(e)):""},p.isAuthenticated(),e.changeFilterView=function(e,t){E.setFilterView(e,t),E.setSelectedFilterView(e)},e.$on("api-version-changed",function(e,t){O.apiVersionChanged(function(){y.localStorage.setItem("x-api-version",t),T.logout()})})}]),setTimeout(function(){window.cordova&&navigator.splashscreen.hide()},1e3),angular.bootstrap(document,[app.name])}),function(){app.config(["$httpProvider","toastrConfig","$ionicConfigProvider","msdElasticConfig","$ionicLoadingConfig","$compileProvider","moment",function(e,t,n,s,r,o,a){window.cordova&&console.log(_.keys(window.cordova.plugins)),e.interceptors.push("authInterceptor"),e.interceptors.push("httpAllInterceptor"),angular.extend(t,{positionClass:"toast-bottom-center",preventDuplicates:!1,preventOpenDuplicates:!0,progressBar:!1,tapToDismiss:!0,timeOut:5e3,titleClass:"toast-title",toastClass:"toast",allowHtml:!0}),angular.extend(r,{content:"Loading",templateUrl:"html/views/modals/loader.html",animation:"fade-in",showBackdrop:!0,hideOnStateChange:!1,maxWidth:200,showDelay:0}),n.views.maxCache(0),n.tabs.position("top"),n.views.transition("none"),s.append="",ionic.Platform.isAndroid()&&n.scrolling.jsScrolling(!1),window.cordova&&window.cordova.plugins.Keyboard&&(window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.cordova.plugins.Keyboard.disableScroll(!0)),a().calendar(null,{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",nextWeek:"ddd",sameElse:""}),a.locale("en",{relativeTime:{s:"%ds",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:"%dd",M:"1 month",MM:"%d months",y:"a year",yy:"%d years"}})}])}.call(this),function(){ionic.Gestures.gestures.Hold.defaults.hold_threshold=20;var e="https://api.dev.todozu.com";app.constant("API",{history:{GET:{historiesByTask:e+"/history/by-task",all:e+"/history/all"}},notification:{getByUserId:e+"/notifications/by-userId",seen:e+"/notifications/seen"},project:{details:e+"/project/details",reSendInvitation:e+"/project/resend-invitation",adminInvitation:e+"/project/admin-invitation"},settings:{removeAvatar:e+"/settings/avatar/remove",update:e+"/settings/update",updateUserName:e+"/settings/update-username",updateEmail:e+"/settings/update-email",updateEmailConfirm:e+"/update-email-confirm",updatePassword:e+"/settings/update-password",uploadAvatar:e+"/settings/avatar/upload",deleteAccount:e+"/user/delete-account",checkForDelete:e+"/user/check-for-delete"},sync:{pull:e+"/sync/pull",push:e+"/sync/push"},task:{GET:{histories:e+"/task/histories/",allHistories:e+"/task/all-histories",getCompleted:e+"/task/completed",view:e+"/task/view/"},uploadNote:e+"/task/note/upload",unCompleteTasks:e+"/task/uncomplete"},user:{register:e+"/user",pull:e+"/sync-all",forgotPassword:e+"/forgot-password",resetPassword:e+"/reset-password",login:e+"/user/login",logout:e+"/user/logout",validatePassword:e+"/user/validate-password",registerDeviceInfo:e+"/user/register-device-info",totalStorage:e+"/user/totalstorage"}}),app.constant("CONSTANT",{website:"https://todozu.com",iconUrl:"https://api.dev.todozu.com/icons/icon.png",upgradeUrl:"https://todozu.com/pricing",version:"0.0.4",file_handler_link:"https://api.dev.todozu.com/serve/file",app_link:"https://app.dev.todozu.com",api_link:"https://api.dev.todozu.com"}),app.constant("RESPONSE_CODE",{SUCCESS:200,ERROR:500}),app.constant("PUSH_NOTIFICATION_CONFIG",{APP_ID:"b3cfc522-0d06-4454-98e8-d457d7d5b85f",SUB_DOMAIN_NAME:"todozu",GOOGLE_PROJECT_NUMBER:"360688121111"}),app.constant("ANALYTICS_CONFIG",{MOBILE_ID:"UA-56174322-7",WEB_ID:"UA-56174322-8"}),app.constant("DEFAULTS",{defaultSettings:{taskCreateReminderNotificationChannels:{email:{title:"Email",value:!1,notified:!0},push:{title:"Push",value:!0,notified:!1}}}})}.call(this),!function(){app.filter("dueDateSummary",["dueService",function(e){return function(t){if(t&&t.recurrence&&t.recurrence)return e.getSummary(t.recurrence)}}])}(),function(){app.filter("nameShorten",function(){return function(e){var t;return t=e.split(" "),t[0].charAt(0).toUpperCase()+t[t.length-1].charAt(0).toUpperCase()}})}.call(this),function(){app.filter("range",function(){return function(e,t){t=parseInt(t);for(var n=1;n<=t;n++)e.push(n);return e}})}.call(this),function(){app.filter("reverse",function(){return function(e){return e.slice().reverse()}})}.call(this),function(){app.filter("cut",function(){return function(e,t,n,s){if(!e)return"";if(n=parseInt(n,10),!n)return e;if(e.length<=n)return e;if(e=e.substr(0,n),t){var r=e.lastIndexOf(" ");r!=-1&&(e=e.substr(0,r))}return e+(s||" â€¦")}})}.call(this),function(){app.config(["$stateProvider",function(e){var t=ionic.Platform.platform(),n="android"===t||"ios"===t;e.state("/assignee/details",{url:"/assignee/details/:id",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return n?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"assignee",cache:!1,requireLogin:!0,sortKey:"assignee",title:"Assignee_Task_List"})}])}.call(this),function(){app.config(["$stateProvider",function(e){var t=ionic.Platform.platform(),n="android"===t||"ios"===t;e.state("/filter/add",{url:"/filter/add",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/filter/add_filter.html"}},state:"filter",cache:!1,requireLogin:!0,title:"Custom_Filters_Add"}).state("/filter/edit",{url:"/filter/edit/:id",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/filter/edit_filter.html"}},state:"filter",cache:!1,requireLogin:!0,title:"Custom_Filters_Edit"}).state("/filter/details",{url:"/filter/details/:id",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return n?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"filter",cache:!1,requireLogin:!0,isListView:!0,sortKey:"filter",title:"Custom_Filters_Task_List"})}])}.call(this),function(){app.config(["$stateProvider",function(e){var t=ionic.Platform.platform(),n="android"===t||"ios"===t;e.state("/label/add",{url:"/label/add",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/label/add_label.html"}},state:"label",cache:!1,requireLogin:!0,title:"Labels_Add"}).state("/label/edit",{url:"/label/edit/:id",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/label/edit_label.html"}},state:"label",cache:!1,requireLogin:!0,title:"Labels_Edit"}).state("/label/details",{url:"/label/details/:id",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return n?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"label",cache:!1,requireLogin:!0,isListView:!0,sortKey:"label",title:"Labels_Task_List"})}])}.call(this),function(){app.config(["$stateProvider",function(e){var t=ionic.Platform.platform(),n="android"===t||"ios"===t;e.state("/project/add",{url:"/project/add",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/project/add_project.html"}},state:"project",cache:!1,requireLogin:!0,title:"Project_Add"}).state("/accept-invitation",{url:"/accept-invitation?msg&email&projectId",onEnter:["$rootScope","$state","$stateParams","message","userModel","project","user","sharedData",function(e,t,n,s,r,o,a,i){n.projectId?n.email==r.getLoggedInEmail()?(i.home(),e.$emit("toast-message",s.successMessages[n.msg])):(s.setAlert(s.successMessages[n.msg]),a.clearAll(),r.setRequestLoginEmail(n.email),t.go("/login")):(s.setAlert(s.errorMessages[n.msg]),"EMAIL_NOT_FOUND"===n.msg?(a.clearAll(),r.setRequestLoginEmail(n.email),t.go("/register")):a.logout())}]}).state("/approve-invitation",{url:"/approve-invitation?msg&email&projectId",onEnter:["$rootScope","$state","$stateParams","message","userModel","project","user","sharedData",function(e,t,n,s,r,o,a,i){n.projectId?n.email===r.getLoggedInEmail()?(e.$emit("toast-message",s.successMessages[n.msg]),i.home()):(s.setAlert(s.successMessages[n.msg]),a.clearAll(),r.setRequestLoginEmail(n.email),t.go("/login")):e.$emit("toast-message",s.successMessages[n.msg])}]}).state("/project/edit",{url:"/project/edit/:id",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/project/edit_project.html"}},state:"project",cache:!1,requireLogin:!0,title:"Project_Edit"}).state("/project/details",{url:"/project/details/:id?focusMe",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return n?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"project",cache:!1,requireLogin:!0,isListView:!0,sortKey:"project",title:"Project_Task_List"}).state("/project/users",{url:"/project/users/:id",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"viewUsersProjectController",templateUrl:"html/views/partials/project/view_users_project.html"}},state:"project",cache:!1,requireLogin:!0,title:"Project_Users"}).state("/project/invite",{url:"/project/invite/:id",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/project/invite_project.html"}},state:"project",cache:!1,requireLogin:!0,title:"Project_Invite"}).state("/approve-admin-invitation",{url:"/approve-admin-invitation?msg&email&projectId",onEnter:["$rootScope","$state","$stateParams","message","userModel","project","user","sharedData","stringService","$ionicPopup",function(e,t,n,s,r,o,a,i,c,l){if(n.projectId)r.isAuthenticated()&&n.email===r.getLoggedInEmail()?(e.$emit("toast-message",s.infoMessages[n.msg]),i.home()):(s.setAlert(s.infoMessages[n.msg]),a.logout(),r.setRequestLoginEmail(n.email),t.go("/login"));else{var u=s.errorMessages[n.msg];u&&l.alert({title:u.title,content:u.message,buttons:[{text:c.OK,onTap:function(){return r.isAuthenticated()?i.home():t.go("/login"),!1}}]})}}]})}])}.call(this),function(){app.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("/",{url:"/",onEnter:["sharedData","$state","userModel",function(e,t,n){n.isAuthenticated()?e.home():t.go("/login")}]}).state("/api-response",{url:"/api-response?state&param1&param2",onEnter:["$state","$stateParams","message","userModel","user",function(e,t,n,s,r){switch(t.state){case"login":t.param2?(n.setAlert(n.successMessages[t.param1]),s.setRequestLoginEmail(t.param2)):n.setAlert(n.errorMessages[t.param1]),s.isAuthenticated()&&r.logout(),e.go("/login")}}]}).state("/login",{url:"/login?returnUrl&params",views:{header:{templateUrl:"html/views/partials/login/header.html"},main:{controller:"loginController",templateUrl:"html/views/partials/login/login.html"}},cache:!1,requireLogin:!1,title:"Login"}).state("/register",{url:"/register",views:{header:{templateUrl:"html/views/partials/login/header.html"},main:{controller:"registerController",templateUrl:"html/views/partials/login/register.html"}},params:{accountDeleted:!1},cache:!1,requireLogin:!1,title:"Register"}).state("/activate",{url:"/activate?id",views:{main:{controller:"activateController",templateUrl:"html/views/shared/_blank.html"}},cache:!1,requireLogin:!1,title:"Activation"}).state("/forgot-password",{url:"/forgot-password",views:{header:{templateUrl:"html/views/partials/login/header.html"},main:{controller:"forgotPasswordController",templateUrl:"html/views/partials/login/forgot-password.html"}},cache:!1,requireLogin:!1,title:"Forgot_Password"}).state("/reset-password",{url:"/reset-password/:id",onEnter:["$rootScope","user","userModel",function(e,t,n){t.clearAll(),e.loggedIn=n.isAuthenticated()}],views:{header:{templateUrl:"html/views/partials/login/header.html"},main:{controller:"resetPasswordController",templateUrl:"html/views/partials/login/reset-password.html"}},cache:!1}),t.otherwise("/")}])}.call(this),function(){app.config(["$stateProvider",function(e){e.state("/settings",{url:"/settings",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"indexSettingController",templateUrl:"html/views/partials/settings/index.html"}},cache:!1,requireLogin:!0,title:"Settings"}).state("/settings/about",{url:"/settings/about",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"aboutSettingController",templateUrl:"html/views/partials/settings/about.html"}},cache:!1,requireLogin:!0,title:"Settings_About"}).state("/settings/general",{url:"/settings/general",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"generalSettingController",templateUrl:"html/views/partials/settings/general.html"}},cache:!1,requireLogin:!0,title:"Settings_General"}).state("/settings/reminder",{url:"/settings/reminder",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"reminderSettingController",templateUrl:"html/views/partials/settings/reminder.html"}},cache:!1,requireLogin:!0,title:"Settings_Reminders"}).state("/settings/notifications",{url:"/settings/notifications",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"notificationsSettingController",templateUrl:"html/views/partials/settings/notifications.html"}},cache:!1,requireLogin:!0,title:"Settings_Notifications"}).state("/settings/test",{url:"/settings/test",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"testSettingController",templateUrl:"html/views/partials/settings/test.html"}},cache:!1,requireLogin:!0}).state("/settings/account",{url:"/settings/account",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"accountSettingController",templateUrl:"html/views/partials/settings/account.html"}},cache:!1,requireLogin:!0,title:"Settings_Account"}).state("/update-email-confirm",{url:"/update-email-confirm?msg&email",onEnter:["$rootScope","$state","$stateParams","message","userModel","project","user",function(e,t,n,s,r,o,a){n.email?(s.setAlert(s.successMessages[n.msg]),r.setRequestLoginEmail(n.email)):s.setAlert(s.errorMessages[n.msg]),a.clearAll(),t.go("/login")}]})}])}.call(this),function(){app.config(["$stateProvider",function(e){var t=ionic.Platform.platform(),n="android"===t||"ios"===t;e.state("/task/list/",{url:"/task/list/:type/:id",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return n?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"task",cache:!1,requireLogin:!0,isListView:!0,skipNavigation:!0,skipParams:{type:["project","label","filter","assignee"]},sortKey:"list",title:"Fixed_Filters_Task_List"}).state("/task/closed",{url:"/task/closed?tasks",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return n?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"closed",cache:!1,requireLogin:!0,isListView:!0,sortKey:"closed",title:"Task_Closed_View"}).state("/task/add",{url:"/task/add",views:{header:{controller:"taskHeaderController",templateUrl:"html/views/shared/_task_header.html"},main:{templateUrl:"html/views/partials/task/add_task.html"}},cache:!1,requireLogin:!0,title:"Task_Add"}).state("/task/edit",{url:"/task/edit/:id?showType",views:{header:{controller:"taskHeaderController",templateUrl:"html/views/shared/_task_header.html"},main:{templateUrl:function(){return n?"html/views/partials/task/edit-task-mobile.html":"html/views/partials/task/edit-task-web.html"}}},state:"task",cache:!1,requireLogin:!0,stateGroup:"task-edit",title:"Task_Edit"}).state("/task/note",{url:"/task/note/:id?focusMe",views:{header:{controller:"taskHeaderController",templateUrl:"html/views/shared/_task_header.html"},main:{controller:"noteTaskController",templateUrl:"html/views/partials/task/note.html"}},state:"task",cache:!1,requireLogin:!0,stateGroup:"task-edit",title:"Task_Notes"}).state("/task/my-feed",{url:"/task/my-feed",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskMyFeedController",templateUrl:"html/views/partials/task/my-feed.html"}},cache:!1,requireLogin:!0,title:"My_Feeds"})}])}.call(this),function(){app.controller("addFilterController",["$rootScope","$scope","labelService","project","filterService","discardChange","dbEnums","guidGenerator","message","sharedData","taskService","userModel","roleValidators","$state",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p){t.isAllAssigneeSelected=function(){for(var e=!0,n=0;n<t.assignees.length;n++)e=e&&t.assignees[n].checked;return t.filter.allAssignees=e,t.filter.allAssignees},t.isAllLabelSelected=function(){for(var e=!0,n=0;n<t.labels.length;n++)e=e&&t.labels[n].checked;return t.filter.allLabels=e,t.filter.allLabels},t.isAllPrioritySelected=function(){for(var e=!0,n=0;n<t.priorities.length;n++)e=e&&t.priorities[n].checked;return t.filter.allPriorities=e,t.filter.allPriorities},t.isAllProjectSelected=function(){for(var e=!0,n=0;n<t.projects.length;n++)e=e&&t.projects[n].checked;return t.filter.allProjects=e,t.filter.allProjects},t.selectAllAssignees=function(){for(var e=0;e<t.assignees.length;e++)t.assignees[e].checked=t.filter.allAssignees},t.selectAllLabels=function(){for(var e=0;e<t.labels.length;e++)t.labels[e].checked=t.filter.allLabels},t.selectAllPriorities=function(){for(var e=0;e<t.priorities.length;e++)t.priorities[e].checked=t.filter.allPriorities},t.selectAllProjects=function(){for(var e=0;e<t.projects.length;e++)t.projects[e].checked=t.filter.allProjects},t.getProjects=function(){t.projects=[],s.getAll().then(function(e){e&&(e.splice(0,0,l.inbox),e.forEach(function(e){t.projects.push({checked:!1,project:e})}))})},t.getAssignees=function(){t.assignees=[],s.getAllProjectsUsers().then(function(e){e&&(e.forEach(function(e){t.assignees.push({checked:!1,assignee:e})}),t.assignees=d.meTopOnList(t.assignees,"assignee"))})},t.getPriorities=function(){t.priorities=[];for(var e in u.priorities)t.priorities.push({checked:!1,priority:u.priorities[e]})},t.getLabels=function(){t.labels=[],n.getAll().then(function(e){e&&e.forEach(function(e){t.labels.push({checked:!1,label:e})})})},t.save=function(){if(t.form.$submitted=!0,t.form.$valid){var n=d.getLoggedInUser();f.checkUserRole(n,a.USER_ROLES.CUSTOM_FILTERS,{},!0).then(function(){t.filter.id=i.getId(),t.filter.userId=d.getLoggedInId(),t.filter.projects=t.filter.allProjects?[]:r.setProjects(t.projects),t.filter.assignees=t.filter.allAssignees?[]:r.setAssignees(t.assignees),t.filter.priorities=t.filter.allPriorities?[]:r.setPriorities(t.priorities),t.filter.labels=t.filter.allLabels?[]:r.setLabels(t.labels),t.filter.status=a.status.active,t.filter.date_created=new Date,t.filter.date_modified=new Date,r.addOrUpdate(t.filter).then(function(n){n&&(t.form.$setPristine(),t.form.$setUntouched(),t.filter={},e.$emit("toast-message",c.successMessages.FILTER_SAVED),o.updateDiscardedBeforeSave(),p.go("/filter/details",{id:n.id}))})})}},t.start=function(){t.fields=angular.copy(r.fields),t.dueDates=r.dueDates,t.filter={allProjects:!1,allAssignees:!1,allPriorities:!1,allLabels:!1},e.title="Add Filter",t.getProjects(),t.getAssignees(),t.getPriorities(),t.getLabels(),e.$emit("basic:header",null,null,t,!0,null,!0),o.savePrevious(t,t.filter)},t.toggleMenu=function(e){switch(e){case"project":t.fields.project=!t.fields.project;break;case"assignees":t.fields.assignees=!t.fields.assignees;break;case"priority":t.fields.priority=!t.fields.priority;break;case"label":t.fields.label=!t.fields.label;break;case"dueDate":t.fields.dueDate=!t.fields.dueDate}},t.start(),t.$on("$stateChangeStart",function(e,n,s){o.changeState(e,n,s,t.filter)})}])}.call(this),function(){app.controller("editFilterController",["$rootScope","$state","$scope","$stateParams","project","taskService","labelService","filterService","message","sharedData","userModel","discardChange","dbEnums","roleValidators",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p){n.isAllAssigneeSelected=function(){for(var e=!0,t=0;t<n.assignees.length;t++)e=e&&n.assignees[t].checked;return n.filter.allAssignees=e,n.filter.allAssignees},n.isAllLabelSelected=function(){for(var e=!0,t=0;t<n.labels.length;t++)e=e&&n.labels[t].checked;return n.filter.allLabels=e,n.filter.allLabels},n.isAllPrioritySelected=function(){for(var e=!0,t=0;t<n.priorities.length;t++)e=e&&n.priorities[t].checked;return n.filter.allPriorities=e,n.filter.allPriorities},n.isAllProjectSelected=function(){for(var e=!0,t=0;t<n.projects.length;t++)e=e&&n.projects[t].checked;return n.filter.allProjects=e,n.filter.allProjects},n.selectAllAssignees=function(){for(var e=0;e<n.assignees.length;e++)n.assignees[e].checked=n.filter.allAssignees},n.selectAllLabels=function(){for(var e=0;e<n.labels.length;e++)n.labels[e].checked=n.filter.allLabels},n.selectAllPriorities=function(){for(var e=0;e<n.priorities.length;e++)n.priorities[e].checked=n.filter.allPriorities},n.selectAllProjects=function(){for(var e=0;e<n.projects.length;e++)n.projects[e].checked=n.filter.allProjects},n.getProjects=function(e,t){n.projects=[],r.getAll().then(function(s){s&&(s.splice(0,0,l.inbox),s.forEach(function(s){for(var r=!!t,o=0;o<e.length;o++)if(s.id===e[o]._id){r=!0;break}n.projects.push({checked:r,project:s})}))})},n.getAssignees=function(e,t){n.assignees=[],r.getAllProjectsUsers().then(function(s){s&&(s.forEach(function(s){for(var r=!!t,o=0;o<e.length;o++)if(s._id===e[o]._id){r=!0;break}n.assignees.push({checked:r,assignee:s})}),n.assignees=u.meTopOnList(n.assignees,"assignee"))})},n.getPriorities=function(e,t){n.priorities=[];for(var s in o.priorities){for(var r=o.priorities[s],a=!!t,i=0;i<e.length;i++)if(r.name==e[i].name){a=!0;break}n.priorities.push({checked:a,priority:r})}},n.getLabels=function(e,t){n.labels=[],a.getAll().then(function(s){s&&s.forEach(function(s){for(var r=!!t,o=0;o<e.length;o++)if(s.id===e[o]._id){r=!0;break}n.labels.push({checked:r,label:s})})})},n.save=function(){if(n.form.$submitted=!0,n.form.$valid)if(d.isChanged(n.project)){var s=u.getLoggedInUser();p.checkUserRole(s,f.USER_ROLES.CUSTOM_FILTERS,{},!0).then(function(){n.filter.projects=i.setProjects(n.projects),n.filter.assignees=i.setAssignees(n.assignees),n.filter.priorities=i.setPriorities(n.priorities),n.filter.labels=i.setLabels(n.labels),i.addOrUpdate(n.filter).then(function(s){s&&(e.$emit("toast-message",c.successMessages.FILTER_EDITED),e.$emit("filterList-update"),d.updateDiscardedBeforeSave(),t.go("/filter/details",{id:n.filter.id}))})})}else d.updateDiscardedBeforeSave(),t.go("/filter/details",{id:n.filter.id})},n.start=function(){i.findById(s.id).then(function(s){s?(n.fields=angular.copy(i.fields),n.dueDates=i.dueDates,n.filter=s,e.title=n.filter.name,n.getProjects(n.filter.projects,n.filter.allProjects),n.getAssignees(n.filter.assignees,n.filter.allAssignees),n.getPriorities(n.filter.priorities,n.filter.allPriorities),n.getLabels(n.filter.labels,n.filter.allLabels),e.$emit("basic:header",t.current.state,n.filter,n,!0),d.savePrevious(n,n.filter)):l.home()})},n.toggleMenu=function(e){switch(e){case"project":n.fields.project=!n.fields.project;break;case"assignees":n.fields.assignees=!n.fields.assignees;break;case"priority":n.fields.priority=!n.fields.priority;break;case"label":n.fields.label=!n.fields.label;break;case"dueDate":n.fields.dueDate=!n.fields.dueDate}},n.start(),n.$on("$stateChangeStart",function(e,t,s){d.changeState(e,t,s,n.filter)})}])}.call(this),function(){app.controller("addLabelController",["$rootScope","$scope","$ionicModal","discardChange","userModel","guidGenerator","dbEnums","sharedData","labelService","message",function(e,t,n,s,r,o,a,i,c,l){t.selectColor=function(e){t.label.color=e},t.saveKeyEnter=function(e){console.log("sds"),13==e.keyCode&&t.save()},t.save=function(){t.form.$submitted=!0,t.form.$valid&&(t.label.id=o.getId(),t.label.userId=r.getLoggedInId(),t.label.tasks=[],t.label.status=a.status.active,t.label.date_created=new Date,t.label.date_modified=new Date,c.addOrUpdate(t.label).then(function(n){n&&(t.form.$setPristine(),t.form.$setUntouched(),t.label={},e.$emit("toast-message",l.successMessages.LABEL_SAVED),e.$emit("labelList-update"),s.updateDiscardedBeforeSave(),i.home())}))},t.start=function(){t.label={},t.colors=i.colorsCodes(),e.title="Add Label",e.$emit("basic:header",null,null,t,!0,null,!0),s.savePrevious(t,t.label),n.fromTemplateUrl("html/views/modals/colour_codes.html",function(e){t.modal=e},{scope:t,animation:"scale-in"})},t.start(),e.$on("$stateChangeStart",function(e,n,r){t.modal.remove(),s.changeState(e,n,r,t.label)})}])}.call(this),function(){app.controller("editLabelController",["$rootScope","$state","$scope","$ionicModal","$stateParams","labelService","sharedData","message","discardChange",function(e,t,n,s,r,o,a,i,c){n.selectColor=function(e){n.label.color=e},n.saveKeyEnter=function(e){13==e.keyCode&&n.save()},n.save=function(){n.form.$submitted=!0,n.form.$valid&&(c.isChanged(n.label)?o.addOrUpdate(n.label).then(function(t){t&&(e.$emit("toast-message",i.successMessages.LABEL_EDITED),e.$emit("labelList-update"),c.updateDiscardedBeforeSave(),a.home())}):(c.updateDiscardedBeforeSave(),a.home()))},n.start=function(){o.findById(r.id).then(function(s){s?(n.label=s,e.title=n.label.name,n.colors=a.colorsCodes(),e.$emit("basic:header",t.current.state,n.label,n,!0),c.savePrevious(n,n.label)):a.home()}),s.fromTemplateUrl("html/views/modals/colour_codes.html",function(e){n.modal=e},{scope:n,animation:"scale-in"})},n.start(),e.$on("$stateChangeStart",function(e,t,s){n.modal.remove(),c.changeState(e,t,s,n.label)})}])}.call(this),function(){app.controller("forgotPasswordController",["$scope","user",function(e,t){e.change=function(){e.alert=null},e.showMessage=function(t){e.alert={title:t.title,msg:t.message,success:t.success}},e.start=function(){e.credentials={}},e.submit=function(n){n.$valid&&t.forgotPassword(e.credentials).then(function(t){e.alert=null,t.error&&(e.showMessage(t.message),n.$setPristine(),n.$setUntouched(),e.credentials={})})},e.start()}])}.call(this),function(){app.controller("loginController",["$scope","$stateParams","$state","$ionicLoading","TodoZuDB","user","sharedData","message","userModel","pushNotification","connectivity","$timeout","$q","$rootScope",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p){e.credentials={},e.isReady=!1,e.showMessage=function(t){e.alert={title:t.title,msg:t.message,success:t.success}},e.login=function(){r.dropDatabase(),e.credentials.email&&e.credentials.password&&(e.credentials.deviceInfo=e.credentials.deviceInfo||{},e.credentials.deviceInfo.uid=c.getDeviceUniqueId(),e.credentials.deviceInfo.device_type=ionic.Platform.platform(),e.credentials.deviceInfo.device_token=c.getDeviceToken(),s.show(),p.isLoginProgress=!0,o.login(e.credentials).then(function(t){e.alert={},t.error?e.showMessage(t.message):(a.home(),p.$emit("connect-socket"),p.$emit("login-success"))}).finally(function(){p.isLoginProgress=!1,d(function(){s.hide()},200)}))},e.start=function(){u.checkConnection()&&(e.credentials.deviceInfo={uid:c.getDeviceUniqueId(),device_type:ionic.Platform.platform(),device_token:c.getDeviceToken()});var t=c.getRequestLoginEmail();t&&(e.credentials.email=t,
c.removeRequestLoginEmail()),e.alert=i.getAlert(),i.clearAlert()},e.start()}])}.call(this),function(){app.controller("registerController",["$scope","$rootScope","user","userModel","message","$stateParams",function(e,t,n,s,r,o){e.showMessage=function(t){e.alert={title:t.title,msg:t.message,success:t.success}},e.submit=function(t){t.$valid&&n.register(e.user).then(function(n){e.alert={},n.error&&(e.showMessage(n.message),t.$setPristine(),t.$setUntouched(),e.user={})})},e.start=function(){e.user={};var n=s.getRequestLoginEmail();n&&(e.user.email=n,s.removeRequestLoginEmail()),e.alert=r.getAlert(),r.clearAlert(),o.accountDeleted&&t.$emit("toast-message",r.successMessages.ACCOUNT_DELETED)},e.start()}])}.call(this),function(){app.controller("resetPasswordController",["$scope","user","$stateParams",function(e,t,n){e.resetAlert=function(){e.alert=null},e.showMessage=function(t){e.alert={title:t.title,msg:t.message,success:t.success}},e.start=function(){e.credentials={token:n.id}},e.submit=function(n){n.$valid&&t.resetPassword(e.credentials).then(function(t){e.resetAlert(),t.error&&(e.showMessage(t.message),n.$setPristine(),n.$setUntouched(),e.start())})},e.start(),e.resetpassword=function(){t.resetpassword(e.resetpasswordform).then(function(t){e.submitted=!1,e.alertbox=!0,e.alertTitle=t.title,e.alertMsg=t.msg,e.success=t.status,e.resetpasswordform.$setPristine()})}}])}.call(this),function(){app.controller("addProjectController",["$rootScope","$state","$scope","$ionicModal","userModel","discardChange","project","guidGenerator","dbEnums","sharedData","message","$q","roleValidators",function(e,t,n,s,r,o,a,i,c,l,u,d,f){n.openModal=function(){n.modal.show()},n.selectColor=function(e){n.project.color=e},n.saveKeyEnter=function(e){13==e.keyCode&&n.save()},n.save=function(){if(n.form.$submitted=!0,n.form.$valid){n.project.id=i.getId(),n.project.status=c.status.active,n.project.date_created=new Date,n.project.date_modified=new Date,n.project.updatedBy=r.getLoggedInUser(),n.project.users=[{_id:r.getLoggedInId(),lastName:r.getLoggedInLastName(),firstName:r.getLoggedInFirstName(),displayName:r.getLoggedInName(),displayShortName:r.getLoggedInShortName(),avatar:r.getAvatar(),isAdmin:!0,email:r.getLoggedInEmail(),role:c.projectUserRole.admin,status:c.status.active}];var t=r.getLoggedInUser(),s=d(function(e,n){return f.checkUserRole(t,c.USER_ROLES.ACTIVE_PROJECTS,{user:t},!0).then(e,n)});s.then(function(){a.addOrUpdate(n.project).then(function(t){t&&(n.form.$setPristine(),n.form.$setUntouched(),n.project={},e.$emit("toast-message",u.successMessages.PROJECT_SAVED),e.$emit("projectList-update"),o.updateDiscardedBeforeSave(),l.home())})})}},n.start=function(){n.project={},n.colors=l.colorsCodes(),e.title="Add Project",e.$emit("basic:header",null,null,n,!0,null,!0),o.savePrevious(n,n.project),s.fromTemplateUrl("html/views/modals/colour_codes.html",function(e){n.modal=e},{scope:n,animation:"scale-in"})},n.start(),n.$on("$stateChangeStart",function(e,t,s){n.modal.remove(),o.changeState(e,t,s,n.project)})}])}.call(this),function(){app.controller("editProjectController",["$rootScope","$state","$scope","$ionicModal","$stateParams","userModel","$timeout","sharedData","project","message","discardChange",function(e,t,n,s,r,o,a,i,c,l,u){n.openModal=function(){n.modal.show()},n.selectColor=function(e){n.project.color=e,n.project.border="none"},n.saveKeyEnter=function(e){13==e.keyCode&&n.save()},n.save=function(){n.form.$submitted=!0,n.form.$valid&&(u.isChanged(n.project)?(n.project.updatedBy=o.getLoggedInUser(),c.addOrUpdate(n.project,!0).then(function(t){t&&(e.$emit("toast-message",l.successMessages.PROJECT_EDITED),e.$emit("projectList-update"),u.updateDiscardedBeforeSave(),i.home())})):(u.updateDiscardedBeforeSave(),i.home()))},n.start=function(){c.findById(r.id).then(function(s){s?(n.project=s,e.title=n.project.name,n.colors=i.colorsCodes(),e.$emit("basic:header",t.current.state,n.project,n,!0),u.savePrevious(n,n.project)):i.home()}),s.fromTemplateUrl("html/views/modals/colour_codes.html",function(e){n.modal=e},{scope:n,animation:"scale-in"})},n.start(),n.$on("$stateChangeStart",function(e,t,s){n.modal.remove(),u.changeState(e,t,s,n.project)})}])}.call(this),function(){app.controller("inviteProjectController",["$rootScope","$scope","$state","$ionicPopup","$stateParams","project","sharedData","message","stringService","dbEnums","userModel","roleValidators",function(e,t,n,s,r,o,a,i,c,l,u,d){function f(e){for(var n=null,s=0;s<t.allUsers.length;s++)if(t.allUsers[s].email==e){n=t.allUsers[s];break}n||(n={email:e,displayName:e,displayShortName:c.firstLetter(e)});var r=o.getProjectAdmin(t.project)._id===u.getLoggedInId();return n.isInviterAdmin=r,n.invitedBy=u.getLoggedInId(),n.role=r?l.projectUserRole.pending:l.projectUserRole.approval,n.invitationPending=!0,n.isAdmin=!1,n}function p(e,t){for(var n=0;n<e.users.length;n++)if(e.users[n].email===t)return!0;return!1}function m(n,s){switch(n){case g.send:o.sendInvitation(t.project,f(t.invitation.email)).then(function(){t.form.$setPristine(),t.form.$setUntouched(),t.invitation={}});break;case g.resend:var r={projectId:t.project.id,user:s};o.reSendInvitation(r).then(function(t){e.$emit("toast-message",t.message)});break;case g.cancel:o.deleteUser(t.project,s).then(function(){e.$emit("toast-message",i.successMessages.PROJECT_INVITATION_CANCELLED)});break;case g.remove:o.deleteUser(t.project,s).then(function(){e.$emit("toast-message",i.successMessages.PROJECT_USER_DELETED)})}}var g={send:"send",resend:"resend",cancel:"cancel",remove:"remove"};t.invitationPopUp=function(e,n,r){s.show({title:n.title,template:n.message,scope:t,buttons:[{text:c.NO,type:"btn-no",onTap:function(){return t.form.$submitted=!1,!0}},{text:c.YES,type:"btn-yes",onTap:function(){m(e,r)}}]})},t.save=function(){if(t.form.$submitted=!0,t.form.$valid)if(t.invitation.email=t.selectedUser?t.selectedUser.originalObject.email:t.form.iEmail.$$rawModelValue,console.log(t.invitation.email),p(t.project,t.invitation.email))t.form.$setPristine(),t.form.$setUntouched(),t.invitation={},e.$emit("toast-message",i.errorMessages.EMAIL_ALREADY_EXISTS);else{var n=u.getLoggedInUser();d.checkUserRole(n,l.USER_ROLES.MAX_USERS_PROJECT,{project:t.project},!0).then(function(){var e=o.getProjectUserById(t.project,u.getLoggedInId());t.invitationPopUp(g.send,e.isAdmin?i.infoMessages.PROJECT_INVITATION_SENT_BY_ADMIN:i.infoMessages.PROJECT_INVITATION_SENT_BY_USER)})}},t.deleteUser=function(e){t.invitationPopUp(g.remove,i.infoMessages.PROJECT_USER_DELETED,e)},t.reSendInvitation=function(e){t.invitationPopUp(g.resend,i.infoMessages.PROJECT_INVITATION_RESENT,e)},t.deleteInvitation=function(e){t.invitationPopUp(g.cancel,i.infoMessages.PROJECT_INVITATION_CANCELLED,e)},t.start=function(){o.findById(r.id).then(function(s){s?(t.project=s,t.project.users=u.adminTopOnList(t.project.users),t.invitation={},e.title="Invite: "+t.project.name,t.loginId=u.getLoggedInId(),t.canDeleteUser=o.canDeleteUser(s,u.getLoggedInUser()),e.$emit("basic:header",n.current.state,t.project,t,!0,"Send")):a.home()}),o.getAllProjectsUsers().then(function(e){t.allUsers=e})},t.start();var v=e.$on("projectList-update",function(){o.findById(r.id).then(function(e){e&&(t.project=e)})});t.$on("$destroy",function(){v()}),t.searchInputFocus=function(){var e=u.getLoggedInUser();e&&d.checkUserRole(e,l.USER_ROLES.MAX_USERS_PROJECT,{project:t.project,invitedUser:invitedUser},!0)}}])}.call(this),function(){app.controller("viewUsersProjectController",["$rootScope","$scope","$state","$ionicPopup","$stateParams","project","sharedData","message","stringService","userModel",function(e,t,n,s,r,o,a,i,c,l){function u(n,s){switch(n){case d.send:o.sendInvitation(t.project,getInvitedUser(t.invitation.email)).then(function(){t.form.$setPristine(),t.form.$setUntouched(),t.invitation={}});break;case d.resend:var r={projectId:t.project.id,user:s};o.reSendInvitation(r).then(function(t){e.$emit("toast-message",t.message)});break;case d.cancel:o.deleteUser(t.project,s).then(function(){e.$emit("toast-message",i.successMessages.PROJECT_INVITATION_CANCELLED)});break;case d.remove:o.deleteUser(t.project,s).then(function(){e.$emit("toast-message",i.successMessages.PROJECT_USER_DELETED)})}}var d={send:"send",resend:"resend",cancel:"cancel",remove:"remove"};t.invitationPopUp=function(e,n,r){s.show({title:n.title,template:n.message,scope:t,buttons:[{text:c.NO,type:"btn-no",onTap:function(){return!0}},{text:c.YES,type:"btn-yes",onTap:function(){u(e,r)}}]})},t.deleteUser=function(e){t.invitationPopUp(d.remove,i.infoMessages.PROJECT_USER_DELETED,e)},t.reSendInvitation=function(e){t.invitationPopUp(d.resend,i.infoMessages.PROJECT_INVITATION_RESENT,e)},t.deleteInvitation=function(e){t.invitationPopUp(d.cancel,i.infoMessages.PROJECT_INVITATION_CANCELLED,e)},t.start=function(){o.findById(r.id).then(function(s){s?(t.project=s,t.project.users=l.adminTopOnList(t.project.users),e.title="Users: "+t.project.name,t.loginId=l.getLoggedInId(),t.canDeleteUser=o.canDeleteUser(s,l.getLoggedInUser()),e.$emit("basic:header",n.current.state,t.project,t)):a.home()}),o.getAllProjectsUsers().then(function(e){t.allUsers=e})},t.start();var f=e.$on("projectList-update",function(){o.findById(r.id).then(function(e){e&&(t.project=e)})});t.$on("$destroy",function(){f()})}])}.call(this),function(){app.controller("aboutSettingController",["$rootScope","$scope","$state","$window","CONSTANT",function(e,t,n,s,r){t.redirectTo=function(e){n.transitionTo(e)},t.openWebsite=function(){s.open(t.websiteURL,"_blank")},t.start=function(){t.title="About",t.websiteURL=r.website,t.version=r.version;var n=ionic.Platform.platform();t.currentPlatform="ios"==n?"iOS":_.capitalize(ionic.Platform.platform()),t.currentPlatformVersion=ionic.Platform.version(),e.$emit("basic:header",null,null,t,!1,null,!0)},t.start()}])}.call(this),function(){app.controller("accountSettingController",["$rootScope","$scope","$state","$ionicModal","user","settingsService","stringService","message","userModel","dbEnums","connectivity","$ionicLoading",function(e,t,n,s,r,o,a,i,c,l,u,d){function f(){t.userProfile={name:c.getLoggedInName(),email:c.getLoggedInEmail(),displayShortName:c.getLoggedInShortName(),avatar:c.getAvatar()}}function p(){t.dropdowns={profile:!0,account:!0}}function m(){s.fromTemplateUrl("html/views/modals/settings/account/account_delete_failure.html",function(e){t.accountDeleteFailureModal=e,t.accountDeleteFailureModal.show()},{scope:t,animation:"scale-in"})}function g(e){var n=!1;t.accountDeleteValidateModel=t.accountDeleteValidateModel||{},t.accountDeleteValidateModel.$error={},_.each(e.reasons,function(e){t.accountDeleteValidateModel.$error[e.key]=e.value,"password"==e.key&&(n=!0)}),n||(t.accountDeleteFailureReasons=e.reasons,m())}t.openUserNameModal=function(){t.userNameModel={firstName:c.getLoggedInFirstName(),lastName:c.getLoggedInLastName()},s.fromTemplateUrl("html/views/modals/settings/account/user_name_update.html",function(e){t.userNameModal=e,t.userNameModal.show()},{scope:t,animation:"scale-in"})},t.closeUserNameModal=function(e){e.preventDefault(),t.userNameModal.remove()},t.updateUserName=function(){t.userNameModal.remove(),o.updateUserName(t.userNameModel).then(function(t){e.$emit("toast-message",t.msg)})},t.openUserEmailModal=function(){t.userEmailModel={email:c.getLoggedInEmail(),password:a.EMPTY},s.fromTemplateUrl("html/views/modals/settings/account/user_email_update.html",function(e){t.userEmailModal=e,t.userEmailModal.show()},{scope:t,animation:"scale-in"})},t.closeUserEmailModal=function(e){e.preventDefault(),t.userEmailModal.remove()},t.updateUserEmail=function(){t.userEmailModal.remove(),o.updateEmail(t.userEmailModel).then(function(t){e.$emit("toast-message",t.msg)})},t.openUserPasswordModal=function(){t.userPasswordModel={},s.fromTemplateUrl("html/views/modals/settings/account/user_password_update.html",function(e){t.userPasswordModal=e,t.userPasswordModal.show()},{scope:t,animation:"scale-in"})},t.closeUserPasswordModal=function(e){e.preventDefault(),t.userPasswordModal.remove()},t.updateUserPassword=function(){t.userPasswordModal.remove(),o.updatePassword(t.userPasswordModel).then(function(t){t.error||(c.setRequestLoginEmail(c.getLoggedInEmail()),r.clearAll(),n.go("/login")),e.$emit("toast-message",t.msg)})},t.redirectTo=function(e){n.transitionTo(e)},t.toggleDropdown=function(e){t.dropdowns[e]=!t.dropdowns[e]},t.logout=function(){r.logout()},t.start=function(){t.title="My Account",p(),f(),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!1),e.$emit("basic:header",null,null,t,!1,null,!0)},t.start();var v=e.$on("userInfo-update",function(){f(),n.reload()}),h=function(){s.fromTemplateUrl("html/views/modals/settings/account/account_delete_warning.html",function(e){t.accountDeleteWarning=e,t.accountDeleteWarning.show()},{scope:t,animation:"scale-in"})};t.closeDeleteAccountModal=function(e){e.preventDefault(),t.accountDeleteWarning.remove()},t.deleteAccountValidate=function(e){e.preventDefault(),t.accountDeleteWarning.remove(),t.accountDeleteValidateModel={deleteText:"",password:"",DELETE_VALIDATION_REGEX:l.keys.DELETE_VALIDATION_REGEX},t.accountDeleteValidateModel.$error={},s.fromTemplateUrl("html/views/modals/settings/account/account_delete_validate_form.html",function(e){t.accountDeleteValidateForm=e,t.accountDeleteValidateForm.show()},{scope:t,animation:"scale-in"})},t.closeDeleteAccountValidateModal=function(e){e.preventDefault(),t.accountDeleteValidateForm.remove()},t.checkValidDeleteAccount=function(t){if(t.preventDefault(),u.isConnected()){var n={};n.userId=c.getLoggedInId(),d.show(),o.validateDeleteAccount(n).then(function(e){d.hide(),console.log("---- result from validate deleting account---");var t=e?e.data.response:void 0;console.log(t),t.result?h():g(t)},function(e){d.hide(),console.log("----error while deleting account-----"),console.log(e)})}else e.$emit("toast-message",i.errorMessages.CONNECTION_REQUIRED)},t.deleteAccount=function(s){if(s.preventDefault(),u.isConnected()){var a=t.accountDeleteValidateModel;a.userId=c.getLoggedInId(),d.show(),o.deleteAccount(a).then(function(e){d.hide(),console.log("---- result from deleting account---");var s=e?e.data.response:void 0;console.log(s),s.result?(t.accountDeleteValidateForm.remove(),r.clearAll(),n.go("/register",{accountDeleted:!0,reload:!0,notify:!1})):g(s)},function(e){d.hide(),console.log("----error while deleting account-----"),console.log(e)}).finally(function(){})}else e.$emit("toast-message",i.errorMessages.CONNECTION_REQUIRED)},t.$on("$stateChangeStart",function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!0)}),t.$on("$destroy",v)}])}.call(this),function(){app.controller("generalSettingController",["$rootScope","$scope","$state","$ionicModal","settingsService","discardChange","message",function(e,t,n,s,r,o,a){function i(){t.dropdowns={general:!0,dates:!0}}function c(){s.fromTemplateUrl("html/views/modals/settings/general/default_view.html",function(e){t.settingsDefaultViewModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/settings/general/float_button.html",function(e){t.settingsFloatButtonModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/settings/general/start_day.html",function(e){t.settingsStartDayModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/settings/general/date_format.html",function(e){t.settingsDateFormatModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/settings/general/time_format.html",function(e){t.settingsTimeFormatModal=e},{scope:t,animation:"scale-in"})}function l(){t.generalSettings=r.getSettings(),o.savePrevious(t,t.generalSettings)}t.redirectTo=function(e){n.transitionTo(e)},t.toggleDropdown=function(e){t.dropdowns[e]=!t.dropdowns[e]},t.setDefaultView=function(e){t.generalSettings.default_view=e},t.setFloatButton=function(e){t.generalSettings.float_button=e},t.setStartDay=function(e){t.generalSettings.start_day=e},t.setDateFormat=function(e){t.generalSettings.date_format=e},t.setTimeFormat=function(e){t.generalSettings.time_format=e},t.save=function(){o.isChanged(t.generalSettings)?r.update(t.generalSettings).then(function(){t.discarded=!0,e.$emit("toast-message",a.successMessages.SETTINGS_SAVED),o.updateDiscardedBeforeSave(),n.go("/settings")}):(o.updateDiscardedBeforeSave(),n.go("/settings"))},t.start=function(){t.title="General",i(),c(),l(),t.defaultViews=r.defaultViews,t.floatButtons=r.floatButtons,t.startDays=r.startDays,t.dateFormats=r.dateFormats,t.timeFormats=r.timeFormats,e.$emit("basic:header",null,null,t,!0,null,!0)},t.start();var u=e.$on("settings-update",function(){l()});t.$on("$destroy",u),t.$on("$stateChangeStart",function(e,n,s){o.changeState(e,n,s,t.generalSettings)})}])}.call(this),function(){app.controller("indexSettingController",["$rootScope","$scope","$state","settingsService",function(e,t,n,s){t.redirectTo=function(e){n.transitionTo(e)},t.start=function(){t.title="Settings",t.list=s.items,e.$emit("basic:header",null,null,t,!1,null,!0)},t.start()}])}.call(this),function(){app.controller("notificationsSettingController",["$rootScope","$scope","$state","settingsService","message","discardChange","userModel","dbEnums","roleValidators",function(e,t,n,s,r,o,a,i,c){function l(){t.dropdowns={tasks:!0,projects:!0}}function u(){t.settings=s.getSettings(),o.savePrevious(t,t.settings)}t.emailChangeDisabled=!0,t.toggleDropdown=function(e){t.dropdowns[e]=!t.dropdowns[e]},t.save=function(){o.isChanged(t.settings)?s.update(t.settings).then(function(){e.$emit("toast-message",r.successMessages.SETTINGS_SAVED),o.updateDiscardedBeforeSave(),n.go("/settings")}):(o.updateDiscardedBeforeSave(),n.go("/settings"))},t.start=function(){var n=a.getLoggedInUser();t.title="Notifications",u(),l(),e.$emit("basic:header",null,null,t,!0,null,!0),c.checkUserRole(n,i.USER_ROLES.EMAIL_NOTIFICATIONS,{},!1).then(function(){t.emailChangeDisabled=!1},function(e){"LICENSE"==e.key})},t.start();var d=e.$on("settings-update",function(){u()});t.$on("$destroy",d),t.$on("$stateChangeStart",function(e,n,s){o.changeState(e,n,s,t.settings)}),t.emailClick=function(e){if(t.emailChangeDisabled){var n=a.getLoggedInUser();c.checkUserRole(n,i.USER_ROLES.EMAIL_NOTIFICATIONS,{},!0)}}}])}.call(this),function(){app.controller("reminderSettingController",["$rootScope","$scope","settingsService","$ionicModal","date","$state","message","reminderService","discardChange","roleValidators","dbEnums","userModel","$q","DEFAULTS",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p){function m(){t.dropdowns={reminder:!0}}function g(){t.settings=n.getSettings(),c.savePrevious(t,t.settings)}function v(){s.fromTemplateUrl("html/views/modals/settings/reminder/auto-reminder-notification-channels.html",function(e){t.autoReminderNotificationChannelsModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/settings/reminder/auto-reminder-time.html",function(e){t.autoReminderTimeModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/settings/reminder/others-reminder-notification-channels.html",function(e){t.othersReminderNotificationChannelsModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/settings/reminder/task-create-reminder-notification-channels.html",function(e){t.taskCreateReminderNotificationChannelsModal=e},{scope:t,animation:"scale-in"})}t.isEmailEnabled=!1,t.channelClicked=function(e){var t=f(function(t,n){if("Email"==e.title&&0==e.value){var s=d.getLoggedInUser();l.checkUserRole(s,u.USER_ROLES.EMAIL_NOTIFICATIONS,{},!0).then(t,n)}else t()});t.then(function(){e.value=!e.value,e.notified=!e.value})},t.openAutoReminderNotificationChannelsModal=function(){t.notificationChannels=angular.copy(t.settings.reminder.autoReminder.channels),t.settings.reminder.autoReminder.enable&&t.autoReminderNotificationChannelsModal.show()},t.openOthersReminderNotificationChannelsModal=function(){t.notificationChannels=angular.copy(t.settings.reminder.othersReminderNotificationChannels),t.othersReminderNotificationChannelsModal.show()},t.openAutoReminderTimeModal=function(){t.settings.reminder.autoReminder.enable&&t.autoReminderTimeModal.show()},t.setAutoReminderNotificationChannels=function(){(t.notificationChannels.email.value||t.notificationChannels.push.value)&&(t.settings.reminder.autoReminder.channels=angular.copy(t.notificationChannels),t.notificationChannels=angular.copy(i.notificationChannels),t.autoReminderNotificationChannelsModal.hide())},t.setAutoReminderTime=function(e){t.settings.reminder.autoReminder.time=e},t.setOthersReminderNotificationChannels=function(){(t.notificationChannels.email.value||t.notificationChannels.push.value)&&(t.settings.reminder.othersReminderNotificationChannels=angular.copy(t.notificationChannels),t.notificationChannels=angular.copy(i.notificationChannels),t.othersReminderNotificationChannelsModal.hide())},t.openTaskCreateReminderNotificationChannelsModal=function(){t.notificationChannels=angular.copy(t.settings.reminder.taskCreateReminderNotificationChannels||p.defaultSettings.taskCreateReminderNotificationChannels),t.taskCreateReminderNotificationChannelsModal.show()},t.setTaskCreateReminderNotificationChannels=function(){(t.notificationChannels.email.value||t.notificationChannels.push.value)&&(t.settings.reminder.taskCreateReminderNotificationChannels=angular.copy(t.notificationChannels),t.notificationChannels=angular.copy(i.notificationChannels),t.taskCreateReminderNotificationChannelsModal.hide())},t.toggleDropdown=function(e){t.dropdowns[e]=!t.dropdowns[e]},t.save=function(){c.isChanged(t.settings)?n.update(t.settings).then(function(){e.$emit("toast-message",a.successMessages.SETTINGS_SAVED),c.updateDiscardedBeforeSave(),o.go("/settings")}):(c.updateDiscardedBeforeSave(),o.go("/settings"))},t.start=function(){t.title="Reminders";var n=d.getLoggedInUser();l.checkUserRole(n,u.USER_ROLES.EMAIL_NOTIFICATIONS,{},!1).then(function(){t.isEmailEnabled=!0}),m(),v(),g(),t.date=r,t.autoReminderTime=angular.copy(i.timeDuration),t.notificationChannels=angular.copy(i.notificationChannels),e.$emit("basic:header",null,null,t,!0,null,!0)},t.start(),t.$on("$stateChangeStart",function(e,n,s){c.changeState(e,n,s,t.settings)})}])}.call(this),function(){app.controller("testSettingController",["$rootScope","$scope","settingsService","$ionicModal",function(e,t,n,s){t.start=function(){t.title="Test",e.$emit("basic:header",null,null,t,!0,null,!0)},t.start()}])}.call(this),function(){app.controller("basicHeaderController",["$rootScope","$state","$ionicHistory","$scope","$ionicPopover","$ionicLoading","$ionicSideMenuDelegate","$ionicPopup","sharedData","project","labelService","filterService","user","rightMenuService","notificationService","navigationService","userModel",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g,v){function h(){r.fromTemplateUrl("html/views/popovers/top_right_popover.html",{scope:E}).then(function(e){E.popover=e}),r.fromTemplateUrl("html/views/popovers/notification_popover.html",{scope:E}).then(function(e){E.notificationBar=e})}var E=s,k={},T=null;s.items=[],v.isAuthenticated()&&m.getNoOfUnseen().then(function(e){s.NoNN=e}),E.buttonClicked=function(e){e&&e.stopPropagation(),T.save()},E.toggleMenu=function(){return a.toggleLeft()},E.menuItemClicked=function(e,t){E.popover.hide(),p.itemClicked(e,k,E,t)},E.back=function(){g.goBack()},E.home=function(){c.home()};var S=e.$on("basic:header",function(e,t,n,s,r,o,a){k=n,E.buttonEnabled=r,E.hasBackButton=a,E.buttonTitle=o||"Save",h(),p.setMenu(t,n),E.menus=p.getMenu(),T=s}),b=e.$on("NoNN-update",function(e,t){s.NoNN=t,s.$$phase||s.$apply()});E.$on("$destroy",function(){S(),b()})}])}.call(this),function(){app.controller("listHeaderController",["$rootScope","$scope","$state","$ionicSideMenuDelegate","date","sortService","platformService","$ionicPopover","rightMenuService","sharedData","notificationService","taskService","dbEnums","userModel","taskListView",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m){function g(){i.fromTemplateUrl("html/views/popovers/top_right_popover.html",{scope:h}).then(function(e){h.popover=e}),i.fromTemplateUrl("html/views/popovers/notification_popover.html",{scope:h}).then(function(e){h.notificationBar=e})}function v(t){t?1==t?e.numberOfTasks="1 task":e.numberOfTasks=t+" tasks":e.numberOfTasks="No tasks"}var h=t,E={},k={};h.sortService=o,t.searchBar={searchText:"",isVisible:!1},p.isAuthenticated()&&u.getNoOfUnseen().then(function(e){t.NoNN=e}),t.items=[],h.home=function(){l.home()},h.menuItemClicked=function(e,t){h.popover.hide(),c.itemClicked(e,E,h,t)},h.openNotificationBar=function(e){c.openNotificationBar(e,h)},h.save=function(){k&&k.save()},h.searchStart=function(){t.focused=!0,e.$emit("search:start",t.focused),e.$emit("search:tasks",t.searchBar.searchText),""==t.searchBar.searchText&&m.clearAllSelected()},h.sendSearchText=function(n){t.focused||(t.focused=!0,e.$emit("search:start",t.focused)),e.$emit("search:tasks",n)},h.searchOutOfFocus=function(n){t.focused=!1,e.$emit("search:start",(n||"").length>0)},h.clearClicked=function(){t.searchBar.searchText="",t.focused=!1,e.$emit("search:start",!1),t.searchBar.isVisible=!1},h.taskAdd=function(){n.current.state==l.STATE.PROJECT&&d.addProjectToTaskObject(E),n.go("/task/add")},h.toggleMenu=function(){return s.toggleLeft()},h.toggleSearchBar=function(n){t.searchBar.isVisible?t.searchOutOfFocus(n):(e.$emit("search:start",!0),e.$emit("search:tasks",""),m.clearAllSelected()),t.searchBar.isVisible=!t.searchBar.isVisible};var T=e.$on("task:header-taskList",function(e,t,n,s,r){E=s,v(n),g(),c.setMenu(t,s),h.menus=c.getMenu(),h.disabledOptions=r,o.setAll(void 0,void 0,t).then(function(){}),h.disabledOptions=a.isMobileDevice()||r}),S=e.$on("list:header-scope",function(e,t){k=t,h.disableModification=t.taskObject.status==f.status.complete}),b=e.$on("NoNN-update",function(e,n){t.NoNN=n,t.$$phase||t.$apply()}),_=e.$watch("selectedFilterView",function(e,t){});h.$on("$destroy",function(){T(),S(),b(),_()})}])}.call(this),function(){app.controller("leftMenuController",["$scope","$rootScope","$state","$ionicPopup","$ionicScrollDelegate","$ionicHistory","project","labelService","sharedData","message","filterService","stringService","sortService","taskListView","$q","$timeout","userModel","roleValidators","dbEnums",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g,v,h,E){function k(){I&&(I(),I=null)}function T(){k(),I=t.$on("projectList-update",function(){console.log("projectList-update called"),a.getAll().then(function(t){e.activeProjects=t}),a.getAllArchived().then(function(t){e.archiveProjects=t}),a.getAllProjectsUsers().then(function(t){e.assignees=t})})}function S(){var e=v.getLoggedInUser();return h.checkUserRole(e,[E.USER_ROLES.LABELS],{label:null,user:e},!0)}function b(e){var t=v.getLoggedInUser(),n=m(function(n,s){h.checkUserRole(t,E.USER_ROLES.CUSTOM_FILTERS,{user:t},!e).then(n,s)});return n}function _(e){var t=v.getLoggedInUser(),n=m(function(n,s){h.checkUserRole(t,E.USER_ROLES.MY_FEEDS,{user:t},!e).then(n,s)});return n}e.canUserFilter=!1,e.selectedId=void 0,e.leftMenuKey=void 0,e.child_menu_key=void 0,e.redirect=function(t){switch(e.selectedId=void 0,e.leftMenuKey=void 0,o.nextViewOptions({disableAnimate:!0}),t){case"myFeed":_().then(function(){n.go("/task/my-feed")});break;default:f.setFilterTypeByValue(t),f.setAll(void 0,void 0,t).then(function(){n.go("/task/list/",{type:t,id:null})})}},e.edit=function(e,t){function s(){o.nextViewOptions({disableAnimate:!0});var s="/"+e+"/edit";n.go(s,{id:t})}"filter"==e?b().then(s):"label"==e?S().then(s):s()},e.set_parent_selected=function(t){if(e.child_menu_key!=e.leftMenuKey&&(e.selectedId=void 0),console.log(e.leftMenuKey+" left"),console.log(e.child_menu_key+" child"),e.leftMenuKey==t)return{fontWeight:"bold"}},e.set_child_selected=function(t,n){if(console.log("ok-1"),e.child_menu_key=n,console.log(e.child_menu_key+" selected"),e.selectedId==t)return{fontWeight:"bold"}},e.details=function(t,s){function r(){var e="/"+t+"/details";o.nextViewOptions({disableAnimate:!0});var r=t!=c.LEFT_MENU_KEYS.FILTER;f.setAll(s,r,t).then(function(){n.go(e,{id:s})})}e.selectedId=s,e.leftMenuKey=t,"filter"==t?b().then(r):r()},e.archive=function(n){var r=l.infoMessages.PROJECT_ARCHIVED_CONFIRMATION;s.show({title:r.title,template:r.message,scope:e,buttons:[{text:d.NO,onTap:function(){return!0}},{text:d.YES,onTap:function(){a.archive(n).then(function(e){e&&(t.$emit("toast-message",l.successMessages.PROJECT_ARCHIVED),t.$emit("projectList-update"))})}}]})},e.unArchive=function(n){var r=l.infoMessages.PROJECT_UNARCHIVED_CONFIRMATION;s.show({title:r.title,template:r.message,scope:e,buttons:[{text:d.NO,onTap:function(){return!0}},{text:d.YES,onTap:function(){a.unArchive(n).then(function(e){e&&(t.$emit("toast-message",l.successMessages.PROJECT_UNARCHIVED),t.$emit("projectList-update"))})}}]})},e.removeLabel=function(n){var r=l.infoMessages.LABEL_DELETE_CONFIRMATION;s.show({title:r.title,template:r.message,scope:e,buttons:[{text:d.NO,onTap:function(){return!0}},{text:d.YES,onTap:function(){i.delete(n).then(function(e){e&&(t.$emit("toast-message",l.successMessages.LABEL_DELETED),t.$emit("labelList-update"))})}}]})},e.removeFilter=function(n){var r=l.infoMessages.FILTER_DELETE_CONFIRMATION;s.show({title:r.title,template:r.message,scope:e,buttons:[{text:d.NO,onTap:function(){return!0}},{text:d.YES,onTap:function(){u.delete(n).then(function(e){e&&(t.$emit("toast-message",l.successMessages.FILTER_DELETED),t.$emit("filterList-update"))})}}]})},e.setDropdowns=function(){e.dropdowns={project:!1,assignee:!1,filter:!1,label:!1}},e.setSettings=function(){e.settings={project:!1,assignee:!1,filter:!1,label:!1}},e.toggleDropdown=function(t){e.leftMenuKey=t,e.selectedId=void 0,e.dropdowns[t]=!e.dropdowns[t],r.resize()},e.start=function(){e.setDropdowns(),e.setSettings(),e.leftMenuSingleItems=c.leftMenuSingleItems(),a.getAll().then(function(t){e.activeProjects=t}),a.getAllArchived().then(function(t){e.archiveProjects=t}),i.getAll().then(function(t){e.labels=t}),u.getAll().then(function(t){e.filters=t,b(!0).then(function(){e.canUserFilter=!0})}),a.getAllProjectsUsers().then(function(t){e.assignees=t})},e.start(),e.onReorder=function(t,n,s){var r=m.defer(),o=angular.copy(e.activeProjects),i=o.splice(t,1);return o.splice(n,0,i[0]),k(),a.reorder(o,function(){T()}),e.activeProjects=o,r.resolve(),r.promise};var I;T();var y=t.$on("taskList-update",function(){a.getAll().then(function(t){e.activeProjects=t})}),w=t.$on("labelList-update",function(){i.getAll().then(function(t){e.labels=t})}),D=t.$on("filterList-update",function(){u.getAll().then(function(t){e.filters=t})}),O=t.$on("left-menu:selected",function(t,n){e.selected=n});e.$on("$destroy",function(){I(),y(),w(),D(),O()}),e.addLabel=function(e){S().then(function(){n.go("/label/add")})},e.addProject=function(){var e=v.getLoggedInUser(),t=m(function(t,n){h.checkUserRole(e,E.USER_ROLES.ACTIVE_PROJECTS,{user:e},!0).then(t,n)});t.then(function(){n.go("/project/add")})},e.addFilter=function(){b().then(function(){n.go("/filter/add")})}}])}.call(this),function(){app.controller("addTaskController",["$q","$scope","$rootScope","$ionicModal","$ionicPopup","$timeout","$state","taskService","dueService","stringService","headerService","guidGenerator","dbEnums","reminderService","sharedData","project","user","labelService","date","message","userModel","roleValidators","settingsService","popupService",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g,v,h,E,k,T,S,b,I){function y(e){var n=!1;return t.taskObject.watchers&&t.taskObject.watchers.forEach(function(t){t.watcher._id===e._id&&(n=t.checked)}),n}function w(){i.setTaskObject(t.taskObject)}function D(){L=!0,i.clearTaskObject()}function O(){s.fromTemplateUrl("html/views/modals/tasks/projects.html",function(e){t.projectModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/tasks/assignees.html",function(e){t.userModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/tasks/priorities.html",function(e){
t.priorityModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/tasks/due_date.html",function(e){t.dueDateModal=e},{scope:t,animation:"scale-in"})}function A(){g.getAll().then(function(e){e&&(e.splice(0,0,m.inbox),t.projects=e)})}function R(){var e=t.taskObject.labels||[];t.taskObject.labels=[],h.getAll().then(function(n){n&&n.forEach(function(n){var s=_.find(e,function(e){return n.id==e.label.id});t.taskObject.labels.push({checked:!!s&&s.checked,label:n})})})}function M(){t.priorities=i.priorities,t.taskObject.priority=3}function C(){var e;t.taskObject.reminders.forEach(function(n){n.date_created=new Date(n.date_created),e=p.getScheduledTime(n,t.taskObject.recurrence.due_date),n.invalid=E.isPast(e)||t.taskObject.recurrence.due_date&&E.isAfter(e,t.taskObject.recurrence.due_date),1==n.time.id&&(n.time.title=E.getDateTime(n.time.value))})}function N(e){var n=T.getLoggedInUser();if(e.recurrence&&e.recurrence.due_date&&e.assignee&&e.assignee._id==n._id){var s=i.addAutoReminder(e.recurrence.due_date);if(s){var r=_.find(e.reminders,function(e){return e.auto});r||(e.reminders.push(s),t.dropdowns.reminders=!0,C())}}else _.remove(e.reminders,function(e){return e.auto})}function $(){t.projectModal&&t.projectModal.remove(),t.userModal&&t.userModal.remove(),t.priorityModal&&t.priorityModal.remove(),t.dueDateModal&&t.dueDateModal.remove()}var L=!1;t.dropdowns={watchers:!1,labels:!1,reminders:!0},t.isEmailEnabled=!1,t.defaultReminderChannels=null,t.toggleMenu=function(e){t.dropdowns[e]=!t.dropdowns[e]},t.tabFocus=function(e){9==e.keyCode&&(3==e.target.tabIndex?t.userModal.show():4==e.target.tabIndex?t.toggleMenu("watchers"):5==e.target.tabIndex?t.priorityModal.show():6==e.target.tabIndex?t.toggleMenu("labels"):7==e.target.tabIndex?t.dueDateModal.show():8==e.target.tabIndex&&t.toggleMenu("reminders"))},t.setAssignees=function(){var n=e.defer();return t.assignees=[],t.taskObject.project.id?g.findById(t.taskObject.project.id).then(function(e){e.users.forEach(function(e){e.status===f.status.active&&t.assignees.push(e)}),t.assignees=T.meTopOnList(t.assignees),t.assignees.unshift({_id:0,displayName:"Unassigned"}),n.resolve(t.assignees)}):(t.assignees.push({_id:0,displayName:"Unassigned"}),n.resolve(t.assignees)),n.promise},t.setWatchers=function(e){var n=[];t.taskObject.watchers.length&&!e||(t.taskObject.project.id?g.findById(t.taskObject.project.id).then(function(e){e.users.forEach(function(e){t.taskObject.assignee._id!==e._id&&e.status===f.status.active&&n.push({checked:y(e),watcher:e})}),n=T.meTopOnList(n,"watcher"),console.log(n),t.taskObject.watchers=angular.copy(n)}):t.taskObject.watchers=angular.copy(n))},t.setReminders=function(e,n){var s=[];if(t.taskObject.reminders.length){if(e){var r=angular.copy(t.assignees);r.splice(0,1),t.taskObject.reminders.forEach(function(e){if(r.length){for(var t=0;t<r.length;t++)if(e.assignee._id==r[t]._id){s.push(e);break}}else e.assignee._id==T.getLoggedInId()&&s.push(e)})}else n&&t.taskObject.reminders.forEach(function(e){(e.time.id||!e.time.id&&t.taskObject.recurrence.due_date)&&s.push(e)});t.taskObject.reminders=angular.copy(s),C()}},t.setDueDate=function(){t.taskObject.recurrence={},t.taskObject.hasDueDate=!0,t.dueDateSummary=l.EMPTY,t.setReminders(!1,!0)},t.updateProject=function(e,n){function s(){t.taskObject.project={id:e.id,name:e.name,color:e.color},(r||n)&&(t.taskObject.assignee={},t.setAssignees().then(function(){t.setReminders(!0,!1)}),t.setWatchers(!0))}var r=t.taskObject.project.id!=e.id;if(r&&!n){var o=T.getLoggedInUser();S.checkUserRole(o,f.USER_ROLES.ACTIVE_TASKS,{project:e},!0).then(function(){s()})}else s()},t.updateAssignee=function(e){t.taskObject.assignee={_id:e._id,displayName:e.displayName,displayShortName:e.displayShortName,email:e.email,avatar:e.avatar},t.setWatchers(!0),N(t.taskObject)},t.updatePriority=function(e){t.taskObject.priority=e},t.updateDueDate=function(e){switch(e){case"TODAY":t.taskObject.recurrence={due_date:E.getDateOnly(E.today())};break;case"TOMORROW":t.taskObject.recurrence={due_date:E.getDateOnly(E.tomorrow())};break;case"WEEK":t.taskObject.recurrence={due_date:E.getDateOnly(E.nextWeek())};break;case"MONTH":t.taskObject.recurrence={due_date:E.getDateOnly(E.nextMonth())};break;case"NO_DATE":t.dueDateModal.show();break;case"CUSTOM_DATE":t.taskObject.recurrence={due_date:t.taskObject.recurrence.due_date}}t.taskObject.hasDueDate=!0,t.dueDateSummary=c.getSummary(t.taskObject.recurrence),N(t.taskObject),t.setReminders(!1,!0)},t.addReminder=function(e){e&&(t.taskObject.reminders.push(t.reminderObject),t.dropdowns.reminders=!0,C()),t.reminderObject={}},t.removeReminder=function(e){var n=k.infoMessages.REMINDER_DELETE_CONFIRMATION;r.show({title:n.title,template:n.message,scope:t,buttons:[{text:l.NO,onTap:function(){return!0}},{text:l.YES,onTap:function(){for(var n=0;n<t.taskObject.reminders.length;n++)if(t.taskObject.reminders[n].id==e){t.taskObject.reminders.splice(n,1);break}C()}}]})},t.getRecurrenceModel=function(e){e?(t.taskObject.recurrence=e,t.taskObject.hasDueDate=!0,t.taskObject.recurrence=c.setDueDate(t.taskObject.recurrence),t.dueDateSummary=c.getSummary(t.taskObject.recurrence),t.setReminders(!1,!0)):o(function(){t.dueDateModal.show()})},t.saveKeyEnter=function(e){13==e.keyCode&&t.save()},t.save=function(){t.form.$submitted=!0,t.form.$valid&&i.add(t.taskObject).then(function(e){e&&(D(),n.$emit("toast-message",k.successMessages.TASK_SAVED),m.taskHome(t.taskObject))})},t.discardPopup=function(e,t){I.discard(n).then(function(n){return!n||(D(),void a.go(e.name,t))})},t.start=function(){t.taskObject=i.getTaskObject();var e=T.getLoggedInUser();S.checkUserRole(e,f.USER_ROLES.EMAIL_NOTIFICATIONS,{},!1).then(function(){t.isEmailEnabled=!0}),S.checkUserRole(e,f.USER_ROLES.ACTIVE_TASKS,{project:t.taskObject.project},0!=t.taskObject.project.id).then(null,function(){}).finally(function(){var e=b.getSettings();t.defaultReminderChannels=e.reminder.taskCreateReminderNotificationChannels,t.reminderObject={},t.title="Add Task",n.addUrl="#/task/add",n.noteUrl="#/task/note/",A(),t.setAssignees(),R(),t.setWatchers(),M(),t.dueDateSummary=c.getSummary(t.taskObject.recurrence),t.loginId=T.getLoggedInId(),t.userId=T.getLoggedInId(),O(),u.setAddTaskHeader(t),n.$emit("task:header"),n.taskSaved&&o(function(){t.save(),n.taskSaved=!1})})},t.start();var U=n.$on("$stateChangeStart",function(e,n,s){t.taskObject&&(w(t.taskObject),"/task/note"!==n.name?!L&&i.taskObjectHasValue()?(e.preventDefault(),t.discardPopup(n,s)):(D(),$()):$())});t.$on("$destroy",function(){j(),U()});var j=n.$on("projectList-update",function(){t.taskObject.project.id&&g.findById(t.taskObject.project.id).then(function(e){e&&t.updateProject(e,!0)})})}])}.call(this),function(){app.controller("defaultViewController",["$rootScope","$scope","$ionicTabsDelegate","taskListView",function(e,t,n,s){function r(t){n.select(t),e.default.edit=!t}e.default={edit:!0},t.toggleTab=function(t){var n=e.$broadcast("default:tabswitch");n.defaultPrevented?n.promise&&n.promise.then(function(e){e&&r(t)}):r(t)};var o=e.$on("task:bulkCompleted",function(){s.clearAllSelected(),s.setDefaultView()});t.$on("$destroy",function(){o()})}])}.call(this),function(){app.controller("editTaskController",["$q","$rootScope","$scope","$state","$ionicModal","$stateParams","$timeout","toastr","connectivity","taskService","dueService","labelService","stringService","headerService","reminderService","historyService","sharedData","project","user","date","dbEnums","message","$ionicPopup","userModel","taskListView","popupService","$ionicTabsDelegate","$ionicLoading","uiHelperService","$ionicScrollDelegate","navigationService","roleValidators","settingsService",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g,v,h,E,k,T,S,b,I,y,w,D,O,A,R,M,C,N){function $(e){var t=!1;return n.taskObject.watchers&&n.taskObject.watchers.forEach(function(n){n.watcher._id===e._id&&(t=n.checked)}),t}function L(){n.taskObject.assignee=l.getAssignee(n.taskObject)||{}}function U(){var e=[];n.taskObject.users.forEach(function(t){t.role!==T.taskUserRole.assignee&&e.push({checked:t.getNotification,watcher:t})}),e=I.meTopOnList(e,"watcher"),n.taskObject.watchers=angular.copy(e)}function j(){n.taskObject.labels=[],d.getAll().then(function(e){e&&e.forEach(function(e){n.taskObject.labels.push({checked:d.isTaskExists(H,e),label:e})})})}function P(){h.getAll().then(function(e){e&&(e.splice(0,0,v.inbox),n.projects=e)})}function F(){var e;n.taskObject.reminders.forEach(function(t){t.date_created=new Date(t.date_created),e=m.getScheduledTime(t,n.taskObject.recurrence.due_date),t.invalid=k.isPast(e)||n.taskObject.recurrence.due_date&&k.isAfter(e,n.taskObject.recurrence.due_date),1==t.time.id&&(t.time.title=k.getDateTime(t.time.value))})}function V(e){void 0!==K&&!angular.equals(K,n.taskObject)&&t.rightDefaultViewVisible&&e.preventDefault()}function x(e){D.select(e)}var B,Y,H,q,K,J,z=!1,J=n.histories=[];n.canSeeHistory=!0,n.licenseError={},B=0,Y=20,n.dropdowns={watchers:!1,labels:!1,reminders:!0},n.isEmailEnabled=!1,n.defaultReminderChannels=null,n.taskComplete=function(){var e={name:s.current.name,params:{id:H}};l.bulkCompleteRequest([n.taskObject],!1,e),q&&y.setDefaultView(),v.home()},n.setFavourites=function(){var e={isFavourite:!n.isFavourite,taskIds:[n.taskObject.id]};l.bulkFavourites(e).then(function(e){e?t.$emit("toast-message",S.successMessages.TASK_ADD_TO_FAVOURITE):t.$emit("toast-message",S.successMessages.TASK_REMOVE_FROM_FAVOURITE),n.isFavourite=e})},n.toggleMenu=function(e){n.dropdowns[e]=!n.dropdowns[e]},n.setAssignees=function(){var t=e.defer();return n.assignees=[],n.taskObject.project.id?h.findById(n.taskObject.project.id).then(function(e){e.users.forEach(function(e){e.status===T.status.active&&n.assignees.push(e)}),n.assignees=I.meTopOnList(n.assignees),n.assignees.unshift({_id:0,displayName:"Unassigned"}),t.resolve(n.assignees)}):(n.assignees.push({_id:0,displayName:"Unassigned"}),t.resolve(n.assignees)),t.promise},n.setReminders=function(e,t){var s=[],r=angular.copy(n.taskObject.reminders);if(r.length){if(e){n.prevReminders.forEach(function(e){_.some(n.taskObject.reminders,e)||r.push(e)});var o=angular.copy(n.assignees);o.splice(0,1),r.forEach(function(e){if(o.length){for(var t=0;t<o.length;t++)if(e.assignee._id==o[t]._id){s.push(e);break}}else e.assignee._id==I.getLoggedInId()&&s.push(e)})}else t&&r.forEach(function(e){(e.time.id||!e.time.id&&n.taskObject.recurrence.due_date)&&s.push(e)});n.taskObject.reminders=angular.copy(s),F()}},n.setWatchers=function(e,t){var s=[];n.taskObject.watchers.length&&!e||(n.taskObject.project.id?h.findById(n.taskObject.project.id).then(function(e){e.users.forEach(function(e){n.taskObject.assignee._id!==e._id&&e.status===T.status.active&&s.push({checked:$(e),watcher:e})}),s=I.meTopOnList(s,"watcher"),n.taskObject.watchers=angular.copy(s),t&&t()}):(n.taskObject.watchers=angular.copy(s),t&&t()))},n.setDueDate=function(){n.taskObject.recurrence={},n.taskObject.hasDueDate=!0,n.dueDateSummary=f.EMPTY,n.setReminders(!1,!0)},n.createModals=function(){r.fromTemplateUrl("html/views/modals/tasks/projects.html",function(e){n.projectModal=e},{scope:n,animation:"scale-in"}),r.fromTemplateUrl("html/views/modals/tasks/assignees.html",function(e){n.userModal=e},{scope:n,animation:"scale-in"}),r.fromTemplateUrl("html/views/modals/tasks/priorities.html",function(e){n.priorityModal=e},{scope:n,animation:"scale-in"}),r.fromTemplateUrl("html/views/modals/tasks/due_date.html",function(e){n.dueDateModal=e},{scope:n,animation:"scale-in"})},n.updateProject=function(e,s){var r=n.taskObject.project.id!=e.id,o=!1;void 0!==K&&!angular.equals(K,n.taskObject)&&t.rightDefaultViewVisible&&(o=!0),n.taskObject.project={id:e.id,name:e.name,color:e.color},(r||s)&&(n.taskObject.assignee={},n.setAssignees().then(function(){n.setReminders(!0,!1),n.setWatchers(!0,function(){s&&!o&&(K=n.taskObject)})}))},n.updateAssignee=function(e){n.taskObject.assignee={_id:e._id,displayName:e.displayName,displayShortName:e.displayShortName,email:e.email,avatar:e.avatar},n.setWatchers(!0)},n.updatePriority=function(e){n.taskObject.priority=e},n.updateDueDate=function(e){var t=n.taskObject.recurrence.due_date?new Date(n.taskObject.recurrence.due_date):null;switch(e){case"TODAY":n.taskObject.recurrence={due_date:k.getDateOnly(k.today())};break;case"TOMORROW":n.taskObject.recurrence={due_date:k.getDateOnly(k.tomorrow())};break;case"WEEK":n.taskObject.recurrence={due_date:k.getDateOnly(k.nextWeek())};break;case"MONTH":n.taskObject.recurrence={due_date:k.getDateOnly(k.nextMonth())};break;case"NO_DATE":n.dueDateModal.show();break;case"CUSTOM_DATE":n.taskObject.recurrence={due_date:n.taskObject.recurrence.due_date}}"NO_DATE"!=e&&(n.taskObject.hasDueDate=!0,n.taskObject.recurrence&&n.taskObject.recurrence.due_date&&(n.taskObject.recurrence.due_date=new Date(n.taskObject.recurrence.due_date),t&&"CUSTOM_DATE"!==e&&(n.taskObject.recurrence.due_date.setHours(t.getHours()),n.taskObject.recurrence.due_date.setMinutes(t.getMinutes()),n.taskObject.recurrence.due_date.setSeconds(t.getSeconds()),n.taskObject.recurrence.due_date.setMilliseconds(t.getMilliseconds()))),n.dueDateSummary=u.getSummary(n.taskObject.recurrence),n.setReminders(!1,!0))},n.addReminder=function(e){e&&(n.taskObject.reminders.push(n.reminderObject),n.dropdowns.reminders=!0,F()),n.reminderObject={}},n.removeReminder=function(e){var t=S.infoMessages.REMINDER_DELETE_CONFIRMATION;b.show({title:t.title,template:t.message,scope:n,buttons:[{text:f.NO,onTap:function(){return!0}},{text:f.YES,onTap:function(){for(var t=0;t<n.taskObject.reminders.length;t++)if(n.taskObject.reminders[t].id==e){n.taskObject.removeReminders.push(e),n.taskObject.reminders.splice(t,1),F();break}}}]})},n.getRecurrenceModel=function(e){e?(n.recurrence=e,n.taskObject.hasDueDate=!0,n.taskObject.recurrence=u.setDueDate(n.taskObject.recurrence),n.dueDateSummary=u.getSummary(n.taskObject.recurrence),n.setReminders(!1,!0)):n.dueDateModal.show()},n.saveKeyEnter=function(e){13==e.keyCode&&n.save()},n.tabFocus=function(e){13==e.keyCode&&(2==e.target.tabIndex?n.projectModal.show():3==e.target.tabIndex?n.userModal.show():4==e.target.tabIndex?n.toggleMenu("watchers"):5==e.target.tabIndex?n.priorityModal.show():6==e.target.tabIndex?n.toggleMenu("labels"):7==e.target.tabIndex?n.dueDateModal.show():8==e.target.tabIndex&&n.toggleMenu("reminders"))},n.save=function(){n.form.$submitted=!0,n.form.$valid&&l.update(n.taskObject,K).then(function(e){return e&&t.$emit("toast-message",S.successMessages.TASK_EDITED),J=!0,q?(y.clearAllSelected(),void a(function(){A.focusTo(n.taskObject.id,R.$getByHandle("tasksScrollHandle"),{offsetTop:20})})):void M.goBack({focusedTaskId:n.taskObject.id})})},n.discardPopup=function(e,r){w.discard(t).then(function(t){return!t||(z=!0,l.clearTaskObject(),n.projectModal&&n.projectModal.remove(),n.userModal&&n.userModal.remove(),n.priorityModal&&n.priorityModal.remove(),n.dueDateModal&&n.dueDateModal.remove(),y.setDefaultView(),void s.go(e.name,r))})},n.start=function(){function e(e){e?(n.createModals(),n.taskObject=e,n.disableModification=e.status==T.status.complete,n.taskObject.removeReminders=[],n.reminderObject={},P(),L(),n.setAssignees(),U(),j(),F(),n.taskObject.prevRecurrence=angular.copy(e.recurrence),n.prevReminders=angular.copy(e.reminders),n.dueDateSummary=u.getSummary(n.taskObject.recurrence),n.priorities=l.priorities,n.loginId=I.getLoggedInId(),q?t.$emit("list:header-scope",n):(p.setEditTaskHeader(n,H),t.$emit("task:header",s.current.state,e),n.date_created=k.getDateTime(n.taskObject.date_created)),n.isFavourite=l.isFavourite(n.taskObject,n.loginId),a(function(){n.taskObject.prevRecurrence=angular.copy(e.recurrence),K=angular.copy(n.taskObject),o.showType&&"reopen"==o.showType&&O.hide()},800)):v.home()}J=!1,q=!!o.type,H=o.id,q||(n.title="Edit Task",n.addUrl="#/task/edit/"+H,n.noteUrl="#/task/note/"+H);var r=N.getSettings();n.defaultReminderChannels=r.reminder.taskCreateReminderNotificationChannels;var i=I.getLoggedInUser();C.checkUserRole(i,T.USER_ROLES.EMAIL_NOTIFICATIONS,{},!1).then(function(){n.isEmailEnabled=!0}),C.checkUserRole(i,T.USER_ROLES.TASK_HISTORY,{},!1).then(function(){},function(e){n.canSeeHistory=!1,n.licenseError=S.infoMessages.TASK_HISTORY}),o.showType&&"reopen"==o.showType&&O.show(),l.findActiveTaskById(H).then(function(n){n?e(n):t.closedTask?e(t.closedTask):l.getTaskFromServer(H).then(function(n){n?e(n):t.$emit("toast-message",S.errorMessages.TASK_NOT_FOUND)},function(e){t.$emit("toast-message",e.msg)})})},n.start(),n.$on("$stateChangeStart",function(e,t,s){z||J||!K||angular.equals(K,n.taskObject)?(n.projectModal&&n.projectModal.remove(),n.userModal&&n.userModal.remove(),n.priorityModal&&n.priorityModal.remove(),n.dueDateModal&&n.dueDateModal.remove(),y.setDefaultView()):(e.preventDefault(),n.discardPopup(t,s))}),n.$on("beforeTaskListSelectionChange",function(e,t,n,s){V(e)}),n.loadMore=function(){c.isConnected()?g.getHistoriesByTaskId(H,B,Y).then(function(e){e.length?(e.forEach(function(e){e.icon=v.EVENT_ICONS[e.key],e.type==T.status.reopened&&(e.icon=v.EVENT_ICONS[e.type.toUpperCase()]),e.date_modified=k.getDateTime(e.date_modified),n.histories.push(e)}),B+=Y):n.noMoreItemsAvailable=!0,n.$broadcast("scroll.infiniteScrollComplete")}):n.noMoreItemsAvailable=!0};var G=t.$on("task:update-favourite",function(e,t){n.isFavourite=t});n.$on("default:tabswitch",function(e){V(e),e.defaultPrevented&&(e.promise=w.discard(t),e.promise.then(function(e){z=e}))}),n.$on("$destroy",function(){G(),W()}),n.toggleTab=function(e){var n=t.$broadcast("default:tabswitch");n.defaultPrevented?n.promise&&n.promise.then(function(t){t&&x(e)}):x(e)};var W=t.$on("projectList-update",function(){n.taskObject.project.id&&h.findById(n.taskObject.project.id).then(function(e){e&&n.updateProject(e,!0)})});n.selectLabel=function(e,t){var s=I.getLoggedInUser();console.log("label "+t.label.name+" : "+t.checked),t.checked&&C.checkUserRole(s,T.USER_ROLES.LABELS_ASSIGN,{labels:[t],task:n.taskObject},!0).then(function(){},function(e){a(function(){t.checked=!t.checked})})},n.copyTask=function(e){l.copyTask(e).then(function(e){l.setTaskObject(e),s.go("/task/add")})}}])}.call(this),function(){app.controller("noteTaskController",["$rootScope","$scope","$stateParams","$ionicScrollDelegate","$state","$ionicModal","userModel","$ionicPopup","$timeout","stringService","taskService","dbEnums","headerService","guidGenerator","noteService","date","sharedData","message","connectivity","$location","uiHelperService","popupService","roleValidators","CONSTANT","$q",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g,v,h,E,k,T,S,b,_,I){function y(){o.fromTemplateUrl("html/views/modals/file_upload.html",function(e){t.fileUploadModal=e},{scope:t,animation:"scale-in"}),o.fromTemplateUrl("html/views/modals/progress_bar.html",function(e){t.progressBarModal=e},{scope:t,animation:"scale-in"})}t.selected=[],t.noteIds=[],console.log("note task controller"),t.canUploadFile=!1,t.loadingText="Uploading...",t.openFileUpload=function(){var n=a.getLoggedInUser();console.log("file uploading...."),console.log(n),b.checkUserRole(n,d.USER_ROLES.FILE_UPLOAD,{},!0).then(function(){E.isConnected()?t.fileUploadModal.show():e.$emit("toast-message",h.errorMessages.CONNECTION_REQUIRED)})},t.resetTaskObject=function(){t.note={},u.clearTaskObject()},t.noteListFormat=function(){t.taskObject.notes.forEach(function(e){e.dateModified=g.getDateTime(e.date_modified),e.selected=!1})},t.setNoteForm=function(){t.note={id:p.getId(),updatedBy:a.getLoggedInUser(),description:l.EMPTY,status:d.status.active,editable:!1,position:-1},t.selected=[],t.noteIds=[],t.isSelect=!1},t.editForm=function(){t.note=angular.copy(t.selected[0]),t.note.editable=!0,t.isSelect=!1},t.editNote=function(){var n={taskId:t.taskId,note:t.note};m.edit(n).then(function(t){e.$emit("toast-message",h.successMessages.NOTE_EDITED)})},t.addNote=function(){var n={taskId:t.taskId,note:t.note};m.add(n).then(function(n){c(function(){t.$broadcast("scroll.refreshComplete"),c(function(){s.$getByHandle("noteScroll").scrollBottom(!0)})},200),e.$emit("toast-message",h.successMessages.NOTE_SAVED)})},t.save=function(){u.setTaskObject(t.taskObject),t.taskObject.name?u.add(t.taskObject).then(function(n){n&&(t.resetTaskObject(),e.$emit("toast-message",h.successMessages.TASK_SAVED),v.home())}):(e.taskSaved=!0,r.go("/task/add"))},t.saveNote=function(){t.note.description&&(t.note.date_modified=Date.now(),t.taskId&&(t.note.editable?t.editNote():t.addNote()),t.taskId||(t.note.dateModified=g.getDateTime(t.note.date_modified),t.taskObject.notes.push(t.note)))},t.$on("taResize",function(e,t){c(function(){var e=document.body.querySelector(".bar-stable");if(t){var n=t[0].offsetHeight;if(e){var s=n+10;s=s>44?s:44,e.style.height=s+"px"}}})}),t.setFooterPermission=function(){for(var e=t.selected.length>1,n=t.selected[0].isFile,s=0;s<t.selected.length;s++){var r=t.selected[s].updatedBy._id===a.getLoggedInId();if(!r)break}t.copyPermission=!n&&!e,t.editPermission=!n&&!e&&r,t.deletePermission=r},t.clicked=function(e,n){var s=t.selected.indexOf(e);s>-1?(t.selected.splice(s,1),t.noteIds.splice(s,1),e.selected=!1,e.position=-1):(t.selected.push(e),t.noteIds.push(e.id),e.position=n,e.selected=!0),t.selected.length<=0?t.setNoteForm():(t.isSelect=!0,t.setFooterPermission())},t.start=function(){function o(o){o?(t.taskObject=o,t.title=o.name,t.disableModification=o.status==d.status.complete,t.setNoteForm(),t.noteListFormat(),e.$emit("task:header",r.current.state,o),c(function(){if(o.notes.length>0){var e=o.notes[o.notes.length-1].id;n.focusMe?(e=n.focusMe,T.focusTo(e,s.$getByHandle("noteScroll"))):T.scrollTo(e,s.$getByHandle("noteScroll"))}},200)):v.home()}e.rightDefaultViewVisible&&e.$emit("set-page","Task_Notes");var i=a.getLoggedInUser();b.checkUserRole(i,d.USER_ROLES.FILE_UPLOAD,{},!1).then(function(){t.canUploadFile=!0}),n.id?(t.taskId=n.id,t.addUrl="#/task/edit/"+n.id,t.noteUrl="#/task/note/"+n.id,u.findActiveTaskById(t.taskId).then(function(n){n?o(n):e.closedTask?o(e.closedTask):u.getTaskFromServer(t.taskId).then(function(t){t?o(t):e.$emit("toast-message",h.errorMessages.TASK_NOT_FOUND)},function(t){e.$emit("toast-message",t.msg)})})):(t.title="Add Note",t.taskObject=u.getTaskObject(),t.addUrl="#/task/add",t.noteUrl="#/task/note/",t.setNoteForm(),t.noteListFormat(),e.$emit("task:header")),y(),f.setTaskNoteHeader(t,n.id)},t.start(),t.uploadNoteFile=function(n){var r={file:n,id:p.getId(),updatedBy:a.getLoggedInUser(),parent:t.taskId},o=I(function(e,t){var s=a.getLoggedInUser();b.checkUserRole(s,d.USER_ROLES.FILE_STORAGE_MAX,{file:n},!0).then(e,t)});o.then(function(){t.progressBarModal.show(),m.uploadNote(r).then(function(n){n.error||(t.setNoteForm(),t.noteListFormat(),s.$getByHandle("noteScroll").scrollBottom(!0)),n&&n.results&&n.results.errors&&"LICENSE"==n.results.errors.key?S.roleWarning(null,n.results.errors).then(function(){window.cordova?$window.open(encodeURI(_.upgradeUrl),"_system","location=no"):$window.open(_.upgradeUrl,"_blank"),console.log("UPGRADE code goes here")},function(){console.log("UPGRADE CANCEL code goes here")}):e.$emit("toast-message",n.msg),t.progressBarModal.hide()})},function(t){!t||t.key&&"LICENSE"==t.key||e.$emit("toast-message",results.msg)})},t.onFileSelected=function(e){if(t.fileUploadModal.hide(),console.log(e),console.log("getting files..."),e&&e.length){var n=e[0],s=a.getLoggedInUser();b.checkUserRole(s,d.USER_ROLES.FILE_UPLOAD_SIZE,{file:n},!0).then(function(){for(var n=0;n<e.length;n++){var s=e[n];t.uploadNoteFile(s)}})}},t.deleteNote=function(){var n;n=t.selected[1]?h.infoMessages.MULTIPLE_NOTES_DELETE_CONFIRMATION:t.selected[0].isFile?h.infoMessages.SINGLE_FILE_DELETE_CONFIRMATION:h.infoMessages.SINGLE_NOTE_DELETE_CONFIRMATION,i.show({title:n.title,template:n.message,scope:t,buttons:[{text:l.NO,onTap:function(){return!0}},{text:l.YES,onTap:function(){if(t.taskId){t.note=angular.copy(t.selected[0]);var n={taskId:t.taskId,noteIds:t.noteIds};console.log(t.noteIds),m.delete(n).then(function(t){e.$emit("toast-message",h.successMessages.NOTE_DELETED)})}else{var s=t.taskObject.notes.indexOf(t.selected[0]);s>-1&&t.taskObject.notes.splice(s,1),t.setNoteForm(),t.noteListFormat(),t.selected=[],t.noteIds=[],t.isSelect=!1}}}]})},t.discardPopup=function(e,n){i.show({template:h.infoMessages.DISCARD_CHANGE.message,title:h.infoMessages.DISCARD_CHANGE.title,scope:t,buttons:[{text:l.NO,onTap:function(){return!0}},{text:l.YES,onTap:function(){t.resetTaskObject(),r.go(e.name,n)}}]})},t.copyNote=function(){e.$emit("toast-message",h.successMessages.NOTE_COPIED),t.copiedNote=angular.copy(t.selected[0].description),t.selected=[],t.noteIds=[],t.isSelect=!1,t.noteListFormat()};var w=e.$on("taskList-update",function(){u.findById(t.taskId).then(function(e){e&&(t.taskObject=e,t.setNoteForm(),t.noteListFormat())})});t.$on("$stateChangeStart",function(e,n,s){"/task/add"===n.name||"/task/edit"===n.name?u.setTaskObject(t.taskObject):(!t.taskId&&u.taskObjectHasValue()||t.note.description)&&(e.preventDefault(),t.discardPopup(n,s))}),t.toggleTab=function(t){var n=e.$broadcast("default:tabswitch");n.defaultPrevented?n.promise&&n.promise.then(function(e){e&&switchTab(t)}):switchTab(t)},t.$on("$destroy",w)}])}.call(this),function(){app.controller("taskFooterController",["$rootScope","$state","$scope","$ionicPopup","$ionicModal","$timeout","$ionicPopover","stringService","message","taskListView","taskService","rightMenuService","date","dbEnums","$ionicLoading","sharedData",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g){function v(t,n){var s={recurrence:E.taskObject.recurrence,taskIds:l.getTaskIds()};u.bulkDueDateUpdate(s,t,n).then(function(){e.$emit("toast-message",c.successMessages.TASK_DUE_DATE_UPDATED),l.clearAllSelected()})}function h(){E.menus=d.getBottomMenu(),a.fromTemplateUrl("html/views/popovers/bottom_right_popover.html",{scope:E,animation:"slide-in-right"}).then(function(e){E.popover=e})}var E=n;E.toggleMenu=function(){return n.showMenu=!n.showMenu},E.bulkFavourites=function(){var t={isFavourite:!E.isFavourite,taskIds:l.getTaskIds()};u.bulkFavourites(t).then(function(t){t?e.$emit("toast-message",c.successMessages.TASK_ADD_TO_FAVOURITE):e.$emit("toast-message",c.successMessages.TASK_REMOVE_FROM_FAVOURITE)})},E.bulkComplete=function(){u.bulkCompleteRequest(l.getSelected()).then(function(){l.clearAllSelected()})},E.delete=function(){s.show({title:c.infoMessages.TASK_DELETE_CONFIRMATION.title,template:c.infoMessages.TASK_DELETE_CONFIRMATION.message,scope:E,buttons:[{text:i.NO,onTap:function(){return!0}},{text:i.YES,onTap:function(){var t=l.getSelected();return t.length>0&&u.delete(t,function(){l.clearAllSelected(),e.$emit("toast-message",c.successMessages.TASK_DELETED)}),!0}}]})},E.openModal=function(){E.taskObject={recurrence:{}},E.dueDateModal.show()},E.updateDueDate=function(e,t){switch(t=t||{date:!1,time:!1},e){case"TODAY":n.taskObject.recurrence={due_date:f.getDateOnly(f.today())},t.date=!0;break;case"TOMORROW":n.taskObject.recurrence={due_date:f.getDateOnly(f.tomorrow())},t.date=!0;break;case"WEEK":n.taskObject.recurrence={due_date:f.getDateOnly(f.nextWeek())},t.date=!0;break;case"MONTH":n.taskObject.recurrence={due_date:f.getDateOnly(f.nextMonth())},t.date=!0;break;case"NO_DATE":n.dueDateModal.show();break;case"CUSTOM_DATE":n.taskObject.recurrence={due_date:n.taskObject.recurrence.due_date}}"NO_DATE"!==e&&v(!t.time,!t.date)},E.getRecurrenceModel=function(e){e?(E.taskObject.recurrence=e,v()):o(function(){n.dueDateModal.show()})},E.start=function(){r.fromTemplateUrl("html/views/modals/tasks/due_date.html",function(e){E.dueDateModal=e},{scope:E,animation:"scale-in"}),h()},E.start(),E.$on("$stateChangeSuccess",function(){n.dueDateModal&&n.dueDateModal.remove(),l.clearAllSelected()});var k=e.$on("task-footer-toggle",function(){E.isFavourite=l.isAllFavourite(),e.singleSelect?n.selectedTask=l.getSingleSelected():n.selectedTask={},n.isForComplete=!1;var t=l.getSelected();t&&t.length>0&&angular.forEach(t,function(e,t){if("complete"==e.status)return n.isForComplete=!0,!1})}),T=e.$on("task:update-favourite",function(e,t){E.isFavourite=t});E.$on("$destroy",function(){k(),T()}),n.bulkReopen=function(){var t=l.getSelected(),n=[];angular.forEach(t,function(e){e.status==p.status.complete&&n.push(e)}),n.length>0&&(m.show(),u.unCompleteTasks(t).then(function(){l.clearAllSelected(),e.$emit("toast-message",c.successMessages.TASK_UNCOMPLETED),e.$emit("pull-from-server"),l.setDefaultView(),g.taskHome(n[0],n[0].id)},function(t){e.$emit("toast-message",t.msg)}).finally(function(){m.hide()}))}}])}.call(this),function(){app.controller("taskHeaderController",["$rootScope","$state","$scope","$ionicPopover","rightMenuService","headerService","user","sharedData","stringService","notificationService","dbEnums","$ionicHistory","navigationService","userModel",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p){function m(){s.fromTemplateUrl("html/views/popovers/top_right_popover.html",{scope:g,animation:"slide-in-right"}).then(function(e){g.popover=e}),s.fromTemplateUrl("html/views/popovers/notification_popover.html",{scope:g}).then(function(e){g.notificationBar=e})}var g=n;g.type=c.EMPTY;var v={};n.items=[],p.isAuthenticated()&&l.getNoOfUnseen().then(function(e){n.NoNN=e}),g.menuItemClicked=function(e,t){g.popover.hide(),r.itemClicked(e,v,g,t)},g.start=function(){m(),r.setMenu(g.type),g.menus=r.getMenu(),g.createButtonName=o.taskHeader.createButtonName,g.createButtonLink=o.taskHeader.createButtonLink,g.noteButtonLink=o.taskHeader.noteButtonLink,g.taskObject=o.taskHeader.taskObject,g.taskId=o.taskHeader.taskId,g.createType=o.taskHeader.createType,g.addTab=o.taskHeader.addTab,g.noteTab=o.taskHeader.noteTab,g.isSaved=o.taskHeader.isSaved,g.disableModification=v&&v.status==u.status.complete},g.save=function(){o.activeScope?o.activeScope.save():t.go("/task/add")},g.back=function(){f.goBack()};var h=e.$on("task:header",function(e,t,n){g.type=t,v=n,g.start()}),E=e.$on("NoNN-update",function(e,t){n.NoNN=t,n.$$phase||n.$apply()});g.$on("$destroy",function(){h(),E()}),g.changeView=function(e,n){"task-add"==e?t.go("/task/add"):"task-edit"==e?t.go("/task/edit",{id:n}):"note"==e&&t.go("/task/note",{id:n})}}])}.call(this),function(){app.controller("taskListController",["$rootScope","$scope","$stateParams","$state","$timeout","sortService","stringService","filterService","sharedData","date","taskService","taskListView","$ionicLoading","labelService","project","dbEnums","settingsService","platformService","userModel","$ionicScrollDelegate","message","uiHelperService","asyncStackService","$q","$ionicLoading","$location","roleValidators",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g,v,h,E,k,T,S,b,I,f,y,w){function D(){r(function(){var e=y.search().focusMe;e?S.focusTo(e,k.$getByHandle("tasksScrollHandle"),{offsetTop:20}):n.focusedTaskId&&S.focusTo(n.focusedTaskId,k.$getByHandle("tasksScrollHandle"),{offsetTop:20})},200)}function O(t){P=!0,u.removeFromBulkCompleteList(t),e.$emit("bulk-complete:response",P)}function A(){R(),B=e.$on("taskList-update",function(){t.getAll(t.type,t.object)})}function R(){B&&(B(),B=null)}function M(){var n={};if(n=angular.extend(n,V),t.canSearchCompleted||(n.limit=10),console.log(JSON.stringify(t.searchText)),t.startSearching){if(!t.searchText||t.searchText.name==a.EMPTY){console.log("cancelling search completed load");var s=I.defer();return t.completedLists=[],V.skip=0,t.$broadcast("scroll.infiniteScrollComplete"),s.reject(),s.promise}n.filter=t.searchText}return t.startSearching&&delete n.project,console.log(JSON.stringify(n)),t.searchingCompletedTasks=!0,u.getCompletedTasks(n).then(function(e){e=e||[],e.forEach(function(e){e.due=l.getDateOnly(e.recurrence.due_date)||new Date("01-01-2050"),e.recurrence.due_time=l.getTime(e.recurrence.due_date),e.isOverdued=l.isPastDay(e.recurrence.due_date),e.assignee=u.getAssignee(e),e.isComplete="complete"===e.status}),e.length>0?(t.completedLists=t.completedLists.concat(e),V.skip+=e.length,t.noMoreCompletedItemsAvailable=!1):t.noMoreCompletedItemsAvailable=!0,r(function(){t.searchingCompletedTasks=!1,
k.resize(),t.$broadcast("scroll.infiniteScrollComplete"),e.length>0&&S.scrollTo(e[0].id,k.$getByHandle("tasksScrollHandle"),{offsetTop:100,animate:!0},function(){})},200)},function(n){t.searchingCompletedTasks=!1,t.$broadcast("scroll.infiniteScrollComplete"),n.msg&&e.$emit("toast-message",n.msg)}).finally(function(){})}function C(e){function n(){if(t.showCompleted)return t.searchingCompletedTasks=!1,t.noMoreCompletedItemsAvailable=!1,V.skip=0,t.completedLists=[],k.resize(),console.info("skip search : ",e),!(!t.isCompletedEnabled||t.startSearching&&!t.canSearchCompleted)&&M()}var s=x.stack(n);s.promise.then(function(){})}function N(){var e=E.getLoggedInUser();w.checkUserRole(e,g.USER_ROLES.SEARCH,{},!1).then(function(){C(!1)},function(){C(!0)})}function $(e){var t=[];return e.forEach(function(e){t.push(e.name)}),t}function L(){U(),Q=e.$on("userInfo-sortOrder",function(){t.getAll(t.type,t.object)})}function U(){Q&&(Q(),Q=null)}function j(e,n){t.completeListVisible=!0;var s=E.getLoggedInUser();w.checkUserRole(s,g.USER_ROLES.SEARCH,{},n).then(function(){t.canSearchCompleted=!0,e&&(t.isCompletedEnabled=!0)},function(){e||(t.isCompletedEnabled=!1)})}var P=!1;t.showCompleted=!1,t.noMoreCompletedItemsAvailable=!1,t.completeListVisible=!1,t.canSearchCompleted=!1,t.isCompletedEnabled=!0,t.searchingCompletedTasks=!1;var F,V={skip:0,limit:25},x=b.createStacker();t.clicked=function(e,n){d.clicked(e,t.type,n?n.shiftKey||window.fixes&&window.fixes.shiftKey:h.isMobileDevice())},t.complete=function(t,n,s){n.stopPropagation(),console.log("item status : "+t.name+"   "+t.status);var o=t.status==g.status.complete;s?r(function(){P||e.$emit("bulk-complete:response",!1),P=!1},3e3):t.status=o?g.status.active:g.status.complete,o?u.removeFromBulkCompleteList(t):u.bulkCompleteRequest([t],s).then(function(){d.clearAllSelected()})},t.getAll=function(o,a){if(s.current.state==c.STATE.CLOSED){var i=n.tasks?n.tasks.split(","):[];return u.getTasksByIds(i).then(function(s){return s&&s.length?(t.taskList=s,e.$emit("task:header-taskList",t.type,s.length,t.object),void r(function(){e.$emit("update-sticky")},200)):u.getCompletedTasks({tasks:n.tasks}).then(function(n){t.taskList=n,e.$emit("task:header-taskList",t.type,n.length,t.object)},function(t){e.$emit("toast-message",t.msg)}).finally(function(){})})}return u.getTasksByType(o,a).then(function(n){t.taskList=n,e.$emit("task:header-taskList",t.type,n.length,t.object),r(function(){e.$emit("update-sticky")},200)})},t.pull=function(){var n=e.$on("pull-from-server-complete",function(){t.$broadcast("scroll.refreshComplete"),n()});e.$emit("pull-from-server")},t.redirectToEdit=function(t,n){d.setDefaultView(),n&&n.status==g.status.complete?e.closedTask=n:delete e.closedTask,s.go("/task/edit",{id:t})},t.start=function(){switch(F=!!n.type,t.searchingCompletedTasks=!1,s.current.state){case c.STATE.ASSIGNEE:m.getUserFromAllProjects(n.id).then(function(r){r?(t.object=r,t.type=s.current.state,e.title=r.displayName,t.getAll(t.type,t.object).then(D),V.assignee=n.id,j(!1,!1)):c.home()});break;case c.STATE.FILTER:i.findById(n.id).then(function(n){n?(t.object=n,t.type=s.current.state,e.title=n.name,t.getAll(t.type,t.object).then(D)):c.home()});break;case c.STATE.LABEL:p.findById(n.id).then(function(n){n?(t.object=n,t.type=s.current.state,e.title=n.name,t.getAll(t.type,t.object).then(D)):c.home()});break;case c.STATE.PROJECT:m.findById(n.id).then(function(r){r?(t.object=r,e.title=r.name,t.type=s.current.state,t.getAll(t.type,t.object).then(D),V.project=n.id,j(!0,!1)):c.home()});break;case c.STATE.TASK:t.object=null,t.type=n.type,e.$emit("left-menu:selected",t.type),e.title=u.TASK_TYPE_NAME[t.type],t.getAll(t.type,t.object).then(D);break;case c.STATE.CLOSED:t.object=null,t.type="closed",e.$emit("left-menu:selected",t.type),e.title=u.TASK_TYPE_NAME[t.type],f.show(),t.getAll(t.type,t.object).finally(function(){f.hide()})}E.isAuthenticated()&&(t.allFloatButtons=v.getSettings().float_button?parseInt(v.getSettings().float_button.value):null),t.hasRightMenu=!1,t.hasFooter=!1,t.priorities=u.priorities,e.returnState=s.current,e.returnParams=n,d.clearAllSelected(),r(function(){},100)},t.taskAdd=function(){s.current.state==c.STATE.PROJECT&&u.addProjectToTaskObject(t.object),s.go("/task/add")},t.undoTaskComplete=function(e){O(e)},E.isAuthenticated()&&t.start();var B;A();var Y,H=e.$on("task-footer-toggle",function(){t.hasFooter=d.isSelected()}),q=e.$on("search:start",function(e,n){n?(Y=!!t.showCompleted,t.startSearching=n,t.getAll(a.EMPTY),N(!0),console.log(n),k.$getByHandle("tasksScrollHandle").scrollTo(0,0)):(r(function(){t.showCompleted=Y,Y=null,t.startSearching=n,N()},500),t.getAll(t.type,t.object),t.searchText={name:a.EMPTY},console.log(n))}),K=e.$on("search:tasks",function(e,n){t.searchText={name:n},console.log("search text: ",n),console.log("startSearching: ",t.startSearching),N()}),J=e.$on("task:list-sorted",function(e){t.getAll(t.type,t.object)}),z=e.$on("$stateChangeStart",function(){e.$emit("left-menu:selected",null)});t.$on("$destroy",function(){R(),H(),K(),q(),J(),x.clear(),Q(),G(),W(),z()}),t.clearRecentTask=function(){console.log("unsetting recentTaskId"),e.recentTaskId=void 0,console.log("unset recentTaskId")},t.loadMoreCompleted=function(e){var t=x.stack(M,[],this);t.promise.then(function(){console.log("load more")})},t.$watch("showCompleted",function(e,n){console.log("showCompleted change : "+e),e!==n&&(e===!1?(t.completedLists=[],t.noMoreCompletedItemsAvailable=!1,V.skip=0):e&&C())}),t.showHideCompleted=function(e){t.showCompleted=!t.showCompleted};var G=e.$on("task-complete",function(){C()});t.unCompleteTask=function(t){console.log(t.status),f.show(),u.unCompleteTasks(t).then(function(t){e.$emit("toast-message",T.successMessages.TASK_UNCOMPLETED),e.$emit("pull-from-server"),F&&d.setDefaultView(),c.taskHome(t[0],t[0].id)},function(n){n&&n.msg&&e.$emit("toast-message",n.msg),t.status=g.status.complete}).finally(function(){f.hide()})};var W=e.$on("task-reopen",function(e,n){n=n||[],n.forEach(function(e){t.completedLists.forEach(function(n,s){if(n.id==e.id)return t.completedLists.splice(s,1),r(function(){console.log("focusing on task "+e.id),S.focusTo(e.id,k.$getByHandle("tasksScrollHandle"),{offsetTop:20,focusMeBackgroundSelector:".item-content"})},300),!1})})});t.completedLists=[],t.onReorder=function(e,n,s){var r=I.defer();console.log(arguments);var a=$(t.taskList);return console.log("--------old list-------"),console.log(a.join(",")),E.get(function(i){var c=o.getSortType(),l=o.getOrder().value,d=angular.copy(t.taskList);R(),u.moveTask(d,e,n,s,i,c.showDateBar,c,l).then(function(e){e=e||{};var n=e.tasks;n?(_.each(n,function(e){u.setTaskProps(e)}),e.requireSort&&(n=u.sortTasks(n,c,l,i)),t.taskList=n,console.log("--------New list-------"),a=$(n),console.log(a.join(",")),r.resolve()):r.reject()},r.reject).finally(function(){A()})}),r.promise},t.completedLists.forEach(function(e){e.due=l.getDateOnly(e.recurrence.due_date)||new Date("01-01-2050"),e.recurrence.due_time=l.getTime(e.recurrence.due_date),e.isOverdued=l.isPastDay(e.recurrence.due_date),e.assignee=u.getAssignee(e)}),t.checkScrolling=function(){console.info("scrolling"),window.cordova&&cordova.plugins&&cordova.plugins.Keyboard&&cordova.plugins.Keyboard.close()};var Q;L()}])}.call(this),function(){app.controller("taskMyFeedController",["$rootScope","$q","$scope","taskService","connectivity","date","$ionicLoading","settingsService","project","sharedData","historyService","dbEnums","asyncStackService","$timeout",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p){function m(){return r.isConnected()?u.getAllHistories(v,h,n.taskIds,n.projectIds).then(function(t){a.hide(),t.length?(t.forEach(function(e){e.icon=l.EVENT_ICONS[e.key],e.type==d.status.reopened&&(e.icon=l.EVENT_ICONS[e.type.toUpperCase()]),e.dateTime=o.getDateTime(e.date_modified),n.items.push(e)}),v+=h):n.noMoreItemsAvailable=!0,e.$broadcast("scroll.infiniteScrollComplete")}):(n.noMoreItemsAvailable=!0,void a.hide())}n.noMoreItemsAvailable=!1;var g=f.createStacker(),v=0,h=20;n.loadMore=function(){g.stack(m)},n.items=[],n.start=function(){n.title="My feeds",n.type="myFeed",a.show(),e.$emit("left-menu:selected",n.type),s.taskCount().then(function(t){e.$emit("task:header-taskList",n.type,t,null,!0)}),n.allFloatButtons=i.getSettings().float_button?parseInt(i.getSettings().float_button.value):null},n.start(),n.$on("$destroy",function(){E(),g.clear()});var E=e.$on("$stateChangeStart",function(){e.$emit("left-menu:selected",null)});n.getLink=function(e){var t="";return t="NOTE"==e.key?"#/task/note/"+e.task.id+("deleted"!=e.type?"?focusMe="+e.value.id:""):"complete"==e.type?"#/task/closed?tasks="+e.task.id:e.key==d.keys.TASK_DELETE?"javascript:void(0)":"#/task/edit/"+e.task.id+("reopen"==e.type?"?type=reopen":"")}}])}.call(this),function(){app.directive("activeHeader",function(){var e;return e={restrict:"A",require:["activeHeader"],controller:function(e){this.tabCheck=function(t){return t==="#"+e.path()}},compile:function(){return{pre:function(e,t,n,s){e.ah=s[0]}}}}})}.call(this),!function(){app.directive("attachFocus",["$rootScope","$timeout",function(e,t){return{restrict:"A",link:function(n,s,r){var o=e.$on("attach-focus",function(e,n){n===r.attachFocus&&$(s).is(":visible")&&t(function(){$(s).is(":button")?$(s).click():$(s).focus()})});n.$on("$destroy",function(){o()})}}}])}(),function(){function e(e,t){e+="";var n=["pdf"],s=[],r=[];"android"==t?r=r.concat(n):"ios"==t&&(r=r.concat(s));var o=e.lastIndexOf(".");if(o<0)return!0;var a=e.substr(o+1,3);return!(r.indexOf(a.toLowerCase())>-1)}app.directive("tdzAttachmentViewer",["$ionicModal","platformService","CONSTANT","authService",function(t,n,s,r){return{scope:{fileName:"=",fileUrl:"="},transclude:!0,require:"^tdzAttachmentViewer",template:'<div class="attachment-content"><div ng-if="isAnImage" style="height:auto"><img ng-src="{{fullFileUrl}}" class="attachment-thumbnail" ng-click="openAttachment($event)"/></br></div><span class="icon tdzicon-attach attachment-icon-left" ng-if="!isAnImage">&nbsp;<br/></span><div ng-click="openAttachment($event)" class="all-wrapped attachment-filename">{{fileName}}</div><ng-transclude></ng-transclude></div>',controller:["$scope",function(e){var t=this;t.isAnImage=function(e){var t=["jpg","gif","png","jpeg"],n=e.substring(e.lastIndexOf(".")+1).toLowerCase();return t.indexOf(n)!==-1},e.$watch("fileName",function(n,s){n!==s&&(e.isAnImage=t.isAnImage(n))}),e.$watch("fileUrl",function(t,n){if(t){var o=r.getAccessToken();e.fullFileUrl=s.file_handler_link+"/attachment?x-access-token="+o+"&url="+t}}),e.isAnImage=t.isAnImage(e.fileName)}],link:function(n,s,r,o){function a(){t.fromTemplateUrl("html/directives/shared/attachment-viewer.html",function(e){n.modal=e,n.modal.show()},{scope:n,animation:"scale-in"})}var i=o;n.openAttachment=function(e){return e.stopPropagation(),i.isAnImage(n.fileName)?(n.src=n.fullFileUrl,void a()):void n.openFile()},n.openFile=function(){if(window.cordova){console.log("opening file ::: "+n.fullFileUrl);var t=(e(n.fullFileUrl,"android"),n.fullFileUrl);window.open(encodeURI(t),"_system","location=no")}else window.open(n.fullFileUrl,"_blank")}}}}])}.call(this),function(){app.directive("autoFocus",["$timeout",function(e){return{restrict:"A",link:function(t,n,s){if(t.$eval(s.autoFocus)!==!1){var r=n[0];e(function(){r.focus(),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&window.cordova.plugins.Keyboard.show()},300)}}}}]),app.directive("focusInput",["$timeout",function(e){return{link:function(t,n,s){e(function(){n[0].focus(),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.show()},300)}}}])}.call(this),function(){app.directive("tdzAvatar",function(){var e;return e={restrict:"E",templateUrl:"html/directives/shared/avatar.html",scope:{imageSrc:"@",shortName:"@",position:"@"},replace:!0,link:function(e,t,n){e.url=e.imageSrc,e.name=e.shortName,"right"==e.position?e.itemPosition="avatar-right":e.itemPosition="avatar-left"}}})}.call(this),!function(){app.directive("clockPicker",["date",function(e){return{restrict:"EA",require:"ngModel",scope:{datetime:"=ngModel"},link:function(t,n,s,r){$(n).clockpicker({autoclose:!1,donetext:"",appendTo:$(n),placement:"none",stayOpen:!0,change:function(t){console.log(t);var n=((t+"").split(":"),e.getTimeFromString(t));r.$setViewValue(n),console.log(n)}}),r.$render=function(){var t=$(n).data("clockpicker"),s=e.getUnFormattedTimeString(r.$modelValue);t.setClock(s)}}}}])}(),function(){app.directive("confirmInput",function(){return{require:"ngModel",scope:{confirmInput:"=confirmInput"},link:function(e,t,n,s){e.$watch("confirmInput",function(){return s.$setValidity("confirmed",e.confirmInput===t.val())}),t.bind("propertychange keyup change paste",function(){return e.$apply(function(){return s.$setValidity("confirmed",e.confirmInput===t.val())})})}}})}.call(this),function(){app.directive("copyToClipboard",["$window",function(e){function t(e){s.val(e),n.append(s),s[0].select();try{var t=document.execCommand("copy");if(!t)throw t}catch(t){window.cordova&&cordova.plugins.clipboard.copy(e)}s.remove()}var n=angular.element(e.document.body),s=angular.element("<textarea/>");return s.css({position:"fixed",opacity:"0"}),{restrict:"A",link:function(e,n,s){n.bind("click",function(e){t(s.copyToClipboard)})}}}])}.call(this),function(){function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}app.directive("dateBar",["date",function(t){var n;return n={restrict:"E",scope:{date:"=",previousDate:"=",index:"="},link:function(n,s,r,o){function a(r){n.hasDateBar=!1;var o=new Date(e(n.date)?parseFloat(n.date):n.date);if(n.previousDate){var a=new Date(e(n.previousDate)?parseFloat(n.previousDate):n.previousDate);(o.getDate()!=a.getDate()||o.getMonth()!=a.getMonth()&&o.getFullYear()!=a.getFullYear())&&(n.hasDateBar=!0,n.display=n.date?t.getMomentDate(o):"No Date")}else(n.date||0==n.index)&&(n.hasDateBar=!0,n.display=n.date?t.getMomentDate(o):"No Date");return"Invalid date"==n.display,n.hasDateBar?s[0].outerHTML='<ion-item  class="item-divider item  date-bar">'+n.display+"</ion-item>":s[0].outerHTML="<div></div>",n.$on("$destroy",function(){window.dateBarDirectives--}),r}window.dateBarDirectives=window.dateBarDirectives||0,window.dateBarDirectives++,a()}}}])}.call(this),!function(e){"use strict";"function"==typeof define&&define.amd?define(["angular","moment"],e):"object"==typeof exports?module.exports=e(require("angular"),require("moment")):e(window.angular,window.moment)}(function(e,t){"use strict";e.module("ui.bootstrap.datetimepicker",[]).constant("dateTimePickerConfig",{dropdownSelector:null,minView:"day",startView:"day"}).directive("datetimepicker",["$log","dateTimePickerConfig","settingsService",function(n,s,r){function o(){var e=new Date;this.utcDateValue=e.getTime(),this.selectable=!0,this.localDateValue=function(){return this.utcDateValue+localOffset};var t=["utcDateValue","localDateValue","display","active","today","selectable","past","future"];for(var n in arguments[0])t.indexOf(n)>=0&&(this[n]=arguments[0][n])}var a=function(t){var s=["startView","minView","minuteStep","dropdownSelector"];for(var r in t)if(s.indexOf(r)<0)throw"invalid option: "+r;var o=["day","month","year"];if(o.indexOf(t.startView)<0)throw"invalid startView value: "+t.startView;if(o.indexOf(t.minView)<0)throw"invalid minView value: "+t.minView;if(o.indexOf(t.minView)>o.indexOf(t.startView))throw"startView must be greater than minView";if(null!==t.dropdownSelector&&!e.isString(t.dropdownSelector))throw"dropdownSelector must be a string";null===t.dropdownSelector||"undefined"!=typeof jQuery&&"function"==typeof jQuery().dropdown||(n.error("Please DO NOT specify the dropdownSelector option unless you are using jQuery AND Bootstrap.js. Please include jQuery AND Bootstrap.js, or write code to close the dropdown in the on-set-time callback. \n\nThe dropdownSelector configuration option is being removed because it will not function properly."),delete t.dropdownSelector)};return{restrict:"E",require:"ngModel",template:'<div class="datetimepicker table-responsive"><table class="table table-striped  {{ data.currentView }}-view">   <thead>       <tr>           <th class="left-arrow" data-ng-click="changeView(data.currentView, data.leftDate, $event)" data-ng-show="data.leftDate.selectable"><i class="tdzicon-back"/></th>           <th class="switch" colspan="5" data-ng-show="data.previousViewDate.selectable" data-ng-click="changeView(data.previousView, data.previousViewDate, $event)">{{ data.previousViewDate.display }}</th>           <th class="right-arrow" data-ng-click="changeView(data.currentView, data.rightDate, $event)" data-ng-show="data.rightDate.selectable"><i class="tdzicon-forward"/></th>       </tr>       <tr>           <th class="dow" data-ng-repeat="day in data.dayNames" >{{ day }}</th>       </tr>   </thead>   <tbody>       <tr data-ng-if="data.currentView !== \'day\'" >           <td colspan="7" >              <span    class="{{ data.currentView }}"                        data-ng-repeat="dateObject in data.dates"                         data-ng-class="{active: dateObject.active, past: dateObject.past, future: dateObject.future, disabled: !dateObject.selectable}"                        data-ng-click="changeView(data.nextView, dateObject, $event)">{{ dateObject.display }}</span>            </td>       </tr>       <tr data-ng-if="data.currentView === \'day\'" data-ng-repeat="week in data.weeks">           <td data-ng-repeat="dateObject in week.dates"                data-ng-click="changeView(data.nextView, dateObject, $event)"               class="day"                data-ng-class="{active: dateObject.active,today: dateObject.today ,past: dateObject.past, future: dateObject.future, disabled: !dateObject.selectable}" >{{ dateObject.display }}</td>       </tr>   </tbody></table></div>',scope:{onSetTime:"&",beforeRender:"&"},replace:!0,link:function(n,i,c,l){var u={};c.datetimepickerConfig&&(u=n.$parent.$eval(c.datetimepickerConfig));var d={};e.extend(d,s,u),a(d);var f=function(e){var n=10*parseInt(t.utc(e).year()/10,10);return t.utc(e).year(n).startOf("year")},p={year:function(e){for(var n=t.utc(e).startOf("year"),s=10*parseInt(n.year()/10,10),r=t.utc(f(e)).subtract(1,"year").startOf("year"),a=l.$modelValue?t(l.$modelValue).year():0,i={currentView:"year",nextView:"year"===d.minView?"setTime":"month",previousViewDate:new o({utcDateValue:null,display:s+"-"+(s+9)}),leftDate:new o({utcDateValue:t.utc(r).subtract(9,"year").valueOf()}),rightDate:new o({utcDateValue:t.utc(r).add(11,"year").valueOf()}),dates:[]},c=0;c<12;c+=1){var u=t.utc(r).add(c,"years"),p={utcDateValue:u.valueOf(),display:u.format("YYYY"),past:u.year()<s,future:u.year()>s+9,active:u.year()===a};i.dates.push(new o(p))}return i},month:function(e){for(var n=t.utc(e).startOf("year"),s=f(e),r=l.$modelValue?t(l.$modelValue).format("YYYY-MMM"):0,a={previousView:"year",currentView:"month",nextView:"month"===d.minView?"setTime":"day",previousViewDate:new o({utcDateValue:s.valueOf(),display:n.format("YYYY")}),leftDate:new o({utcDateValue:t.utc(n).subtract(1,"year").valueOf()}),rightDate:new o({utcDateValue:t.utc(n).add(1,"year").valueOf()}),dates:[]},i=0;i<12;i+=1){var c=t.utc(n).add(i,"months"),u={utcDateValue:c.valueOf(),display:c.format("MMM"),active:c.format("YYYY-MMM")===r};a.dates.push(new o(u))}return a},day:function(e){for(var n=t.utc(e),s=t.utc(n).startOf("month"),a=t.utc(n).startOf("year"),i=t.utc(n).endOf("month"),c=parseInt(r.getSettings().start_day.value),u=s.day(),d=7,f=c>u?d+u-c:u-c,p=t.utc(s).subtract(Math.abs(f),"days"),m=l.$modelValue?t(l.$modelValue).format("YYYY-MMM-DD"):"",g=t().format("YYYY-MMM-DD"),v={previousView:"month",currentView:"day",nextView:"setTime",previousViewDate:new o({utcDateValue:a.valueOf(),display:s.format("MMMM - YYYY")}),leftDate:new o({utcDateValue:t.utc(s).subtract(1,"months").valueOf()}),rightDate:new o({utcDateValue:t.utc(s).add(1,"months").valueOf()}),dayNames:[],weeks:[]},h=0;h<7;h+=1)v.dayNames.push(t.utc().weekday((c+h)%d).format("dd"));for(var E=0;E<6;E+=1){for(var k={dates:[]},T=0;T<7;T+=1){var S=t.utc(p).add(7*E+T,"days"),b={utcDateValue:S.valueOf(),display:S.format("D"),active:S.format("YYYY-MMM-DD")===m,today:S.format("YYYY-MMM-DD")===g,past:S.isBefore(s),future:S.isAfter(i)};k.dates.push(new o(b))}v.weeks.push(k)}return v},setTime:function(e){var t=new Date(e),s=new Date(t.getTime()+6e4*t.getTimezoneOffset()),r=l.$modelValue;return l.$setViewValue(s),d.dropdownSelector&&jQuery(d.dropdownSelector).dropdown("toggle"),n.onSetTime({newDate:s,oldDate:r}),p[d.startView](e)}},m=function(e){var n=e?t(e).toDate():new Date;return n.getTime()-6e4*n.getTimezoneOffset()};n.changeView=function(e,t,s){if(s&&(s.stopPropagation(),s.preventDefault()),e&&t.utcDateValue>-(1/0)&&t.selectable&&p[e]){var r=p[e](t.utcDateValue),o=[];if(r.weeks)for(var a=0;a<r.weeks.length;a+=1)for(var i=r.weeks[a],c=0;c<i.dates.length;c+=1){var l=i.dates[c];o.push(l)}n.beforeRender({$view:r.currentView,$dates:r.dates||o,$leftDate:r.leftDate,$upDate:r.previousViewDate,$rightDate:r.rightDate}),n.data=r}},l.$render=function(){n.changeView(d.startView,new o({utcDateValue:m(l.$viewValue)}))}}}}])}),function(){app.directive("tdzDatetimepicker",["$timeout","$ionicModal",function(e,t){return{require:"ngModel",scope:{ngModel:"=",canClearDate:"@",callback:"&"},link:function(n,s,r){function o(){l=!1,u=!1;var e=n.ngModel?new Date(n.ngModel):(new Date).setHours(0,0,0,0);n.datepicker={date:n.ngModel?new Date(n.ngModel):null,time:new Date(e)},c=n.$watch("datepicker.date",function(e,t){e!=t&&(l=!0,console.log("date changed to : "+e))}),i=n.$watch("datepicker.time",function(e,t){e!=t&&(u=!0,console.log("time changed to : "+e))})}function a(){c&&c(),i&&i()}n.currentTab="date";var i,c,l=!1,u=!1;s.on("click",function(){o(),t.fromTemplateUrl("html/directives/shared/datetimepicker.html",function(e){n.modal=e,n.modal.show()},{scope:n,animation:"scale-in"})}),n.discardDate=function(){n.datepicker.date=void 0},n.discardTime=function(){n.datepicker.time=new Date(n.datepicker.time.setHours(0,0,0,0))},n.save=function(){void 0!==n.datepicker.date||u?(null===n.datepicker.date&&u&&(n.datepicker.date=new Date),n.datepicker.time=new Date(n.datepicker.time),n.datepicker.date=new Date(n.datepicker.date),n.ngModel=new Date(n.datepicker.date.getFullYear(),n.datepicker.date.getMonth(),n.datepicker.date.getDate(),n.datepicker.time.getHours(),n.datepicker.time.getMinutes())):n.ngModel=void 0,a(),e(function(){n.modal.remove(),n.callback({value:l||u||void 0===n.datepicker.date?"CUSTOM_DATE":"NO_DATE",fieldsChanged:{date:l,time:u}})})},n.close=function(){a(),e(function(){n.modal.remove(),n.callback({value:"NO_DATE",fieldsChanged:{date:!1,time:!1}})})}}}}])}.call(this),!function(){app.directive("disableSwipe",["$ionicGesture",function(e){return{restrict:"A",link:function(t,n,s){function r(e){var t=e.gesture.direction;if(console.log("gesture event"),console.log(arguments),"left"==t)return console.log("cancelling gesture left"),e.preventDefault(),!1}var o=e.on("swipe",r,n);t.$on("$destroy",function(){e.off(o,"swipe",r)})}}}])}(),function(){app.directive("displayUserName",["userModel",function(e){return{restrict:"E",replace:!0,scope:{user:"="},transclude:!0,template:"<span>{{name}} <ng-transclude></ng-transclude> </span>",link:function(t,n,s){var r=e.getLoggedInId();t.$watch("user",function(){t.name=t.user._id==r?"Me ":t.user.displayName+" "})}}}])}.call(this),function(){app.directive("sortable",["$ionicGesture","$ionicScrollDelegate","$timeout",function(e,t,n){return{restrict:"A",link:function(n,s,r){function o(e,t,n,s){var r,o,a="",i=n[e];if(e<n.length)if(e>0){var c=n[e-1],l=$(c).position().top+$(c).height()+1,u=$(i).position().top+1;t-l<u-t?(a="insertAfter",o=c,r=s.index(o)):(a="insertBefore",o=i,r=s.index(o))}else a="insertBefore",o=i,r=s.index(i);else a="insertAfter",i=n[e-1],o=i,r=s.index(i);return{closestIndex:r,relativeCard:o,positionToInsert:a}}var a,i,c,l,u,d,f,p,m={draggable:r.draggable?r.draggable:".card",duration:200},g=null,v=null,h=0,E=0,k=!1,T=function(e){return $("<div></div>").css({height:e+"px",marginTop:(l>0?-E:-1)+"px"}).addClass("placeholder")},S=function(e){if(g=angular.element(e.target).closest(m.draggable),g.length||(g=null),g){i=s.find(m.draggable),c=l=i.index(g);var t=g.position(),n=e.gesture.touches[0].clientY;h=n-t.top-s.offset().top,g.css({position:"absolute",zIndex:1e3,left:t.left+"px",top:t.top+"px",width:g.outerWidth()+"px"}).addClass("dragging"),a=i.not(".dragging");var r=n-h-s.offset().top,k=o(c,r,a,i);u=k.closestIndex,d=u,E=parseInt(g.css("marginTop"))+1,f=g.outerHeight()+E,v=T(f),v.insertAfter(g),U(),p=setInterval(j,20)}},b=e.on("hold",S,s),_=function(e){if(g){e.stopPropagation(),O=e.touches?e.touches[0].clientY:e.clientY;var t=O-h-s.offset().top;g.css("top",t+"px");var n,r,c=0;if(a.each(function(e){var s=$(this).position().top;if(t>s&&(c=e+1,n=s,e>0)){var o=a[e-1];r=$(o).position().top+$(o).height()}}),!k&&c!==l){l=c;var d=v;v=T(1);var p=o(c,t,a,i);p&&(v[p.positionToInsert](p.relativeCard),u=p.closestIndex),k=!0,setTimeout(function(){v&&(v.css("height",f+"px"),d.css("height",1),setTimeout(function(){d.remove(),k=!1},m.duration))},50)}}},I=e.on("touchmove",_,s),y=e.on("mousemove",_,s),w=function(e){function t(e){g.css({position:"",zIndex:"",left:"",top:"",width:""}).removeClass("dragging"),e?v.replaceWith(g):v.remove(),v=null,g=null}g&&(clearInterval(p),c===l&&d==u||!r.sorted?t():(n.$fromIndex=c,n.$toIndex=l,n.$closestIndex=u,n.$apply(function(){var e=n[r.sorted],s=e(c,l,u);s&&s.then?s.then(function(){t(!0)},function(){t()}):t()})))},D=e.on("release",w,s);n.$on("$destroy",function(){e.off(b,"hold",S),e.off(I,"touchmove",_),e.off(y,"mousemove",_),e.off(D,"release",w),p&&clearInterval(p)});var O,A,R,M,C=80,N=.2,L=t,U=function(){O=-1;var e=s.closest(".scroll"),n=e.parent();A=n.height(),R=n.position().top,M=e.height()-A,$(n).attr("delegate-handle")&&(L=t.$getByHandle($(n).attr("delegate-handle")))},j=function(){var e=0;if(O>=0&&O<R+C?e=O-(R+C):O>=0&&O>A-C&&(e=O-(A-C)),0!==e){var t=L.getScrollPosition().top+N*e;t<0?t=0:t>M&&(t=M),L.scrollTo(0,t,!1)}}}}}])}.call(this),function(){app.directive("select2",["$timeout","$parse",function(e,t){return{restrict:"AC",require:"ngModel",scope:{placeholder:"@"},link:function(t,n,s){e(function(){n.select2({minimumResultsForSearch:1/0,placeholder:t.placeholder}),n.select2Initialized=!0});var r=function(){n.select2Initialized&&e(function(){n.trigger("change")})},o=function(){n.select2Initialized&&e(function(){n.select2("destroy"),n.select2({minimumResultsForSearch:1/0,placeholder:t.placeholder})})};if(t.$watch(s.ngModel,r),s.ngOptions){var a=s.ngOptions.match(/ in ([^ ]*)/)[1];t.$watch(a,o)}s.ngDisabled&&t.$watch(s.ngDisabled,r)}}}])}.call(this),function(){app.constant("msdElasticConfig",{append:""}),app.directive("msdElastic",["$timeout","$window","msdElasticConfig",function(e,t,n,s){"use strict";return{require:"ngModel",restrict:"A, C",link:function(n,r,o,a){function i(){var e=h;p=u,T=getComputedStyle(u),angular.forEach(O,function(t){e+=t+":"+T.getPropertyValue(t)+";"}),k.setAttribute("style",e)}function c(){var t,s,r,o,a;p!==u&&i(),m||(m=!0,k.value=u.value+g,k.style.overflowY=u.style.overflowY,t=""===u.style.height?"auto":parseInt(u.style.height,10),s=getComputedStyle(u).getPropertyValue("width"),"px"===s.substr(s.length-2,2)&&(o=parseInt(s,10)-_.width,k.style.width=o+"px"),r=k.scrollHeight,r>D?(r=D,a="scroll"):r<w&&(r=w),r+=_.height,u.style.overflowY=a||"hidden",t!==r&&(u.style.height=r+"px",n.$emit("elastic:resize",d)),n.$emit("taResize",d),e(function(){m=!1},1))}function l(){m=!1,c()}var u=r[0],d=r;if("TEXTAREA"===u.nodeName&&t.getComputedStyle){d.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var f=u.value;u.value="",u.value=f;var p,m,g=o.msdElastic?o.msdElastic.replace(/\\n/g,"\n"):s.append,v=angular.element(t),h="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",E=angular.element('<textarea tabindex="-1" style="'+h+'"/>').data("elastic",!0),k=E[0],T=getComputedStyle(u),S=T.getPropertyValue("resize"),b="border-box"===T.getPropertyValue("box-sizing")||"border-box"===T.getPropertyValue("-moz-box-sizing")||"border-box"===T.getPropertyValue("-webkit-box-sizing"),_=b?{width:parseInt(T.getPropertyValue("border-right-width"),10)+parseInt(T.getPropertyValue("padding-right"),10)+parseInt(T.getPropertyValue("padding-left"),10)+parseInt(T.getPropertyValue("border-left-width"),10),height:parseInt(T.getPropertyValue("border-top-width"),10)+parseInt(T.getPropertyValue("padding-top"),0)+parseInt(T.getPropertyValue("padding-bottom"),0)+parseInt(T.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},I=parseInt(T.getPropertyValue("min-height"),10),y=parseInt(T.getPropertyValue("height"),10),w=Math.max(I,y)-_.height,D=parseInt(T.getPropertyValue("max-height"),10),O=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];d.data("elastic")||(D=D&&D>0?D:9e4,k.parentNode!==document.body&&angular.element(document.body).append(k),d.css({resize:"none"===S||"vertical"===S?"none":"horizontal"}).data("elastic",!0),"onpropertychange"in u&&"oninput"in u?u.oninput=u.onkeyup=c:u.oninput=c,v.bind("resize",l),n.$watch(function(){return a.$modelValue},function(e){l()}),n.$on("elastic:adjust",function(){i(),l()}),e(c),n.$on("$destroy",function(){E.remove(),v.unbind("resize",l)}))}}}}])}.call(this),function(){app.directive("favouriteButton",function(){var e;return e={restrict:"AE",replace:!0,templateUrl:"html/directives/shared/favourite_button_directive.html",scope:{favourited:"@"},controller:function(e){var t;t=function(){return e.favourited=!e.favourited},e.buttonClicked=t}}})}.call(this),!function(){app.directive("fixShiftKey",[function(){return{restrict:"A",link:function(e,t,n){function s(e){16==e.keyCode&&(window.fixes=window.fixes||{},window.fixes.shiftKey=!0)}function r(e){16==e.keyCode&&window.fixes&&delete window.fixes.shiftKey}$(window).on("keydown",s),$(window).on("keyup",r)}}}])}(),function(){app.directive("focusMe",["$parse","$ionicScrollDelegate","$location","$timeout",function(e,t,n,s){return{restrict:"AE",link:function(e,r,o){function a(){if(!c){var e=n.search().focusMe;if(void 0!==e){var s=$("#"+e);if(s.length>0){var r=s.position(),a=r.top,i=r.left;o.focusMeOffsetTop&&(a-=parseInt(o.focusMeOffsetTop)),t.scrollTo(i,a),c=!0;var l=s;return o.focusMeBackgroundSelector&&(l=$(o.focusMeBackgroundSelector,s)),void l.animate({backgroundColor:"#e5eff7"},"fast").animate({backgroundColor:"none"},"fast").animate({backgroundColor:"#e5eff7"},"fast").animate({backgroundColor:"none"},"fast").promise().then(function(){console.log("animation complete"),console.log(s)})}console.log("element with id "+n.search().focusMe+"not found")}}}console.log("focus me called");var i,c=!1;o.watch?e.$watch(o.watch,function(e,t){void 0!==e&&(i&&s.cancel(i),i=s(function(){a()},200))}):a()}}}])}.call(this),function(){app.directive("tdzImagepicker",["$ionicModal","$rootScope","message","$ionicLoading","Cropper","$timeout","settingsService","userModel","guidGenerator",function(e,t,n,s,r,o,a,i,c){return{require:"ngModel",scope:{ngModel:"="},link:function(n,l,u,d){function f(){e.fromTemplateUrl("html/directives/shared/image_picker.html",function(e){n.modal=e,n.modal.show()},{scope:n,animation:"scale-in"})}function p(){n.$broadcast(n.showEvent)}n.width=300;var m,g=!1;l.on("click",function(){n.dataUrl=n.ngModel,o(f())}),n.clear=function(){n.dataUrl=null,m=null,g=!0},n.close=function(){n.dataUrl=null,n.modal.remove()},n.onFileSelected=function(e){e&&e.length&&r.encode(m=e[0]).then(function(e){n.dataUrl=e,o(p)})},n.uploadAndSave=function(){m?(s.show(),r.crop(m,data).then(function(e){return r.scale(e,{width:n.width
})}).then(function(e){e.name=m.name;var n={parent:i.getLoggedInId(),id:c.getId(),file:e};a.uploadAvatar(n).then(function(e){t.$emit("toast-message",e.msg),s.hide()})})):g&&a.removeAvatar({userId:i.getLoggedInId(),avatar:null}).then(function(e){t.$emit("toast-message",e.msg),s.hide()}),n.close()},n.showEvent="show",n.hideEvent="hide",n.options={maximize:!0,aspectRatio:1,guides:!1,crop:function(e){data=e}}}}}])}.call(this),app.directive("leftMenuEdit",["$timeout",function(e){return{restrict:"A",link:function(t,n,s){var r=n[0];n.bind("blur",function(){n.attr("disabled",!0)}),t.$watch(s.leftMenuEdit,function(t){t&&e(function(){n.removeAttr("disabled"),r.focus()})})}}}]),function(){app.directive("ngShiftEnter",function(){return function(e,t,n){var s={16:!1,13:!1};t.bind("keydown",function(t){t.which in s&&(s[t.which]=!0,s[16]&&s[13]&&(e.$apply(function(){e.$eval(n.ngShiftEnter,{event:t})}),t.preventDefault()))}),t.bind("keyup",function(e){e.which in s&&(s[e.keyCode]=!1)})}})}.call(this),function(){app.directive("notificationChannels",["userModel","stringService",function(e,t){return{restrict:"E",replace:!0,scope:{channels:"=",assignee:"="},template:"<span>{{channelList}}</span>",link:function(n,s,r){n.$watch("channels",function(){var s=[],r=e.getLoggedInId();n.channels.email.value&&s.push(n.channels.email.title),n.channels.push.value&&s.push(n.channels.push.title),s=s.join(", ");var o=s.lastIndexOf(",");o!=-1&&(s=s.substring(0,o)+" and "+s.substring(o+1)),s=s.replace(/, $/," and "),n.assignee?n.assignee._id!=r?n.channelList=t.EMPTY:n.channelList=s+": ":n.channelList=s})}}}])}.call(this),!function(){app.directive("passwordValidation",["$q","user","connectivity",function(e,t,n){return{require:"ngModel",link:function(s,r,o,a){a.$asyncValidators.password=function(s,r){if(a.$isEmpty(s)||!n.isConnected())return $.when();var o=e.defer();return t.validatePassword(s).then(function(e){e?o.resolve():o.reject()},function(e){o.reject()}),o.promise}}}}])}(),function(){app.directive("tdzRecurrencepicker",["$timeout","$ionicModal","settingsService","date","dueService",function(e,t,n,s,r){return{require:"ngModel",scope:{ngModel:"=",callback:"&"},link:function(o,a,i){function c(){o.recurrencePicker={isRecurring:!0,repeat:o.ngModel.repeat||r.REPEAT_KEY.DAILY,every:o.ngModel.every||1,starts_on:o.ngModel.starts_on||new Date,repeatBy:o.ngModel.repeatBy||0,repeatOn:l(),repeatEnd:o.ngModel.repeatEnd||{id:0,end:null,occurrence:null,remainingOccurrence:null}},o.repeats=r.REPEAT_ITEMS,o.repeatByList=r.REPEAT_BY_ITEMS,o.repeatByList[o.recurrencePicker.repeatBy].checked=!0,o.start_on_display=s.getDateTime(o.recurrencePicker.starts_on),o.updateSummary()}function l(){var e=n.getSettings().start_day.value,t=angular.copy(r.REPEAT_ON_ITEMS);o.ngModel.repeatOn&&_.each(t,function(e){var t=_.find(o.ngModel.repeatOn||[],function(t){return t.title==e.title});t&&(e.checked=t.checked)});for(var s=angular.copy(t),a=0;a<e;a++)t.push(s[a]);return t.splice(0,e),t}function u(){t.fromTemplateUrl("html/directives/shared/repeat.html",function(e){o.repeatModal=e},{scope:o,animation:"scale-in"}),t.fromTemplateUrl("html/directives/shared/repeat_every.html",function(e){o.repeatEveryModal=e},{scope:o,animation:"scale-in"}),t.fromTemplateUrl("html/directives/shared/recurrence_picker.html",function(e){o.modal=e,o.modal.show()},{scope:o,animation:"scale-in"})}function d(){o.repeatEveryModal.remove(),o.repeatModal.remove(),o.modal.remove()}a.on("click",function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!1),c(),u()}),o.save=function(){var t={isRecurring:!0,repeat:o.recurrencePicker.repeat,every:o.recurrencePicker.every,starts_on:o.recurrencePicker.starts_on||new Date,repeatEnd:o.recurrencePicker.repeatEnd};o.recurrencePicker.repeat===r.REPEAT_KEY.WEEKLY&&(t.repeatOn=o.recurrencePicker.repeatOn),o.recurrencePicker.repeat===r.REPEAT_KEY.MONTHLY&&(t.repeatBy=o.recurrencePicker.repeatBy,t.weekNumber=o.recurrencePicker.weekNumber),o.ngModel=angular.copy(t),d(),e(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!0),o.callback({model:o.ngModel})})},o.close=function(){d(),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!0),o.callback()},o.setStartOn=function(e){e&&(o.start_on_display=s.getDateTime(o.recurrencePicker.starts_on),o.updateSummary())},o.setEndDate=function(e){e&&(o.end_display=s.getDateTime(o.recurrencePicker.repeatEnd.end),o.setRepeatEnd())},o.setRepeat=function(e){o.recurrencePicker.repeat=e,o.updateSummary(),o.repeatModal.hide()},o.setRepeatEvery=function(e){o.recurrencePicker.every=e,o.updateSummary(),o.repeatEveryModal.hide()},o.setRepeatBy=function(){if(o.recurrencePicker.repeatBy){var e=new Date;e.setDate(1);for(var t=0;t<7&&e.getDay()!=o.recurrencePicker.starts_on.getDay();t++)e.setDate(e.getDate()+1);o.recurrencePicker.weekNumber=(o.recurrencePicker.starts_on.getDate()-e.getDate())/7}o.updateSummary()},o.setRepeatEnd=function(){switch(o.recurrencePicker.repeatEnd.id){case 0:o.recurrencePicker.repeatEnd={id:0,end:null,occurrence:null,remainingOccurrence:null};break;case 1:o.recurrencePicker.repeatEnd={id:1,end:null,occurrence:o.recurrencePicker.repeatEnd.occurrence,remainingOccurrence:o.recurrencePicker.repeatEnd.occurrence};break;case 2:o.recurrencePicker.repeatEnd={id:2,end:o.recurrencePicker.repeatEnd.end,occurrence:null,remainingOccurrence:null}}console.log(o.recurrencePicker.repeatEnd),o.updateSummary()},o.updateSummary=function(){o.summary=r.getSummary(o.recurrencePicker),o.recurrencePicker.repeatEnd&&o.recurrencePicker.repeatEnd.end&&(o.end_display=s.getDateTime(o.recurrencePicker.repeatEnd.end))}}}}])}.call(this),function(){app.directive("stickyHeader",["$ionicPosition","$compile","$rootScope",function(e,t,n){return{restrict:"A",require:"^$ionicScroll",link:function(s,r,o,a){var i,c=angular.element(a.element),l=ionic.Platform.isIOS()?90:ionic.Platform.isAndroid()?70:5,u=function(e,t){for(var n=e.getElementsByTagName("textarea"),s=t.getElementsByTagName("textarea"),r=e.getElementsByTagName("select"),o=t.getElementsByTagName("select"),a=0,i=n.length;a<i;++a)s[a].value=n[a].value;for(var a=0,i=r.length;a<i;++a)o[a].value=r[a].value},d=function(n){i=n.clone().css({position:"absolute",top:e.position(c).top+"px",left:0,right:0}),o.ionStickyClass=o.ionStickyClass?o.ionStickyClass:"assertive",u(n[0],i[0]),i[0].className+=" "+o.ionStickyClass,i.removeAttr("ng-repeat-start").removeAttr("ng-if"),c.parent().append(i),t(i)(s)},f=function(){i&&i.remove(),i=null};s.$on("$destroy",function(){f(),angular.element(a.element).off("scroll")});var p,m=ionic.throttle(function(t){for(var n=null,s=[],o=r[0].getElementsByClassName("item-divider"),a=0;a<o.length;++a)s.push(angular.element(o[a]));for(var a=0;a<s.length;++a)if(e.offset(s[a]).top-s[a].prop("offsetHeight")<l&&(a===s.length-1||e.offset(s[a+1]).top-(s[a].prop("offsetHeight")+s[a+1].prop("offsetHeight"))>l)){n=s[a][0];break}(p!=n||t)&&(f(),p=n,null!=n&&d(angular.element(n)))},200);c.on("scroll",function(e){m()}),n.$on("update-sticky",function(){m(!0)})}}}])}.call(this),function(){app.directive("tdzReminderpicker",["$timeout","$ionicModal","settingsService","userModel","date","guidGenerator","reminderService","message","$q","dbEnums","roleValidators",function(e,t,n,s,r,o,a,i,c,l,u){return{require:"ngModel",scope:{ngModel:"=",assignees:"=",dueDate:"=",callback:"&",isEmailEnabled:"=",defaultReminderChannels:"="},link:function(d,f,p){function m(){t.fromTemplateUrl("html/directives/shared/tdz-reminderpicker/reminder.html",function(e){d.modal=e,d.modal.show()},{scope:d,animation:"scale-in"}),t.fromTemplateUrl("html/directives/shared/tdz-reminderpicker/assignees.html",function(e){d.userModal=e},{scope:d,animation:"scale-in"}),t.fromTemplateUrl("html/directives/shared/tdz-reminderpicker/notification-channels.html",function(e){d.notificationChannelModal=e},{scope:d,animation:"scale-in"}),t.fromTemplateUrl("html/directives/shared/tdz-reminderpicker/reminder-time.html",function(e){d.reminderTimeModal=e},{scope:d,animation:"scale-in"})}function g(){d.reminder=d.ngModel||E,d.noDueDate=!d.dueDate,d.isDifferentUser=!1,d.valid=!0,d.notificationChannels=angular.copy(d.defaultReminderChannels||a.notificationChannels),d.isEmailEnabled||(d.notificationChannels.email.value=!1,d.notificationChannels.email.notified=!0,d.notificationChannels.push.value=!0,d.notificationChannels.push.notified=!1),d.reminderTime=a.timeDuration,d.reminder.assignee=b,d.reminder.notificationChannels=angular.copy(d.notificationChannels),d.users=angular.copy(d.assignees),d.users.splice(0,1),d.users.length||d.users.push(s.getLoggedInUser())}function v(){d.reminder.dateTime=new Date;var e=new Date(S.reminder.defaultTime);d.reminder.dateTime.setHours(e.getHours()),d.reminder.dateTime.setMinutes(e.getMinutes())}function h(){var e=moment(new Date);if(d.valid=!!d.reminder.time,d.validationError=i.errorMessages.REMINDER_TIME_REQUIRED,d.valid&&1==d.reminder.time.id&&e.diff(d.reminder.time.value)>k)d.valid=!1,d.validationError=i.errorMessages.REMINDER_TIME_VALIDATION_ERROR_FOR_FIXED;else if(d.valid&&0==d.reminder.time.id){var t=a.getScheduledTime(d.reminder,d.dueDate);r.isAfter(t,e)||(d.valid=!1,d.validationError=i.errorMessages.REMINDER_TIME_VALIDATION_ERROR_FOR_RELATIVE)}}var E={},k=-12e4,T=null,S=n.getSettings(),b=s.getLoggedInUser();f.on("click",function(){g(),m(),v()}),d.addChannels=function(){(d.notificationChannels.email.value||d.notificationChannels.push.value)&&(d.reminder.notificationChannels=angular.copy(d.notificationChannels),d.notificationChannelModal.hide())},d.channelClicked=function(e){var t=c(function(t,n){if("Email"==e.title&&0==e.value){var r=s.getLoggedInUser();u.checkUserRole(r,l.USER_ROLES.EMAIL_NOTIFICATIONS,{},!0).then(t,n)}else t()});t.then(function(){e.value=!e.value,e.notified=!e.value})},d.openNotificationChannelModal=function(){d.notificationChannels=angular.copy(d.reminder.notificationChannels),d.notificationChannelModal.show()},d.updateAssignee=function(e){d.reminder.assignee=e,d.isDifferentUser=b._id!=e._id},d.updateReminderDate=function(e){"CUSTOM_DATE"==e?(d.reminder.time.id=1,d.reminder.time.value=angular.copy(d.reminder.dateTime),d.reminder.time.title=r.getDateTime(d.reminder.time.value),T=angular.copy(d.reminder.time),v(),h()):d.reminder.time=angular.copy(T)},d.updateReminderTime=function(e){e?(d.reminder.time=angular.copy(e),d.reminder.time.id=0,T=angular.copy(d.reminder.time),h()):d.reminder.time=angular.copy(T),d.reminderTimeModal.hide()},d.save=function(){h(),d.valid&&(d.reminder.id=o.getId(),d.reminder.updatedBy=s.getLoggedInUser(),d.reminder.date_created=new Date,d.ngModel=d.reminder,e(function(){d.modal.remove(),d.callback({newReminder:!0})}))},d.close=function(){d.modal.remove(),d.callback({newReminder:!1})},d.$watch("reminder.time.id",function(e){0!=e&&1!=e||(d.valid=!0)})}}}])}.call(this),function(){app.directive("tdzTimepicker",["$timeout","$ionicModal",function(e,t){return{require:"ngModel",scope:{ngModel:"=",canClearDate:"@",callback:"&"},link:function(n,s,r){function o(){n.picker={time:n.ngModel?new Date(n.ngModel):new Date}}s.on("click",function(){o(),t.fromTemplateUrl("html/directives/shared/timepicker.html",function(e){n.modal=e,n.modal.show()},{scope:n,animation:"scale-in"})}),n.save=function(){n.ngModel=new Date(n.picker.time),e(function(){n.modal.remove(),n.callback({newTime:!0})})},n.close=function(){n.modal.remove(),n.callback({newTime:!1})}}}}])}.call(this),function(){app.directive("uiTimepicker",["moment",function(e){return{restrict:"EA",require:"ngModel",scope:{datetime:"=ngModel"},replace:!0,template:"<div></div>",link:function(t,n,s){function r(t){return"AM"===e(t).format("A")}function o(){i=c=g-v.right-v.left-v.top-v.bottom,l=u=i/2,h=.2*i,f.outerRadius(i/2),f.innerRadius(i/2*.85)}function a(n,s,r,o){var a=Math.min((T-E)/(k-E),1),c=Math.min(360*a,360)*Math.PI/180;f.endAngle(c),n.attr("d",f);var l=360*T/k,u=i/2-5,d=u*Math.cos((l-90)*Math.PI/180),p=u*Math.sin((l-90)*Math.PI/180);s.attr("cx",d).attr("cy",p);var m=e(t.datetime).hours(),g=m>=12?m-12:m,v=e(t.datetime).minutes(),h=""+g+":";v<10&&(h+="0"),h+=v,r.text(h),o.text(e(t.datetime).format("A"))}var i,c,l,u,d=d3.select(n[0]),f=d3.svg.arc().startAngle(0*(Math.PI/180)).endAngle(360*(Math.PI/180)),p=245,m=p,g=p,v={top:15,right:10,bottom:10,left:15},h=10,E=1,k=720,T=1,S=!1;d.each(function(n){o();var s=d3.select(this).selectAll("svg").data([n]),d=s.enter().append("svg").attr("class","x1-timepicker-svg").append("g").attr("transform","translate("+v.left+","+v.top+")");s.attr("width",p).attr("height",m);var g=d.append("g").attr("class","x1-timepicker-component"),E=(g.append("circle").attr("class","x1-timepicker-inner").attr("transform","translate("+l+","+u+")").attr("cx",0).attr("cy",0).attr("r",i/2),g.append("path").attr("transform","translate("+l+","+u+")").attr("d",f),d.append("g").attr("class","x1-timepicker-arcs")),b=E.append("path").attr("class","arc").attr("transform","translate("+l+","+u+")").attr("d",f),_=d.append("g").attr("class","x1-timepicker-labels"),I=_.append("text").attr("class","time").attr("x",l).attr("y",u+h/3).attr("width",i).style("font-size",1.4*h+"px"),y=_.append("text").attr("class","ampm").attr("cursor","pointer").attr("x",l).attr("y",i/1.4+h/3).attr("width",i).style("font-size",.6*h+"px").on("click",function(){var n=r(t.datetime),s=n?12:-12;S=!n,t.datetime=e(t.datetime).add(s,"hour").toDate(),d3.select(this).text(e(t.datetime).format("A")),t.$apply()}),w=d3.behavior.drag().on("drag",function(){var n=d3.event.x,s=d3.event.y,r=(Math.PI*i,0),o=0,l=n-i/2,u=c/2-s,d=(u-o)/(l-r),f=Math.abs(Math.atan(d)/(Math.PI/180)),p=0;l>0&&u>=0?p=90-f:l>=0&&u<0?p=90+f:l<0&&u<=0?p=270-f:l<=0&&u>0&&(p=270+f),T=k*(p/360);var m=Math.floor(T/60);m=S?m:m+12,t.datetime=e(t.datetime).set("hour",m).set("minute",T%60).set("second",0).toDate(),t.$apply(function(){a(b,D,I,y)})}),D=d.append("g").append("circle").attr("class","x1-timepicker-handler").attr("cursor","pointer").attr("transform","translate("+l+","+u+")").attr("cx",0).attr("cy",0).attr("r",18).attr("fill","#FFFFFF").call(w),O=function(t){var n=e(t).hours(),s=n>=12?n-12:n,r=e(t).minutes();T=60*s+r,a(b,D,I,y)};O(t.datetime),S=r(t.datetime),t.$watch("datetime",function(e,t){O(e)})})}}}])}.call(this),function(){app.service("filterService",["$q","$window","$rootScope","labelService","date","filterModel","dbEnums","message","sync",function(e,t,n,s,r,o,a,i,c){function l(e,t){for(var n=0;n<t.length;n++)if(e.project.id===t[n]._id)return!0;return!1}function u(e,t){for(var n=null,s=0;s<e.users.length;s++)if(e.users[s].role===a.taskUserRole.assignee&&e.users[s]._id||0==e.project.id&&e.users[s].role==a.taskUserRole.admin){n=e.users[s];break}for(var r=0;r<t.length;r++)if(n&&n._id===t[r]._id)return!0;return!1}function d(e,t){for(var n=0;n<t.length;n++)if(e.priority===t[n].number)return!0;return!1}function f(e,t){var n=!1;return t.forEach(function(t){s.findById(t._id).then(function(t){t&&s.isTaskExists(e,t)&&(n=!0)})}),n}function p(e,t){var n=!1;switch(t){case k.dueDates[0]:e.recurrence.due_date||(n=!0);break;case k.dueDates[1]:r.isPastDay(e.recurrence.due_date)&&(n=!0);break;case k.dueDates[2]:r.isToday(e.recurrence.due_date)&&(n=!0);break;case k.dueDates[3]:r.isTomorrow(e.recurrence.due_date)&&(n=!0);break;case k.dueDates[4]:r.isInNextNDays(e.recurrence.due_date,2)&&(n=!0);break;case k.dueDates[5]:r.isInNextNDays(e.recurrence.due_date,3)&&(n=!0);break;case k.dueDates[6]:r.isInNextNDays(e.recurrence.due_date,5)&&(n=!0);break;case k.dueDates[7]:r.isInNextNDays(e.recurrence.due_date,7)&&(n=!0);break;case k.dueDates[8]:r.isInNextNDays(e.recurrence.due_date,14)&&(n=!0);break;case k.dueDates[9]:r.isInNextNMonths(e.recurrence.due_date,1)&&(n=!0);break;case k.dueDates[10]:r.isInNextNMonths(e.recurrence.due_date,6)&&(n=!0);break;case k.dueDates[11]:r.isInNextNYears(e.recurrence.due_date,1)&&(n=!0)}return n}function m(e,t){return t.allProjects||!t.allProjects&&0==t.projects.length||l(e,t.projects)}function g(e,t){return t.allAssignees||!t.allAssignees&&0==t.assignees.length||u(e,t.assignees)}function v(e,t){return t.allPriorities||!t.allPriorities&&0==t.priorities.length||d(e,t.priorities)}function h(e,t){return t.allLabels||!t.allLabels&&0==t.labels.length||f(e,t.labels)}function E(e,t){return!t.due_date||p(e,t.due_date)}var k=this;k.addOrUpdate=function(t){var n=e.defer();return c.add(a.collections.Filter,t,a.events.Filter.addOrUpdate),o.addOrUpdate(t,function(e,t){n.resolve(t)}),n.promise},k.findById=function(t){var n=e.defer();return o.findById(t,function(e,t){n.resolve(t)}),n.promise},k.getAll=function(){var t=e.defer();return o.getAll(function(e,n){t.resolve(n)}),t.promise},k.delete=function(t){var n=e.defer();return c.add(a.collections.Filter,t,a.events.Filter.delete),o.delete(t.id,function(e,t){n.resolve(t)}),n.promise},k.removeProjectFromAllFilters=function(e){o.getAll(function(t,n){n.forEach(function(t){t.projects.forEach(function(n,s){n._id==e.id&&t.projects.splice(s,1)})}),o.bulkUpdate(n,function(){})})},k.updateItem=function(e){e.status===a.status.active?o.addOrUpdate(e,function(e,t){}):e.status===a.status.deleted&&o.delete(e.id,function(e,t){})},k.setProjects=function(e){var t=[];return e.forEach(function(e){e.checked&&t.push({_id:e.project.id,name:e.project.name,color:e.project.color})}),t},k.setAssignees=function(e){var t=[];return e.forEach(function(e){e.checked&&t.push({_id:e.assignee._id,displayName:e.assignee.displayName,displayShortName:e.assignee.displayShortName,email:e.assignee.email,avatar:e.assignee.avatar})}),t},k.setPriorities=function(e){var t=[];return e.forEach(function(e){e.checked&&t.push({name:e.priority.name,number:e.priority.number,color:e.priority.color})}),t},k.setLabels=function(e){var t=[];return e.forEach(function(e){e.checked&&t.push({_id:e.label.id,name:e.label.name,color:e.label.color})}),t},k.isTaskExists=function(e,t){var n=m(e,t),s=g(e,t),r=v(e,t),o=h(e,t),a=E(e,t);return n&&s&&r&&o&&a},k.fields=[{project:!1,people:!1,priority:!1,label:!1,dueDate:!1}],k.dueDates=["No date","Overdue","Today","Tomorrow","Within 2 days","Within 3 days","Within 5 days","Within 1 week","Within 2 weeks","Within 1 month","Within 6 months","Within 1 year"]}])}.call(this),function(){app.service("historyService",["$q","$http","taskService","connectivity","API","RESPONSE_CODE","message","userModel",function(e,t,n,s,r,o,a,i){var c=this;c.getAllHistories=function(n,c){var l=e.defer();if(s.isConnected()){var u={skip:n,limit:c,userId:i.getLoggedInId()};t.post(r.history.GET.all,u).success(function(e){e.response_code===o.SUCCESS?l.resolve(e.data):e.response_code===o.ERROR&&l.resolve({error:!0,msg:a.errorMessages[e.errors.value],results:e})}).error(function(e){l.resolve({error:!0,msg:a.errorMessages.GENERAL,results:e})})}else l.resolve({error:!0,msg:a.errorMessages.CONNECTION_REQUIRED});return l.promise},c.getHistoriesByTaskId=function(n,i,c){var l=e.defer();if(s.isConnected()){var u={skip:i,limit:c,taskIds:[n]};t.post(r.history.GET.historiesByTask,u).success(function(e){e.response_code===o.SUCCESS?l.resolve(e.data):e.response_code===o.ERROR&&l.resolve({error:!0,msg:a.errorMessages[e.errors.value],results:e})}).error(function(e){l.resolve({error:!0,msg:a.errorMessages.GENERAL,results:e})})}else l.resolve({error:!0,msg:a.errorMessages.CONNECTION_REQUIRED});return l.promise}}])}.call(this),function(){app.service("labelService",["$rootScope","$q","sharedData","sync","dbEnums","roleValidators","labelModel","userModel",function(e,t,n,s,r,o,a,i){var c=this;c.addOrUpdate=function(e){var n=t.defer(),c=i.getLoggedInUser();return o.checkUserRole(c,[r.USER_ROLES.LABELS],{label:e,user:c},!0).then(function(){console.log("lbl added "+e.name),s.add(r.collections.Label,e,r.events.Label.addOrUpdate),a.addOrUpdate(e,function(e,t){n.resolve(t)})},n.reject),n.promise},c.addTaskToLabels=function(e,t){e.forEach(function(e){if(e.checked&&!c.isTaskExists(t,e.label))e.label.tasks.push(t),a.addOrUpdate(e.label,function(e,t){});else if(!e.checked&&c.isTaskExists(t,e.label)){var n=e.label.tasks.indexOf(t);e.label.tasks.splice(n,1),a.addOrUpdate(e.label,function(e,t){})}})},c.addLabelsOnTask=function(e,n){return t(function(s,r){var o=t(function(e,t){e()});_.each(e,function(e){c.isTaskExists(n.id,e)||(o=o.then(function(){return t(function(t,s){e.tasks.push(n.id),a.addOrUpdate(e,function(e,n){t()})})}))}),o.then(s,r)})},c.delete=function(e){var n=t.defer();return s.add(r.collections.Label,e,r.events.Label.delete),a.delete(e.id,function(e,t){n.resolve(t)}),n.promise},c.findById=function(e){var n=t.defer();return a.findById(e,function(e,t){n.resolve(t)}),n.promise},c.getAll=function(){var e=t.defer();return a.getAll(function(t,n){e.resolve(n)}),e.promise},c.isTaskExists=function(e,t){for(var n=0;n<t.tasks.length;n++)if(t.tasks[n]==e)return!0;return!1},c.removeTaskFromAllLabels=function(e){a.getAll(function(t,n){n.forEach(function(t){t.tasks.forEach(function(n,s){n==e.id&&t.tasks.splice(s,1)})}),a.bulkUpdate(n,function(){})})},c.updateItem=function(e){e.status===r.status.active?a.addOrUpdate(e,function(e,t){}):e.status===r.status.deleted&&a.delete(e.id,function(e,t){})},c.reOrderLabelList=function(e,t){}}])}.call(this),function(){app.service("noteService",["$http","$q","$rootScope","taskModel","Upload","sync","dbEnums","connectivity","RESPONSE_CODE","message","API","userModel",function(e,t,n,s,r,o,a,i,c,l,u,d){function f(e,t){for(var n=0;n<e.length;n++)if(e[n].id==t){e.splice(n,1);break}return e}var p=this;p.add=function(e){var n=t.defer();return s.findById(e.taskId,function(t,r){e.note.date_modified=new Date,r.notes.push(e.note),o.add(a.collections.Task,{task:r,note:e.note},a.events.Task.addNote),s.addOrUpdate(r,function(e,t){n.resolve(t)})}),n.promise},p.edit=function(e){var n=t.defer();return s.findById(e.taskId,function(t,r){for(var i=0;i<r.notes.length;i++)if(r.notes[i].id===e.note.id){r.notes[i].description=e.note.description,r.notes[i].date_modified=new Date;break}o.add(a.collections.Task,{task:r,note:e.note},a.events.Task.updateNote),s.addOrUpdate(r,function(e,t){n.resolve(t)})}),n.promise},p.delete=function(e){var n=t.defer();return s.findById(e.taskId,function(t,r){e.noteIds.forEach(function(e){r.notes=angular.copy(f(r.notes,e))}),r.date_modified=Date.now(),o.add(a.collections.Task,{task:r,noteIds:e.noteIds,updatedBy:d.getLoggedInUser()},a.events.Task.deleteNote),s.addOrUpdate(r,function(e,t){n.resolve(t)})}),n.promise},p.uploadNote=function(e){var s=t.defer();return i.isConnected()?r.upload({url:u.task.uploadNote,fields:e,file:e.file}).progress(function(e){var t=parseFloat(e.loaded),s=parseFloat(e.total);n.progressPercentage=100*(t/(2*s)),console.log(n.progressPercentage)}).success(function(e){console.log(e),e.response_code==c.SUCCESS?(n.progressPercentage=100,s.resolve({error:!1,msg:l.successMessages.ATTACHMENT_ADDED})):e.response_code===c.ERROR&&s.resolve({error:!0,msg:l.errorMessages[e.errors.value],results:e})}).error(function(e){s.resolve({error:!0,msg:l.errorMessages.GENERAL,results:e})}):s.resolve({error:!0,msg:l.errorMessages.CONNECTION_REQUIRED}),s.promise}}])}.call(this),function(){app.service("notificationService",["$rootScope","$q","$http","API","RESPONSE_CODE","message","connectivity","userModel","notificationModel",function(e,t,n,s,r,o,a,i,c){var l=this;l.getAllNotificationsByUserId=function(e,c){var l=t.defer();if(a.isConnected()){var u={skip:e,limit:c,userId:i.getLoggedInId()};n.post(s.notification.getByUserId,u).success(function(e){e.response_code===r.SUCCESS?l.resolve(e.data):e.response_code===r.ERROR&&l.resolve({error:!0,msg:o.errorMessages[e.errors.value],results:e})}).error(function(e){l.resolve({error:!0,msg:o.errorMessages.GENERAL,results:e})})}else l.resolve({error:!0,msg:o.errorMessages.CONNECTION_REQUIRED});return l.promise},l.getNotifications=function(){var e=t.defer();return c.getAll(function(t,n){e.resolve(n)}),e.promise},l.getNoOfUnseen=function(){var e=t.defer();return c.getNoOfUnseen(function(t,n){e.resolve(n)}),e.promise},l.seenNotifications=function(){a.isConnected()&&n.post(s.notification.seen,{userId:i.getLoggedInId()}),c.bulkSeen(function(){})}}])}.call(this),function(){app.service("project",["$http","$rootScope","$q","$state","RESPONSE_CODE","connectivity","message","API","sharedData","dbEnums","guidGenerator","projectModel","sync","userModel","filterService","taskService","userRoleValidator","roleValidators",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g,v,h){var E=this;E.addOrUpdate=function(e,t){var s=n.defer();return p.getLoggedInUser(),f.add(l.collections.Project,{project:e,update:t},l.events.Project.addOrUpdate),d.addOrUpdate(e,function(e,t){s.resolve(t)}),s.promise},E.archive=function(e){e.users.forEach(function(e){e._id===p.getLoggedInId()&&(e.status=l.status.archived)});var t=n.defer();return f.add(l.collections.Project,{userId:p.getLoggedInId(),project:e},l.events.Project.archive),d.addOrUpdate(e,function(e,n){t.resolve(n)}),t.promise},E.delete=function(e){var t=n.defer();return e.updatedBy=p.getLoggedInUser(),f.add(l.collections.Project,e,l.events.Project.delete),d.delete(e.id,function(n,s){m.removeProjectFromAllFilters(e),g.removeTasksByProjectId(e),t.resolve()}),t.promise},E.deleteUser=function(e,t){e.users.forEach(function(e,n,s){e.email===t.email&&s.splice(n,1)});var s=n.defer();return f.add(l.collections.Project,{deletedUser:t,projectId:e.id},l.events.Project.deleteUser),d.addOrUpdate(e,function(e,t){s.resolve(t)}),s.promise},E.findById=function(e){var t=n.defer();return d.findById(e,function(e,n){t.resolve(n)}),t.promise},E.getAll=function(){var e=n.defer();return d.getAll(function(t,n){e.resolve(n)}),e.promise},E.getAllArchived=function(){var e=n.defer();return d.getAllArchived(function(t,n){e.resolve(n)}),e.promise},E.getAllProjectsUsers=function(){var e=[],t=[],s=n.defer();return d.getAll(function(n,r){r.forEach(function(n){for(var s=0;s<n.users.length;s++){var r=n.users[s];t[r._id]||(e.push(r),t[r._id]=!0)}}),s.resolve(e)}),s.promise},E.getUserFromAllProjects=function(e){var t=n.defer();return E.getAllProjectsUsers().then(function(n){for(var s=null,r=0;r<n.length;r++)if(n[r]._id==e){s=n[r];break}t.resolve(s)}),t.promise},E.getProjectUserById=function(e,t){for(var n=0;n<e.users.length;n++)if(e.users[n]._id===t)return e.users[n]},E.getProjectAdmin=function(e){for(var t=0;t<e.users.length;t++)if(e.users[t].isAdmin)return e.users[t]},E.getUserRole=function(e,t){for(var n=0;n<e.users.length;n++)if(e.users[n]._id===t)return e.users[n].role},E.left=function(e){var t=n.defer();return f.add(l.collections.Project,{userId:p.getLoggedInId(),project:e},l.events.Project.left),d.delete(e.id,function(n,s){m.removeProjectFromAllFilters(e),g.removeTasksByProjectId(e),t.resolve()}),t.promise},E.reorder=function(e,t){e.forEach(function(e,t){e.users.forEach(function(e){e._id==p.getLoggedInId()&&e.status===l.status.active&&(e.order=t)})}),f.add(l.collections.Project,{projects:e,userId:p.getLoggedInId()},l.events.Project.reorder),d.bulkUpdate(e,!0,t)},E.reSendInvitation=function(t){var s=n.defer();return o.isConnected()?e.post(i.project.reSendInvitation,t).success(function(e){e.response_code===r.SUCCESS?s.resolve({error:!1,message:a.successMessages.PROJECT_INVITATION_RESENT}):e.response_code===r.ERROR&&s.resolve({error:!0,message:a.errorMessages[e.errors.value]})}).error(function(){s.resolve({error:!0,message:a.errorMessages.CONNECTION_ERROR})}):s.resolve({error:!0,message:a.errorMessages.CONNECTION_ERROR}),s.promise},E.sendInvitation=function(e,t){var s=n.defer();return delete t.accessToken,delete t.accessTokenExpired,delete t.approvalToken,e.users.push(t),f.add(l.collections.Project,{projectId:e.id,invitedUser:t},l.events.Project.sendInvitation),d.addOrUpdate(e,function(e,t){s.resolve(t)}),s.promise},E.unArchive=function(e){e.users.forEach(function(e){e._id===p.getLoggedInId()&&(e.status=l.status.active)});var t=n.defer();return f.add(l.collections.Project,{userId:p.getLoggedInId(),project:e},l.events.Project.unArchive),d.addOrUpdate(e,function(e,n){t.resolve(n)}),t.promise},E.updateItem=function(e){e.status===l.status.deleted?d.delete(e.id,function(e,t){}):d.addOrUpdate(e,function(e,t){})},E.canDeleteProject=function(e){var t=p.getLoggedInUser();if(!e||!t)return!1;var n=_.find(e.users,function(e){if(e._id&&e._id==t._id)return!0});return!!n&&n.role==l.projectUserRole.admin&&e.users.length<=1},E.canDeleteUser=function(e,t){if(!t||!e||e.users.length<=0)return!1;var n=_.find(e.users,function(e){if(e._id&&e._id==t._id)return!0});return!!n&&n.role==l.projectUserRole.admin}}])}.call(this),!function(){app.service("roleValidators",["$q","projectModel","popupService","CONSTANT","dbEnums","userModel","taskModel","labelModel","helperService","$window","connectivity","userModelHelper",function(e,t,n,s,r,o,a,i,c,l,u,d){function f(t,n){return e(function(e,s){var o=a.getTaskUserByRole(n,r.taskUserRole.assignee);o&&t._id==o._id?s({shouldSkip:!0}):e()})}function p(t,n,s){var r=e.defer(),a=o.getUserFeatures(),i=e(function(e,t){e()});return i=i.then(function(e){return w(a,n)}).then(r.resolve,function(e){e&&e.shouldSkip?r.resolve():r.reject(e)}),r.promise}function m(t){return e(function(e,n){g(t).then(function(t){t?e():n({shouldSkip:!0})},n)})}function g(t){return e(function(e,n){a.findById(t.id,function(s,r){if(s)n(s);else if(r){var o=r.project.id!=t.project.id;e(o)}else e(!0)})})}function v(t,n){return e(function(e,s){i.getAll(function(r,o){if(r)s(r);else{var a=_.filter(o,function(e){return(e.tasks||[]).indexOf(n)>=0}),i=_.map(a,function(e){return e.id}),c=_.map(t||[],function(e){return e.id}),l=!1;_.each(c,function(e){var t=_.indexOf(i,e)>=0;if(!t)return l=!0,!1}),e(l)}})})}function h(t,n){return e(function(e,s){var o=c.getUserByRole(n.users,r.taskUserRole.assignee);o?a.findById(n.id,function(i,c){if(i)s(i);else if(c){var l=a.getTaskUserByRole(c,r.taskUserRole.assignee);l?c.project.id!=n.project.id?e():l._id!=o._id&&o._id!=t._id?e():s({shouldSkip:!0}):e()}else e()}):s({shouldSkip:!0})})}function E(n,s,r){return e(function(e,o){n&&"LICENSE"==n.key&&n.isLicense?0==r.id?(n.skipUpgrade=!0,e(n)):t.findById(r.id,function(t,r){var o=k(s,r);n.skipUpgrade=!o,e(n)}):e(err)})}function k(e,t){var n=0==t.id;if(n)return!0;var s=_.find(t.users,function(e){return e.isAdmin});return!s||s._id==e._id}function T(n,s){var r=o.getUserFeatures();return e(function(e,a){0==n.id?w(r,s).then(function(t){e({project:n,config:t})},a):t.findById(n.id,function(t,n){if(!t){var i=o.getLoggedInUser(),c=k(i,n),l=S(r);return w(c?l:n.licenseConfigs,s).then(function(t){e({project:n,config:t})},a)}a(t)})})}function S(e){var t={};return _.each(e,function(e,n){t[n]=e.config}),t}function b(e,t,n,s){var r=o.getAllFeatures(),a=r[n],i=s?a.message_other:a.message;i=i||"";var c=y(e);return i=I(c,i),{key:"LICENSE",message:i,name:a.name,feature_key:n,isLicense:!0,skipUpgrade:a.skipUpgrade}}function I(e,t){return _.each(e,function(e,n){t=t.replace("{"+n+"}",e)}),t}function y(e){return{firstName:e.firstName,lastName:e.lastName,email:e.email,displayName:e.displayName}}function w(t,n){var s=e.defer(),r=t[n];if(console.log("previous one",r),r)s.resolve(r);else{var a=o.getAllFeatures(),i=a[n];console.log("********"),console.log(i);var c={key:"LICENSE",message:i.message,name:i.name,feature_key:n,isLicense:!0};console.log("last one...",c),s.reject(c)}return s.promise}function D(t){return e(function(e,n){a.getAll(function(s,o){if(s)n(s);else{var a=_.filter(o,function(e){return t&&e.project.id==t.id&&e.status==r.status.active});e(a)}})})}var O=this;O.checkUserRole=function(t,r,o,a){return e(function(n,s){"string"==typeof r&&(r=[r]);var a=e(function(e,t){e()});_.each(r,function(n){a=a.then(function(){return e(function(s,r){var a=_.filter(A,function(e){return e.key==n});console.log("this is a validators"),console.log("validator",a);var i=e(function(e,t){e()});_.each(a,function(e){i=i.then(function(){return e.validate(t,n,o)})}),i.then(s,r)})})}),a.then(n,s)}).then(null,function(t){return e(function(e,r){t&&t.key&&"LICENSE"==t.key&&a&&n.roleWarning(null,t).then(function(){
window.cordova?l.open(encodeURI(s.upgradeUrl),"_system","location=no"):l.open(s.upgradeUrl,"_blank"),console.log("UPGRADE code goes here")},function(){console.log("UPGRADE CANCEL code goes here")}),r(t)})})};var A=[{key:"active_projects",validate:function(n,s,a){var i,c=e.defer(),l=o.getUserFeatures(),u=e(function(e,t){e()});return u=u.then(function(){return w(l,s)}).then(function(s){return i=s,e(function(e,o){t.getUserCreatedActiveProjects(n._id,function(t,a){t?o(t):"*"!==s.config.max&&a.length+1>s.config.max?o(b(n,s,r.USER_ROLES.ACTIVE_PROJECTS)):e()})})}).then(c.resolve,c.reject),c.promise}},{key:"active_tasks",validate:function(t,n,s){return e(function(n,o){var a=s.task,i=s.project||(a?a.project:null),l=e(function(e,t){a?m(a).then(e,t):e()});l.then(function(){return e(function(n,s){T(i,r.USER_ROLES.ACTIVE_TASKS).then(function(n){return e(function(e,s){var o=n.project,a=n.config;return"*"!==a.max?D(o).then(function(n){if(n.length+1>a.max){var i=k(t,o),l=c.getUserByRole(o.users,r.projectUserRole.admin);s(b(l,a,r.USER_ROLES.ACTIVE_TASKS,!i))}else e()},s):void e()})}).then(n,s)})}).then(n,function(e,s){e&&e.shouldSkip?n(s):E(e,t,i).then(o)})})}},{key:"assignee_project",validate:function(t,n,s){return e(function(n,o){var i=s.task,l=i.project;h(t,i).then(function(){return f(t,i).then(function(){T(l,r.USER_ROLES.ASSIGNEE_PROJECT).then(function(n){return e(function(e,s){var o=n.project,l=n.config;return"*"!==l.max?D(o).then(function(n){var u=_.filter(n,function(e){if(e.id==i.id)return!1;var n=a.getTaskUserByRole(e,r.taskUserRole.assignee);return e.status==r.status.active&&n&&n._id!=t._id});if(u.length+1>l.max){var d=k(t,o),f=c.getUserByRole(o.users,r.projectUserRole.admin);s(b(f,l,r.USER_ROLES.ASSIGNEE_PROJECT,!d))}else e()},s):void e()})}).then(function(e){n(e)},function(e){E(e,t,l).then(o)})})},null).then(null,function(e){e&&e.shouldSkip?n():o(e)})})}},{key:"max_users_project",validate:function(t,n,s){return e(function(n,o){var a="object"==typeof s.project?s.project:{id:s.project},i=s.invitedUser;i?i.invitedBy:t,T(a,r.USER_ROLES.MAX_USERS_PROJECT).then(function(n){return e(function(e,s){var o=n.project,a=n.config;if("*"!==a.max){var i=o.users.length;if(i+1>a.max){var l=k(t,o),u=c.getUserByRole(o.users,r.projectUserRole.admin);s(b(u,a,r.USER_ROLES.MAX_USERS_PROJECT,!l))}else e()}else e()})}).then(function(e){n(e)},function(e){E(e,t,a).then(o)})})}},{key:"labels",validate:function(t,n,s){var a,c=e.defer(),l=o.getUserFeatures(),u=s.label,d=e(function(e,t){e()});return d=d.then(function(){return w(l,n)}).then(function(n){return a=n,e(function(e,s){"*"!==n.config.max?i.getAll(function(o,a){if(o)s(o);else{var i=u?_.find(a,function(e){return e.id==u.id}):null;i?s(b(t,n.config,r.USER_ROLES.LABELS,!1)):a.length+1>n.config.max?s(b(t,n.config,r.USER_ROLES.LABELS,!1)):e()}}):e()})}).then(c.resolve,c.reject),c.promise}},{key:"labels_assign",validate:function(t,n,s){var r=e.defer(),a=s.labels||[],i=s.task,c=o.getUserFeatures(),l=_.filter(a,function(e){return e.checked}),u=_.map(l,function(e){return e.label}),d=e(function(e,t){e()});return d=d.then(function(){return v(u,i.id)}),d=d.then(function(t){return t?w(c,n):e(function(e,t){t({shouldSkip:!0})})}).then(r.resolve,function(e){e&&e.shouldSkip?r.resolve():r.reject(e)}),r.promise}},{key:"email_notifications",validate:function(t,n,s){var r=e.defer(),a=o.getUserFeatures(),i=e(function(e,t){e()});return i=i.then(function(e){return w(a,n)}).then(r.resolve,function(e){e&&e.shouldSkip?r.resolve():r.reject(e)}),r.promise}},{key:"custom_filters",validate:function(e,t,n){return p(e,t,n)}},{key:"search",validate:function(e,t,n){return p(e,t,n)}},{key:"file_upload",validate:function(e,t,n){return p(e,t,n)}},{key:"file_upload_size",validate:function(t,n,s){var r=e.defer(),a=s.file,i=o.getUserFeatures();console.log("file upload user features",c);var c,l=e(function(e,t){e()});return l=l.then(function(){return w(i,n)}).then(function(s){return c=s,console.log("top top",s),e(function(e,r){if("*"!==s.config.max){var o=a.size/1024/1024;console.log("file length...........sfsdfsdfsdf"),console.log(o),o>s.config.max?r(b(t,s.config,n,!1)):e()}else e()})}).then(r.resolve,r.reject),r.promise}},{key:"file_storage_max",validate:function(t,n,s){var r,a=e.defer(),i=s.file,c=o.getUserFeatures(),l=e(function(e,t){e()});return l=l.then(function(){return e(function(e,s){r=c[n],r?d.getLoggedInUserTotalStorage().then(function(o){if("*"!==r.config.max){var a=o+i.size,c=a/1024/1024;c>r.config.max?s(b(t,r.config,n,!1)):e()}else e()},s):e()})}).then(a.resolve,a.reject),a.promise}},{key:"my_feeds",validate:function(e,t,n){return p(e,t,n)}},{key:"task_history",validate:function(e,t,n){return p(e,t,n)}}];O.validate=function(t,n,s,r,o){var a=_.filter(A,function(e){return e.key==n}),i=e(function(e,t){e()});_.each(a,function(n){i=i.then(function(){var o=e.defer();return n.validate(t,s,r).then(function(){o.resolve()},function(e){e.isValidation?o.reject({result:!1,type:"validation",validationResult:e}):o.reject(e)}),o.promise})}),i.then(function(){o()},function(e){o(e)})},O.applyFeatureOnProjects=function(e,t,n){var s=["active_tasks","assignee_project","users_project"],r=o.getUserFeatures();_.each(t,function(e){e.licenseConfigs={},_.each(s,function(t){var n=r[t];n&&(e.licenseConfigs[t]=n.config)})}),n()}}])}(),function(){app.service("settingsService",["$http","$rootScope","$state","$q","$window","API","RESPONSE_CODE","Upload","userModel","settingsModel","dbEnums","message","sync","connectivity","DEFAULTS",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m){var g=this;g.items=[{title:"General",url:"/settings/general",icon:"tdzicon-tick"},{title:"My Account",url:"/settings/account",icon:"tdzicon-task-visibility"},{title:"Reminders",url:"/settings/reminder",icon:"tdzicon-reminder"},{title:"Notifications",url:"/settings/notifications",icon:"tdzicon-notifications"},{title:"About",url:"/settings/about",icon:"tdzicon-logo"}],g.defaultViews=[{title:"Inbox",value:"inbox"},{title:"Today",value:"today"},{title:"Next 7 days",value:"next7days"},{title:"Overdue",value:"overdue"},{title:"Favourites",value:"favourites"},{title:"All Tasks",value:""}],g.floatButtons=[{title:"Add task",value:0},{title:"Show all",value:1}],g.startDays=[{title:"Saturday",value:6},{title:"Sunday",value:0},{title:"Monday",value:1}],g.dateFormats=[{title:"dd mmm yyyy",value:0},{title:"mmm dd yyyy",value:1}],g.timeFormats=[{title:"12 hour",value:0},{title:"24 hour",value:1}],g.removeAvatar=function(t){var n=s.defer();return p.isConnected()?e.post(o.settings.removeAvatar,t).success(function(e){e.response_code===a.SUCCESS?n.resolve({error:!1,msg:d.successMessages.PROFILE_IMAGE_UPDATED}):e.response_code===a.ERROR&&n.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}).error(function(e){n.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}):n.resolve({error:!0,msg:d.errorMessages.CONNECTION_REQUIRED}),n.promise},g.update=function(e){var t=s.defer();return f.add(u.collections.Settings,{settings:e,userId:c.getLoggedInId()},u.events.Settings.update),l.addOrUpdate(e,function(){t.resolve()}),t.promise},g.updateEmail=function(t){var n=s.defer();return p.isConnected()?e.post(o.settings.updateEmail,t).success(function(e){e.response_code===a.SUCCESS?n.resolve({error:!1,msg:d.successMessages.EMAIL_UPDATE_REQUEST}):e.response_code===a.ERROR&&n.resolve({error:!0,msg:d.errorMessages[e.errors.value],results:e})}).error(function(e){n.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}):n.resolve({error:!0,msg:d.errorMessages.CONNECTION_REQUIRED}),n.promise},g.updateItem=function(e){l.addOrUpdate(e,function(){})},g.updatePassword=function(t){var n=s.defer();return p.isConnected()?e.post(o.settings.updatePassword,t).success(function(e){e.response_code===a.SUCCESS?n.resolve({error:!1,msg:d.successMessages.PASSWORD_UPDATED}):e.response_code===a.ERROR&&n.resolve({error:!0,msg:d.errorMessages[e.errors.value],results:e})}).error(function(e){n.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}):n.resolve({error:!0,msg:d.errorMessages.CONNECTION_REQUIRED}),n.promise},g.updateUserName=function(t){var n=s.defer();return p.isConnected()?e.post(o.settings.updateUserName,t).success(function(e){e.response_code===a.SUCCESS?n.resolve({error:!1,msg:d.successMessages.NAME_UPDATED}):e.response_code===a.ERROR&&n.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}).error(function(e){n.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}):n.resolve({error:!0,msg:d.errorMessages.CONNECTION_REQUIRED}),n.promise},g.uploadAvatar=function(e){var t=s.defer();return p.isConnected()?i.upload({url:o.settings.uploadAvatar,fields:e,file:e.file}).success(function(e){console.log(e),e.response_code==a.SUCCESS?t.resolve({error:!1,msg:d.successMessages.PROFILE_IMAGE_UPDATED}):e.response_code===a.ERROR&&t.resolve({error:!0,msg:d.errorMessages[e.errors.value],results:e})}).error(function(){t.resolve({error:!0,msg:d.errorMessages.GENERAL,results:results})}):t.resolve({error:!0,msg:d.errorMessages.CONNECTION_REQUIRED}),t.promise},g.updateSort=function(e){var t=s.defer();return f.add(u.collections.Settings,{sort:e.sort,userId:c.getLoggedInId()},u.events.Settings.sortUpdate),l.addOrUpdate(e,function(){t.resolve()}),t.promise},g.getSettings=function(){var e=JSON.parse(r.localStorage.getItem("settings"));return!e||!e.reminder||e.reminder.taskCreateReminderNotificationChannels&&e.reminder.taskCreateReminderNotificationChannels.email.title||(e.reminder.taskCreateReminderNotificationChannels=m.defaultSettings.taskCreateReminderNotificationChannels),e},g.deleteAccount=function(t){var n=s.defer();return e.post(o.settings.deleteAccount,t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},g.validateDeleteAccount=function(t){var n=s.defer();return e.post(o.settings.checkForDelete,t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}}])}.call(this),function(){app.service("taskService",["$q","$rootScope","$http","API","RESPONSE_CODE","connectivity","taskModel","sortService","labelService","userModel","filterService","guidGenerator","dbEnums","date","sync","dueService","message","toastService","$timeout","$ionicListDelegate","$state","sharedData","reminderModel","settingsService","helperService","roleValidators",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g,v,h,E,k,T,S,b,I,y,w){function D(e){t.recentTaskId=e}function O(e,t,n,s){var r={_id:e._id,displayName:e.displayName,displayShortName:e.displayShortName,email:e.email,avatar:e.avatar,getNotification:t,role:n,favourite:!1};return s&&(r.isAdmin=!0),r}function A(e,t){if(e.recurrence.due_date||t.recurrence.due_date){if(e.recurrence.due_date){if(t.recurrence.due_date){var n=moment(e.recurrence.due_date),s=moment(t.recurrence.due_date);return n<s?-1:n>s?1:0}return-1}return 1}return 0}function R(e,t){return e.priority==t.priority?0:e.priority<t.priority?1:-1}function M(e,t,n,s,r){var o=l.getTaskCustomOrders(),a=C(e,t,n,o,s,r);return a}function C(e,t,n,s,r,o){var a=_.find(s||[],function(t){return e.id==t.taskId}),i=_.find(s||[],function(e){return t.id==e.taskId});return a||i?a?i?a.order-i.order:-1:1:0}var N,$,L=this,U=angular.copy(S.BASIC_TASK),j=[];L.addAutoReminder=function(e){var t=I.getSettings(),n=null;return t.reminder.autoReminder.enable&&e&&(n={id:d.getId(),assignee:l.getLoggedInUser(),date_created:new Date,updatedBy:l.getLoggedInUser(),notificationChannels:t.reminder.autoReminder.channels,time:{id:0,title:t.reminder.autoReminder.time.title,value:t.reminder.autoReminder.time.value},auto:!0}),n},L.priorities={0:{name:"Priority 1",color:"#1775d2",number:0},1:{name:"Priority 2",color:" #6C6C6C",number:1},2:{name:"Priority 3",color:"#BABABA",number:2},3:{name:"Priority 4",number:3}},L.CHANNELS={EMAIL:"email",MOBILE:"mobile",WEB:"web"},L.TASK_TYPE_NAME={inbox:"Inbox",today:"Today",next7days:"Next 7 Days",overdue:"Overdue",watching:"Watching",favourites:"Favourites",closed:"Closed"},L.add=function(t){var n=e.defer();t.id=d.getId(),t.status=f.status.active,t.date_created=new Date,t.date_modified=new Date,t.updatedBy=l.getLoggedInUser();var s=[];if(t.assignee._id){var r=l.getLoggedInId()===t.assignee._id;s.push(O(t.assignee,!0,f.taskUserRole.assignee,r))}if(t.watchers.forEach(function(e){if(e.watcher._id){var t=l.getLoggedInId()===e.watcher._id,n=t||e.checked,r=t?f.taskUserRole.admin:f.taskUserRole.watcher;s.push(O(e.watcher,n,r,t))}}),!s.length){var o=l.getLoggedInUser();s.push(O(o,!0,f.taskUserRole.admin,!0))}t.users=angular.copy(s);var i=l.getLoggedInUser();return w.checkUserRole(i,[f.USER_ROLES.ACTIVE_TASKS,f.USER_ROLES.ASSIGNEE_PROJECT],{task:t,user:i,project:t.project},!0).then(function(){console.log("license check successful"),delete t.assignee,delete t.watchers,t.labels&&c.addTaskToLabels(t.labels,t.id);var e=t.labels;delete t.labels,m.add(f.collections.Task,{task:t,labels:e},f.events.Task.add),a.addOrUpdate(t,function(e,s){D(t.id),n.resolve(s)})},function(e){console.log("license check error"),console.log(e),n.reject(e)}),n.promise},L.copyTask=function(t){return e(function(n,s){var r=l.getLoggedInUser(),o=angular.copy(t);o.notes=[],delete o._id,delete o.id,o.id=d.getId(),o.status=f.status.active,o.date_created=new Date,o.date_modified=new Date,o.updatedBy=r,o.name=f.keys.COPY_TASK_PREFIX+o.name;var a=[],i=t.users||[];_.each(i,function(e){var t=e._id==r._id,n=e.role,s=O(e,e.getNotification,n,t);s.favourite=!!t&&s.favourite,a.push(s)}),o.users=a;var u=[],p=e(function(e,n){c.getAll().then(function(n){n?(n.forEach(function(e){var n=c.isTaskExists(t.id,e);n&&u.push({checked:!0,label:e})}),e()):e()},n)});p.then(function(){o.reminders=o.reminders||[],n(o)},s)})},L.bulkDueDateUpdate=function(t,n,s){var r=e.defer();return a.getSelected(t.taskIds,function(e,o){o&&L.updateDueDate(o,t.recurrence,n,s).then(r.resolve,r.reject)}),r.promise},L.updateDueDate=function(t,n,s,r){var o=e.defer();return _.each(t,function(e){var t=e.recurrence&&e.recurrence.due_date?new Date(e.recurrence.due_date):null;e.recurrence=angular.copy(n),e.recurrence&&e.recurrence.due_date&&(e.recurrence.due_date=new Date(e.recurrence.due_date)),s&&t&&e.recurrence.due_date&&(e.recurrence.due_date.setHours(t.getHours()),e.recurrence.due_date.setMinutes(t.getMinutes()),e.recurrence.due_date.setSeconds(t.getSeconds()),e.recurrence.due_date.setMilliseconds(t.getMilliseconds())),r&&t&&e.recurrence.due_date&&(e.recurrence.due_date.setFullYear(t.getFullYear()),e.recurrence.due_date.setMonth(t.getMonth()),e.recurrence.due_date.setDate(t.getDate())),e.updatedBy=l.getLoggedInUser()}),a.bulkUpdate(t,function(){o.resolve(!0)}),m.add(f.collections.Task,{taskList:t},f.events.Task.bulkDueDateUpdate),o.promise},L.bulkFavourites=function(n){var s=e.defer();return a.getSelected(n.taskIds,function(e,r){r&&(r.forEach(function(e){for(var t=0;t<e.users.length;t++)if(e.users[t]._id===l.getLoggedInId()){e.users[t].favourite=n.isFavourite;break}}),m.add(f.collections.Task,{isFavourite:n.isFavourite,taskIds:n.taskIds,userId:l.getLoggedInId()},f.events.Task.bulkFavourites),a.bulkUpdate(r,function(){t.$emit("task:update-favourite",n.isFavourite),s.resolve(n.isFavourite)}))}),s.promise},L.reminderDeleted=function(t,n){var s,r=e.defer();return a.findById(t,function(e,t){for(var o=0;o<t.reminders.length;o++)if(t.reminders[o].id==n){s=angular.copy(t.reminders[o]),t.reminders.splice(o,1);break}s?(m.add(f.collections.Task,{task:t,reminder:s},f.events.Task.deleteReminder),a.addOrUpdate(t,function(e,t){r.resolve(t)})):r.resolve()}),r.promise},L.reminderExecuted=function(t,n){var s,r=e.defer();return a.findById(t,function(e,t){for(var o=0;o<t.reminders.length;o++)if(t.reminders[o].id==n){s=t.reminders[o],s.notificationChannels.push.notified=!0;break}m.add(f.collections.Task,{task:t,reminder:s},f.events.Task.deleteReminder),a.addOrUpdate(t,function(e,t){r.resolve(t)})}),r.promise},L.removeTasksByProjectId=function(e){a.getAll(function(t,n){n.forEach(function(t){t.project.id==e.id&&a.delete(t.id,function(e,n){c.removeTaskFromAllLabels(t)})})})},L.update=function(t,n){var s=e.defer();if(angular.equals(t,n))s.resolve(void 0);else{t.updatedBy=l.getLoggedInUser();var r=[];if(t.assignee){var o=l.getLoggedInId()===t.assignee._id;r.push(O(t.assignee,!0,f.taskUserRole.assignee,o))}if(t.watchers.forEach(function(e){if(e.watcher._id){var t=l.getLoggedInId()===e.watcher._id,n=e.checked,s=t?f.taskUserRole.admin:f.taskUserRole.watcher;r.push(O(e.watcher,n,s,t))}}),!r.length){var i=l.getLoggedInUser();r.push(O(i,!0,f.taskUserRole.admin,!0))}t.users=angular.copy(r);var u=l.getLoggedInUser();w.checkUserRole(u,[f.USER_ROLES.ACTIVE_TASKS,f.USER_ROLES.ASSIGNEE_PROJECT],{task:t,user:u,project:t.project},!0).then(function(){delete t.assignee,delete t.watchers,t.labels&&c.addTaskToLabels(t.labels,t.id);var e=t.labels;delete t.labels,_.isEqual(t.prevRecurrence,t.recurrence)||(t.recurrence=g.setDueDate(t.recurrence)),delete t.prevRecurrence,t.removeReminders.forEach(function(e){b.delete(e,function(){})}),t.date_modified=new Date,m.add(f.collections.Task,{task:t,labels:e},f.events.Task.update),a.addOrUpdate(t,function(e,n){D(t.id),s.resolve(n)})},s.reject)}return s.promise},L.updateItem=function(e){e.status===f.status.deleted?a.delete(e.id,function(e,t){}):a.addOrUpdate(e,function(e,t){})},L.findActiveTaskById=function(t){var n=e.defer();return a.findActiveTaskById(t,function(e,t){n.resolve(t)}),n.promise},L.findById=function(t){var n=e.defer();return a.findById(t,function(e,t){n.resolve(t)}),n.promise},L.getAll=function(){var t=e.defer();return a.getAll(function(e,n){t.resolve(n)}),t.promise},L.getTasksByIds=function(t){var n=e.defer();return a.getAllByPredicate(function(e){var n=_.find(t,function(t){return t==e.id});return n},function(e,t){n.resolve(t)}),n.promise},L.taskCount=function(){var t=e.defer();return a.getAll(function(e,n){t.resolve(n.length)}),t.promise},L.setTaskObject=function(e){U=e},L.getTaskObject=function(){return N&&(U.project=N),U},L.clearTaskObject=function(){U=angular.copy(S.BASIC_TASK),N=void 0},L.taskObjectHasValue=function(){return U.name||U.notes.length},L.getTasksByType=function(n,s){var r=[],o=e.defer();return L.getAll().then(function(e){e.forEach(function(e){var t=angular.copy(e);console.log("task...",t),L.taskType[n](e,s)&&(e.due=p.getDateOnly(e.recurrence.due_date)||new Date("01/01/2050"),e.recurrence.due_time=p.getTime(e.recurrence.due_date),e.due_time=p.getTime(e.recurrence.due_date),e.isOverdued=p.isPastDay(e.recurrence.due_date),e.assignee=L.getAssignee(e),console.log("conversion..",e),r.push(e))});var a=i.getSortType();a=a||i.DEFAULT_SORT;var c=i.getOrder().value;t.showDateBar=!!a&&a.showDateBar,l.get(function(e){r=L.sortTasks(r,a,c,e),o.resolve(r)})}),o.promise},L.isUserAnAdmin=function(e,t){for(var n=0;n<e.users.length;n++)if(e.users[n]._id===t&&e.users[n].isAdmin)return!0;return!1},L.isUserAnAssignee=function(e,t){if(!e.project.id&&L.isUserAnAdmin(e,t))return!0;for(var n=0;n<e.users.length;n++)if(e.users[n].role===f.taskUserRole.assignee&&e.users[n]._id===t)return!0;return!1},L.getTaskUserByRole=function(e,t){var n=_.find(e.users,function(e){return e.role===t});return n},L.isUserAWatcher=function(e,t){for(var n=0;n<e.users.length;n++)if(e.users[n].getNotification&&e.users[n]._id===t)return!0;return!1},L.isFavourite=function(e,t){for(var n=0;n<e.users.length;n++)if(e.users[n]._id===t)return e.users[n].favourite;return!1},L.getAssignee=function(e){for(var t=0;t<e.users.length;t++)if(e.users[t].role===f.taskUserRole.assignee)return e.users[t];return null},L.taskType={inbox:function(e){return!e.project.id&&e.status==f.status.active},today:function(e){return p.isToday(e.recurrence.due_date)&&L.isUserAnAssignee(e,l.getLoggedInId())&&e.status==f.status.active},next7days:function(e){return p.isInNextNDays(e.recurrence.due_date,8)&&L.isUserAnAssignee(e,l.getLoggedInId())&&e.status==f.status.active},overdue:function(e){return p.isPastDay(e.recurrence.due_date)&&L.isUserAnAssignee(e,l.getLoggedInId())&&e.status==f.status.active},watching:function(e){return L.isUserAWatcher(e,l.getLoggedInId())&&e.status==f.status.active},favourites:function(e){return L.isFavourite(e,l.getLoggedInId())&&e.status==f.status.active},assignee:function(e,t){return t&&L.isUserAnAssignee(e,t._id)&&e.status==f.status.active},label:function(e,t){return t&&c.isTaskExists(e.id,t)&&e.status==f.status.active},filter:function(e,t){return t&&u.isTaskExists(e,t)&&e.status==f.status.active},project:function(e,t){return t&&e.project.id==t.id&&e.status==f.status.active},closed:function(e){return e.status==f.status.closed},"":function(e){return e.status==f.status.active}},L.addProjectToTaskObject=function(e){e&&(N={id:e.id,name:e.name,color:e.color})},L.getActiveReminders=function(e){var t=[];return e.reminders&&e.reminders.forEach(function(n){var s=L.isReminderActive(e,n);s&&t.push(n)}),t},L.countActiveReminders=function(e){var t=L.getActiveReminders(e);return t.length},L.isReminderActive=function(e,t){var n=(y.getScheduledTime(t,e.recurrence.due_date),!1),s=!0,r=!0;return t.notificationChannels.email&&t.notificationChannels.email.value&&!t.notificationChannels.email.notified&&(s=!1),t.notificationChannels.push&&t.notificationChannels.push.value&&!t.notificationChannels.push.notified&&(r=!1),r&&s||(n=!0),n},L.getCompletedTasks=function(t){var a=angular.extend({limit:25,skip:0},t),i=e.defer();o.isConnected()?n.get(s.task.GET.getCompleted,{params:a}).success(function(e){e.response_code===r.SUCCESS?(e.data.completedTasks.forEach(function(e){e.due=p.getDateOnly(e.recurrence.due_date)||new Date("01-01-2050"),e.recurrence.due_time=p.getTime(e.recurrence.due_date),e.due_time=p.getTime(e.recurrence.due_date),e.isOverdued=p.isPastDay(e.recurrence.due_date),e.assignee=L.getAssignee(e)}),i.resolve(e.data.completedTasks)):e.response_code===r.ERROR&&i.reject({error:!0,msg:v.errorMessages[e.errors.value],results:e})}).error(function(e){i.reject({error:!0,msg:v.errorMessages.GENERAL,results:e})}):i.reject({error:!0,msg:v.errorMessages.CONNECTION_REQUIRED});var c=i.promise;return c},L.unCompleteTasks=function(a){var i=e.defer(),c=_.isArray(a)?a:[a],u=c,d=l.getLoggedInUser(),p=e(function(e,t){e()});return _.each(c,function(e){p=p.then(function(){return w.checkUserRole(d,f.USER_ROLES.ACTIVE_TASKS,{project:e.project,user:d},!0)})}),p.then(function(){return e(function(e,i){o.isConnected()?n.post(s.task.unCompleteTasks,u).success(function(n){n.response_code===r.SUCCESS?L.addTaskFromServer(n.data.tasks).then(function(){e(n.data.tasks?n.data.tasks:a),t.$emit("task-reopen",n.data.tasks)},i):i({error:!0,msg:v.errorMessages[n.errors.value],results:n})}).error(function(e){i({error:!0,msg:v.errorMessages.GENERAL,results:e})}):i({error:!0,msg:v.errorMessages.CONNECTION_REQUIRED})})}).then(i.resolve,i.reject),i.promise},L.addTaskFromServer=function(t){var n=e.defer();return a.bulkUpdate(t,function(e,s){e&&n.reject(e),n.resolve(t)},n.reject),n.promise},L.getTaskFromServer=function(t){var r=e.defer();return o.isConnected()?n.get(s.task.GET.view+t).then(function(e){r.resolve(e.data.data.task)},function(e){r.reject({error:!0,msg:v.errorMessages.GENERAL})}):r.reject({error:!0,msg:v.errorMessage.CONNECTION_REQUIRED}),r.promise},L.moveTask=function(t,n,s,r,o,a,i,c){var l,u,d=e.defer(),f=t[n],p=!1,m=t;n<s?(l=t[s],s+1<t.length&&(u=t[s+1])):n>s?(u=t[s],s-1>=0&&(l=t[s-1])):n<r?(l=t[s-1],s+1<t.length&&(u=t[s+1])):n>r&&(u=t[s-1],s-1>=0&&(l=t[s-1]));var g;if(a){var v=t[r],h=L.areDateGroupEqual(f,v);if(!h){var E=f.recurrence;g=E&&E.due_date?new Date(E.due_date):null,f.recurrence=angular.copy(v.recurrence),f.recurrence&&f.recurrence.due_date&&(f.recurrence.due_date=new Date(f.recurrence.due_date),f.recurrence.due_date.setHours(0),f.recurrence.due_date.setMinutes(0),f.recurrence.due_date.setSeconds(0),f.recurrence.due_date.setMilliseconds(0)),p=!0}}var k=1,T=-1;if(l){var S=i&&"plan"==i.value?1:L.compareTasks(f,l,o,p,i,c);k=S}if(u){var S=i&&"plan"==i.value?-1:L.compareTasks(f,u,o,p,i,c);T=S}var b=k>=0&&T<=0;return b||"priority"!=i.value||(n<s?b=k>=0:n>s&&(b=T<=0)),b?(console.log("step 2"),e(function(e,t){p?(g&&f.recurrence&&f.recurrence.due_date&&(f.recurrence.due_date.setHours(g.getHours()),f.recurrence.due_date.setMinutes(g.getMinutes()),f.recurrence.due_date.setSeconds(g.getSeconds()),f.recurrence.due_date.setMilliseconds(g.getMilliseconds())),console.log("step 3"),L.updateDueDate([f],f.recurrence).then(function(){e()},t)):e()}).then(function(){var e=!1;p||(m.splice(n,1),m.splice(s,0,f),e=!0,d.resolve({tasks:m})),console.log("step 4"),L.saveTaskCustomOrder(f,l,u,o,i,c).then(function(){console.log("step 5"),e||d.resolve({tasks:m,requireSort:!0})},function(){e||d.reject()})})):d.resolve({tasks:null}),d.promise},L.saveTaskCustomOrder=function(t,n,s,r,o,a){var i=e.defer();return L.getAll().then(function(e){e.forEach(function(e){e.due=p.getDateOnly(e.recurrence.due_date)||new Date("01-01-2050"),e.recurrence.due_time=p.getTime(e.recurrence.due_date),e.due_time=p.getTime(e.recurrence.due_date)});var c=L.sortTasks(e,o,a,r),u=_.findIndex(c,function(e){return e.id==t.id}),d=n?_.findIndex(c,function(e){return e.id==n.id}):-1,g=s?_.findIndex(c,function(e){return e.id==s.id}):-1,v=c.splice(u,1)[0];d>=0?u>d?c.splice(d+1,0,v):c.splice(d,0,v):g>=0&&(u>g?c.splice(g,0,v):c.splice(g-1,0,v));var h=[],E=1;_.each(c,function(e){h.push({taskId:e.id,order:E++})}),console.log("sorted task"),console.log(_.map(c,function(e){return e.name}).join(" , ")),l.setTaskCustomOrders(h),m.add(f.collections.User,{user:r,taskCustomOrder:h},f.events.Task.moveTaskOrder),i.resolve()}),i.promise},L.sortTasks=function(e,t,n,s){var r;if("plan"==t.value)r=e.sort(function(e,r){var o=M(e,r,s,t,n);return o});else{r=e.sort(function(e,r){var o=M(e,r,s,t,n);return o});var o="asc"==n?"desc":"asc",a="priority"==t.value?o:n;r="priority"==t.value?_.orderBy(r,["priority","due","due_time"],[o,n,n]):_.orderBy(r,[t.value,"due","due_time","priority"],[a,a,a,"asc"])}return r},L.customOrderCompareTasks=function(e,t,n,s,r){if(!e&&!t)return 0;if(!e)return-1;if(!t)return 1;var o;o=A(e,t);var a="date compare result "+o;if(0==o){var i=R(e,t);if(a=a+";;;priority compare result "+i,0==i){var c=M(e,t,n);return a=a+";;;custom order compare result "+c,c}return i*("asc"==r?1:-1)}return o*("asc"==r?1:-1)},L.compareTasks=function(e,t,n,s,r,o){if(null==e&&null==t)return 0;if(null==e)return-1;if(null==t)return 1;var a=o;"due"==r.value&&(a="desc");var i;i=A(e,t);var c=R(e,t);return"priority"!=r.value||s?0!=i||s?i*("asc"==o?1:-1):c*("asc"==a?1:-1):0==c?i*("asc"==o?1:-1):c*("asc"==a?1:-1)},L.areDateGroupEqual=function(e,t){var n=e.recurrence.due_date,s=t.recurrence.due_date,r=A(e,t);if(r){var o=p.getDateGroupHeader(n),a=p.getDateGroupHeader(s);return o==a}return!0},L.bulkCompleteRequest=function(n,s,r){var o=e.defer();return t.rightDefaultViewVisible&&t.$emit("task:bulkCompleted"),n?(j=j||[],j.length>0,j=j.concat(n),s?o.resolve():(h.openTaskCompleteToast(),$=r,_.each(n,function(e){a.delete(e.id,!0)}),t.$emit("taskList-update"),o.resolve())):o.resolve(),o.promise},L.removeFromBulkCompleteList=function(e){j=j||[],_.remove(j,function(t){return t.id==e.id}),a.addOrUpdate(e,function(){})},t.$on("bulk-complete:response",function(e,n){if(n)_.each(j,function(e){e.status=f.status.active,a.addOrUpdate(e,!0,function(){})}),t.$emit("taskList-update"),console.log("undo bulk complete "),console.log(_.map(j,function(e){return e.name})),$&&T.go($.name,$.params),k.closeOptionButtons();else{var s=[];j.length&&(j.forEach(function(e){s.push(e.id)}),L.bulkComplete(j).then(function(){}),console.log("---completing tasks--"),console.log(_.map(j,function(e){return e.name})))}j=[]}),L.bulkComplete=function(t){var n=e.defer();if(t){var s=new Date;t.forEach(function(e){e.recurrence=g.setDueDate(e.recurrence,s),e.status=e.recurrence.isRecurring?f.status.active:f.status.complete,e.date_modified=s,e.updatedBy=l.getLoggedInUser()}),m.add(f.collections.Task,{taskList:t,userId:l.getLoggedInId()},f.events.Task.bulkComplete),a.bulkUpdate(t,function(){n.resolve(!0)})}return n.promise},L.setTaskProps=function(e){return e.due=p.getDateOnly(e.recurrence.due_date)||new Date("01-01-2050"),e.recurrence.due_time=p.getTime(e.recurrence.due_date),e.isOverdued=p.isPastDay(e.recurrence.due_date),e.assignee=L.getAssignee(e),e},L.delete=function(e,t){var n=_.map(e,function(e){return e.id}),s=l.getLoggedInUser();m.add(f.collections.Task,{taskIds:n,updatedBy:s},f.events.Task.delete),_.each(n,function(e){a.delete(e,function(){t()})})},L.sendProjectAdminInvitation=function(e){}}])}.call(this),!function(){app.service("userRoleValidator",["$q","userModel","roleValidators","popupService","CONSTANT","$window",function(e,t,n,s,r,o){var a=this;a.checkUserRole=function(a,i,c,l){var u=e.defer();u.resolve();var d=t.getUserFeatures(),f=d[i],p=t.getAllFeatures();if(f)n.validate(a,i,f,c,function(e){e&&e.type&&"validation"==e.type&&l&&s.roleWarning(null,e).then(function(){o.open(r.website,"blank"),console.log("UPGRADE code goes here")},function(){console.log("UPGRADE CANCEL code goes here")}),e?u.reject(e):u.resolve()});else{var m=p[i];u.reject({result:!1,type:"role",reasons:[{key:"license",value:{name:m.name,message:m.message}}]})}return u.promise}}])}(),!function(){app.service("userModelHelper",["$q","$http","connectivity","API","userModel","RESPONSE_CODE",function(e,t,n,s,r,o){var a=this;a.getLoggedInUserTotalStorage=function(){return e(function(e,a){if(n.isConnected()){var i=r.getLoggedInUser();t.post(s.user.totalStorage,{userId:i._id}).then(function(t){var n=t.data;n.response_code===o.SUCCESS?e(n.data.totalSize):n.response_code===o.ERROR&&defer.resolve({error:!0,message:message.errorMessages[n.errors.value]})},a)}else defer.resolve({error:!0,message:message.errorMessages.CONNECTION_ERROR})})}}])}(),function(){app.service("user",["$http","$q","$window","$state","$rootScope","$ionicLoading","API","connectivity","socket","message","RESPONSE_CODE","sharedData","notificationModel","projectModel","sync","TodoZuDB","labelModel","filterModel","taskModel","settingsModel","userModel","sortService","taskListView",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g,v,h,E,k,T,S,b){function _(e){var s=t.defer();return n.localStorage.setItem("timestamp",new Date),g.createInstances().then(function(){T.addOrUpdate(e.userInfo,function(){}),e.taskCustomOrders&&T.setTaskCustomOrders(e.taskCustomOrders),T.setToken(e.token,function(){}),k.addOrUpdate(e.settings,function(){}),e.settings.filterView&&k.setAllFilterViews(e.settings.filterView),e.settings.sortOption&&k.setAllSortOptions(e.settings.sortOption),e.features&&T.saveUserFeatures(e.features),e.licenseFeatures&&T.saveAllFeatures(e.licenseFeatures),p.bulkUpdate(e.projects,function(){}),v.bulkUpdate(e.labels,function(){}),h.bulkUpdate(e.filters,function(){}),E.bulkUpdate(e.tasks,function(){}),f.bulkUpdate(e.notifications,function(){}),e.api_version&&n.localStorage.setItem("x-api-version",e.api_version),s.resolve(!0)}),s.promise}var I=this;I.register=function(n){var r=t.defer();return i.isConnected()?(o.show(),e.post(a.user.register,n).success(function(e){o.hide(),e.response_code===u.SUCCESS?(T.setRequestLoginEmail(n.email),l.setAlert(l.successMessages.CONFIRM_EMAIL_ADDRESS),s.go("/login")):e.response_code===u.ERROR&&(console.log(e),r.resolve({error:!0,message:l.errorMessages[e.errors.value]}))}).error(function(e){o.hide(),r.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR})})):r.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR}),r.promise},I.forgotPassword=function(n){var r=t.defer();return i.isConnected()?e.post(a.user.forgotPassword,n).success(function(e){e.response_code===u.SUCCESS?(l.setAlert(l.successMessages.FORGOT_PASSWORD_EMAIL_SENT),T.setRequestLoginEmail(e.data.email),s.go("/login")):e.response_code===u.ERROR&&(console.log(e),r.resolve({error:!0,message:l.errorMessages[e.errors[0].value]}))}).error(function(e){r.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR})}):r.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR}),r.promise},I.resetPassword=function(n){var r=t.defer();return i.isConnected()?e.post(a.user.resetPassword,n).success(function(e){
console.log(e),e.response_code===u.SUCCESS?(I.clearAll(),l.setAlert(l.successMessages.RESET_PASSWORD_CONFIRMATION),T.setRequestLoginEmail(e.data.email),s.go("/login")):e.response_code===u.ERROR&&r.resolve({error:!0,message:l.errorMessages[e.errors.value]})}).error(function(e){r.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR})}):r.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR}),r.promise},I.login=function(n){var s=t.defer();return i.isConnected()?e.post(a.user.login,n).success(function(e){console.log("user login...."),console.log(e),e.response_code===u.SUCCESS?_(e.data).then(function(e){S.setAll().then(function(){s.resolve({success:e})})}):e.response_code===u.ERROR&&s.resolve({error:!0,message:l.errorMessages[e.errors.value]})}).error(function(){s.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR})}):s.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR}),s.promise},I.logout=function(t,n){if(o.show(),T.getDeviceUniqueId()){var i={userId:T.getLoggedInId(),uid:T.getDeviceUniqueId(),device_token:T.getDeviceToken()};e.post(a.user.logout,i).success(function(e){200===e.response_code?(I.clearAll(),r.$emit("logoff-success"),t&&n?s.go("/login",{returnUrl:t,params:n}):s.go("/login"),o.hide()):500===e.response_code&&r.$emit("show-message","general","error")}).error(function(e){o.hide()})}else I.clearAll(),o.hide(),r.$emit("logoff-success"),t&&n?s.go("/login",{returnUrl:t,params:n}):s.go("/login")},I.clearAll=function(){b.clearFilterView(),c.disconnect(),T.clearSession(),g.dropDatabase()},I.validatePassword=function(n,s){var r=t.defer();return data={password:n,userId:T.getLoggedInId()},e.post(a.user.validatePassword,data).success(function(e){200===e.response_code?r.resolve(e.data.result):r.resolve(!1)}).error(function(e){r.reject(e)}),r.promise},I.registerDeviceInfo=function(){var n=t.defer(),s={userId:T.getLoggedInId()};return s.deviceInfo={uid:T.getDeviceUniqueId(),device_type:ionic.Platform.platform(),device_token:T.getDeviceToken()},e.post(a.user.registerDeviceInfo,s).then(function(e){n.resolve()},function(e){n.reject(e)}),n.promise},I.logoutListener=r.$on("logout",function(e,t,n){I.logout(t,n)})}])}.call(this),!function(){app.service("asyncStackService",["$q",function(e){function t(){function t(t,n,s,r){var o=t,a=n;s=s||this;var i=this,c=!1,l=e.defer();i.promise=l.promise,i.execute=function(){try{var e=o.apply(s,a);e.then?e.then(function(){c=!0,r.removeMe(i),l.resolve()},function(e){c=!0,r.removeMe(i),l.reject(e)}):(c=!0,r.removeMe(i),l.resolve())}catch(e){c=!0,r.removeMe(i),l.reject()}}}function n(){!o&&r.length>0&&(o=r.shift(),o.execute())}var s=this,r=[],o=null;s.stack=function(e,o,a){var i=new t(e,o,a||s,s);r.push(i);try{return n(),i}catch(e){throw r.pop(),e}},s.removeMe=function(e){r.shift(),o=null,n()},s.clear=function(){r.splice(0,r.length)}}var n=this;n.createStacker=function(){return new t}}])}(this),app.service("authInterceptor",["$window","$window","$q","TodoZuDB",function(e,e,t,n){this.request=function(t){var n=e.localStorage.getItem("token");n&&(t.headers=t.headers||{},t.headers["x-access-token"]=n);var s=JSON.parse(e.localStorage.getItem("socketInfo")||"{}");return s.id&&(t.headers["x-socket-id"]=s.id),t}}]),!function(){app.service("authService",["$window",function(e){var t=this;t.getAccessToken=function(){var t=e.localStorage.getItem("token");return t}}])}(),function(){app.service("sharedData",["$state","settingsService",function(e,t){var n=this;n.EVENT_ICONS={ASSIGNEE:"tdzicon-people",CREATE:"tdzicon-plus-circled",DUE:"tdzicon-calendar-empty",FILE:"tdzicon-attach",NOTE:"tdzicon-note",PRIORITY:"tdzicon-priorities",PROJECT:"tdzicon-square",REMINDER:"tdzicon-reminder",STATUS:"tdzicon-tick",TITLE:"tdzicon-mini-task-desc",USER_JOINED:"tdzicon-square",USER_LEFT:"tdzicon-square",USER_REMOVED:"tdzicon-square",WATCHER:"tdzicon-viewer",REOPEN:"tdzicon-tick-circle",TASK_DELETE:"tdzicon-delete",ROLE_CHANGED:"tdzicon-square"},n.colorsCodes=function(){return[{color:"#457AAE"},{color:"#B65988"},{color:"#19BD9B"},{color:"#2ECD71"},{color:"#3598DC"},{color:"#9A59B5"},{color:"#34495E"},{color:"#26517C"},{color:"#AE4474"},{color:"#17A086"},{color:"#27AE5F"},{color:"#2A80B9"},{color:"#8F44AD"},{color:"#2D3E50"},{color:"#F5DB62"},{color:"#D45B7E"},{color:"#F2C40F"},{color:"#E77E22"},{color:"#E84C3D"},{color:"#ECF0F1"},{color:"#A3B1B2"},{color:"#F4CD16"},{color:"#D92F5E"},{color:"#F39C11"},{color:"#D25400"},{color:"#BF3A2B"},{color:"#BEC3C7"},{color:"#7E8C8D"}]},n.STATE={ASSIGNEE:"assignee",FILTER:"filter",LABEL:"label",PROJECT:"project",TASK:"task",CLOSED:"closed"},n.home=function(){var n=t.getSettings();e.go("/task/list/",{type:n.default_view.value})},n.taskHome=function(t,n){if(t.project.id){var s={id:t.project.id};n&&(s.focusMe=n),e.go("/project/details",s)}else{var s={type:"inbox"};n&&(s.focusMe=n),e.go("/task/list/",s)}},n.inbox={id:"",color:"",hasBorder:!0,name:"Inbox",users:[]},n.BASIC_TASK={project:{id:0,name:"Inbox"},hasDueDate:!1,recurrence:{},assignee:{},watchers:[],labels:[],notes:[],reminders:[]},n.LEFT_MENU_KEYS={ASSIGNEE:"assignee",FAVOURITES:"favourites",INBOX:"inbox",FILTER:"filter",LABEL:"label",MY_FEEDS:"myFeed",NEXT_7_DAY:"next7days",OVERDUE:"overdue",PROJECT:"project",TODAY:"today",WATCHING:"watching"},n.leftMenuSingleItems=function(){return[{title:"Inbox",value:"inbox",icon:"tdzicon-inbox"},{title:"Today",value:"today",icon:"tdzicon-today"},{title:"Next 7 Days",value:"next7days",icon:"tdzicon-next7days"},{title:"Overdue",value:"overdue",icon:"tdzicon-overdue"},{title:"My Feeds",value:"myFeed",icon:"ion-ios-pulse"},{title:"Watching",value:"watching",icon:"tdzicon-viewer"},{title:"Favourites",value:"favourites",icon:"tdzicon-favourites"}]}}])}.call(this),function(){app.service("date",["settingsService","stringService","moment","platformService",function(e,t,n,s){function r(e){return(e<10?"0":"")+e}var o=this;o.getDate=function(e){return"tomorrow"===e?o.tomorrow():"today"===e?o.today():"week"===e?o.nextWeek():"month"===e?o.nextMonth():e.setHours(0,0,0,0)},o.getDateOnly=function(e){return void 0==e||""==e?e:(e=new Date(e),e.setHours(0,0,0,0))},o.today=function(){return n().startOf("day")},o.tomorrow=function(){return n().add("days",1).startOf("day")},o.nextWeek=function(){return n().add("days",7).startOf("day")},o.nextMonth=function(){return n().add("months",1).startOf("day")},o.isToday=function(e){if(!e)return!1;e=new Date(e);var t=new Date;return e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()&&e.getDate()==t.getDate()},o.isTomorrow=function(e){if(void 0==e||""==e)return!1;e=new Date(e);var t=new Date;return e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()&&e.getDate()==t.getDate()+1},o.isYesterday=function(e){if(void 0==e||""==e)return!1;e=new Date(e);var t=new Date;return e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()&&e.getDate()==t.getDate()-1},o.isInNextNDays=function(e,t){if(!e)return!1;e=new Date(e);var n=new Date;n.setHours(0,0,0,0);var s=new Date;return s.setDate(n.getDate()+t),s.setHours(0,0,0,0),e>=n&&e<s},o.isInNextNMonths=function(e,t){if(!e)return!1;e=new Date(e);var n=new Date;n.setHours(0,0,0,0);var s=new Date;return s.setMonth(n.getMonth()+t),s.setHours(0,0,0,0),e>=n&&e<=s},o.isInNextNYears=function(e,t){if(!e)return!1;e=new Date(e);var n=new Date;n.setHours(0,0,0,0);var s=new Date;return s.setFullYear(n.getFullYear()+t),s.setHours(0,0,0,0),e>=n&&e<=s},o.isInRange=function(e,t,s){var r=n.range(new Date(e),new Date(t));return r.contains(new Date(s))},o.isPastDay=function(e){if(void 0==e||""==e)return!1;e=new Date(e);var t=new Date;return!(o.isToday(e)&&!e.getHours()&&!e.getMinutes())&&e<t},o.updateSummary=function(e,t){var n=new Date;e.starts_on=new Date(e.starts_on);var s="";if(s=e.every<=1?e.repeat.type:"Every "+e.every+" "+e.repeat.title,2==e.repeat.id){var r=0,a="";s+=" on ";for(var i=0;i<t.length;i++)t[i].checked&&(r++,a+=t[i].title+", ");a=7==r?"all days":r>0?a.replace(/,\s*$/,""):o.week[n.getDay()],s+=a}else 3==e.repeat.id?s+=e.by?" on the "+o.weekPrefixes[e.weekNumber]+" "+o.week[e.starts_on.getDay()]:" on day "+e.starts_on.getDate():4==e.repeat.id&&(s+=" on "+o.month[e.starts_on.getMonth()]+" "+e.starts_on.getDate());return e.starts_on=new Date(e.starts_on),(e.starts_on.getHours()||e.starts_on.getMinutes())&&(s+=o.timeFormat(e.starts_on)),1==e.repeatEnd.id&&e.repeatEnd.occurrence?s+=", "+e.repeatEnd.occurrence+" times":2==e.repeatEnd.id&&e.repeatEnd.end&&(s+=" until "+o.dateTimeFormat(e.repeatEnd.end)),s},o.month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o.week=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o.weekPrefixes=["First","Second","Third","Fourth","Fifth"],o.repeats=[{id:0,type:"No repeat",title:"No repeat"},{id:1,type:"Daily",title:"days"},{id:2,type:"Weekly",title:"weeks"},{id:3,type:"Monthly",title:"months"},{id:4,type:"Yearly",title:"years"}],o.repeatOnList=[{checked:!1,code:"S",title:"Sunday"},{checked:!1,code:"M",title:"Monday"},{checked:!1,code:"T",title:"Tuesday"},{checked:!1,code:"W",title:"Wednesday"},{checked:!1,code:"T",title:"Thursday"},{checked:!1,code:"F",title:"Friday"},{checked:!1,code:"S",title:"Saturday"}],o.repeatByList=[{checked:!1,code:0,name:"day of the month"},{checked:!1,code:1,name:"day of the week"}],o.TIME_FORMAT=["hh:mm A","HH:mm"],o.DATE_FORMAT=["DD MMM YYYY","MMM DD, YYYY"],o.getDateTime=function(s){var r=t.EMPTY;s=new Date(s);var a=o.DATE_FORMAT[parseInt(e.getSettings().date_format.value)];return(s.getHours()||s.getMinutes())&&(r=" @ "+o.TIME_FORMAT[parseInt(e.getSettings().time_format.value)]),n(s).calendar(null,{lastDay:"[Yesterday]"+r,sameDay:"[Today]"+r,nextDay:"[Tomorrow]"+r,nextWeek:a+r,lastWeek:a+r,sameElse:a+r})},o.getDateTimeFromNow=function(e){e=new Date(e);var t=new Date,s=t.getFullYear()!=e.getFullYear();return t.setDate(t.getDate()-1),n(e).diff(n(t))>1?n(e).fromNow(!0):s?n(e).format("D MMM YYYY"):n(e).format("D MMM")},o.getTime=function(s){s=new Date(s);var r=e.getSettings();if(r&&s.getHours()||s.getMinutes()){var a=o.TIME_FORMAT[parseInt(r.time_format.value)];return n(s).format(a)}return t.EMPTY},o.getMomentDate=function(t){var r=o.DATE_FORMAT[parseInt(e.getSettings().date_format.value)],a=n(new Date(t)),i=n().diff(a,"days");return s.isMobileDevice(),a.year()===n().year()&&(r=r.replace(new RegExp("y","gi"),"")),r=r.replace("dd","d").replace("DD","D"),a.calendar(null,{lastDay:'[Yesterday] [&nbsp;<span class="date-value">]'+r+"[</span>]",sameDay:'[Today] [&nbsp;<span class="date-value">]'+r+"[</span>]",nextDay:'[Tomorrow] [&nbsp;<span class="date-value">]'+r+"[</span>]",nextWeek:'ddd [&nbsp;<span class="date-value">]'+r+"[</span>]",lastWeek:'[Last] dddd [&nbsp;<span class="date-value">]'+r+"[</span>]",sameElse:(i>0?"["+i+" days ago &nbsp;":"[")+'<span class="date-value '+(i>0?"previous-day":"future-day")+'">]'+r+"[</span>]"})},o.getDateGroupHeader=function(e){return e?o.getMomentDate(e):"No Date"},o.isPast=function(e){var t=n(new Date);return e=n(new Date(e)),t.diff(e)>0},o.isAfter=function(e,t){return e=n(new Date(e)),t=n(new Date(t)),e.diff(t)>1},o.getUnFormattedTimeString=function(e){var t=e,n=t?new Date(t):new Date;t||(n.setHours(0),n.setMinutes(0),n.setMinutes(0),n.setMilliseconds(0));var s=r(n.getHours())+":"+r(n.getMinutes());return s},o.getTimeFromString=function(e){var t=(e+"").split(":"),n=new Date;return t.length>1&&(n.setHours(t[0]),n.setMinutes(t[1]),n.setSeconds(0),n.setMilliseconds(0)),n}}])}.call(this),function(){app.service("discardChange",["$ionicPopup","$state","message","stringService",function(e,t,n,s){var r,o,a,i=this;i.savePrevious=function(e,t){o=!1,r=e,a=angular.copy(t)},i.discardPopup=function(a,i){e.show({template:n.infoMessages.DISCARD_CHANGE.message,title:n.infoMessages.DISCARD_CHANGE.title,scope:r,buttons:[{text:s.NO,onTap:function(){return!0}},{text:s.YES,onTap:function(){o=!0,t.go(a.name,i)}}]})},i.updateDiscardedBeforeSave=function(){o=!0},i.isChanged=function(e){return!angular.equals(a,e)},i.changeState=function(e,t,n,s){!o&&i.isChanged(s)&&(e.preventDefault(),i.discardPopup(t,n))}}])}.call(this),function(){app.service("dueService",["date","stringService",function(e,t){function n(e,t,n){switch(t.due_date=e,t.repeatEnd.id){case 1:n&&t.repeatEnd.remainingOccurrence--,t.isRecurring=!!t.repeatEnd.remainingOccurrence;break;case 2:var s=new Date(t.repeatEnd.end);s.setDate(s.getDate()+1),s.setHours(0,0,0,0),t.isRecurring=e<s}return t}var s=this;s.REPEAT_BY_ITEMS=[{checked:!1,code:0,name:"day of the month"},{checked:!1,code:1,name:"day of the week"}],s.REPEAT_ITEMS={DAILY:{title:"Daily",plural:"days"},WEEKLY:{title:"Weekly",plural:"weeks"},MONTHLY:{title:"Monthly",plural:"months"},YEARLY:{title:"Yearly",plural:"years"}},s.REPEAT_KEY={DAILY:"DAILY",WEEKLY:"WEEKLY",MONTHLY:"MONTHLY",YEARLY:"YEARLY"},s.REPEAT_ON_ITEMS=[{checked:!1,code:"S",title:"Sunday"},{checked:!1,code:"M",title:"Monday"},{checked:!1,code:"T",title:"Tuesday"},{checked:!1,code:"W",title:"Wednesday"},{checked:!1,code:"T",title:"Thursday"},{checked:!1,code:"F",title:"Friday"},{checked:!1,code:"S",title:"Saturday"}],s.getSummary=function(n){if(n.isRecurring){var r=new Date;n.starts_on=new Date(n.starts_on);var o="";if(o=!n.every||n.every<=1?s.REPEAT_ITEMS[n.repeat].title:"Every "+n.every+" "+s.REPEAT_ITEMS[n.repeat].plural,n.repeat===s.REPEAT_KEY.WEEKLY){var a=0,i="";o+=" on ";for(var c=0;c<n.repeatOn.length;c++)n.repeatOn[c].checked&&(a++,i+=n.repeatOn[c].title+", ");i=7==a?"all days":a>0?i.replace(/,\s*$/,""):e.week[r.getDay()],o+=i}else n.repeat==s.REPEAT_KEY.MONTHLY?o+=n.repeatBy?" on the "+e.weekPrefixes[n.weekNumber]+" "+e.week[n.starts_on.getDay()]:" on day "+n.starts_on.getDate():n.repeat==s.REPEAT_KEY.YEARLY&&(o+=" on "+e.month[n.starts_on.getMonth()]+" "+n.starts_on.getDate());return(n.starts_on.getHours()||n.starts_on.getMinutes())&&(o+=" @ "+e.getTime(n.starts_on)),1==n.repeatEnd.id&&n.repeatEnd.occurrence?o+=", "+n.repeatEnd.occurrence+" times":2==n.repeatEnd.id&&n.repeatEnd.end&&(o+=" until "+e.getDateTime(n.repeatEnd.end)),o}return n.due_date?e.getDateTime(n.due_date):t.EMPTY},s.setDueDate=function(e,t){if(!e.isRecurring)return e;var r;e.starts_on=new Date(e.starts_on),e.due_date=new Date(e.due_date);var o;switch(t?(o=t<e.due_date?new Date(e.due_date):new Date(t),r=e.every):(o=new Date(e.starts_on),r=0),e.repeat){case s.REPEAT_KEY.DAILY:o.setDate(o.getDate()+r);break;case s.REPEAT_KEY.WEEKLY:var a,i=new Date(o),c=!1;a=r?7:14;var l=i.getDay()+1;for(i.setDate(i.getDate()+1);l<a;){if(e.repeatOn[i.getDay()].checked){c=!0,o=i;break}i.setDate(i.getDate()+1),l++}if(!c){var u=new Date(o);for(u.setDate(u.getDate()+7*r-u.getDay()),p=0;p<7;p++){if(e.repeatOn[u.getDay()].checked){o=u;break}u.setDate(u.getDate()+1)}}break;case s.REPEAT_KEY.MONTHLY:var d=o.getMonth()+1*r;o.setMonth(d);var f=new Date(e.starts_on);if(e.repeatBy){o.setDate(1);for(var p=0;p<7&&o.getDay()!=f.getDay();p++)o.setDate(o.getDate()+1);o.setDate(o.getDate()+7*e.weekNumber),o.getMonth()>d&&o.setDate(o.getDate()-7)}else o.setDate(f.getDate());break;case s.REPEAT_KEY.YEARLY:o.setFullYear(o.getFullYear()+1*r),o.setDate(e.starts_on.getDate())}return o.setHours(e.starts_on.getHours()),o.setMinutes(e.starts_on.getMinutes()),n(o,e,t)}}])}.call(this),!function(){app.service("gAnalytics",["ANALYTICS_CONFIG","platformService","$state","$rootScope","userModel",function(e,t,n,s,r){function o(e){var t=e||n.current.title||n.current.url;e||"/task/list/"!=n.current.name||(t="next7days"==n.params.type?"Next7Days_Filters_Task_List":_.capitalize(n.params.type)+"_Filters_Task_List"),c&&window.cordova?window.ga.trackView(t):(ga("set","page",t),ga("send","pageview"))}function a(){var e,t=r.isAuthenticated();e=t?r.getLoggedInEmail():null,c&&window.cordova?window.ga.setUserId(e):ga("set","userId",e)}var i=this,c=t.isMobileDevice();i.init=function(){c&&window.cordova?(window.ga.startTrackerWithId(e.MOBILE_ID),console.log("analytics registered mobile")):(ga("create",e.WEB_ID,"auto"),ga("send","pageview"),console.log("analytics registered web")),s.$on("$stateChangeSuccess",function(){o()}),s.$on("login-success",function(){a()}),s.$on("logoff-success",function(){a()}),s.$on("set-page",function(e,t){o(t)}),a()}}])}(),function(){app.service("guidGenerator",function(){var e=this;e.getId=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(32).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()}})}.call(this),function(){app.service("headerService",function(){var e=this;e.activeScope=null,e.taskHeader={},e.setAddTaskHeader=function(t){e.activeScope=t,e.taskHeader={title:"Add Task",taskObject:t.taskObject,taskId:null,createType:"add",createButtonName:"Add Task",createButtonLink:"#/task/add",noteButtonLink:"#/task/note/",addTab:!0,isSaved:!0}},e.setEditTaskHeader=function(t,n){e.activeScope=t,e.taskHeader={title:"Edit Task",taskObject:t.taskObject,taskId:n,createType:"edit",createButtonName:"Edit Task",createButtonLink:"#/task/edit/"+n,noteButtonLink:"#/task/note/"+n,addTab:!0,isSaved:!0}},e.setTaskNoteHeader=function(t,n){e.activeScope=t,e.taskHeader={title:"Add Note",taskObject:t.taskObject,taskId:n,createType:n?"edit":"add",createButtonName:n?"Edit Task":"Add Task",createButtonLink:n?"#/task/edit/"+n:"#/task/add",noteButtonLink:n?"#/task/note/"+n:"#/task/note/",noteTab:!0,isSaved:!n}}})}.call(this),!function(){app.service("helperService",["date",function(e){var t=this;t.getScheduledTime=function(e,n){var s;return e.time.id?s=new Date(e.time.value):(s=new Date(n),s.setMinutes(s.getMinutes()-t.timeDuration[e.time.value].minutes)),s},t.getUserByRole=function(e,t){var n=_.find(e,function(e){return e.role==t&&e._id});return n},t.timeDuration=[{title:"5 minutes before",value:0,minutes:5},{title:"15 minutes before",value:1,minutes:15},{title:"30 minutes before",value:2,minutes:30},{title:"1 hour before",value:3,minutes:60},{title:"2 hours before",value:4,minutes:120},{title:"3 hours before",value:5,minutes:180},{title:"6 hours before",value:6,minutes:360},{title:"12 hours before",value:7,minutes:720},{title:"1 day before",value:8,minutes:1440}]}])}(),!function(){app.service("httpAllInterceptor",["$rootScope","$window","$q","TodoZuDB","userModel","message","$timeout",function(e,t,n,s,r,o,a){function i(n){try{var s=n.headers();if(s["x-api-version"]){console.log("api version : "+s["x-api-version"]);var r=s["x-api-version"],o=parseInt((s["x-api-version"]||"").replace(/\./g,"")),a=t.localStorage.getItem("x-api-version");if(a){var i=parseInt((t.localStorage.getItem("x-api-version")||"").replace(/\./g,""));i!=o&&e.$emit("api-version-changed",r)}else t.localStorage.setItem("x-api-version",r)}}catch(e){console.log("Error in version check"),console.log(e)}finally{return n}}this.response=function(e){return n(function(t,n){try{t(e)}finally{a(function(){r.isAuthenticated()&&i(e)})}})}}])}(),function(){app.service("localNotification",["$rootScope","$cordovaVibration","$state",function(e,t,n){}])}.call(this),!function(){app.service("loggingService",["$rootScope","userModel","$window",function(e,t,n){function s(){if(t.isAuthenticated()){var e=t.getLoggedInUser(),s={payload:{person:e}};e&&n.Rollbar&&n.Rollbar.configure(s)}}function r(){n.Rollbar&&n.Rollbar.configure({payload:{person:null}})}var o=this;o.init=function(){n.cordova&&n.Rollbar?(n.Rollbar.init(),console.log("cordova rollbar initialized")):(console.log("cordova rollbar not found"),n.cordova&&console.log(n.cordova.plugins)),n.cordova||(s(),e.$on("login-success",function(){s()}),e.$on("logoff-success",function(){r()}))}}])}(),function(){app.service("message",["CONSTANT",function(e){var t=this;t.errorMessages={ACTIVATION_ERROR:{title:"Activation error",message:"Please activate your account by clicking on the link we have sent via email before attempting login.",success:!1},CONNECTION_ERROR:{title:"No internet connection",message:"No internet connection detected.<br/> Please check connectivity then try again.",success:!1},CONNECTION_REQUIRED:{title:"Internet connection required",message:"Internet connection required.",success:!1},DATABASE_ERROR:{title:"Database error",message:"Database Error or no database connection.",success:!1},EMAIL_ALREADY_EXISTS:{title:"Email address already exists",message:"The email address submitted already exists. Please use another address then try again.",success:!1},EMAIL_ALREADY_VERIFIED:{title:"Email address already verified",message:"Your email address has already been verified and your TodoZu account setup is complete.<br> Please login below using your registered credentials.",success:!1},EMAIL_NOT_FOUND:{title:"Email address does not exist",message:"This email address does not match our records.",success:!1},EMAIL_NOT_VERIFIED:{title:"Account verification incomplete",message:"Password reset is not authorised until your email address is verified. Please check your email account for the verification link sent. Follow the instructions to verify that you are the owner of this registered email address before trying to reset password.",success:!1},EMAIL_REQUIRED:{title:"Email address required",message:"No email address provided.",success:!1},GENERAL:{title:"Something went wrong",message:"Something went wrong.",success:!1},INVALID_TOKEN:{title:"Invalid token",message:"The provided token is invalid or has already expired.",success:!1},LOGIN_FAILED_EMAIL_NOT_VERIFIED:{title:"Email not verified",message:"Your email address has not yet been verified.",success:!1},LOGIN_FAILED:{title:"Login failed",message:"The email address or password you entered is incorrect.",success:!1},MAX_FILE_SIZE_EXCEEDED:{title:"File exceeds maximum size (5MB)",message:"File exceeds maximum size (5MB).",success:!1},NO_FILE:{title:"No such file exists",message:"No such file exists.",success:!1},PASSWORD_MISMATCH:{title:"Password mismatch",message:"You have provided an incorrect password.",success:!1},REMINDER_TIME_REQUIRED:{title:"Reminder time required",message:"Reminder time required.",success:!1},REMINDER_TIME_VALIDATION_ERROR_FOR_FIXED:{title:"Reminder time validation error for fixed date time",message:"Time of reminder must be more than 2 minutes from now.",success:!1},REMINDER_TIME_VALIDATION_ERROR_FOR_RELATIVE:{title:"Reminder time validation error for relative date time",message:"Reminder must be set to a time in the future.",success:!1},USER_NOT_FOUND:{title:"User not found",message:"User not found.",success:!1},TASK_NOT_FOUND:{title:"Task not found",message:"Task not found",success:!1},PROJECT_ADMIN_INVITATION_INVALID_PROJECT_USER:{title:"Invalid project user",message:"User with the email is not a valid project user.",success:!1},LINK_EXPIRED:{title:"Link expired",message:"This link has expired.<br/>Please contact the project administrator to arrange for another invitation to be sent."},LINK_USED:{title:"Link used",message:"This link has already been used.<br/>Please contact the project administrator to arrange for another invitation to be sent."},INVALID_TOKEN_MSG:{title:"Invalid token",message:"The token provided is invalid."}},t.successMessages={ATTACHMENT_ADDED:{title:"Attachment added",message:"Attachment added.",success:!0},CONNECTION_ESTABLISHED:{title:"Connection established",message:"Connection established.",success:!0},CONFIRM_EMAIL_ADDRESS:{title:"Confirm email address",message:"Almost there! We have sent a confirmation message to your registered email address.<br/> <br/>Click the link in the email to confirm your account registration.",success:!0},EMAIL_UPDATED:{title:"Email updated",message:"Email address updated.",success:!0},EMAIL_UPDATE_REQUEST:{title:"Please check your new email address and follow the prompts",message:"Please check your new email address and follow the prompts.",success:!0},EMAIL_VERIFIED:{title:"Email address verified",message:"Congratulations! Your email address is verified and your TodoZu account setup is complete.<br/><br/> Please login below using your registered credentials.",success:!0},FILTER_EDITED:{title:"Filter updated",message:"Filter updated successfully.",success:!0},FILTER_DELETED:{title:"Filter deleted",message:"Filter deleted successfully.",success:!0},FILTER_SAVED:{title:"Filter saved",message:"Filter saved successfully.",success:!0},FORGOT_PASSWORD_EMAIL_SENT:{title:"Email sent (password reset)",message:"An email has been sent with a link to reset your password. Please check your email and follow the instructions.",success:!0},LABEL_EDITED:{title:"Label updated",message:"Label updated successfully.",success:!0},LABEL_DELETED:{title:"Label deleted",message:"Label deleted successfully.",success:!0},LABEL_SAVED:{title:"Label saved",message:"Label saved successfully.",success:!0},NAME_UPDATED:{title:"Name updated",message:"Your name has been updated successfully.",success:!0},NOTE_COPIED:{title:"Note copied to clipboard",message:"Note copied successfully.",success:!0},NOTE_DELETED:{title:"Note deleted",message:"Note deleted successfully.",success:!0},NOTE_EDITED:{title:"Note updated",message:"Note updated successfully.",success:!0},NOTE_SAVED:{title:"Note saved",message:"Note saved successfully.",success:!0},PASSWORD_RESET_REQUEST:{title:"Email sent (password reset)",message:"An email has been sent with a link to reset your password. Please check your email and follow the instructions.",success:!0},PASSWORD_UPDATED:{title:"Password updated",message:"Password updated successfully.",success:!0},PASSWORD_RESET:{title:"Password reset successful",message:"Congratulations! You have successfully updated your password. Please login below.",success:!0},PROFILE_IMAGE_UPDATED:{title:"Profile image updated",message:"Profile image updated.",success:!0},PROJECT_ARCHIVED:{title:"Project archived",message:"Project archived successfully.",success:!0},PROJECT_DELETED:{title:"Project deleted",message:"Project deleted successfully.",success:!0},PROJECT_EDITED:{title:"Project updated",message:"Project updated successfully.",success:!0},PROJECT_INVITATION_APPROVAL_ACCEPT:{title:"New user approved",message:"New user approved successfully.",success:!0},PROJECT_INVITATION_APPROVAL_REJECTED:{title:"New user request rejected",message:"New user request rejected.",success:!0},PROJECT_INVITATION_CANCELLED:{title:"Invitation cancelled",message:"Invitation cancelled.",success:!0},PROJECT_INVITATION_RESENT:{title:"Invitation resent",message:"Invitation resent.",success:!0},PROJECT_ADMIN_INVITATION_SENT:{title:"Project admin request sent",message:"Project admin request sent",success:!0},PROJECT_ADMIN_INVITATION_SENT:{title:"Project admin request sent",message:"Project admin request sent",success:!0},PROJECT_JOINED:{title:"Project joined",message:"You have successfully joined.",success:!0},PROJECT_LEFT:{title:"You have left project",message:"You have successfully left.",success:!0},PROJECT_SAVED:{title:"Project saved",message:"Project saved successfully.",success:!0},PROJECT_UNARCHIVED:{title:"Project unarchived",message:"Project unarchived successfully.",success:!0},PROJECT_USER_DELETED:{title:"User removed",message:"User removed successfully.",success:!0},REMINDER_ADDED:{title:"Reminder added",message:"Reminder added successfully.",success:!0},REMINDER_DELETED:{title:"Reminder deleted",message:"Reminder deleted successfully.",success:!0},RESET_PASSWORD_CONFIRMATION:{title:"Password reset successful",message:"Congratulations! You have successfully updated your password. Please login below.",success:!0},SETTINGS_SAVED:{title:"Settings saved",message:"Settings saved successfully.",success:!0},TASK_ADD_TO_FAVOURITE:{title:"Added to favourites",message:"Added to favourites successfully.",success:!0},TASK_COMPLETED:{title:"Task completed",message:"Task completed successfully.",success:!0},TASK_UNCOMPLETED:{title:"Task re-opened",message:"Task re-opened successfully.",success:!0},TASK_DUE_DATE_UPDATED:{title:"Task due date updated",message:"Task due date updated successfully.",success:!0},TASK_EDITED:{title:"Task updated",message:"Task updated successfully.",success:!0},TASK_REMOVE_FROM_FAVOURITE:{title:"Removed from favourites",message:"Removed from favourites.",success:!0},TASK_SAVED:{title:"Task saved",message:"Task saved successfully.",success:!0},TASK_DELETED:{title:"Task deleted",message:"Task deleted.",success:!0},ACCOUNT_DELETED:{title:"Account deleted.",message:"Account deleted.",success:!0}},t.infoMessages={DISCARD_CHANGE:{title:"Discard changes",message:"Are you sure you want to discard changes without saving?"},FILTER_DELETE_CONFIRMATION:{title:"Delete filter",message:"Are you sure you want to delete this filter?"},LABEL_DELETE_CONFIRMATION:{title:"Delete label",message:"Labels attached to existing tasks will be permanently detached. Are you sure you want to delete this label?"},LINK_TO_TASK_CONFIRMATION:{title:"Link to task",message:"NOTE:<br> Only users with access to the Project to which this task is assigned will be able to view the task via the above link."},MULTIPLE_NOTES_DELETE_CONFIRMATION:{title:"Delete",message:"Are you sure you want to delete the selected notes and attachments?"},NO_DUE_DATE_SET:{title:"No due date / time set",message:"Due: -"},PROJECT_ARCHIVED_CONFIRMATION:{title:"Archive project",message:"Are you sure you want to archive this project?"},PROJECT_DELETED_CONFIRMATION:{title:"Delete project",message:"<strong>WARNING!</strong> You are about to permanently delete this project. ALL TASKS in this project will also be permanently deleted. Are you sure you want to continue?"},PROJECT_DELETED_DISALLOWED:{title:"Delete project - Disallowed",message:"To delete this project, first remove all active project users then try again."},PROJECT_USER_DELETED:{title:"Remove user",message:"Are you sure you want to remove this user from this project?"},PROJECT_INVITATION_SENT_BY_ADMIN:{title:"Invite user",message:"Are you sure you want to send an invitation and grant this user access to this project?"},PROJECT_INVITATION_SENT_BY_USER:{title:"Invite user",message:"Your invitation request will be sent to the project admin for approval. Continue?"},PROJECT_INVITATION_RESENT:{title:"Resend invitation",message:"Are you sure you want to resend this invitation?"},PROJECT_INVITATION_CANCELLED:{title:"Cancel invitation",message:"Are you sure you want to cancel this invitation?"},PROJECT_LEFT_CONFIRMATION:{title:"Leave project",message:"Are you sure you want to leave this project?"},PROJECT_ADMIN_REQUEST_CONFIRMATION:{title:"Change project admin",message:"<strong>WARNING!</strong> You are about to invite another user to become the administrator of this project.<br/><br/>By doing this, you will loose all your existing admin permissions for this project and will be able to access the project only as a regular user.<br/><br/>This action cannot be reversed without the approval of the new project admin.<br/><br/>Are you sure you want to continue?"},PROJECT_UNARCHIVED_CONFIRMATION:{title:"Unarchive project",message:"Are you sure you want to unarchive this project?"},PROJECT_ADMIN_REQUEST_APPROVED:{title:"Project admin request approved",message:"Project admin request approved",success:!0},PROJECT_ADMIN_REQUEST_REJECTED:{title:"Project admin request rejected",message:"Project admin request rejected",success:!1},REMINDER_DELETE_CONFIRMATION:{title:"Delete reminder",message:"Are you sure you want to delete this reminder?"},SINGLE_NOTE_DELETE_CONFIRMATION:{title:"Delete note",message:"Are you sure you want to delete this note?"},SINGLE_FILE_DELETE_CONFIRMATION:{title:"Delete attachment",message:"Are you sure you want to delete this attachment?"},TASK_DELETE_CONFIRMATION:{title:"Delete task",message:"Are you sure you want to delete this task? Note that all task details, notes, attachments and history will be permanently deleted for all users."},TASK_HISTORY:{title:"Task history",message:"<p>The 'Task History' feature is a change log of each task and shows updates by user, date/time and change type. This feature is not available on your current license type.</p><p><a href='"+e.upgradeUrl+"' target='_blank'> Click here</a> to upgrade your license.</p>",success:!1},
API_VERSION_CHANGE:{title:"TodoZu: Logout required",message:"Important updates have been applied to the TodoZu service. You are required to logout and login again for these changes to take effect.",success:!1}};var n={};t.setAlert=function(e){n={title:e.title,msg:e.message,success:e.success}},t.getAlert=function(){return n},t.clearAlert=function(){n={}}}])}.call(this),!function(){app.service("navigationService",["$ionicHistory","$state","sharedData",function(e,t,n){function s(n){var o,a=0;if(!n.backViewId)return{view:n,count:a};o=e.getViewById(n.backViewId);var i=t.get(n.stateName),c=t.get(o.stateName);if(!i||!c)return{view:n,count:a};var l=n,u=!0;if(c.skipNavigation&&r.isMatchingParams(o.stateParams,c.skipParams)||(l=o,a=1,u=!1),i.stateGroup&&c.stateGroup&&i.stateGroup==c.stateGroup||u){var d=s(o);l=d.view,d.view!=o&&(a+=d.count+(c.skipNavigation?1:0))}return{view:l,count:a}}var r=this;r.isMatchingParams=function(e,t){if(!e||!t)return!1;if(0==_.size(e)&&_.size(t)>0||0==_.size(t)&&_.size(e)>0)return!1;var n=!0,s=e||{};return _.each(t,function(e,r){if(Array.isArray(t[r])){var o=!1;return _.each(t[r],function(e,n){if(t[r][n]==s[r])return o=!0,!1}),n=o}if(t[r]!==s[r])return n=!1,!1}),n},r.goBack=function(r){var o=e.currentView(),a=s(o),i=a.view;o!=i?(r&&(i.stateParams=angular.extend(i.stateParams,r)),e.nextViewOptions({disableBack:!0}),t.go(i.stateName,i.stateParams)):n.home()}}])}(),function(){app.service("connectivity",["$rootScope","$timeout","message",function(e,t,n){var s=this;s.checkConnection=function(){return navigator.connection?!("none"==navigator.connection.type):navigator.onLine},s.isConnected=function(){return navigator.onLine},s.startMonitor=function(){e.connected=!0,window.addEventListener("online",function(s){e.connected=!0,e.$emit("toast-message",n.successMessages.CONNECTION_ESTABLISHED),t(function(){e.$emit("network-connected"),e.$emit("connect-socket"),e.$emit("push-to-server",!0)},500)},!1),window.addEventListener("offline",function(t){e.connected=!1,e.$emit("network-disconnected"),e.$emit("disconnect-socket"),e.$emit("toast-message",n.errorMessages.CONNECTION_ERROR)},!1),document.addEventListener("resume",function(){t(function(){e.$emit("network-connected"),e.$emit("push-to-server",!0)},500)},!1)}}])}.call(this),function(){app.service("platformService",function(){var e=this,t=ionic.Platform.platform();e.isMobileDevice=function(){return"android"===t||"ios"===t},e.getPlatform=function(){return t}})}.call(this),!function(){app.service("popupService",["$ionicPopup","$q","stringService","message","$rootScope","$ionicModal",function(e,t,n,s,r,o){var a=this;a.discard=function(r){var o=t.defer();return e.show({template:s.infoMessages.DISCARD_CHANGE.message,title:s.infoMessages.DISCARD_CHANGE.title,scope:r,buttons:[{text:n.NO,onTap:function(){o.resolve(!1)}},{text:n.YES,onTap:function(){o.resolve(!0)}}]}),o.promise},a.roleWarning=function(e,n){var s,a=t.defer(),i=e?e.$new():r.$new();return i.cancel=function(){s.remove(),a.reject()},i.upgrade=function(){s.remove(),a.resolve()},i.validationResult=n,o.fromTemplateUrl("html/views/modals/validations/role_validation_popup.html",function(e){s=e,s.show()},{scope:i,animation:"scale-in"}),a.promise};var i=!1;a.apiVersionChanged=function(t){i||(i=!0,e.alert({title:s.infoMessages.API_VERSION_CHANGE.title,content:s.infoMessages.API_VERSION_CHANGE.message,buttons:[{text:n.OK,onTap:function(){i=!1,t&&t()}}]}))}}])}(),function(){app.service("pushNotification",["$rootScope","$state","$q","$window","platformService","userModel","PUSH_NOTIFICATION_CONFIG","$timeout","toastr","$ionicLoading","$ionicPopup","stringService",function(e,t,n,s,r,o,a,i,c,l,u,d){function f(e){console.log(e);var t=e.additionalData;e.isActive?u.alert({title:t.title,content:e.message,buttons:[{text:d.CLOSE,onTap:function(){m(t,e.isActive)}}]}):m(t,e.isActive)}function p(e){console.log(e);var t=e.data;m(t,e.isActive)}function m(n,s){console.log("push notification data"),console.log(n);var r=e.$on("pull-from-server-complete",function(){r(),i(function(){s||l.hide(),s||t.go(n.state,n.params)},300)});e.$emit("pull-from-server"),s||l.show()}function g(){notify.PERMISSION_DEFAULT!=notify.permissionLevel()&&notify.PERMISSION_DENIED!=notify.permissionLevel()||notify.requestPermission(function(){})}var v,h=this;h.initialized=!1,h.init=function(){var e=n.defer();if(r.isMobileDevice())v=window.plugins.OneSignal,v.init(a.APP_ID,{googleProjectNumber:a.GOOGLE_PROJECT_NUMBER},f),h.initialized=!0,e.resolve();else{v=window.OneSignal||[];var t={appId:a.APP_ID,notificationClickHandlerMatch:"origin"};location.protocol.indexOf("https")<0&&(t.subdomainName=a.SUB_DOMAIN_NAME),v.push(["init",t]),v.push(["addListenerForNotificationOpened",p]),v.push(["isPushNotificationsEnabled",function(e){e||v.push(["registerForPushNotifications"])}]),g(),h.initialized=!0,e.resolve()}return e.promise},h.getDeviceUniqueId=function(){var e=n.defer();return console.log(new Date),v&&(r.isMobileDevice()?v.getIds(function(t){console.log("getIdsAvailable:\nUserID: "+t.userId+"\nRegistration ID: "+t.pushToken),console.log(new Date),o.setDeviceUniqueId(t.userId),o.setDeviceToken(t.pushToken),e.resolve({userId:t.userId,device_token:t.pushToken})}):v.push(["getIdsAvailable",function(t){console.log("getIdsAvailable:\nUserID: "+t.userId+"\nRegistration ID: "+t.registrationId),console.log(new Date),o.setDeviceUniqueId(t.userId),o.setDeviceToken(t.registrationId),e.resolve({userId:t.userId,device_token:t.registrationId})}])),e.promise}}])}.call(this),function(){app.service("reminderService",["$cordovaLocalNotification","$rootScope","$state","taskService","date","reminderModel","$interval","message","userModel","dbEnums","$q","CONSTANT",function(e,t,n,s,r,o,a,i,c,l,u,d){function f(t,n,s){T[n.id]?e.update({id:T[n.id].UID,at:s,text:t.recurrence.due_date?"Due: "+r.getDateTime(t.recurrence.due_date):i.infoMessages.NO_DUE_DATE_SET.message,title:"Reminder: "+t.name}).then(function(){console.log("The notification has updated")}):(n.UID=m(),b[n.UID]=!0,T[n.id]=n,e.schedule({id:n.UID,icon:"res://ic_stat_onesignal_default",at:s,text:t.recurrence.due_date?"Due: "+r.getDateTime(t.recurrence.due_date):i.infoMessages.NO_DUE_DATE_SET.message,title:"Reminder: "+t.name,data:JSON.stringify({taskId:t.id,reminderId:n.id})}).then(function(){console.log("The notification has been set")}))}function p(e,t,n){t.taskId=e.id,t.scheduleTime=n,o.addOrUpdate(t,function(){})}function m(){var e;do e=parseInt(1e7*Math.random());while(b[e]);return e}function g(){return("android"===k||"ios"===k)&&window.cordova}function v(){c.isAuthenticated()&&o.getAll(function(e,t){var n=new Date,a=new Date;a.setMinutes(n.getMinutes()+1),t.forEach(function(e){r.isInRange(n,a,e.scheduleTime)&&s.findById(e.taskId).then(function(t){var n,a="Reminder: "+t.name;n=t.recurrence.due_date?"Due:  "+r.getDateTime(t.recurrence.due_date):i.infoMessages.NO_DUE_DATE_SET.message,console.log("Reminder: Task - "+t.name+" :::: Reminder id - "+e.id),h(e,a,n),s.reminderDeleted(t.id,e.id),o.delete(e.id,function(){})})})})}function h(e,t,n){console.log(t+" :::: Reminder id - "+e.id),{state:"/task/edit",params:e.taskId},notify.createNotification(t,{body:n,icon:d.iconUrl}),I.play()}function E(e){var t=c.getLoggedInId();e.reminders.forEach(function(n){if(t==n.assignee._id){var a=S.getScheduledTime(n,e.recurrence.due_date);r.isPast(a)&&n.notificationChannels.push.value&&(console.log("cleaning up reminder for task : "+e.name),s.reminderDeleted(e.id,n.id),o.delete(n.id,function(){}))}})}var k=ionic.Platform.platform(),T=[],S=this,b=[],I=new Audio("media/sound/notification.mp3");S.notificationChannels={email:{title:"Email",value:!0,notified:!1},push:{title:"Push",value:!1,notified:!0}},S.timeDuration=[{title:"0 minutes before",value:9,minutes:0},{title:"5 minutes before",value:0,minutes:5},{title:"15 minutes before",value:1,minutes:15},{title:"30 minutes before",value:2,minutes:30},{title:"1 hour before",value:3,minutes:60},{title:"2 hours before",value:4,minutes:120},{title:"3 hours before",value:5,minutes:180},{title:"6 hours before",value:6,minutes:360},{title:"12 hours before",value:7,minutes:720},{title:"1 day before",value:8,minutes:1440}],S.init=function(){g()&&e.registerPermission()},S.getScheduledTime=function(e,t){var n;return e.time.id?n=new Date(e.time.value):(n=new Date(t),n.setMinutes(n.getMinutes()-S.timeDuration[e.time.value].minutes)),n},S.addReminder=function(e,t){var n=S.getScheduledTime(t,e.recurrence.due_date);!r.isPast(n)&&t.notificationChannels.push.value&&(g()?f(e,t,n):p(e,t,n))},S.deleteReminder=function(t,n){if(g()){if(!T[n.id])return;e.clear(T[n.id].UID).then(function(){})}else o.delete(n.id,function(){})},S.deleteRemindersByTaskId=function(t){var n=u.defer();if(g()){for(var s in T)if(T.hasOwnProperty(s)&&T[s].taskId==t){if(!T[reminder.id])return;e.clear(T[s].UID).then(function(){})}n.resolve()}else o.deleteRemindersByTaskId(t,function(){n.resolve()});return n.promise},t.$on("reminder:setReminders",function(e,t){var n=c.getLoggedInId();t.status==l.status.active?S.deleteRemindersByTaskId(t.id).then(function(){t.reminders.forEach(function(e){n==e.assignee._id&&S.addReminder(t,e)})}):t.reminders.forEach(function(e){n==e.assignee._id&&S.deleteReminder(t,e)})}),g()?(window.cordova.plugins.notification.local.on("trigger",function(t){console.log("reminder triggered.");var n=JSON.parse(t.data);s.reminderDeleted(n.taskId,n.reminderId),o.delete(n.reminderId,function(){}),e.clear(t.id).then(function(){})}),t.$on("$cordovaLocalNotification:click",function(t,r,a){var i=JSON.parse(r.data);s.reminderDeleted(i.taskId,i.reminderId).then(function(){n.go("/task/edit",{id:i.taskId})}),o.delete(i.reminderId,function(){}),e.clear(r.id).then(function(){})})):a(v,6e4),S.cleanUpReminders=function(){s.getAll().then(function(e){_.forEach(e,function(e){e.status==l.status.active&&E(e)})})}}])}.call(this),function(){app.service("rightMenuService",["$rootScope","$state","project","user","dbEnums","message","sharedData","date","notificationService","userModel","$ionicPopup","stringService","CONSTANT","$ionicModal","$ionicLoading","roleValidators","sync","RESPONSE_CODE","connectivity","$http","API",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m,g,v,h,E,k,T){function S(t,s){u.show({title:o.infoMessages.PROJECT_ARCHIVED_CONFIRMATION.title,template:o.infoMessages.PROJECT_ARCHIVED_CONFIRMATION.message,scope:s,buttons:[{text:d.NO,type:"btn-no",onTap:function(){return!0}},{text:d.YES,type:"btn-yes",onTap:function(){n.archive(t).then(function(){e.$emit("toast-message",o.successMessages.PROJECT_ARCHIVED),a.home()})}}]})}function b(e,t){t.copy=function(){t.copyTaskLinkModal.remove()},p.fromTemplateUrl("html/views/modals/copy-task-link.html",function(n){t.copyTaskLinkModal=n,t.link=f.app_link+"/#/task/edit/"+e.id,t.modalTitle=o.infoMessages.LINK_TO_TASK_CONFIRMATION.title,t.modalDescription=o.infoMessages.LINK_TO_TASK_CONFIRMATION.message,t.copyTaskLinkModal.show()},{scope:t,animation:"scale-in"})}function I(e,t){var s=l.getLoggedInUser(),r=n.canDeleteProject(e,s);r?y(e,t):u.show({title:o.infoMessages.PROJECT_DELETED_DISALLOWED.title,template:o.infoMessages.PROJECT_DELETED_DISALLOWED.message,scope:t,buttons:[{text:d.OK,type:"btn-ok",onTap:function(){return!0}}]})}function y(t,s){u.show({title:o.infoMessages.PROJECT_DELETED_CONFIRMATION.title,template:o.infoMessages.PROJECT_DELETED_CONFIRMATION.message,scope:s,buttons:[{text:d.NO,type:"btn-no",onTap:function(){return!0}},{text:d.YES,type:"btn-yes",onTap:function(){n.delete(t).then(function(){e.$emit("toast-message",o.successMessages.PROJECT_DELETED),a.home()})}}]})}function w(t,s){u.show({title:o.infoMessages.PROJECT_LEFT_CONFIRMATION.title,template:o.infoMessages.PROJECT_LEFT_CONFIRMATION.message,scope:s,buttons:[{text:d.NO,type:"btn-no",onTap:function(){return!0}},{text:d.YES,type:"btn-yes",onTap:function(){n.left(t).then(function(){e.$emit("toast-message",o.successMessages.PROJECT_LEFT),a.home()})}}]})}function D(e,t,n,s,o){function a(e){var t=[];return e.length>0&&(e.forEach(function(e){e.date=i.getDateTimeFromNow(e.date_created),e.isProject?e.redirectTo=e.isProjectDeleted?"#/":"#/project/details/"+e.project.id:e.isNote?e.redirectTo="#/task/note/"+e.task.id+"?focusMe="+(e.note?e.note.id:""):e.isCompleted?e.redirectTo="#/task/closed?tasks="+e.task.id:e.redirectTo="#/task/edit/"+e.task.id,e.task&&e.task.status&&e.task.status==r.status.deleted&&(e.redirectTo="javascript:void(0)"),e.isNote&&e.isCompleted,e.markAsUnread=!e.seen,t.push(e)}),t=_.orderBy(t,"date_created","desc"),c.items.concat(t),t.forEach(function(e){c.items.push(e)})),t}var c=this;c.skip=0,this.limit=25,c.initialData=o||[],c.items=[],this.loadMore=function(){console.log("loadMore : "+moment().format("hh:mm:ss:sss")),0===c.skip?(c.initialData.length>0?(a(c.initialData),c.skip+=c.initialData.length):c.noMoreItemsAvailable=!0,s.$broadcast("scroll.infiniteScrollComplete"),console.log("loadMore ends : "+moment().format("hh:mm:ss:sss"))):t.getAllNotificationsByUserId(c.skip,c.limit).then(function(e){e.length?(a(e),c.skip+=e.length):c.noMoreItemsAvailable=!0,console.log("loadMore ends : "+moment().format("hh:mm:ss:sss")),s.$broadcast("scroll.infiniteScrollComplete")})},this.loadMore()}function O(t){var n=e.$new();u.show({title:o.infoMessages.PROJECT_ADMIN_REQUEST_CONFIRMATION.title,template:o.infoMessages.PROJECT_ADMIN_REQUEST_CONFIRMATION.message,scope:n,buttons:[{text:d.NO,type:"btn-no",onTap:function(){return!0}},{text:d.YES,type:"btn-yes",onTap:function(){A(t)}}]})}function A(t){var n=e.$new();n.project=t,n.sendProjectAdminRequest=M.sendProjectAdminRequest,n.removeProjectAdminRequestDetailModal=R,n.model={},p.fromTemplateUrl("html/views/modals/project/project_admin_request_details.html",function(e){U=e,n.project=t,U.show()},{scope:n,animation:"scale-in"})}function R(e){U.remove(),e.preventDefault()}var M=this,C={DELETE:"DELETE",REMINDER:"REMINDER"},N={ARCHIVE:"ARCHIVE",DELETE:"DELETE",EDIT:"EDIT",HELP:"HELP",INVITE_USERS:"INVITE_USERS",LEAVE:"LEAVE",LINK:"LINK",LOGOUT:"LOGOUT",NOTIFICATION:"NOTIFICATION",REFRESH:"REFRESH",SEARCH:"SEARCH",SETTINGS:"SETTINGS",VIEW_USERS:"VIEW_USERS",PROJECT_ADMIN_REQUEST:"PROJECT_ADMIN_REQUEST"},$=[],L={FILTER:"filter",LABEL:"label",PROJECT:"project",TASK:"task"};M.getMenu=function(){return $},M.getBottomMenu=function(){return[{title:"Reminder",value:C.REMINDER},{title:"Delete",value:C.DELETE}]},M.itemClicked=function(n,o,a,i){switch(n.value){case N.ARCHIVE:S(o,a);break;case N.DELETE:n.type==L.FILTER||n.type==L.LABEL||n.type==L.PROJECT&&I(o,a);break;case N.EDIT:var c;n.type==L.FILTER?c="/filter/edit":n.type==L.LABEL?c="/label/edit":n.type==L.PROJECT&&(c="/project/edit"),t.go(c,{id:o.id});break;case N.HELP:break;case N.INVITE_USERS:var u=l.getLoggedInUser();g.checkUserRole(u,r.USER_ROLES.MAX_USERS_PROJECT,{project:o.id},!0),t.go("/project/invite",{id:o.id});break;case N.LEAVE:w(o,a);break;case N.LINK:b(o,a);break;case N.LOGOUT:s.logout();break;case N.NOTIFICATION:M.openNotificationBar(i,a);break;case N.REFRESH:m.show();var d=e.$on("pull-from-server-complete",function(){d(),m.hide()});e.$emit("push-to-server",!0);break;case N.SEARCH:e.$emit("attach-focus","search-box");break;case N.SETTINGS:t.go("/settings");break;case N.VIEW_USERS:t.go("/project/users",{id:o.id});break;case N.PROJECT_ADMIN_REQUEST:O(o)}},M.openNotificationBar=function(e,t){moment(),c.getNotifications().then(function(n){if(t.items=[],n.length){var s=new D(t.notificationBar,c,e,t,n);t.notification=s,t.notificationBar.show(e).then(function(){}),c.seenNotifications()}})},M.setMenu=function(e,t){if($=[{title:"Refresh",value:N.REFRESH},{title:"Notifications",value:N.NOTIFICATION,isNotification:!0},{title:"Settings",value:N.SETTINGS}],e)switch(e){case L.FILTER:break;case L.LABEL:break;case L.PROJECT:$.push({title:"Edit project",value:N.EDIT,type:L.PROJECT}),$.push({title:"View users",value:N.VIEW_USERS}),$.push({title:"Invite user to project",value:N.INVITE_USERS}),$.push({title:"Archive project",value:N.ARCHIVE});var s=t?n.getUserRole(t,l.getLoggedInId()):d.EMPTY;if(t?t.users:[],s==r.projectUserRole.admin){var o={title:"Make another user Project Admin",value:N.PROJECT_ADMIN_REQUEST,type:L.PROJECT};$.push(o);var a={title:"Delete project",value:N.DELETE,type:L.PROJECT,disabled:!n.canDeleteProject(t)};$.push(a)}else $.push({title:"Leave project",value:N.LEAVE,type:L.PROJECT});break;case L.TASK:$.push({title:"Link to task",value:N.LINK,type:L.TASK})}$.push({title:"Help",value:N.HELP}),$.push({title:"Logout",value:N.LOGOUT})};var U;M.sendProjectAdminRequest=function(t,n,s){var r=_.find(n.users,function(e){return e.email==s.email});if(!r)return u.alert({title:o.errorMessages.PROJECT_ADMIN_INVITATION_INVALID_PROJECT_USER.title,content:o.errorMessages.PROJECT_ADMIN_INVITATION_INVALID_PROJECT_USER.message,buttons:[{text:d.OK,onTap:function(){return!1}}]}),!1;U.remove();var a=l.getLoggedInUser();a.password=s.password;var i={project:n,user:a,newAdmin:s.email};E.isConnected()?k.post(T.project.adminInvitation,i).success(function(t){t.response_code===h.SUCCESS?e.$emit("toast-message",o.successMessages.PROJECT_ADMIN_INVITATION_SENT):t.response_code===h.ERROR&&t.errors.message&&e.$emit("toast-message",{title:t.errors.message})}).error(function(t){e.$emit("toast-message",{title:t.message})}):e.$emit("toast-message",o.errorMessages.CONNECTION_ERROR),console.log(n)}}])}.call(this),function(){app.service("orientation",["$rootScope","screenSize",function(e,t){var n=this;n.setOrientation=function(){ionic.Platform.isIPad()||ionic.Platform.isIOS()||ionic.Platform.isAndroid()},window.addEventListener("orientationchange",function(){e.desktop=t.is("md,lg"),e.mobile=t.is("xs, sm")},!1)}])}.call(this),function(){app.service("socket",["$rootScope","$state","dbEnums","toastService","labelService","CONSTANT","taskService","project","userModel","notificationModel","filterService","settingsService","message","$window","taskModel",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m){var g,v=this;v.connect=function(){g=io.connect(o.api_link,{forceNew:!0,query:"userId="+c.getLoggedInId()}),v.enableAllListeners()},v.disconnect=function(){g&&g.disconnect()},v.enableAllListeners=function(){g.on("connect",function(){p.localStorage.setItem("socketInfo",JSON.stringify({id:g.id})),console.log(g)}),g.on("disconnect",function(){p.localStorage.removeItem("socketInfo")}),g.on(v.socketEventNames.user.userUpdated,function(e){c.addOrUpdate(e,function(){})}),g.on(v.socketEventNames.user.userSessionTimeOut,function(t){c.setRequestLoginEmail(t.email),e.$emit("logout",null,null),e.$emit("toast-message",f.successMessages.PASSWORD_UPDATED)}),g.on(v.socketEventNames.project.projectUpdated,function(e){i.updateItem(e)}),g.on(v.socketEventNames.project.projectDeleted,function(e){console.log(e.name),e.status=n.status.deleted,i.updateItem(e)}),g.on(v.socketEventNames.project.projectLeft,function(e){e.status=n.status.deleted,i.updateItem(e)}),g.on(v.socketEventNames.task.taskUpdated,function(e){a.updateItem(e)}),g.on(v.socketEventNames.task.taskCompleted,function(t){console.log("Completed"),a.updateItem(t),e.$emit("task-complete")}),g.on(v.socketEventNames.label.labelUpdated,function(e){r.updateItem(e)}),g.on(v.socketEventNames.filter.filterUpdated,function(e){u.updateItem(e)}),g.on(v.socketEventNames.settings.settingsUpdated,function(e){d.updateItem(e)}),g.on(v.socketEventNames.notification.foreground,function(e,t,n){s.openNotificationToast(e,t,n)}),g.on(v.socketEventNames.notification.notify,function(e){l.addOrUpdate(e,function(){})}),g.on(v.socketEventNames.notification.seen,function(){l.bulkSeen(function(){})}),g.on(v.socketEventNames.user.taskOrderChanged,function(e){c.changeTaskSortOrder(e,function(){})}),g.on(v.socketEventNames.task.taskDeleted,function(e){m.delete(e.id)})},v.socketEventNames={user:{userUpdated:"user:updated",userSessionTimeOut:"user:sessionTimeOut",taskOrderChanged:"user:taskOrderChanged"},project:{projectUpdated:"project:updated",projectDeleted:"project:deleted",projectLeft:"project:left"},label:{labelUpdated:"label:updated",labelDeleted:"label:deleted"},filter:{filterUpdated:"filter:updated",filterDeleted:"filter:deleted"},task:{taskUpdated:"task:updated",taskCompleted:"task:completed",taskDeleted:"task:deleted"},settings:{settingsUpdated:"settings:updated"},notification:{foreground:"foreground-push-notification",notify:"notify",seen:"seen"}},v.getClientId=function(){return g.id},e.$on("connect-socket",function(){c.isAuthenticated()&&v.connect()}),e.$on("disconnect-socket",function(){v.disconnect()})}])}.call(this),function(){app.service("sortService",["$window","stringService","filterService","$rootScope","$q","$state","settingsService","sync","dbEnums","userModel",function(e,t,n,s,r,o,a,i,c,l){function u(e,t){i.add(c.collections.Settings,{sortOption:t,sortKey:e,userId:l.getLoggedInId()},c.events.Settings.sortUpdate)}function d(e){var t=p.SORTS,n=_.find(t,function(t,n){return t.value==e});return n}function f(e){var t=_.find(p.ORDERS,function(t,n){return t.value==e});return t}var p=this;p.DEFAULT_ORDER={name:"DESC",value:"desc"},p.DEFAULT_SORT={name:"Due date",value:"due",showDateBar:!0},p.FILTER_TYPE={DEFAULT:"Filter",CUSTOM:"My Filters"},p.FILTERS=[{name:"Inbox",value:"inbox",type:p.FILTER_TYPE.DEFAULT},{name:"Today",value:"today",type:p.FILTER_TYPE.DEFAULT},{name:"Next 7 days",value:"next7days",type:p.FILTER_TYPE.DEFAULT},{name:"Overdue",value:"overdue",type:p.FILTER_TYPE.DEFAULT},{name:"Favourites",value:"favourites",type:p.FILTER_TYPE.DEFAULT},{name:"Watching",value:"watching",type:p.FILTER_TYPE.DEFAULT}],p.SORTS=[{name:"Due date",value:"due",showDateBar:!0},{name:"Priority",value:"priority",showDateBar:!1},{name:"My order",value:"custom",showDateBar:!0},{name:"Plan view",value:"plan",showDateBar:!1}],p.ORDERS=[{name:"Ascending",value:"asc"},{name:"Descending",value:"desc"}],p.getFilterByValue=function(e){for(var t=0;t<p.FILTERS.length;t++)if(p.FILTERS[t].value==e)return p.FILTERS[t];return null},p.getFilterType=function(){return JSON.parse(e.localStorage.getItem("filterType"))},p.getOrder=function(){var e=p.getSortOptionByKey((s.sorts||{}).key||"project"),t=f(e.order);return t},p.getSortType=function(){var e=p.getSortOptionByKey((s.sorts||{}).key||"project"),t=d(e.sort);return t},p.setAll=function(e,t,n){var s=r.defer();return p.setAllFilters(e,t).then(function(){s.resolve()}),s.promise},p.setAllFilters=function(e,t){var o=r.defer(),a=[];return n.getAll().then(function(n){a={list:angular.copy(p.FILTERS)},n.forEach(function(n){var s={name:n.name,value:n.id,type:p.FILTER_TYPE.CUSTOM};a.list.indexOf(s)<=-1&&(a.list.push(s),e!=s.value||t||(a.select=s))}),a.select||t||(a.select=p.getFilterType()),s.filters=a,o.resolve()}),o.promise},p.setAllSorts=function(e){var t=p.getSortOptionByKey(e),n=p.getSortOrdersByKey(e),r=d(t.sort);s.sorts={list:n,select:r,key:e}},p.setAllOrders=function(e){var t=p.getSortOptionByKey(e),n=f(t.order);s.orders={list:p.ORDERS,select:n,key:e}},p.setDefault=function(e,t){p.setFilterTypeByValue(e),t||(p.setOrder(p.DEFAULT_ORDER),p.setSortType(p.DEFAULT_SORT))},p.setFilterTypeByValue=function(e){p.setFilterType(p.getFilterByValue(e))},p.setFilterType=function(n){n=n||t.EMPTY,e.localStorage.setItem("filterType",JSON.stringify(n))},p.setOrder=function(e){var t=a.getSettings();t.sort=t.sort||{},t.sort.order=e.value,a.updateSort(t)},p.setSortType=function(e){var t=a.getSettings();t.sort=t.sort||{},t.sort.sortType=e.value,a.updateSort(t)},s.changeFilter=function(e){switch(p.setFilterType(e),e.type){case p.FILTER_TYPE.DEFAULT:o.go("/task/list/",{type:e.value});break;case p.FILTER_TYPE.CUSTOM:o.go("/filter/details",{id:e.value})}},s.changeOrder=function(e){p.setOrder(e),s.$emit("task:list-sorted")},s.changeSort=function(e){p.setSortType(e),s.$emit("task:list-sorted")},s.$on("$stateChangeSuccess",function(e,t,n,s,r){if(l.isAuthenticated()){var o=t.sortKey;"list"==o&&(o=n.type),o&&(p.setAllSorts(o),p.setAllOrders(o))}}),p.getSortOptionByKey=function(t){var n=e.localStorage.getItem("sortOptions")||"{}",s=JSON.parse(n),r=s[t];return r||(r={sort:p.DEFAULT_SORT_TYPES[t],order:"asc"},s[t]=r,e.localStorage.setItem("sortOptions",JSON.stringify(s)),u(t,r)),r},p.setSortOptionByKey=function(t,n){var s=JSON.parse(e.localStorage.getItem("sortOptions")||"{}");s[t]=n,e.localStorage.setItem("sortOptions",JSON.stringify(s)),u(t,n)},s.changeSortValue=function(e,t){var n=p.getSortOptionByKey(e);n.sort=t,p.setSortOptionByKey(e,n),s.$emit("task:list-sorted")},s.changeSortOrder=function(e,t){var n=p.getSortOptionByKey(e);n.order=t,p.setSortOptionByKey(e,n),s.$emit("task:list-sorted")},p.getSortOrdersByKey=function(e){var t=p.SORT_ORDERS_LIST[e];return t||(t=p.SORT_ORDERS_LIST.default),t},p.DEFAULT_SORT_TYPES={inbox:"due",today:"due",next7days:"due",overdue:"due",watching:"due",favourites:"due",closed:"due",project:"plan",assignee:"due",label:"due",filter:"due"},p.SORT_ORDERS_LIST={inbox:_.filter(p.SORTS,function(e,t){return"plan"!=e.value}),today:_.filter(p.SORTS,function(e,t){return"plan"!=e.value}),next7days:_.filter(p.SORTS,function(e,t){return"plan"!=e.value}),overdue:_.filter(p.SORTS,function(e,t){return"plan"!=e.value}),watching:_.filter(p.SORTS,function(e,t){return"plan"!=e.value}),favourites:_.filter(p.SORTS,function(e,t){return"plan"!=e.value}),closed:_.filter(p.SORTS,function(e,t){return"plan"!=e.value}),project:p.SORTS,assignee:_.filter(p.SORTS,function(e,t){return"plan"!=e.value}),label:_.filter(p.SORTS,function(e,t){return"plan"!=e.value}),filter:_.filter(p.SORTS,function(e,t){return"plan"!=e.value}),filter:_.filter(p.SORTS,function(e,t){return"plan"!=e.value})}}])}.call(this),function(){app.service("stringService",function(){var e=this;e.CLOSE="CLOSE",e.COPY_LINK="COPY LINK",e.NO="NO",e.YES="YES",e.EMPTY="",e.OK="OK",e.CANCEL="CANCEL",e.UPGRADE="UPGRADE",e.firstLetter=function(e){return e.charAt(0).toUpperCase()},e.capitalizeFirstLetter=function(t){return t?t[0].toUpperCase()+t.substr(1):e.EMPTY}})}.call(this),function(){app.service("taskListView",["$rootScope","taskService","userModel","platformService","$state","$timeout","$window","popupService","$q","dbEnums","sync",function(e,t,n,s,r,o,a,i,c,l,u){function d(t,n){o(function(){s.isMobileDevice()||(e.rightDefaultViewVisible=!0,e.default={edit:!0},r.go("/task/list/",{type:n,id:t.id},{notify:!1}))})}function f(e,t){u.add(l.collections.Settings,{filterView:t,filterKey:e,userId:n.getLoggedInId()},l.events.Settings.filterViewUpdate)}var p=this,m=!1;p.clearAllSelected=function(){p.setSelected(),e.rightDefaultViewVisible=!1,e.default={edit:!1},e.selectedItems={},m=!1,e.multipleSelect=e.singleSelect=!1,e.$emit("task-footer-toggle")},p.clicked=function(t,n,s){function r(t,n,s){var r=p.getSelected();e.rightDefaultViewVisible=!1,e.default={edit:!1};var a=n;if(e.selectedItems||(e.selectedItems={}),t.status==l.status.complete?e.closedTask=t:delete e.closedTask,s){var i=p.findIndex(r,t);i>-1?(r.splice(i,1),delete e.selectedItems[t.id]):(r.push(t),e.selectedItems[t.id]=!0),p.setSelected(r),p.singleSelect()&&d(r[0],a)}else{var c=p.singleSelect()&&r[0].id==t.id;r.forEach(function(t){delete e.selectedItems[t.id]}),r=[],c||(r.push(t),e.selectedItems[t.id]=!0,d(t,a)),p.setSelected(r)}e.multipleSelect=r.length>1,e.singleSelect=1==r.length,e.$emit("task-footer-toggle"),o.resolve(!0)}var o=c.defer(),a=e.$broadcast("beforeTaskListSelectionChange",t,n,s);return a.defaultPrevented?void i.discard(e).then(function(e){e?r(t,n,s):o.resolve(!1)}):(r(t,n,s),o.promise)},p.findIndex=function(e,t){for(var n=0;n<e.length;n++)if(e[n].id==t.id)return n;return-1},p.getSingleSelected=function(){var e=p.getSelected();return p.singleSelect()?e[0]:{}},p.getTaskIds=function(){var e=p.getSelected(),t=[];return e.forEach(function(e){t.push(e.id)}),t},p.isAllFavourite=function(){var e=p.getSelected(),s=!0;return e.forEach(function(e){s=s&&t.isFavourite(e,n.getLoggedInId())}),s},p.isSelected=function(){var e=p.getSelected();return e.length},p.multipleSelect=function(){var e=p.getSelected();return e.length>1},p.singleSelect=function(){var e=p.getSelected();return 1==e.length},p.setDefaultView=function(){e.rightDefaultViewVisible=!1,e.default={edit:!0}},p.setSelected=function(e){var t=e||[];a.localStorage.setItem("selected",JSON.stringify(t))},p.getSelected=function(){return JSON.parse(a.localStorage.getItem("selected"))},p.setAllFilterViews=function(e){a.localStorage.setItem("filterViews",JSON.stringify(e))},p.setFilterView=function(e,t){var n=JSON.parse(a.localStorage.getItem("filterViews")||"{}");n[e]=t,a.localStorage.setItem("filterViews",JSON.stringify(n)),f(e,t)},p.getFilterView=function(e){var t=JSON.parse(a.localStorage.getItem("filterViews")||"{}"),n=t[e];return n||(n=t[e]="default",a.localStorage.setItem("filterViews",JSON.stringify(t)),f(e,n)),n=_.find(p.viewTypes,function(e,t){return e.value==n})},p.setSelectedFilterView=function(t){var n=p.getFilterView(t);e.filterView={},e.filterView.select=n,e.filterView.list=p.filterViewTypes[t],e.filterView.key=t},p.clearFilterView=function(){e.filterView={}},p.viewTypes=[{name:"Default",value:"default",isDateView:!1},{name:"Narrow",value:"narrow",isDateView:!1},{name:"Wide",value:"wide",isDateView:!1}],p.filterViewTypes={inbox:p.viewTypes,project:p.viewTypes,assignee:p.viewTypes,filter:p.viewTypes,label:p.viewTypes,today:_.filter(p.viewTypes,{isDateView:!1}),next7days:_.filter(p.viewTypes,{isDateView:!1}),overdue:_.filter(p.viewTypes,{isDateView:!1}),watching:_.filter(p.viewTypes,{isDateView:!1}),favourites:_.filter(p.viewTypes,{isDateView:!1})},p.defaultViewType=_.find(p.viewTypes,{value:"default"}),e.$on("$stateChangeSuccess",function(e,t,s,r,o){if(n.isAuthenticated()){var a="project";p.setSelectedFilterView(a)}})}])}.call(this),function(){app.service("toastService",["$rootScope","toastr","toastrConfig","$templateCache","$ionicListDelegate","$ionicLoading","$state","platformService","$timeout",function(e,t,n,s,r,o,a,i,c){function l(){return'<div class = "toast-undo"> <span class="toast-message">Task completed</span> <button class="undo-button" ng-click="undoToast()">UNDO</button></div>'}function u(e,n){c(function(e){return function(){e&&e.isOpened&&t.remove(e.scope.toastId)}}(e),void 0!==n?n:3500)}var d=this,f=!1,p=s.get("directives/toast/toast.html");d.setDefaultToast=function(){s.remove("directives/toast/toast.html"),angular.extend(n,{positionClass:i.isMobileDevice()?"toast-bottom-full-width":"toast-bottom-center",tapToDismiss:!0,timeOut:3e3,preventOpenDuplicates:!0,preventDuplicates:!1,onShown:function(e){console.log("Showing toast - "+(e.scope.message?e.scope.message.toString():"")+"    "+e.scope.toastId)},onHidden:function(e,t){console.log("Hiding toast - "+(t.scope.message?t.scope.message.toString():"")+"    "+t.scope.toastId)}}),s.put("directives/toast/toast.html",p)},d.openTaskCompleteToast=function(){s.remove("directives/toast/toast.html"),angular.extend(n,{positionClass:i.isMobileDevice()?"toast-bottom-full-width":"toast-bottom-center",tapToDismiss:!1,onHidden:function(){e.$emit("bulk-complete:response",f),d.setDefaultToast(),f=!1},preventOpenDuplicates:!0}),s.put("directives/toast/toast.html",l());var r=t.success();u(r,3500)},e.undoToast=function(){f=!0,t.clear()},e.$on("toast-message",function(e,n){d.setDefaultToast();var s;s=n.success?t.success(n.title):t.error(n.title),u(s,3500)}),$(document).on("click","ion-side-menu,ion-header-bar",function(){t.clear()})}])}.call(this),!function(){app.service("uiHelperService",["$timeout",function(e){var t=this;window.uiLog=[],t.focusTo=function(n,s,r){if(window.uiLog.push("id : "+n),r=$.extend({offsetTop:0,offsetLeft:0},r),void 0!==n){var o=t.scrollTo(n,s,r,function(){window.uiLog.push("in callback");var t=$("#"+n);r.focusMeBackgroundSelector&&(t=$(r.focusMeBackgroundSelector,o)),0==t.length&&(t=o),e(function(){t.animate({backgroundColor:"#e5eff7"},"fast").animate({backgroundColor:"none"},"fast").animate({backgroundColor:"#e5eff7"},"fast").animate({backgroundColor:"none"},"fast").promise().then(function(){console.log("animation complete"),window.uiLog.push("animation complete");
})})});o.length>0||console.log("element with id "+n+"not found")}},t.scrollTo=function(t,n,s,r){function o(){function o(){console.log("scrolling now"),window.uiLog.push("scrolling now"),a=window.document.body,i=$("#"+t,a);var o=i.offset(),c=i.parents(".scroll"),l=o.top,u=o.left;if(c.length>0){var d=$(c.get(0)).offset();l=Math.abs(l-d.top),u=Math.abs(u-d.left)}s.offsetTop&&(l-=parseInt(s.offsetTop)),s.offsetLeft&&(u-=parseInt(s.offsetLeft)),n.scrollTo(u,l),r&&(window.uiLog.push("calling callback"),e(r))}if(i.length>0){var c=ionic.debounce(o,800),l=$("img",a);console.log("has images: "+l.length),c(),l.length>0&&$(l).on("load",function(){console.log("load event called in scrollTo"),window.uiLog.push("load event called in scrollTo"),c()})}}if(s=$.extend({offsetTop:0,offsetLeft:0},s),void 0!==t){var a=window.document.body,i=$("#"+t,a);return i.length>0?o():(window.uiLog.push("element not found to scroll to . going for timeout"),e(function(){a=window.document.body,i=$("#"+t,a),o()},2e3)),i}}}])}(),function(){app.service("filterModel",["$rootScope","TodoZuDB","dbEnums",function(e,t,n){var s=this;s.addOrUpdate=function(n,s){var r=t.getDb().open("todozu-db",t.version);r.onsuccess=function(){var t=r.result,o=t.transaction("filters","readwrite"),a=o.objectStore("filters");a.put(n),s(null,n),t.close(),e.$emit("filterList-update",n)}},s.bulkUpdate=function(n,s){var r=t.getDb().open("todozu-db",t.version);r.onsuccess=function(){for(var t=r.result,o=t.transaction("filters","readwrite"),a=o.objectStore("filters"),i=0;i<n.length;i++)a.put(n[i]);s(),t.close(),e.$emit("filterList-update")}},s.getAll=function(e){var s=[],r=t.getDb().open("todozu-db",t.version);r.onsuccess=function(){var t=r.result,o=t.transaction("filters","readwrite"),a=o.objectStore("filters");a.openCursor().onsuccess=function(t){var r=t.target.result;r?(r.value.status===n.status.active&&s.push(r.value),r.continue()):e(null,s)},t.close()}},s.findById=function(e,n){var s=t.getDb().open("todozu-db",t.version);s.onsuccess=function(){var t=s.result,r=t.transaction("filters","readwrite"),o=r.objectStore("filters");o.get(e).onsuccess=function(e){n(null,e.target.result)},t.close()}},s.delete=function(n,s){var r=t.getDb().open("todozu-db",t.version);r.onsuccess=function(){var t=r.result,o=t.transaction("filters","readwrite"),a=o.objectStore("filters");a.delete(n).onsuccess=function(t){s(null,!0),e.$emit("filterList-update")},t.close()}}}])}.call(this),function(){app.service("labelModel",["$rootScope","TodoZuDB","dbEnums",function(e,t,n){var s=this;s.addOrUpdate=function(n,s){var r=t.getDb().open("todozu-db",t.version);r.onsuccess=function(){var t=r.result,o=t.transaction("labels","readwrite"),a=o.objectStore("labels");a.put(n),s(null,n),t.close(),e.$emit("labelList-update",n)}},s.bulkUpdate=function(n,s){var r=t.getDb().open("todozu-db",t.version);r.onsuccess=function(){for(var t=r.result,o=t.transaction("labels","readwrite"),a=o.objectStore("labels"),i=0;i<n.length;i++)a.put(n[i]);s(),t.close(),e.$emit("labelList-update")}},s.getAll=function(e){var s=[],r=t.getDb().open("todozu-db",t.version);r.onsuccess=function(){var t=r.result,o=t.transaction("labels","readwrite"),a=o.objectStore("labels");a.openCursor().onsuccess=function(t){var r=t.target.result;r?(r.value.status===n.status.active&&s.push(r.value),r.continue()):e(null,s)},t.close()}},s.findById=function(e,n){var s=t.getDb().open("todozu-db",t.version);s.onsuccess=function(){var t=s.result,r=t.transaction("labels","readwrite"),o=r.objectStore("labels");o.get(e).onsuccess=function(e){n(null,e.target.result)},t.close()}},s.delete=function(n,s){var r=t.getDb().open("todozu-db",t.version);r.onsuccess=function(){var t=r.result,o=t.transaction("labels","readwrite"),a=o.objectStore("labels");a.delete(n).onsuccess=function(t){s(null,!0),e.$emit("labelList-update")},t.close()}}}])}.call(this),function(){app.service("notificationModel",["$rootScope","TodoZuDB",function(e,t){function n(){var e=t.getDb().open("todozu-db",t.version);e.onsuccess=function(){var t=e.result,n=t.transaction("notifications","readwrite"),s=n.objectStore("notifications"),o=s.count();o.onsuccess=function(){var e=o.result-r,t=0;s.openCursor().onsuccess=function(n){var s=n.target.result;s&&(t<e&&s.delete(),t++,s.continue())}},t.close()}}var s=this,r=50;s.addOrUpdate=function(r,o){var a=t.getDb().open("todozu-db",t.version);a.onsuccess=function(){var t=a.result,i=t.transaction("notifications","readwrite"),c=i.objectStore("notifications");r.id=r._id,c.put(r),t.close(),n(),o(null,r),s.getNoOfUnseen(function(t,n){console.log(n),e.$emit("NoNN-update",n)}),e.$emit("notificationList-update",r)}},s.bulkUpdate=function(n,r){var o=t.getDb().open("todozu-db",t.version);o.onsuccess=function(){for(var t=o.result,a=t.transaction("notifications","readwrite"),i=a.objectStore("notifications"),c=0;c<n.length;c++)n[c].id=n[c]._id,i.put(n[c]);r(),t.close(),s.getNoOfUnseen(function(t,n){e.$emit("NoNN-update",n)}),e.$emit("notificationList-update")}},s.bulkSeen=function(n){var r=t.getDb().open("todozu-db",t.version);r.onsuccess=function(){var t=r.result,o=t.transaction("notifications","readwrite"),a=o.objectStore("notifications");a.openCursor().onsuccess=function(t){var r=t.target.result;r?(r.value.seen=!0,a.put(r.value),r.continue()):(n(null),s.getNoOfUnseen(function(t,n){e.$emit("NoNN-update",n)}),e.$emit("notificationList-update"))},t.close()}},s.delete=function(n,s){var r=t.getDb().open("todozu-db",t.version);r.onsuccess=function(){var t=r.result,o=t.transaction("notifications","readwrite"),a=o.objectStore("notifications");a.delete(n).onsuccess=function(t){s(null,!0),e.$emit("notificationList-update")},t.close()}},s.getAll=function(e){var n=[],s=t.getDb().open("todozu-db",t.version);s.onsuccess=function(){var t=s.result,r=t.transaction("notifications","readwrite"),o=r.objectStore("notifications");o.openCursor().onsuccess=function(t){var s=t.target.result;s?(n.push(s.value),s.continue()):e(null,n)},t.close()}},s.getNoOfUnseen=function(e){var n=0,s=t.getDb().open("todozu-db",t.version);s.onsuccess=function(){var t=s.result,r=t.transaction("notifications","readwrite"),o=r.objectStore("notifications");o.openCursor().onsuccess=function(t){var s=t.target.result;s?(s.value.seen||n++,s.continue()):e(null,n)},t.close()}}}])}.call(this),function(){app.service("projectModel",["$rootScope","userModel","dbEnums","TodoZuDB","taskModel",function(e,t,n,s,r){var o=this;o.addOrUpdate=function(e,t){var n=s.getDb().open("todozu-db",s.version);n.onsuccess=function(){var s=n.result,o=s.transaction("projects","readwrite"),i=o.objectStore("projects");i.put(e),r.updateProjectInfo(e,function(){}),t(null,e),s.close(),a()}},o.bulkUpdate=function(e,t,n){"function"==typeof t&&(n=t,t=!1);var r=s.getDb().open("todozu-db",s.version);r.onsuccess=function(){for(var s=r.result,o=s.transaction("projects","readwrite"),i=o.objectStore("projects"),c=0;c<e.length;c++)i.put(e[c]);t||a(),n(),s.close()}},o.getAll=function(e){r.getAll(function(r,o){o=o||[];var a=[],i=s.getDb().open("todozu-db",s.version);i.onsuccess=function(){var s=i.result,r=s.transaction("projects","readwrite"),c=r.objectStore("projects");c.openCursor().onsuccess=function(s){var r=s.target.result;r?(r.value.users.forEach(function(e){e._id==t.getLoggedInId()&&e.status===n.status.active&&r.value.status==n.status.active&&(r.value.order=e.order,r.value.tasksCount=0,o.forEach(function(e){e.project&&e.project.id===r.value.id&&(r.value.tasksCount+=1)}),a.push(r.value))}),r.continue()):e(null,_.sortBy(a,"order"))},s.close()}})},o.getUserCreatedActiveProjects=function(e,t){o.getUserCreatedProjects(e,function(e,s){if(e)t(e);else{var r=_.filter(s,function(e){var t=!1;return e.status==n.status.active&&(t=!0),t});t(null,r)}})},o.getUserCreatedProjects=function(e,t){var n=[],r=s.getDb().open("todozu-db",s.version);r.onsuccess=function(){var s=r.result,o=s.transaction("projects","readwrite"),a=o.objectStore("projects");a.openCursor().onsuccess=function(s){var r=s.target.result;r?(r.value.users.forEach(function(t){t._id==e&&1==t.isAdmin&&(r.value.order=t.order,n.push(r.value))}),r.continue()):t(null,_.sortBy(n,"order"))},s.close()}},o.getAllArchived=function(e){var r=[],o=s.getDb().open("todozu-db",s.version);o.onsuccess=function(){var s=o.result,a=s.transaction("projects","readwrite"),i=a.objectStore("projects");i.openCursor().onsuccess=function(s){var o=s.target.result;o?(o.value.users.forEach(function(e){e._id==t.getLoggedInId()&&e.status===n.status.archived&&r.push(o.value)}),o.continue()):e(null,r)},s.close()}},o.findById=function(e,t){var r=s.getDb().open("todozu-db",s.version);r.onsuccess=function(){var s=r.result,o=s.transaction("projects","readwrite"),a=o.objectStore("projects");a.get(e).onsuccess=function(e){e.target.result&&e.target.result.status==n.status.active?t(null,e.target.result):t(null,null)},s.close()}},o.delete=function(e,t){var n=s.getDb().open("todozu-db",s.version);n.onsuccess=function(){var s=n.result,r=s.transaction("projects","readwrite"),o=r.objectStore("projects");o.delete(e).onsuccess=function(e){t(null,!0),a()},s.close()}};var a=ionic.debounce(function(){e.$emit("projectList-update")},200)}])}.call(this),function(){app.service("reminderModel",["TodoZuDB",function(e){var t=this;t.addOrUpdate=function(t,n){var s=e.getDb().open("todozu-db",e.version);s.onsuccess=function(){var e=s.result,r=e.transaction("reminders","readwrite"),o=r.objectStore("reminders");o.put(t),n(null,t),e.close()}},t.getAll=function(t){var n=[],s=e.getDb().open("todozu-db",e.version);s.onsuccess=function(){var e=s.result,r=e.transaction("reminders","readwrite"),o=r.objectStore("reminders");o.openCursor().onsuccess=function(e){var s=e.target.result;s?(n.push(s.value),s.continue()):t(null,n)},e.close()}},t.findById=function(t,n){var s=e.getDb().open("todozu-db",e.version);s.onsuccess=function(){var e=s.result,r=e.transaction("reminders","readwrite"),o=r.objectStore("reminders");o.get(t).onsuccess=function(e){n(null,e.target.result)},e.close()}},t.delete=function(t,n){var s=e.getDb().open("todozu-db",e.version);s.onsuccess=function(){var e=s.result,r=e.transaction("reminders","readwrite"),o=r.objectStore("reminders");o.delete(t).onsuccess=function(e){n(null,!0)},e.close()}},t.deleteRemindersByTaskId=function(t,n){var s=e.getDb().open("todozu-db",e.version);s.onsuccess=function(){var e=s.result,r=e.transaction("reminders","readwrite"),o=r.objectStore("reminders");o.openCursor().onsuccess=function(e){var s=e.target.result;s?(s.value.taskId==t&&s.delete(),s.continue()):n()},e.close()}}}])}.call(this),function(){app.service("settingsModel",["$rootScope","$timeout","$window",function(e,t,n){var s=this;s.addOrUpdate=function(s,r){n.localStorage.setItem("settings",JSON.stringify(s)),t(function(){e.$emit("settings-update",s)}),r()},s.get=function(e){var t=JSON.parse(n.localStorage.getItem("settings"));!t||!t.reminder||t.reminder.taskCreateReminderNotificationChannels&&t.reminder.taskCreateReminderNotificationChannels.email.title||(t.reminder.taskCreateReminderNotificationChannels=DEFAULTS.defaultSettings.taskCreateReminderNotificationChannels),e(t)},s.setAllFilterViews=function(e){n.localStorage.setItem("filterViews",JSON.stringify(e))},s.setAllSortOptions=function(e){n.localStorage.setItem("sortOptions",JSON.stringify(e))}}])}.call(this),function(){app.service("taskModel",["$window","$rootScope","userModel","TodoZuDB","dbEnums","$timeout",function(e,t,n,s,r,o){var a=this;a.addOrUpdate=function(e,n,r){"function"==typeof n&&(r=n,n=!1);var o=s.getDb().open("todozu-db",s.version);o.onsuccess=function(){var s=o.result,a=s.transaction("tasks","readwrite"),c=a.objectStore("tasks");c.put(e),n||t.$emit("reminder:setReminders",e),r(null,e),s.close(),n||i()}},a.bulkUpdate=function(e,n){var r=s.getDb().open("todozu-db",s.version);r.onsuccess=function(){for(var s=r.result,o=s.transaction("tasks","readwrite"),a=o.objectStore("tasks"),c=0;c<e.length;c++)a.put(e[c]),t.$emit("reminder:setReminders",e[c]);n(),s.close(),i()}},a.delete=function(e,n,r){"function"==typeof n&&(r=n,n=!1);var o=s.getDb().open("todozu-db",s.version);o.onsuccess=function(){var s=o.result,a=s.transaction("tasks","readwrite"),i=a.objectStore("tasks");i.delete(e).onsuccess=function(e){r&&r(null,!0),n||t.$emit("taskList-update")},s.close()}},a.findActiveTaskById=function(e,t){var n=s.getDb().open("todozu-db",s.version);n.onsuccess=function(){var s=n.result,o=s.transaction("tasks","readwrite"),a=o.objectStore("tasks");a.get(e).onsuccess=function(e){e.target.result.status==r.status.active?t(null,e.target.result):t(null,null)},s.close()}},a.findById=function(e,t){var n=s.getDb().open("todozu-db",s.version);n.onsuccess=function(){var s=n.result,r=s.transaction("tasks","readwrite"),o=r.objectStore("tasks");o.get(e).onsuccess=function(e){t(null,e.target.result)},s.close()}},a.getAll=function(e){var t=[],n=s.getDb().open("todozu-db",s.version);n.onsuccess=function(){var s=n.result,o=s.transaction("tasks","readwrite"),a=o.objectStore("tasks");a.openCursor().onsuccess=function(n){var s=n.target.result;s?(s.value.status===r.status.active&&t.push(s.value),s.continue()):e(null,t)},s.close()}},a.getAllByPredicate=function(e,t){e=e||function(){return!0},t=t||function(){};var n=[],r=s.getDb().open("todozu-db",s.version);r.onsuccess=function(){var s=r.result,o=s.transaction("tasks","readwrite"),a=o.objectStore("tasks");a.openCursor().onsuccess=function(s){var r=s.target.result;r?(e(r.value)&&n.push(r.value),r.continue()):t(null,n)},s.close()}},a.getAllIds=function(e){var t=[],n=s.getDb().open("todozu-db",s.version);n.onsuccess=function(){var s=n.result,r=s.transaction("tasks","readwrite"),o=r.objectStore("tasks");o.openCursor().onsuccess=function(n){var s=n.target.result;s?(t.push(s.value.id),s.continue()):e(null,t)},s.close()}},a.getSelected=function(e,t){var n=[],r=s.getDb().open("todozu-db",s.version);r.onsuccess=function(){var s=r.result,o=s.transaction("tasks","readwrite"),a=o.objectStore("tasks");a.openCursor().onsuccess=function(s){var r=s.target.result;r?(e.indexOf(r.value.id)>-1&&n.push(r.value),r.continue()):t(null,n)},s.close()}},a.updateProjectInfo=function(e,t){a.getAll(function(n,s){return n?void t(n):(_.each(s,function(t){t.project&&t.project.id===e.id&&(t.project.name=e.name,t.project.color=e.color)}),void a.bulkUpdate(s,t))})},a.getTaskUserByRole=function(e,t){var n=_.find(e.users,function(e){return e.role===t&&e._id});return n};var i=ionic.debounce(function(){t.$emit("taskList-update")},500)}])}.call(this),function(){app.service("userModel",["$rootScope","$timeout","$window","dbEnums",function(e,t,n,s){function r(e,t,n){var s;if(t){for(var r=0;r<e.length;r++)if(e[r][t]._id==n){s=e[r],e.splice(r,1),e.unshift(s);break}}else for(var r=0;r<e.length;r++)if(e[r]._id==n){s=e[r],e.splice(r,1),e.unshift(s);break}return e}var o=this;o.addOrUpdate=function(s,r){n.localStorage.setItem("userInfo",JSON.stringify(s)),t(function(){e.$emit("userInfo-update",s)}),r()},o.clearSession=function(){var e=o.getRequestLoginEmail(),t=o.getDeviceToken(),s=o.getDeviceUniqueId();n.localStorage.clear(),o.setDeviceToken(t),o.setDeviceUniqueId(s),e&&o.setRequestLoginEmail(e)},o.getAvatar=function(){return JSON.parse(n.localStorage.getItem("userInfo")).avatar},o.getDeviceToken=function(){return JSON.parse(n.localStorage.getItem("device_token"))},o.getDeviceUniqueId=function(){return JSON.parse(n.localStorage.getItem("uid"))},o.getLastPullTimestamp=function(){var e=n.localStorage.getItem("timestamp");return e?new Date(e):e},o.getLoggedInName=function(){return JSON.parse(n.localStorage.getItem("userInfo")).firstName+" "+JSON.parse(n.localStorage.getItem("userInfo")).lastName},o.getLoggedInFirstName=function(){return JSON.parse(n.localStorage.getItem("userInfo")).firstName},o.getLoggedInLastName=function(){return JSON.parse(n.localStorage.getItem("userInfo")).lastName},o.getLoggedInShortName=function(){return JSON.parse(n.localStorage.getItem("userInfo")).firstName.charAt(0).toUpperCase()+JSON.parse(n.localStorage.getItem("userInfo")).lastName.charAt(0).toUpperCase()},o.getLoggedInEmail=function(){return JSON.parse(n.localStorage.getItem("userInfo")).email},o.getLoggedInId=function(){var e=JSON.parse(n.localStorage.getItem("userInfo"))||{};return e._id},o.getLoggedInUser=function(){var e=JSON.parse(n.localStorage.getItem("userInfo"));return{_id:e._id,displayName:o.getLoggedInName(),displayShortName:o.getLoggedInShortName(),email:e.email,avatar:e.avatar}},o.getRequestLoginEmail=function(){return n.localStorage.getItem("request_login_email")},o.getToken=function(){return n.localStorage.getItem("token")},o.get=function(e){e(JSON.parse(n.localStorage.getItem("userInfo")))},o.getTaskCustomOrders=function(){return JSON.parse(n.localStorage.getItem("taskCustomOrders"))},o.setTaskCustomOrders=function(e){n.localStorage.setItem("taskCustomOrders",JSON.stringify(e))},o.isAuthenticated=function(){return!!n.localStorage.getItem("token")},o.meTopOnList=function(e,t){var n=o.getLoggedInId();return r(e,t,n)},o.adminTopOnList=function(e){var t=_.find(e,function(e){return e.role==s.projectUserRole.admin});return t?r(e,null,t._id):[]},o.removeRequestLoginEmail=function(){n.localStorage.removeItem("request_login_email")},o.setDeviceToken=function(e){n.localStorage.setItem("device_token",JSON.stringify(e))},o.setDeviceUniqueId=function(e){n.localStorage.setItem("uid",JSON.stringify(e))},o.setLastPullTimestamp=function(e){n.localStorage.setItem("timestamp",e)},o.setRequestLoginEmail=function(e){n.localStorage.setItem("request_login_email",e)},o.setToken=function(e,t){n.localStorage.setItem("token",e),t()},o.changeTaskSortOrder=function(t,n){var s=o.getTaskCustomOrders(),r=_.map(t||[],function(e){return{order:e.order,taskId:e.taskId}}),a=_.map(s||[],function(e){return{order:e.order,taskId:e.taskId}}),i=_.isEqual(_.sortBy(a||[],"order"),_.sortBy(r||[],"order"));return i?void n():(o.setTaskCustomOrders(t),n(),void e.$emit("userInfo-sortOrder"))},o.saveUserFeatures=function(e){n.localStorage.setItem("user-features",JSON.stringify(e||{}))},o.getUserFeatures=function(){var e=n.localStorage.getItem("user-features");return JSON.parse(e||"{}")},o.saveAllFeatures=function(e){n.localStorage.setItem("all-features",JSON.stringify(e||{}))},o.getAllFeatures=function(){var e=n.localStorage.getItem("all-features");return JSON.parse(e||"{}")}}])}.call(this),function(){app.service("TodoZuDB",["$q","$window",function(e,t){var n,s=this;s.version=1,s.name="todozu-db",s.createDatabase=function(){n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB},s.createInstances=function(){var t=e.defer(),r=n.open(s.name,s.version);return r.onupgradeneeded=function(){var e=r.result,n=e.createObjectStore("changes",{keyPath:"id",autoIncrement:!0});n=e.createObjectStore("filters",{keyPath:"id"}),n=e.createObjectStore("labels",{keyPath:"id"}),n=e.createObjectStore("projects",{keyPath:"id"}),n=e.createObjectStore("tasks",{keyPath:"id"}),n=e.createObjectStore("reminders",{keyPath:"id"}),n=e.createObjectStore("notifications",{keyPath:"id"}),t.resolve(),e.close()},t.promise},s.getDb=function(){return console.log("getting db instance..."),console.log(n),n},s.dropDatabase=function(){return new Promise(function(e,t){var r=n.deleteDatabase(s.name);r.onsuccess=function(t){e(t)},r.onerror=function(e){console.log("error while deleting"),t(e)},r.onblocked=function(e){console.log("blocked, unable to delete"),t(e)}})}}])}.call(this),function(){app.service("dbEnums",function(){var e=this;e.collections={Filter:"Filter",Label:"Label",Notification:"Notification",Project:"Project",Settings:"Settings",Task:"Task",User:"User"},e.events={Filter:{addOrUpdate:"addOrUpdate",delete:"delete"},Label:{addOrUpdate:"addOrUpdate",delete:"delete"},Project:{addOrUpdate:"addOrUpdate",archive:"archive",delete:"delete",deleteUser:"deleteUser",left:"left",reorder:"reorder",sendInvitation:"sendInvitation",unArchive:"unArchive",adminInvitation:"adminInvitation"},Settings:{update:"update",sortUpdate:"sortUpdate",filterViewUpdate:"filterViewUpdate"},Task:{add:"add",addNote:"addNote",bulkComplete:"bulkComplete",bulkDueDateUpdate:"bulkDueDateUpdate",bulkFavourites:"bulkFavourites",delete:"delete",deleteNote:"deleteNote",deleteReminder:"deleteReminder",reminderExecuted:"reminderExecuted",update:"update",updateNote:"updateNote",moveTaskOrder:"moveTaskOrder"}},e.keys={ASSIGNEE:"Assignee",CREATE:"Create",DUE:"Due",FILE:"file",NOTE:"Note",PRIORITY:"Priority",PROJECT:"Project",STATUS:"Status",TITLE:"Title",WATCHER:"Watcher",DELETE_VALIDATION_REGEX:/^delete$/i,COPY_TASK_PREFIX:"COPY - ",TASK_DELETE:"TASK_DELETE"},e.projectUserRole={admin:"admin",approval:"waiting for approval",pending:"pending user",user:"user"},e.status={accepted:"accepted",active:"active",approval:"approval",archived:"archived",complete:"complete",deleted:"deleted",inactive:"inactive",pending:"pending",rejected:"rejected",reopened:"reopen"},e.taskUserRole={admin:"admin",assignee:"assignee",user:"user",watcher:"watcher"},e.USER_ROLES={ACTIVE_PROJECTS:"active_projects",ACTIVE_TASKS:"active_tasks",ASSIGNEE_PROJECT:"assignee_project",MAX_USERS_PROJECT:"max_users_project",LABELS:"labels",LABELS_ASSIGN:"labels_assign",EMAIL_NOTIFICATIONS:"email_notifications",CUSTOM_FILTERS:"custom_filters",SEARCH:"search",FILE_UPLOAD:"file_upload",FILE_UPLOAD_SIZE:"file_upload_size",FILE_STORAGE_MAX:"file_storage_max",MY_FEEDS:"my_feeds",TASK_HISTORY:"task_history"}})}.call(this),function(){app.service("sync",["$q","$window","$http","$rootScope","API","connectivity","TodoZuDB","$timeout","projectModel","filterModel","labelModel","settingsModel","taskModel","userModel","notificationModel",function(e,t,n,s,r,o,a,i,c,l,u,d,f,p,m){function g(t){var s=e.defer();return o.isConnected()?n.post(r.sync.push,t).success(function(e){s.resolve(!0)}).error(function(e){console.log("pushing error",e),s.resolve(!1)}):s.resolve(!1),s.promise}var v=this,h=!1,E=!1,k=!1;v.clearInstance=function(){var e=a.getDb().open(a.name,a.version);e.onsuccess=function(){var t=e.result,n=t.transaction("changes","readwrite");n.objectStore("changes").clear(),t.close()}},v.add=function(e,t,n){var r={collectionName:e,object:t,type:n,timestamp:Date()},o=a.getDb().open(a.name,a.version);o.onsuccess=function(){var e=o.result,t=e.transaction("changes","readwrite"),n=t.objectStore("changes");n.put(r),h=!0,s.$emit("push-to-server"),e.close()}},s.$on("push-to-server",function(e,t,n){i(function(){if(h&&!E){E=!0;var e=[],r=a.getDb().open(a.name,a.version);r.onsuccess=function(){var o=r.result,a=o.transaction("changes","readwrite"),i=a.objectStore("changes");i.openCursor().onsuccess=function(r){var o=r.target.result;o?(e.push(o.value),o.continue()):g(e).then(function(e){e&&(h=!1,t&&s.$emit("pull-from-server",n),v.clearInstance()),E=!1})},o.close()}}else t&&s.$emit("pull-from-server")},500)}),s.$on("pull-from-server",function(e){if(o.isConnected()&&!h&&!k&&p.isAuthenticated()){k=!0;var t={id:p.getLoggedInId(),timestamp:p.getLastPullTimestamp()};n.post(r.sync.pull,t).success(function(e){console.log("pull success");var t=e.data;p.setLastPullTimestamp(new Date),t.features&&p.saveUserFeatures(t.features),t.licenseFeatures&&p.saveAllFeatures(t.licenseFeatures),t.settings&&(d.addOrUpdate(t.settings,function(){}),t.settings.filterView&&d.setAllFilterViews(t.settings.filterView),t.settings.sortOption&&d.setAllSortOptions(t.settings.sortOption)),t.projects.length&&c.bulkUpdate(t.projects,function(){}),t.labels.length&&u.bulkUpdate(t.labels,function(){}),t.filters.length&&l.bulkUpdate(t.filters,function(){}),t.tasks.length&&f.bulkUpdate(t.tasks,function(){}),t.taskCustomOrders&&t.taskCustomOrders.length&&p.changeTaskSortOrder(t.taskCustomOrders,function(){}),t.notifications&&t.notifications.length>0&&m.bulkUpdate(t.notifications,function(){}),k=!1}).error(function(e){console.log("pull error",e),k=!1}).finally(function(){s.$emit("pull-from-server-complete")})}else s.$emit("pull-from-server-complete")})}])}.call(this);