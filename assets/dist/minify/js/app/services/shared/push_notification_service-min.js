(function(){app.service("pushNotification",["$rootScope","$state","$q","$window","platformService","userModel","PUSH_NOTIFICATION_CONFIG","$timeout","toastr","$ionicLoading","$ionicPopup","stringService",function(e,i,o,n,t,s,r,a,l,c,u,d){function I(e){console.log(e);var i=e.additionalData;e.isActive?u.alert({title:i.title,content:e.message,buttons:[{text:d.CLOSE,onTap:function(){f(i,e.isActive)}}]}):f(i,e.isActive)}function v(e){console.log(e);var i=e.data;f(i,e.isActive)}function f(o,n){console.log("push notification data"),console.log(o);var t=e.$on("pull-from-server-complete",function(){t(),a(function(){n||c.hide(),n||i.go(o.state,o.params)},300)});e.$emit("pull-from-server"),n||c.show()}function p(){notify.PERMISSION_DEFAULT!=notify.permissionLevel()&&notify.PERMISSION_DENIED!=notify.permissionLevel()||notify.requestPermission(function(){})}var g,D=this;D.initialized=!1,D.init=function(){var e=o.defer();if(t.isMobileDevice())g=window.plugins.OneSignal,g.init(r.APP_ID,{googleProjectNumber:r.GOOGLE_PROJECT_NUMBER},I),D.initialized=!0,e.resolve();else{g=window.OneSignal||[];var i={appId:r.APP_ID,notificationClickHandlerMatch:"origin"};location.protocol.indexOf("https")<0&&(i.subdomainName=r.SUB_DOMAIN_NAME),g.push(["init",i]),g.push(["addListenerForNotificationOpened",v]),g.push(["isPushNotificationsEnabled",function(e){e||g.push(["registerForPushNotifications"])}]),p(),D.initialized=!0,e.resolve()}return e.promise},D.getDeviceUniqueId=function(){var e=o.defer();return console.log(new Date),g&&(t.isMobileDevice()?g.getIds(function(i){console.log("getIdsAvailable:\nUserID: "+i.userId+"\nRegistration ID: "+i.pushToken),console.log(new Date),s.setDeviceUniqueId(i.userId),s.setDeviceToken(i.pushToken),e.resolve({userId:i.userId,device_token:i.pushToken})}):g.push(["getIdsAvailable",function(i){console.log("getIdsAvailable:\nUserID: "+i.userId+"\nRegistration ID: "+i.registrationId),console.log(new Date),s.setDeviceUniqueId(i.userId),s.setDeviceToken(i.registrationId),e.resolve({userId:i.userId,device_token:i.registrationId})}])),e.promise}}])}).call(this);