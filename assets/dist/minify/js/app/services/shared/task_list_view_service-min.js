(function(){app.service("taskListView",["$rootScope","taskService","userModel","platformService","$state","$timeout","$window","popupService","$q","dbEnums","sync",function(e,t,i,l,s,r,n,a,c,o,f){function d(t,i){r(function(){l.isMobileDevice()||(e.rightDefaultViewVisible=!0,e.default={edit:!0},s.go("/task/list/",{type:i,id:t.id},{notify:!1}))})}function u(e,t){f.add(o.collections.Settings,{filterView:t,filterKey:e,userId:i.getLoggedInId()},o.events.Settings.filterViewUpdate)}var g=this,w=!1;g.clearAllSelected=function(){g.setSelected(),e.rightDefaultViewVisible=!1,e.default={edit:!1},e.selectedItems={},w=!1,e.multipleSelect=e.singleSelect=!1,e.$emit("task-footer-toggle")},g.clicked=function(t,i,l){function s(t,i,l){var s=g.getSelected();e.rightDefaultViewVisible=!1,e.default={edit:!1};var n=i;if(e.selectedItems||(e.selectedItems={}),t.status==o.status.complete?e.closedTask=t:delete e.closedTask,l){var a=g.findIndex(s,t);a>-1?(s.splice(a,1),delete e.selectedItems[t.id]):(s.push(t),e.selectedItems[t.id]=!0),g.setSelected(s),g.singleSelect()&&d(s[0],n)}else{var c=g.singleSelect()&&s[0].id==t.id;s.forEach(function(t){delete e.selectedItems[t.id]}),s=[],c||(s.push(t),e.selectedItems[t.id]=!0,d(t,n)),g.setSelected(s)}e.multipleSelect=s.length>1,e.singleSelect=1==s.length,e.$emit("task-footer-toggle"),r.resolve(!0)}var r=c.defer(),n=e.$broadcast("beforeTaskListSelectionChange",t,i,l);return n.defaultPrevented?void a.discard(e).then(function(e){e?s(t,i,l):r.resolve(!1)}):(s(t,i,l),r.promise)},g.findIndex=function(e,t){for(var i=0;i<e.length;i++)if(e[i].id==t.id)return i;return-1},g.getSingleSelected=function(){var e=g.getSelected();return g.singleSelect()?e[0]:{}},g.getTaskIds=function(){var e=g.getSelected(),t=[];return e.forEach(function(e){t.push(e.id)}),t},g.isAllFavourite=function(){var e=g.getSelected(),l=!0;return e.forEach(function(e){l=l&&t.isFavourite(e,i.getLoggedInId())}),l},g.isSelected=function(){var e=g.getSelected();return e.length},g.multipleSelect=function(){var e=g.getSelected();return e.length>1},g.singleSelect=function(){var e=g.getSelected();return 1==e.length},g.setDefaultView=function(){e.rightDefaultViewVisible=!1,e.default={edit:!0}},g.setSelected=function(e){var t=e||[];n.localStorage.setItem("selected",JSON.stringify(t))},g.getSelected=function(){return JSON.parse(n.localStorage.getItem("selected"))},g.setAllFilterViews=function(e){n.localStorage.setItem("filterViews",JSON.stringify(e))},g.setFilterView=function(e,t){var i=JSON.parse(n.localStorage.getItem("filterViews")||"{}");i[e]=t,n.localStorage.setItem("filterViews",JSON.stringify(i)),u(e,t)},g.getFilterView=function(e){var t=JSON.parse(n.localStorage.getItem("filterViews")||"{}"),i=t[e];return i||(i=t[e]="default",n.localStorage.setItem("filterViews",JSON.stringify(t)),u(e,i)),i=_.find(g.viewTypes,function(e,t){return e.value==i})},g.setSelectedFilterView=function(t){var i=g.getFilterView(t);e.filterView={},e.filterView.select=i,e.filterView.list=g.filterViewTypes[t],e.filterView.key=t},g.clearFilterView=function(){e.filterView={}},g.viewTypes=[{name:"Default",value:"default",isDateView:!1},{name:"Narrow",value:"narrow",isDateView:!1},{name:"Wide",value:"wide",isDateView:!1}],g.filterViewTypes={inbox:g.viewTypes,project:g.viewTypes,assignee:g.viewTypes,filter:g.viewTypes,label:g.viewTypes,today:_.filter(g.viewTypes,{isDateView:!1}),next7days:_.filter(g.viewTypes,{isDateView:!1}),overdue:_.filter(g.viewTypes,{isDateView:!1}),watching:_.filter(g.viewTypes,{isDateView:!1}),favourites:_.filter(g.viewTypes,{isDateView:!1})},g.defaultViewType=_.find(g.viewTypes,{value:"default"}),e.$on("$stateChangeSuccess",function(e,t,l,s,r){if(i.isAuthenticated()){var n="project";g.setSelectedFilterView(n)}})}])}).call(this);