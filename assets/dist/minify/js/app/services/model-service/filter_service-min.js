(function(){app.service("filterService",["$q","$window","$rootScope","labelService","date","filterModel","dbEnums","message","sync",function(e,r,t,n,a,i,s,o,c){function u(e,r){for(var t=0;t<r.length;t++)if(e.project.id===r[t]._id)return!0;return!1}function d(e,r){for(var t=null,n=0;n<e.users.length;n++)if(e.users[n].role===s.taskUserRole.assignee&&e.users[n]._id||0==e.project.id&&e.users[n].role==s.taskUserRole.admin){t=e.users[n];break}for(var a=0;a<r.length;a++)if(t&&t._id===r[a]._id)return!0;return!1}function l(e,r){for(var t=0;t<r.length;t++)if(e.priority===r[t].number)return!0;return!1}function f(e,r){var t=!1;return r.forEach(function(r){n.findById(r._id).then(function(r){r&&n.isTaskExists(e,r)&&(t=!0)})}),t}function h(e,r){var t=!1;switch(r){case _.dueDates[0]:e.recurrence.due_date||(t=!0);break;case _.dueDates[1]:a.isPastDay(e.recurrence.due_date)&&(t=!0);break;case _.dueDates[2]:a.isToday(e.recurrence.due_date)&&(t=!0);break;case _.dueDates[3]:a.isTomorrow(e.recurrence.due_date)&&(t=!0);break;case _.dueDates[4]:a.isInNextNDays(e.recurrence.due_date,2)&&(t=!0);break;case _.dueDates[5]:a.isInNextNDays(e.recurrence.due_date,3)&&(t=!0);break;case _.dueDates[6]:a.isInNextNDays(e.recurrence.due_date,5)&&(t=!0);break;case _.dueDates[7]:a.isInNextNDays(e.recurrence.due_date,7)&&(t=!0);break;case _.dueDates[8]:a.isInNextNDays(e.recurrence.due_date,14)&&(t=!0);break;case _.dueDates[9]:a.isInNextNMonths(e.recurrence.due_date,1)&&(t=!0);break;case _.dueDates[10]:a.isInNextNMonths(e.recurrence.due_date,6)&&(t=!0);break;case _.dueDates[11]:a.isInNextNYears(e.recurrence.due_date,1)&&(t=!0)}return t}function p(e,r){return r.allProjects||!r.allProjects&&0==r.projects.length||u(e,r.projects)}function v(e,r){return r.allAssignees||!r.allAssignees&&0==r.assignees.length||d(e,r.assignees)}function m(e,r){return r.allPriorities||!r.allPriorities&&0==r.priorities.length||l(e,r.priorities)}function b(e,r){return r.allLabels||!r.allLabels&&0==r.labels.length||f(e,r.labels)}function y(e,r){return!r.due_date||h(e,r.due_date)}var _=this;_.addOrUpdate=function(r){var t=e.defer();return c.add(s.collections.Filter,r,s.events.Filter.addOrUpdate),i.addOrUpdate(r,function(e,r){t.resolve(r)}),t.promise},_.findById=function(r){var t=e.defer();return i.findById(r,function(e,r){t.resolve(r)}),t.promise},_.getAll=function(){var r=e.defer();return i.getAll(function(e,t){r.resolve(t)}),r.promise},_.delete=function(r){var t=e.defer();return c.add(s.collections.Filter,r,s.events.Filter.delete),i.delete(r.id,function(e,r){t.resolve(r)}),t.promise},_.removeProjectFromAllFilters=function(e){i.getAll(function(r,t){t.forEach(function(r){r.projects.forEach(function(t,n){t._id==e.id&&r.projects.splice(n,1)})}),i.bulkUpdate(t,function(){})})},_.updateItem=function(e){e.status===s.status.active?i.addOrUpdate(e,function(e,r){}):e.status===s.status.deleted&&i.delete(e.id,function(e,r){})},_.setProjects=function(e){var r=[];return e.forEach(function(e){e.checked&&r.push({_id:e.project.id,name:e.project.name,color:e.project.color})}),r},_.setAssignees=function(e){var r=[];return e.forEach(function(e){e.checked&&r.push({_id:e.assignee._id,displayName:e.assignee.displayName,displayShortName:e.assignee.displayShortName,email:e.assignee.email,avatar:e.assignee.avatar})}),r},_.setPriorities=function(e){var r=[];return e.forEach(function(e){e.checked&&r.push({name:e.priority.name,number:e.priority.number,color:e.priority.color})}),r},_.setLabels=function(e){var r=[];return e.forEach(function(e){e.checked&&r.push({_id:e.label.id,name:e.label.name,color:e.label.color})}),r},_.isTaskExists=function(e,r){var t=p(e,r),n=v(e,r),a=m(e,r),i=b(e,r),s=y(e,r);return t&&n&&a&&i&&s},_.fields=[{project:!1,people:!1,priority:!1,label:!1,dueDate:!1}],_.dueDates=["No date","Overdue","Today","Tomorrow","Within 2 days","Within 3 days","Within 5 days","Within 1 week","Within 2 weeks","Within 1 month","Within 6 months","Within 1 year"]}])}).call(this);