(function(){app.service("labelService",["$rootScope","$q","sharedData","sync","dbEnums","roleValidators","labelModel","userModel",function(e,t,n,a,s,i,l,d){var o=this;o.addOrUpdate=function(e){var n=t.defer(),o=d.getLoggedInUser();return i.checkUserRole(o,[s.USER_ROLES.LABELS],{label:e,user:o},!0).then(function(){console.log("lbl added "+e.name),a.add(s.collections.Label,e,s.events.Label.addOrUpdate),l.addOrUpdate(e,function(e,t){n.resolve(t)})},n.reject),n.promise},o.addTaskToLabels=function(e,t){e.forEach(function(e){if(e.checked&&!o.isTaskExists(t,e.label))e.label.tasks.push(t),l.addOrUpdate(e.label,function(e,t){});else if(!e.checked&&o.isTaskExists(t,e.label)){var n=e.label.tasks.indexOf(t);e.label.tasks.splice(n,1),l.addOrUpdate(e.label,function(e,t){})}})},o.addLabelsOnTask=function(e,n){return t(function(a,s){var i=t(function(e,t){e()});_.each(e,function(e){o.isTaskExists(n.id,e)||(i=i.then(function(){return t(function(t,a){e.tasks.push(n.id),l.addOrUpdate(e,function(e,n){t()})})}))}),i.then(a,s)})},o.delete=function(e){var n=t.defer();return a.add(s.collections.Label,e,s.events.Label.delete),l.delete(e.id,function(e,t){n.resolve(t)}),n.promise},o.findById=function(e){var n=t.defer();return l.findById(e,function(e,t){n.resolve(t)}),n.promise},o.getAll=function(){var e=t.defer();return l.getAll(function(t,n){e.resolve(n)}),e.promise},o.isTaskExists=function(e,t){for(var n=0;n<t.tasks.length;n++)if(t.tasks[n]==e)return!0;return!1},o.removeTaskFromAllLabels=function(e){l.getAll(function(t,n){n.forEach(function(t){t.tasks.forEach(function(n,a){n==e.id&&t.tasks.splice(a,1)})}),l.bulkUpdate(n,function(){})})},o.updateItem=function(e){e.status===s.status.active?l.addOrUpdate(e,function(e,t){}):e.status===s.status.deleted&&l.delete(e.id,function(e,t){})},o.reOrderLabelList=function(e,t){}}])}).call(this);