(function(){app.service("userModel",["$rootScope","$timeout","$window","dbEnums",function(e,t,r,a){function o(e,t,r){var a;if(t){for(var o=0;o<e.length;o++)if(e[o][t]._id==r){a=e[o],e.splice(o,1),e.unshift(a);break}}else for(var o=0;o<e.length;o++)if(e[o]._id==r){a=e[o],e.splice(o,1),e.unshift(a);break}return e}var n=this;n.addOrUpdate=function(a,o){r.localStorage.setItem("userInfo",JSON.stringify(a)),t(function(){e.$emit("userInfo-update",a)}),o()},n.clearSession=function(){var e=n.getRequestLoginEmail(),t=n.getDeviceToken(),a=n.getDeviceUniqueId();r.localStorage.clear(),n.setDeviceToken(t),n.setDeviceUniqueId(a),e&&n.setRequestLoginEmail(e)},n.getAvatar=function(){return JSON.parse(r.localStorage.getItem("userInfo")).avatar},n.getDeviceToken=function(){return JSON.parse(r.localStorage.getItem("device_token"))},n.getDeviceUniqueId=function(){return JSON.parse(r.localStorage.getItem("uid"))},n.getLastPullTimestamp=function(){var e=r.localStorage.getItem("timestamp");return e?new Date(e):e},n.getLoggedInName=function(){return JSON.parse(r.localStorage.getItem("userInfo")).firstName+" "+JSON.parse(r.localStorage.getItem("userInfo")).lastName},n.getLoggedInFirstName=function(){return JSON.parse(r.localStorage.getItem("userInfo")).firstName},n.getLoggedInLastName=function(){return JSON.parse(r.localStorage.getItem("userInfo")).lastName},n.getLoggedInShortName=function(){return JSON.parse(r.localStorage.getItem("userInfo")).firstName.charAt(0).toUpperCase()+JSON.parse(r.localStorage.getItem("userInfo")).lastName.charAt(0).toUpperCase()},n.getLoggedInEmail=function(){return JSON.parse(r.localStorage.getItem("userInfo")).email},n.getLoggedInId=function(){var e=JSON.parse(r.localStorage.getItem("userInfo"))||{};return e._id},n.getLoggedInUser=function(){var e=JSON.parse(r.localStorage.getItem("userInfo"));return{_id:e._id,displayName:n.getLoggedInName(),displayShortName:n.getLoggedInShortName(),email:e.email,avatar:e.avatar}},n.getRequestLoginEmail=function(){return r.localStorage.getItem("request_login_email")},n.getToken=function(){return r.localStorage.getItem("token")},n.get=function(e){e(JSON.parse(r.localStorage.getItem("userInfo")))},n.getTaskCustomOrders=function(){return JSON.parse(r.localStorage.getItem("taskCustomOrders"))},n.setTaskCustomOrders=function(e){r.localStorage.setItem("taskCustomOrders",JSON.stringify(e))},n.isAuthenticated=function(){return!!r.localStorage.getItem("token")},n.meTopOnList=function(e,t){var r=n.getLoggedInId();return o(e,t,r)},n.adminTopOnList=function(e){var t=_.find(e,function(e){return e.role==a.projectUserRole.admin});return t?o(e,null,t._id):[]},n.removeRequestLoginEmail=function(){r.localStorage.removeItem("request_login_email")},n.setDeviceToken=function(e){r.localStorage.setItem("device_token",JSON.stringify(e))},n.setDeviceUniqueId=function(e){r.localStorage.setItem("uid",JSON.stringify(e))},n.setLastPullTimestamp=function(e){r.localStorage.setItem("timestamp",e)},n.setRequestLoginEmail=function(e){r.localStorage.setItem("request_login_email",e)},n.setToken=function(e,t){r.localStorage.setItem("token",e),t()},n.changeTaskSortOrder=function(t,r){var a=n.getTaskCustomOrders(),o=_.map(t||[],function(e){return{order:e.order,taskId:e.taskId}}),s=_.map(a||[],function(e){return{order:e.order,taskId:e.taskId}}),i=_.isEqual(_.sortBy(s||[],"order"),_.sortBy(o||[],"order"));return i?void r():(n.setTaskCustomOrders(t),r(),void e.$emit("userInfo-sortOrder"))},n.saveUserFeatures=function(e){r.localStorage.setItem("user-features",JSON.stringify(e||{}))},n.getUserFeatures=function(){var e=r.localStorage.getItem("user-features");return JSON.parse(e||"{}")},n.saveAllFeatures=function(e){r.localStorage.setItem("all-features",JSON.stringify(e||{}))},n.getAllFeatures=function(){var e=r.localStorage.getItem("all-features");return JSON.parse(e||"{}")}}])}).call(this);