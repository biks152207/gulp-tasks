(function(){app.service("taskModel",["$window","$rootScope","userModel","TodoZuDB","dbEnums","$timeout",function(t,e,n,o,s,r){var u=this;u.addOrUpdate=function(t,n,s){"function"==typeof n&&(s=n,n=!1);var r=o.getDb().open("todozu-db",o.version);r.onsuccess=function(){var o=r.result,u=o.transaction("tasks","readwrite"),a=u.objectStore("tasks");a.put(t),n||e.$emit("reminder:setReminders",t),s(null,t),o.close(),n||c()}},u.bulkUpdate=function(t,n){var s=o.getDb().open("todozu-db",o.version);s.onsuccess=function(){for(var o=s.result,r=o.transaction("tasks","readwrite"),u=r.objectStore("tasks"),a=0;a<t.length;a++)u.put(t[a]),e.$emit("reminder:setReminders",t[a]);n(),o.close(),c()}},u.delete=function(t,n,s){"function"==typeof n&&(s=n,n=!1);var r=o.getDb().open("todozu-db",o.version);r.onsuccess=function(){var o=r.result,u=o.transaction("tasks","readwrite"),c=u.objectStore("tasks");c.delete(t).onsuccess=function(t){s&&s(null,!0),n||e.$emit("taskList-update")},o.close()}},u.findActiveTaskById=function(t,e){var n=o.getDb().open("todozu-db",o.version);n.onsuccess=function(){var o=n.result,r=o.transaction("tasks","readwrite"),u=r.objectStore("tasks");u.get(t).onsuccess=function(t){t.target.result.status==s.status.active?e(null,t.target.result):e(null,null)},o.close()}},u.findById=function(t,e){var n=o.getDb().open("todozu-db",o.version);n.onsuccess=function(){var o=n.result,s=o.transaction("tasks","readwrite"),r=s.objectStore("tasks");r.get(t).onsuccess=function(t){e(null,t.target.result)},o.close()}},u.getAll=function(t){var e=[],n=o.getDb().open("todozu-db",o.version);n.onsuccess=function(){var o=n.result,r=o.transaction("tasks","readwrite"),u=r.objectStore("tasks");u.openCursor().onsuccess=function(n){var o=n.target.result;o?(o.value.status===s.status.active&&e.push(o.value),o.continue()):t(null,e)},o.close()}},u.getAllByPredicate=function(t,e){t=t||function(){return!0},e=e||function(){};var n=[],s=o.getDb().open("todozu-db",o.version);s.onsuccess=function(){var o=s.result,r=o.transaction("tasks","readwrite"),u=r.objectStore("tasks");u.openCursor().onsuccess=function(o){var s=o.target.result;s?(t(s.value)&&n.push(s.value),s.continue()):e(null,n)},o.close()}},u.getAllIds=function(t){var e=[],n=o.getDb().open("todozu-db",o.version);n.onsuccess=function(){var o=n.result,s=o.transaction("tasks","readwrite"),r=s.objectStore("tasks");r.openCursor().onsuccess=function(n){var o=n.target.result;o?(e.push(o.value.id),o.continue()):t(null,e)},o.close()}},u.getSelected=function(t,e){var n=[],s=o.getDb().open("todozu-db",o.version);s.onsuccess=function(){var o=s.result,r=o.transaction("tasks","readwrite"),u=r.objectStore("tasks");u.openCursor().onsuccess=function(o){var s=o.target.result;s?(t.indexOf(s.value.id)>-1&&n.push(s.value),s.continue()):e(null,n)},o.close()}},u.updateProjectInfo=function(t,e){u.getAll(function(n,o){return n?void e(n):(_.each(o,function(e){e.project&&e.project.id===t.id&&(e.project.name=t.name,e.project.color=t.color)}),void u.bulkUpdate(o,e))})},u.getTaskUserByRole=function(t,e){var n=_.find(t.users,function(t){return t.role===e&&t._id});return n};var c=ionic.debounce(function(){e.$emit("taskList-update")},500)}])}).call(this);