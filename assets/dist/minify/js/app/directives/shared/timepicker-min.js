(function(){app.directive("uiTimepicker",["moment",function(t){return{restrict:"EA",require:"ngModel",scope:{datetime:"=ngModel"},replace:!0,template:"<div></div>",link:function(a,e,r){function n(a){return"AM"===t(a).format("A")}function i(){c=d=f-v.right-v.left-v.top-v.bottom,o=p=c/2,g=.2*c,m.outerRadius(c/2),m.innerRadius(c/2*.85)}function s(e,r,n,i){var s=Math.min((y-x)/(M-x),1),d=Math.min(360*s,360)*Math.PI/180;m.endAngle(d),e.attr("d",m);var o=360*y/M,p=c/2-5,l=p*Math.cos((o-90)*Math.PI/180),h=p*Math.sin((o-90)*Math.PI/180);r.attr("cx",l).attr("cy",h);var u=t(a.datetime).hours(),f=u>=12?u-12:u,v=t(a.datetime).minutes(),g=""+f+":";v<10&&(g+="0"),g+=v,n.text(g),i.text(t(a.datetime).format("A"))}var c,d,o,p,l=d3.select(e[0]),m=d3.svg.arc().startAngle(0*(Math.PI/180)).endAngle(360*(Math.PI/180)),h=245,u=h,f=h,v={top:15,right:10,bottom:10,left:15},g=10,x=1,M=720,y=1,k=!1;l.each(function(e){i();var r=d3.select(this).selectAll("svg").data([e]),l=r.enter().append("svg").attr("class","x1-timepicker-svg").append("g").attr("transform","translate("+v.left+","+v.top+")");r.attr("width",h).attr("height",u);var f=l.append("g").attr("class","x1-timepicker-component"),x=(f.append("circle").attr("class","x1-timepicker-inner").attr("transform","translate("+o+","+p+")").attr("cx",0).attr("cy",0).attr("r",c/2),f.append("path").attr("transform","translate("+o+","+p+")").attr("d",m),l.append("g").attr("class","x1-timepicker-arcs")),A=x.append("path").attr("class","arc").attr("transform","translate("+o+","+p+")").attr("d",m),I=l.append("g").attr("class","x1-timepicker-labels"),P=I.append("text").attr("class","time").attr("x",o).attr("y",p+g/3).attr("width",c).style("font-size",1.4*g+"px"),F=I.append("text").attr("class","ampm").attr("cursor","pointer").attr("x",o).attr("y",c/1.4+g/3).attr("width",c).style("font-size",.6*g+"px").on("click",function(){var e=n(a.datetime),r=e?12:-12;k=!e,a.datetime=t(a.datetime).add(r,"hour").toDate(),d3.select(this).text(t(a.datetime).format("A")),a.$apply()}),b=d3.behavior.drag().on("drag",function(){var e=d3.event.x,r=d3.event.y,n=(Math.PI*c,0),i=0,o=e-c/2,p=d/2-r,l=(p-i)/(o-n),m=Math.abs(Math.atan(l)/(Math.PI/180)),h=0;o>0&&p>=0?h=90-m:o>=0&&p<0?h=90+m:o<0&&p<=0?h=270-m:o<=0&&p>0&&(h=270+m),y=M*(h/360);var u=Math.floor(y/60);u=k?u:u+12,a.datetime=t(a.datetime).set("hour",u).set("minute",y%60).set("second",0).toDate(),a.$apply(function(){s(A,w,P,F)})}),w=l.append("g").append("circle").attr("class","x1-timepicker-handler").attr("cursor","pointer").attr("transform","translate("+o+","+p+")").attr("cx",0).attr("cy",0).attr("r",18).attr("fill","#FFFFFF").call(b),$=function(a){var e=t(a).hours(),r=e>=12?e-12:e,n=t(a).minutes();y=60*r+n,s(A,w,P,F)};$(a.datetime),k=n(a.datetime),a.$watch("datetime",function(t,a){$(t)})})}}}])}).call(this);