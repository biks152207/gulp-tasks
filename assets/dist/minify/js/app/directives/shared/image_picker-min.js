(function(){app.directive("tdzImagepicker",["$ionicModal","$rootScope","message","$ionicLoading","Cropper","$timeout","settingsService","userModel","guidGenerator",function(e,n,t,o,i,a,c,d,l){return{require:"ngModel",scope:{ngModel:"="},link:function(t,r,s,u){function m(){e.fromTemplateUrl("html/directives/shared/image_picker.html",function(e){t.modal=e,t.modal.show()},{scope:t,animation:"scale-in"})}function g(){t.$broadcast(t.showEvent)}t.width=300;var h,f=!1;r.on("click",function(){t.dataUrl=t.ngModel,a(m())}),t.clear=function(){t.dataUrl=null,h=null,f=!0},t.close=function(){t.dataUrl=null,t.modal.remove()},t.onFileSelected=function(e){e&&e.length&&i.encode(h=e[0]).then(function(e){t.dataUrl=e,a(g)})},t.uploadAndSave=function(){h?(o.show(),i.crop(h,data).then(function(e){return i.scale(e,{width:t.width})}).then(function(e){e.name=h.name;var t={parent:d.getLoggedInId(),id:l.getId(),file:e};c.uploadAvatar(t).then(function(e){n.$emit("toast-message",e.msg),o.hide()})})):f&&c.removeAvatar({userId:d.getLoggedInId(),avatar:null}).then(function(e){n.$emit("toast-message",e.msg),o.hide()}),t.close()},t.showEvent="show",t.hideEvent="hide",t.options={maximize:!0,aspectRatio:1,guides:!1,crop:function(e){data=e}}}}}])}).call(this);