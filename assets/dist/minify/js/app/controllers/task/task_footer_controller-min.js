(function(){app.controller("taskFooterController",["$rootScope","$state","$scope","$ionicPopup","$ionicModal","$timeout","$ionicPopover","stringService","message","taskListView","taskService","rightMenuService","date","dbEnums","$ionicLoading","sharedData",function(e,t,s,a,o,n,c,r,u,i,l,d,g,m,f,k){function p(t,s){var a={recurrence:O.taskObject.recurrence,taskIds:i.getTaskIds()};l.bulkDueDateUpdate(a,t,s).then(function(){e.$emit("toast-message",u.successMessages.TASK_DUE_DATE_UPDATED),i.clearAllSelected()})}function T(){O.menus=d.getBottomMenu(),c.fromTemplateUrl("html/views/popovers/bottom_right_popover.html",{scope:O,animation:"slide-in-right"}).then(function(e){O.popover=e})}var O=s;O.toggleMenu=function(){return s.showMenu=!s.showMenu},O.bulkFavourites=function(){var t={isFavourite:!O.isFavourite,taskIds:i.getTaskIds()};l.bulkFavourites(t).then(function(t){t?e.$emit("toast-message",u.successMessages.TASK_ADD_TO_FAVOURITE):e.$emit("toast-message",u.successMessages.TASK_REMOVE_FROM_FAVOURITE)})},O.bulkComplete=function(){l.bulkCompleteRequest(i.getSelected()).then(function(){i.clearAllSelected()})},O.delete=function(){a.show({title:u.infoMessages.TASK_DELETE_CONFIRMATION.title,template:u.infoMessages.TASK_DELETE_CONFIRMATION.message,scope:O,buttons:[{text:r.NO,onTap:function(){return!0}},{text:r.YES,onTap:function(){var t=i.getSelected();return t.length>0&&l.delete(t,function(){i.clearAllSelected(),e.$emit("toast-message",u.successMessages.TASK_DELETED)}),!0}}]})},O.openModal=function(){O.taskObject={recurrence:{}},O.dueDateModal.show()},O.updateDueDate=function(e,t){switch(t=t||{date:!1,time:!1},e){case"TODAY":s.taskObject.recurrence={due_date:g.getDateOnly(g.today())},t.date=!0;break;case"TOMORROW":s.taskObject.recurrence={due_date:g.getDateOnly(g.tomorrow())},t.date=!0;break;case"WEEK":s.taskObject.recurrence={due_date:g.getDateOnly(g.nextWeek())},t.date=!0;break;case"MONTH":s.taskObject.recurrence={due_date:g.getDateOnly(g.nextMonth())},t.date=!0;break;case"NO_DATE":s.dueDateModal.show();break;case"CUSTOM_DATE":s.taskObject.recurrence={due_date:s.taskObject.recurrence.due_date}}"NO_DATE"!==e&&p(!t.time,!t.date)},O.getRecurrenceModel=function(e){e?(O.taskObject.recurrence=e,p()):n(function(){s.dueDateModal.show()})},O.start=function(){o.fromTemplateUrl("html/views/modals/tasks/due_date.html",function(e){O.dueDateModal=e},{scope:O,animation:"scale-in"}),T()},O.start(),O.$on("$stateChangeSuccess",function(){s.dueDateModal&&s.dueDateModal.remove(),i.clearAllSelected()});var h=e.$on("task-footer-toggle",function(){O.isFavourite=i.isAllFavourite(),e.singleSelect?s.selectedTask=i.getSingleSelected():s.selectedTask={},s.isForComplete=!1;var t=i.getSelected();t&&t.length>0&&angular.forEach(t,function(e,t){if("complete"==e.status)return s.isForComplete=!0,!1})}),D=e.$on("task:update-favourite",function(e,t){O.isFavourite=t});O.$on("$destroy",function(){h(),D()}),s.bulkReopen=function(){var t=i.getSelected(),s=[];angular.forEach(t,function(e){e.status==m.status.complete&&s.push(e)}),s.length>0&&(f.show(),l.unCompleteTasks(t).then(function(){i.clearAllSelected(),e.$emit("toast-message",u.successMessages.TASK_UNCOMPLETED),e.$emit("pull-from-server"),i.setDefaultView(),k.taskHome(s[0],s[0].id)},function(t){e.$emit("toast-message",t.msg)}).finally(function(){f.hide()}))}}])}).call(this);