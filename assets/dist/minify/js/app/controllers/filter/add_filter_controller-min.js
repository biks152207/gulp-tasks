(function(){app.controller("addFilterController",["$rootScope","$scope","labelService","project","filterService","discardChange","dbEnums","guidGenerator","message","sharedData","taskService","userModel","roleValidators","$state",function(e,s,t,i,l,r,a,n,o,c,f,d,g,u){s.isAllAssigneeSelected=function(){for(var e=!0,t=0;t<s.assignees.length;t++)e=e&&s.assignees[t].checked;return s.filter.allAssignees=e,s.filter.allAssignees},s.isAllLabelSelected=function(){for(var e=!0,t=0;t<s.labels.length;t++)e=e&&s.labels[t].checked;return s.filter.allLabels=e,s.filter.allLabels},s.isAllPrioritySelected=function(){for(var e=!0,t=0;t<s.priorities.length;t++)e=e&&s.priorities[t].checked;return s.filter.allPriorities=e,s.filter.allPriorities},s.isAllProjectSelected=function(){for(var e=!0,t=0;t<s.projects.length;t++)e=e&&s.projects[t].checked;return s.filter.allProjects=e,s.filter.allProjects},s.selectAllAssignees=function(){for(var e=0;e<s.assignees.length;e++)s.assignees[e].checked=s.filter.allAssignees},s.selectAllLabels=function(){for(var e=0;e<s.labels.length;e++)s.labels[e].checked=s.filter.allLabels},s.selectAllPriorities=function(){for(var e=0;e<s.priorities.length;e++)s.priorities[e].checked=s.filter.allPriorities},s.selectAllProjects=function(){for(var e=0;e<s.projects.length;e++)s.projects[e].checked=s.filter.allProjects},s.getProjects=function(){s.projects=[],i.getAll().then(function(e){e&&(e.splice(0,0,c.inbox),e.forEach(function(e){s.projects.push({checked:!1,project:e})}))})},s.getAssignees=function(){s.assignees=[],i.getAllProjectsUsers().then(function(e){e&&(e.forEach(function(e){s.assignees.push({checked:!1,assignee:e})}),s.assignees=d.meTopOnList(s.assignees,"assignee"))})},s.getPriorities=function(){s.priorities=[];for(var e in f.priorities)s.priorities.push({checked:!1,priority:f.priorities[e]})},s.getLabels=function(){s.labels=[],t.getAll().then(function(e){e&&e.forEach(function(e){s.labels.push({checked:!1,label:e})})})},s.save=function(){if(s.form.$submitted=!0,s.form.$valid){var t=d.getLoggedInUser();g.checkUserRole(t,a.USER_ROLES.CUSTOM_FILTERS,{},!0).then(function(){s.filter.id=n.getId(),s.filter.userId=d.getLoggedInId(),s.filter.projects=s.filter.allProjects?[]:l.setProjects(s.projects),s.filter.assignees=s.filter.allAssignees?[]:l.setAssignees(s.assignees),s.filter.priorities=s.filter.allPriorities?[]:l.setPriorities(s.priorities),s.filter.labels=s.filter.allLabels?[]:l.setLabels(s.labels),s.filter.status=a.status.active,s.filter.date_created=new Date,s.filter.date_modified=new Date,l.addOrUpdate(s.filter).then(function(t){t&&(s.form.$setPristine(),s.form.$setUntouched(),s.filter={},e.$emit("toast-message",o.successMessages.FILTER_SAVED),r.updateDiscardedBeforeSave(),u.go("/filter/details",{id:t.id}))})})}},s.start=function(){s.fields=angular.copy(l.fields),s.dueDates=l.dueDates,s.filter={allProjects:!1,allAssignees:!1,allPriorities:!1,allLabels:!1},e.title="Add Filter",s.getProjects(),s.getAssignees(),s.getPriorities(),s.getLabels(),e.$emit("basic:header",null,null,s,!0,null,!0),r.savePrevious(s,s.filter)},s.toggleMenu=function(e){switch(e){case"project":s.fields.project=!s.fields.project;break;case"assignees":s.fields.assignees=!s.fields.assignees;break;case"priority":s.fields.priority=!s.fields.priority;break;case"label":s.fields.label=!s.fields.label;break;case"dueDate":s.fields.dueDate=!s.fields.dueDate}},s.start(),s.$on("$stateChangeStart",function(e,t,i){r.changeState(e,t,i,s.filter)})}])}).call(this);