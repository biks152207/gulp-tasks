(function(){app.controller("editFilterController",["$rootScope","$state","$scope","$stateParams","project","taskService","labelService","filterService","message","sharedData","userModel","discardChange","dbEnums","roleValidators",function(e,i,t,s,r,l,a,n,o,c,f,d,g,u){t.isAllAssigneeSelected=function(){for(var e=!0,i=0;i<t.assignees.length;i++)e=e&&t.assignees[i].checked;return t.filter.allAssignees=e,t.filter.allAssignees},t.isAllLabelSelected=function(){for(var e=!0,i=0;i<t.labels.length;i++)e=e&&t.labels[i].checked;return t.filter.allLabels=e,t.filter.allLabels},t.isAllPrioritySelected=function(){for(var e=!0,i=0;i<t.priorities.length;i++)e=e&&t.priorities[i].checked;return t.filter.allPriorities=e,t.filter.allPriorities},t.isAllProjectSelected=function(){for(var e=!0,i=0;i<t.projects.length;i++)e=e&&t.projects[i].checked;return t.filter.allProjects=e,t.filter.allProjects},t.selectAllAssignees=function(){for(var e=0;e<t.assignees.length;e++)t.assignees[e].checked=t.filter.allAssignees},t.selectAllLabels=function(){for(var e=0;e<t.labels.length;e++)t.labels[e].checked=t.filter.allLabels},t.selectAllPriorities=function(){for(var e=0;e<t.priorities.length;e++)t.priorities[e].checked=t.filter.allPriorities},t.selectAllProjects=function(){for(var e=0;e<t.projects.length;e++)t.projects[e].checked=t.filter.allProjects},t.getProjects=function(e,i){t.projects=[],r.getAll().then(function(s){s&&(s.splice(0,0,c.inbox),s.forEach(function(s){for(var r=!!i,l=0;l<e.length;l++)if(s.id===e[l]._id){r=!0;break}t.projects.push({checked:r,project:s})}))})},t.getAssignees=function(e,i){t.assignees=[],r.getAllProjectsUsers().then(function(s){s&&(s.forEach(function(s){for(var r=!!i,l=0;l<e.length;l++)if(s._id===e[l]._id){r=!0;break}t.assignees.push({checked:r,assignee:s})}),t.assignees=f.meTopOnList(t.assignees,"assignee"))})},t.getPriorities=function(e,i){t.priorities=[];for(var s in l.priorities){for(var r=l.priorities[s],a=!!i,n=0;n<e.length;n++)if(r.name==e[n].name){a=!0;break}t.priorities.push({checked:a,priority:r})}},t.getLabels=function(e,i){t.labels=[],a.getAll().then(function(s){s&&s.forEach(function(s){for(var r=!!i,l=0;l<e.length;l++)if(s.id===e[l]._id){r=!0;break}t.labels.push({checked:r,label:s})})})},t.save=function(){if(t.form.$submitted=!0,t.form.$valid)if(d.isChanged(t.project)){var s=f.getLoggedInUser();u.checkUserRole(s,g.USER_ROLES.CUSTOM_FILTERS,{},!0).then(function(){t.filter.projects=n.setProjects(t.projects),t.filter.assignees=n.setAssignees(t.assignees),t.filter.priorities=n.setPriorities(t.priorities),t.filter.labels=n.setLabels(t.labels),n.addOrUpdate(t.filter).then(function(s){s&&(e.$emit("toast-message",o.successMessages.FILTER_EDITED),e.$emit("filterList-update"),d.updateDiscardedBeforeSave(),i.go("/filter/details",{id:t.filter.id}))})})}else d.updateDiscardedBeforeSave(),i.go("/filter/details",{id:t.filter.id})},t.start=function(){n.findById(s.id).then(function(s){s?(t.fields=angular.copy(n.fields),t.dueDates=n.dueDates,t.filter=s,e.title=t.filter.name,t.getProjects(t.filter.projects,t.filter.allProjects),t.getAssignees(t.filter.assignees,t.filter.allAssignees),t.getPriorities(t.filter.priorities,t.filter.allPriorities),t.getLabels(t.filter.labels,t.filter.allLabels),e.$emit("basic:header",i.current.state,t.filter,t,!0),d.savePrevious(t,t.filter)):c.home()})},t.toggleMenu=function(e){switch(e){case"project":t.fields.project=!t.fields.project;break;case"assignees":t.fields.assignees=!t.fields.assignees;break;case"priority":t.fields.priority=!t.fields.priority;break;case"label":t.fields.label=!t.fields.label;break;case"dueDate":t.fields.dueDate=!t.fields.dueDate}},t.start(),t.$on("$stateChangeStart",function(e,i,s){d.changeState(e,i,s,t.filter)})}])}).call(this);