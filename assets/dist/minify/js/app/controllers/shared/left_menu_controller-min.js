(function(){app.controller("leftMenuController",["$scope","$rootScope","$state","$ionicPopup","$ionicScrollDelegate","$ionicHistory","project","labelService","sharedData","message","filterService","stringService","sortService","taskListView","$q","$timeout","userModel","roleValidators","dbEnums",function(e,t,n,o,i,s,c,l,r,u,a,f,d,g,h,p,E,v,m){function L(){T&&(T(),T=null)}function _(){L(),T=t.$on("projectList-update",function(){console.log("projectList-update called"),c.getAll().then(function(t){e.activeProjects=t}),c.getAllArchived().then(function(t){e.archiveProjects=t}),c.getAllProjectsUsers().then(function(t){e.assignees=t})})}function A(){var e=E.getLoggedInUser();return v.checkUserRole(e,[m.USER_ROLES.LABELS],{label:null,user:e},!0)}function R(e){var t=E.getLoggedInUser(),n=h(function(n,o){v.checkUserRole(t,m.USER_ROLES.CUSTOM_FILTERS,{user:t},!e).then(n,o)});return n}function I(e){var t=E.getLoggedInUser(),n=h(function(n,o){v.checkUserRole(t,m.USER_ROLES.MY_FEEDS,{user:t},!e).then(n,o)});return n}e.canUserFilter=!1,e.selectedId=void 0,e.leftMenuKey=void 0,e.child_menu_key=void 0,e.redirect=function(t){switch(e.selectedId=void 0,e.leftMenuKey=void 0,s.nextViewOptions({disableAnimate:!0}),t){case"myFeed":I().then(function(){n.go("/task/my-feed")});break;default:d.setFilterTypeByValue(t),d.setAll(void 0,void 0,t).then(function(){n.go("/task/list/",{type:t,id:null})})}},e.edit=function(e,t){function o(){s.nextViewOptions({disableAnimate:!0});var o="/"+e+"/edit";n.go(o,{id:t})}"filter"==e?R().then(o):"label"==e?A().then(o):o()},e.set_parent_selected=function(t){if(e.child_menu_key!=e.leftMenuKey&&(e.selectedId=void 0),console.log(e.leftMenuKey+" left"),console.log(e.child_menu_key+" child"),e.leftMenuKey==t)return{fontWeight:"bold"}},e.set_child_selected=function(t,n){if(console.log("ok-1"),e.child_menu_key=n,console.log(e.child_menu_key+" selected"),e.selectedId==t)return{fontWeight:"bold"}},e.details=function(t,o){function i(){var e="/"+t+"/details";s.nextViewOptions({disableAnimate:!0});var i=t!=r.LEFT_MENU_KEYS.FILTER;d.setAll(o,i,t).then(function(){n.go(e,{id:o})})}e.selectedId=o,e.leftMenuKey=t,"filter"==t?R().then(i):i()},e.archive=function(n){var i=u.infoMessages.PROJECT_ARCHIVED_CONFIRMATION;o.show({title:i.title,template:i.message,scope:e,buttons:[{text:f.NO,onTap:function(){return!0}},{text:f.YES,onTap:function(){c.archive(n).then(function(e){e&&(t.$emit("toast-message",u.successMessages.PROJECT_ARCHIVED),t.$emit("projectList-update"))})}}]})},e.unArchive=function(n){var i=u.infoMessages.PROJECT_UNARCHIVED_CONFIRMATION;o.show({title:i.title,template:i.message,scope:e,buttons:[{text:f.NO,onTap:function(){return!0}},{text:f.YES,onTap:function(){c.unArchive(n).then(function(e){e&&(t.$emit("toast-message",u.successMessages.PROJECT_UNARCHIVED),t.$emit("projectList-update"))})}}]})},e.removeLabel=function(n){var i=u.infoMessages.LABEL_DELETE_CONFIRMATION;o.show({title:i.title,template:i.message,scope:e,buttons:[{text:f.NO,onTap:function(){return!0}},{text:f.YES,onTap:function(){l.delete(n).then(function(e){e&&(t.$emit("toast-message",u.successMessages.LABEL_DELETED),t.$emit("labelList-update"))})}}]})},e.removeFilter=function(n){var i=u.infoMessages.FILTER_DELETE_CONFIRMATION;o.show({title:i.title,template:i.message,scope:e,buttons:[{text:f.NO,onTap:function(){return!0}},{text:f.YES,onTap:function(){a.delete(n).then(function(e){e&&(t.$emit("toast-message",u.successMessages.FILTER_DELETED),t.$emit("filterList-update"))})}}]})},e.setDropdowns=function(){e.dropdowns={project:!1,assignee:!1,filter:!1,label:!1}},e.setSettings=function(){e.settings={project:!1,assignee:!1,filter:!1,label:!1}},e.toggleDropdown=function(t){e.leftMenuKey=t,e.selectedId=void 0,e.dropdowns[t]=!e.dropdowns[t],i.resize()},e.start=function(){e.setDropdowns(),e.setSettings(),e.leftMenuSingleItems=r.leftMenuSingleItems(),c.getAll().then(function(t){e.activeProjects=t}),c.getAllArchived().then(function(t){e.archiveProjects=t}),l.getAll().then(function(t){e.labels=t}),a.getAll().then(function(t){e.filters=t,R(!0).then(function(){e.canUserFilter=!0})}),c.getAllProjectsUsers().then(function(t){e.assignees=t})},e.start(),e.onReorder=function(t,n,o){var i=h.defer(),s=angular.copy(e.activeProjects),l=s.splice(t,1);return s.splice(n,0,l[0]),L(),c.reorder(s,function(){_()}),e.activeProjects=s,i.resolve(),i.promise};var T;_();var S=t.$on("taskList-update",function(){c.getAll().then(function(t){e.activeProjects=t})}),M=t.$on("labelList-update",function(){l.getAll().then(function(t){e.labels=t})}),O=t.$on("filterList-update",function(){a.getAll().then(function(t){e.filters=t})}),b=t.$on("left-menu:selected",function(t,n){e.selected=n});e.$on("$destroy",function(){T(),S(),M(),O(),b()}),e.addLabel=function(e){A().then(function(){n.go("/label/add")})},e.addProject=function(){var e=E.getLoggedInUser(),t=h(function(t,n){v.checkUserRole(e,m.USER_ROLES.ACTIVE_PROJECTS,{user:e},!0).then(t,n)});t.then(function(){n.go("/project/add")})},e.addFilter=function(){R().then(function(){n.go("/filter/add")})}}])}).call(this);