(function(){app.controller("reminderSettingController",["$rootScope","$scope","settingsService","$ionicModal","date","$state","message","reminderService","discardChange","roleValidators","dbEnums","userModel","$q","DEFAULTS",function(n,e,i,t,a,o,s,l,r,c,d,m,h,u){function f(){e.dropdowns={reminder:!0}}function C(){e.settings=i.getSettings(),r.savePrevious(e,e.settings)}function g(){t.fromTemplateUrl("html/views/modals/settings/reminder/auto-reminder-notification-channels.html",function(n){e.autoReminderNotificationChannelsModal=n},{scope:e,animation:"scale-in"}),t.fromTemplateUrl("html/views/modals/settings/reminder/auto-reminder-time.html",function(n){e.autoReminderTimeModal=n},{scope:e,animation:"scale-in"}),t.fromTemplateUrl("html/views/modals/settings/reminder/others-reminder-notification-channels.html",function(n){e.othersReminderNotificationChannelsModal=n},{scope:e,animation:"scale-in"}),t.fromTemplateUrl("html/views/modals/settings/reminder/task-create-reminder-notification-channels.html",function(n){e.taskCreateReminderNotificationChannelsModal=n},{scope:e,animation:"scale-in"})}e.isEmailEnabled=!1,e.channelClicked=function(n){var e=h(function(e,i){if("Email"==n.title&&0==n.value){var t=m.getLoggedInUser();c.checkUserRole(t,d.USER_ROLES.EMAIL_NOTIFICATIONS,{},!0).then(e,i)}else e()});e.then(function(){n.value=!n.value,n.notified=!n.value})},e.openAutoReminderNotificationChannelsModal=function(){e.notificationChannels=angular.copy(e.settings.reminder.autoReminder.channels),e.settings.reminder.autoReminder.enable&&e.autoReminderNotificationChannelsModal.show()},e.openOthersReminderNotificationChannelsModal=function(){e.notificationChannels=angular.copy(e.settings.reminder.othersReminderNotificationChannels),e.othersReminderNotificationChannelsModal.show()},e.openAutoReminderTimeModal=function(){e.settings.reminder.autoReminder.enable&&e.autoReminderTimeModal.show()},e.setAutoReminderNotificationChannels=function(){(e.notificationChannels.email.value||e.notificationChannels.push.value)&&(e.settings.reminder.autoReminder.channels=angular.copy(e.notificationChannels),e.notificationChannels=angular.copy(l.notificationChannels),e.autoReminderNotificationChannelsModal.hide())},e.setAutoReminderTime=function(n){e.settings.reminder.autoReminder.time=n},e.setOthersReminderNotificationChannels=function(){(e.notificationChannels.email.value||e.notificationChannels.push.value)&&(e.settings.reminder.othersReminderNotificationChannels=angular.copy(e.notificationChannels),e.notificationChannels=angular.copy(l.notificationChannels),e.othersReminderNotificationChannelsModal.hide())},e.openTaskCreateReminderNotificationChannelsModal=function(){e.notificationChannels=angular.copy(e.settings.reminder.taskCreateReminderNotificationChannels||u.defaultSettings.taskCreateReminderNotificationChannels),e.taskCreateReminderNotificationChannelsModal.show()},e.setTaskCreateReminderNotificationChannels=function(){(e.notificationChannels.email.value||e.notificationChannels.push.value)&&(e.settings.reminder.taskCreateReminderNotificationChannels=angular.copy(e.notificationChannels),e.notificationChannels=angular.copy(l.notificationChannels),e.taskCreateReminderNotificationChannelsModal.hide())},e.toggleDropdown=function(n){e.dropdowns[n]=!e.dropdowns[n]},e.save=function(){r.isChanged(e.settings)?i.update(e.settings).then(function(){n.$emit("toast-message",s.successMessages.SETTINGS_SAVED),r.updateDiscardedBeforeSave(),o.go("/settings")}):(r.updateDiscardedBeforeSave(),o.go("/settings"))},e.start=function(){e.title="Reminders";var i=m.getLoggedInUser();c.checkUserRole(i,d.USER_ROLES.EMAIL_NOTIFICATIONS,{},!1).then(function(){e.isEmailEnabled=!0}),f(),g(),C(),e.date=a,e.autoReminderTime=angular.copy(l.timeDuration),e.notificationChannels=angular.copy(l.notificationChannels),n.$emit("basic:header",null,null,e,!0,null,!0)},e.start(),e.$on("$stateChangeStart",function(n,i,t){r.changeState(n,i,t,e.settings)})}])}).call(this);