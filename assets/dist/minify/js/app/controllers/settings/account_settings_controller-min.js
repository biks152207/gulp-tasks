(function(){app.controller("accountSettingController",["$rootScope","$scope","$state","$ionicModal","user","settingsService","stringService","message","userModel","dbEnums","connectivity","$ionicLoading",function(e,o,t,a,n,l,s,r,c,i,d,u){function m(){o.userProfile={name:c.getLoggedInName(),email:c.getLoggedInEmail(),displayShortName:c.getLoggedInShortName(),avatar:c.getAvatar()}}function g(){o.dropdowns={profile:!0,account:!0}}function f(){a.fromTemplateUrl("html/views/modals/settings/account/account_delete_failure.html",function(e){o.accountDeleteFailureModal=e,o.accountDeleteFailureModal.show()},{scope:o,animation:"scale-in"})}function p(e){var t=!1;o.accountDeleteValidateModel=o.accountDeleteValidateModel||{},o.accountDeleteValidateModel.$error={},_.each(e.reasons,function(e){o.accountDeleteValidateModel.$error[e.key]=e.value,"password"==e.key&&(t=!0)}),t||(o.accountDeleteFailureReasons=e.reasons,f())}o.openUserNameModal=function(){o.userNameModel={firstName:c.getLoggedInFirstName(),lastName:c.getLoggedInLastName()},a.fromTemplateUrl("html/views/modals/settings/account/user_name_update.html",function(e){o.userNameModal=e,o.userNameModal.show()},{scope:o,animation:"scale-in"})},o.closeUserNameModal=function(e){e.preventDefault(),o.userNameModal.remove()},o.updateUserName=function(){o.userNameModal.remove(),l.updateUserName(o.userNameModel).then(function(o){e.$emit("toast-message",o.msg)})},o.openUserEmailModal=function(){o.userEmailModel={email:c.getLoggedInEmail(),password:s.EMPTY},a.fromTemplateUrl("html/views/modals/settings/account/user_email_update.html",function(e){o.userEmailModal=e,o.userEmailModal.show()},{scope:o,animation:"scale-in"})},o.closeUserEmailModal=function(e){e.preventDefault(),o.userEmailModal.remove()},o.updateUserEmail=function(){o.userEmailModal.remove(),l.updateEmail(o.userEmailModel).then(function(o){e.$emit("toast-message",o.msg)})},o.openUserPasswordModal=function(){o.userPasswordModel={},a.fromTemplateUrl("html/views/modals/settings/account/user_password_update.html",function(e){o.userPasswordModal=e,o.userPasswordModal.show()},{scope:o,animation:"scale-in"})},o.closeUserPasswordModal=function(e){e.preventDefault(),o.userPasswordModal.remove()},o.updateUserPassword=function(){o.userPasswordModal.remove(),l.updatePassword(o.userPasswordModel).then(function(o){o.error||(c.setRequestLoginEmail(c.getLoggedInEmail()),n.clearAll(),t.go("/login")),e.$emit("toast-message",o.msg)})},o.redirectTo=function(e){t.transitionTo(e)},o.toggleDropdown=function(e){o.dropdowns[e]=!o.dropdowns[e]},o.logout=function(){n.logout()},o.start=function(){o.title="My Account",g(),m(),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!1),e.$emit("basic:header",null,null,o,!1,null,!0)},o.start();var v=e.$on("userInfo-update",function(){m(),t.reload()}),w=function(){a.fromTemplateUrl("html/views/modals/settings/account/account_delete_warning.html",function(e){o.accountDeleteWarning=e,o.accountDeleteWarning.show()},{scope:o,animation:"scale-in"})};o.closeDeleteAccountModal=function(e){e.preventDefault(),o.accountDeleteWarning.remove()},o.deleteAccountValidate=function(e){e.preventDefault(),o.accountDeleteWarning.remove(),o.accountDeleteValidateModel={deleteText:"",password:"",DELETE_VALIDATION_REGEX:i.keys.DELETE_VALIDATION_REGEX},o.accountDeleteValidateModel.$error={},a.fromTemplateUrl("html/views/modals/settings/account/account_delete_validate_form.html",function(e){o.accountDeleteValidateForm=e,o.accountDeleteValidateForm.show()},{scope:o,animation:"scale-in"})},o.closeDeleteAccountValidateModal=function(e){e.preventDefault(),o.accountDeleteValidateForm.remove()},o.checkValidDeleteAccount=function(o){if(o.preventDefault(),d.isConnected()){var t={};t.userId=c.getLoggedInId(),u.show(),l.validateDeleteAccount(t).then(function(e){u.hide(),console.log("---- result from validate deleting account---");var o=e?e.data.response:void 0;console.log(o),o.result?w():p(o)},function(e){u.hide(),console.log("----error while deleting account-----"),console.log(e)})}else e.$emit("toast-message",r.errorMessages.CONNECTION_REQUIRED)},o.deleteAccount=function(a){if(a.preventDefault(),d.isConnected()){var s=o.accountDeleteValidateModel;s.userId=c.getLoggedInId(),u.show(),l.deleteAccount(s).then(function(e){u.hide(),console.log("---- result from deleting account---");var a=e?e.data.response:void 0;console.log(a),a.result?(o.accountDeleteValidateForm.remove(),n.clearAll(),t.go("/register",{accountDeleted:!0,reload:!0,notify:!1})):p(a)},function(e){u.hide(),console.log("----error while deleting account-----"),console.log(e)}).finally(function(){})}else e.$emit("toast-message",r.errorMessages.CONNECTION_REQUIRED)},o.$on("$stateChangeStart",function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!0)}),o.$on("$destroy",v)}])}).call(this);