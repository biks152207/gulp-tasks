var todoZuModules=["angucomplete-alt","angularMoment","btford.socket-io","ionic","ionMdInput","matchMedia","monospaced.elastic","ng-mfb","ngAnimate","ngCropper","ngCordova","ngFileUpload","ngSanitize","toastr","ui.bootstrap.datetimepicker","ui.router"],app=angular.module("app",todoZuModules);ionic.Platform.ready(function(){app.run(["$rootScope","$state","$templateCache","$ionicSideMenuDelegate","$ionicScrollDelegate","$cordovaStatusbar","screenSize","pushNotification","connectivity","sharedData","socket","orientation","TodoZuDB","userModel","taskService","$location","date","sortService","taskListView","platformService","user","loggingService","$ionicPopup","message","stringService","$window","gAnalytics","reminderService","popupService","$timeout",function(e,t,i,n,o,a,r,c,s,u,d,l,g,p,v,f,m,h,S,$,w,b,A,D,y,M,k,C,R,T){function F(){w.registerDeviceInfo()}if(window.StatusBar&&(StatusBar.overlaysWebView(!0),StatusBar.styleDefault()),M.cordova&&M.TestFairy&&(console.log("initializing test fairy sdk"),M.TestFairy.begin("63c43cf0d18d04c9b9673e532c6075c842d8381a")),k.init(),s.checkConnection())try{c.init().then(function(){c.getDeviceUniqueId().then(function(){if(e.isLoginProgress||!p.isAuthenticated())var t=e.$on("login-success",function(){t(),F()});else F()})})}catch(e){console.log(e)}if(b.init(),e.isMobile=$.isMobileDevice(),o.scrollTop(),g.createDatabase(),s.startMonitor(),e.desktop=r.is("md, lg"),e.mobile=r.is("xs, sm"),e.toastInstance=i.get("directives/toast/toast.html"),l.setOrientation(),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!0),p.isAuthenticated()){d.connect();var I=e.$on("pull-from-server-complete",function(){I(),T(function(){C.cleanUpReminders()},1e3)});e.$emit("push-to-server",!0,!0)}e.$on("$stateChangeStart",function(i,o,a){e.loggedIn=p.isAuthenticated(),n.isOpen()&&n.toggleLeft();var r=o.requireLogin;o.name;p.isAuthenticated()&&0==r?(i.preventDefault(),u.home()):p.isAuthenticated()||1!=r||(i.preventDefault(),t.go("/login",{returnUrl:o.name,params:a.id},{reload:!0}),d.disconnect())}),e.getActiveReminders=function(e){if(void 0!==e)return v.getActiveReminders(e)},e.countActiveReminders=function(e){if(void 0!==e)return v.countActiveReminders(e)},e.isReminderActive=function(e,t){if(void 0!==t&&void 0!=e)return v.isReminderActive(e,t)},e.$on("$stateChangeSuccess",function(t,i,n,o,a){e.currentPathHash="#"+f.url()}),e.dateDisplayText=function(e){if(p.isAuthenticated())return e?m.getDateTime(new Date(e)):""},p.isAuthenticated(),e.changeFilterView=function(e,t){S.setFilterView(e,t),S.setSelectedFilterView(e)},e.$on("api-version-changed",function(e,t){R.apiVersionChanged(function(){M.localStorage.setItem("x-api-version",t),w.logout()})})}]),setTimeout(function(){window.cordova&&navigator.splashscreen.hide()},1e3),angular.bootstrap(document,[app.name])});
(function(){app.config(["$httpProvider","toastrConfig","$ionicConfigProvider","msdElasticConfig","$ionicLoadingConfig","$compileProvider","moment",function(o,e,t,a,i,n,s){window.cordova&&console.log(_.keys(window.cordova.plugins)),o.interceptors.push("authInterceptor"),o.interceptors.push("httpAllInterceptor"),angular.extend(e,{positionClass:"toast-bottom-center",preventDuplicates:!1,preventOpenDuplicates:!0,progressBar:!1,tapToDismiss:!0,timeOut:5e3,titleClass:"toast-title",toastClass:"toast",allowHtml:!0}),angular.extend(i,{content:"Loading",templateUrl:"html/views/modals/loader.html",animation:"fade-in",showBackdrop:!0,hideOnStateChange:!1,maxWidth:200,showDelay:0}),t.views.maxCache(0),t.tabs.position("top"),t.views.transition("none"),a.append="",ionic.Platform.isAndroid()&&t.scrolling.jsScrolling(!1),window.cordova&&window.cordova.plugins.Keyboard&&(window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.cordova.plugins.Keyboard.disableScroll(!0)),s().calendar(null,{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",nextWeek:"ddd",sameElse:""}),s.locale("en",{relativeTime:{s:"%ds",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:"%dd",M:"1 month",MM:"%d months",y:"a year",yy:"%d years"}})}])}).call(this);
(function(){ionic.Gestures.gestures.Hold.defaults.hold_threshold=20;var t="https://api.dev.todozu.com";app.constant("API",{history:{GET:{historiesByTask:t+"/history/by-task",all:t+"/history/all"}},notification:{getByUserId:t+"/notifications/by-userId",seen:t+"/notifications/seen"},project:{details:t+"/project/details",reSendInvitation:t+"/project/resend-invitation",adminInvitation:t+"/project/admin-invitation"},settings:{removeAvatar:t+"/settings/avatar/remove",update:t+"/settings/update",updateUserName:t+"/settings/update-username",updateEmail:t+"/settings/update-email",updateEmailConfirm:t+"/update-email-confirm",updatePassword:t+"/settings/update-password",uploadAvatar:t+"/settings/avatar/upload",deleteAccount:t+"/user/delete-account",checkForDelete:t+"/user/check-for-delete"},sync:{pull:t+"/sync/pull",push:t+"/sync/push"},task:{GET:{histories:t+"/task/histories/",allHistories:t+"/task/all-histories",getCompleted:t+"/task/completed",view:t+"/task/view/"},uploadNote:t+"/task/note/upload",unCompleteTasks:t+"/task/uncomplete"},user:{register:t+"/user",pull:t+"/sync-all",forgotPassword:t+"/forgot-password",resetPassword:t+"/reset-password",login:t+"/user/login",logout:t+"/user/logout",validatePassword:t+"/user/validate-password",registerDeviceInfo:t+"/user/register-device-info",totalStorage:t+"/user/totalstorage"}}),app.constant("CONSTANT",{website:"https://todozu.com",iconUrl:"https://api.dev.todozu.com/icons/icon.png",upgradeUrl:"https://todozu.com/pricing",version:"0.0.4",file_handler_link:"https://api.dev.todozu.com/serve/file",app_link:"https://app.dev.todozu.com",api_link:"https://api.dev.todozu.com"}),app.constant("RESPONSE_CODE",{SUCCESS:200,ERROR:500}),app.constant("PUSH_NOTIFICATION_CONFIG",{APP_ID:"b3cfc522-0d06-4454-98e8-d457d7d5b85f",SUB_DOMAIN_NAME:"todozu",GOOGLE_PROJECT_NUMBER:"360688121111"}),app.constant("ANALYTICS_CONFIG",{MOBILE_ID:"UA-56174322-7",WEB_ID:"UA-56174322-8"}),app.constant("DEFAULTS",{defaultSettings:{taskCreateReminderNotificationChannels:{email:{title:"Email",value:!1,notified:!0},push:{title:"Push",value:!0,notified:!1}}}})}).call(this);
!function(){app.filter("dueDateSummary",["dueService",function(e){return function(r){if(r&&r.recurrence&&r.recurrence)return e.getSummary(r.recurrence)}}])}();
(function(){app.filter("nameShorten",function(){return function(t){var n;return n=t.split(" "),n[0].charAt(0).toUpperCase()+n[n.length-1].charAt(0).toUpperCase()}})}).call(this);
(function(){app.filter("range",function(){return function(n,r){r=parseInt(r);for(var t=1;t<=r;t++)n.push(t);return n}})}).call(this);
(function(){app.filter("reverse",function(){return function(e){return e.slice().reverse()}})}).call(this);
(function(){app.filter("cut",function(){return function(t,r,n,u){if(!t)return"";if(n=parseInt(n,10),!n)return t;if(t.length<=n)return t;if(t=t.substr(0,n),r){var e=t.lastIndexOf(" ");e!=-1&&(t=t.substr(0,e))}return t+(u||" â€¦")}})}).call(this);
(function(){app.config(["$stateProvider",function(e){var t=ionic.Platform.platform(),l="android"===t||"ios"===t;e.state("/assignee/details",{url:"/assignee/details/:id",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return l?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"assignee",cache:!1,requireLogin:!0,sortKey:"assignee",title:"Assignee_Task_List"})}])}).call(this);
(function(){app.config(["$stateProvider",function(t){var e=ionic.Platform.platform(),l="android"===e||"ios"===e;t.state("/filter/add",{url:"/filter/add",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/filter/add_filter.html"}},state:"filter",cache:!1,requireLogin:!0,title:"Custom_Filters_Add"}).state("/filter/edit",{url:"/filter/edit/:id",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/filter/edit_filter.html"}},state:"filter",cache:!1,requireLogin:!0,title:"Custom_Filters_Edit"}).state("/filter/details",{url:"/filter/details/:id",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return l?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"filter",cache:!1,requireLogin:!0,isListView:!0,sortKey:"filter",title:"Custom_Filters_Task_List"})}])}).call(this);
(function(){app.config(["$stateProvider",function(e){var l=ionic.Platform.platform(),t="android"===l||"ios"===l;e.state("/label/add",{url:"/label/add",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/label/add_label.html"}},state:"label",cache:!1,requireLogin:!0,title:"Labels_Add"}).state("/label/edit",{url:"/label/edit/:id",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/label/edit_label.html"}},state:"label",cache:!1,requireLogin:!0,title:"Labels_Edit"}).state("/label/details",{url:"/label/details/:id",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return t?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"label",cache:!1,requireLogin:!0,isListView:!0,sortKey:"label",title:"Labels_Task_List"})}])}).call(this);
(function(){app.config(["$stateProvider",function(e){var t=ionic.Platform.platform(),s="android"===t||"ios"===t;e.state("/project/add",{url:"/project/add",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/project/add_project.html"}},state:"project",cache:!1,requireLogin:!0,title:"Project_Add"}).state("/accept-invitation",{url:"/accept-invitation?msg&email&projectId",onEnter:["$rootScope","$state","$stateParams","message","userModel","project","user","sharedData",function(e,t,s,r,a,o,i,l){s.projectId?s.email==a.getLoggedInEmail()?(l.home(),e.$emit("toast-message",r.successMessages[s.msg])):(r.setAlert(r.successMessages[s.msg]),i.clearAll(),a.setRequestLoginEmail(s.email),t.go("/login")):(r.setAlert(r.errorMessages[s.msg]),"EMAIL_NOT_FOUND"===s.msg?(i.clearAll(),a.setRequestLoginEmail(s.email),t.go("/register")):i.logout())}]}).state("/approve-invitation",{url:"/approve-invitation?msg&email&projectId",onEnter:["$rootScope","$state","$stateParams","message","userModel","project","user","sharedData",function(e,t,s,r,a,o,i,l){s.projectId?s.email===a.getLoggedInEmail()?(e.$emit("toast-message",r.successMessages[s.msg]),l.home()):(r.setAlert(r.successMessages[s.msg]),i.clearAll(),a.setRequestLoginEmail(s.email),t.go("/login")):e.$emit("toast-message",r.successMessages[s.msg])}]}).state("/project/edit",{url:"/project/edit/:id",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/project/edit_project.html"}},state:"project",cache:!1,requireLogin:!0,title:"Project_Edit"}).state("/project/details",{url:"/project/details/:id?focusMe",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return s?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"project",cache:!1,requireLogin:!0,isListView:!0,sortKey:"project",title:"Project_Task_List"}).state("/project/users",{url:"/project/users/:id",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"viewUsersProjectController",templateUrl:"html/views/partials/project/view_users_project.html"}},state:"project",cache:!1,requireLogin:!0,title:"Project_Users"}).state("/project/invite",{url:"/project/invite/:id",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{templateUrl:"html/views/partials/project/invite_project.html"}},state:"project",cache:!1,requireLogin:!0,title:"Project_Invite"}).state("/approve-admin-invitation",{url:"/approve-admin-invitation?msg&email&projectId",onEnter:["$rootScope","$state","$stateParams","message","userModel","project","user","sharedData","stringService","$ionicPopup",function(e,t,s,r,a,o,i,l,c,m){if(s.projectId)a.isAuthenticated()&&s.email===a.getLoggedInEmail()?(e.$emit("toast-message",r.infoMessages[s.msg]),l.home()):(r.setAlert(r.infoMessages[s.msg]),i.logout(),a.setRequestLoginEmail(s.email),t.go("/login"));else{var n=r.errorMessages[s.msg];n&&m.alert({title:n.title,content:n.message,buttons:[{text:c.OK,onTap:function(){return a.isAuthenticated()?l.home():t.go("/login"),!1}}]})}}]})}])}).call(this);
(function(){app.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("/",{url:"/",onEnter:["sharedData","$state","userModel",function(e,t,r){r.isAuthenticated()?e.home():t.go("/login")}]}).state("/api-response",{url:"/api-response?state&param1&param2",onEnter:["$state","$stateParams","message","userModel","user",function(e,t,r,a,l){switch(t.state){case"login":t.param2?(r.setAlert(r.successMessages[t.param1]),a.setRequestLoginEmail(t.param2)):r.setAlert(r.errorMessages[t.param1]),a.isAuthenticated()&&l.logout(),e.go("/login")}}]}).state("/login",{url:"/login?returnUrl&params",views:{header:{templateUrl:"html/views/partials/login/header.html"},main:{controller:"loginController",templateUrl:"html/views/partials/login/login.html"}},cache:!1,requireLogin:!1,title:"Login"}).state("/register",{url:"/register",views:{header:{templateUrl:"html/views/partials/login/header.html"},main:{controller:"registerController",templateUrl:"html/views/partials/login/register.html"}},params:{accountDeleted:!1},cache:!1,requireLogin:!1,title:"Register"}).state("/activate",{url:"/activate?id",views:{main:{controller:"activateController",templateUrl:"html/views/shared/_blank.html"}},cache:!1,requireLogin:!1,title:"Activation"}).state("/forgot-password",{url:"/forgot-password",views:{header:{templateUrl:"html/views/partials/login/header.html"},main:{controller:"forgotPasswordController",templateUrl:"html/views/partials/login/forgot-password.html"}},cache:!1,requireLogin:!1,title:"Forgot_Password"}).state("/reset-password",{url:"/reset-password/:id",onEnter:["$rootScope","user","userModel",function(e,t,r){t.clearAll(),e.loggedIn=r.isAuthenticated()}],views:{header:{templateUrl:"html/views/partials/login/header.html"},main:{controller:"resetPasswordController",templateUrl:"html/views/partials/login/reset-password.html"}},cache:!1}),t.otherwise("/")}])}).call(this);
(function(){app.config(["$stateProvider",function(e){e.state("/settings",{url:"/settings",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"indexSettingController",templateUrl:"html/views/partials/settings/index.html"}},cache:!1,requireLogin:!0,title:"Settings"}).state("/settings/about",{url:"/settings/about",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"aboutSettingController",templateUrl:"html/views/partials/settings/about.html"}},cache:!1,requireLogin:!0,title:"Settings_About"}).state("/settings/general",{url:"/settings/general",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"generalSettingController",templateUrl:"html/views/partials/settings/general.html"}},cache:!1,requireLogin:!0,title:"Settings_General"}).state("/settings/reminder",{url:"/settings/reminder",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"reminderSettingController",templateUrl:"html/views/partials/settings/reminder.html"}},cache:!1,requireLogin:!0,title:"Settings_Reminders"}).state("/settings/notifications",{url:"/settings/notifications",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"notificationsSettingController",templateUrl:"html/views/partials/settings/notifications.html"}},cache:!1,requireLogin:!0,title:"Settings_Notifications"}).state("/settings/test",{url:"/settings/test",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"testSettingController",templateUrl:"html/views/partials/settings/test.html"}},cache:!1,requireLogin:!0}).state("/settings/account",{url:"/settings/account",views:{header:{controller:"basicHeaderController",templateUrl:"html/views/shared/_basic_header.html"},main:{controller:"accountSettingController",templateUrl:"html/views/partials/settings/account.html"}},cache:!1,requireLogin:!0,title:"Settings_Account"}).state("/update-email-confirm",{url:"/update-email-confirm?msg&email",onEnter:["$rootScope","$state","$stateParams","message","userModel","project","user",function(e,t,r,l,i,s,a){r.email?(l.setAlert(l.successMessages[r.msg]),i.setRequestLoginEmail(r.email)):l.setAlert(l.errorMessages[r.msg]),a.clearAll(),t.go("/login")}]})}])}).call(this);
(function(){app.config(["$stateProvider",function(t){var e=ionic.Platform.platform(),l="android"===e||"ios"===e;t.state("/task/list/",{url:"/task/list/:type/:id",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return l?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"task",cache:!1,requireLogin:!0,isListView:!0,skipNavigation:!0,skipParams:{type:["project","label","filter","assignee"]},sortKey:"list",title:"Fixed_Filters_Task_List"}).state("/task/closed",{url:"/task/closed?tasks",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskListController",templateUrl:function(){return l?"html/views/partials/task/list-mobile.html":"html/views/partials/task/list-web.html"}},"right-default-view":{controller:"defaultViewController",templateUrl:"html/views/shared/right-default-view.html"},footer:{controller:"taskFooterController",templateUrl:"html/views/shared/_task_footer.html"}},params:{focusedTaskId:""},state:"closed",cache:!1,requireLogin:!0,isListView:!0,sortKey:"closed",title:"Task_Closed_View"}).state("/task/add",{url:"/task/add",views:{header:{controller:"taskHeaderController",templateUrl:"html/views/shared/_task_header.html"},main:{templateUrl:"html/views/partials/task/add_task.html"}},cache:!1,requireLogin:!0,title:"Task_Add"}).state("/task/edit",{url:"/task/edit/:id?showType",views:{header:{controller:"taskHeaderController",templateUrl:"html/views/shared/_task_header.html"},main:{templateUrl:function(){return l?"html/views/partials/task/edit-task-mobile.html":"html/views/partials/task/edit-task-web.html"}}},state:"task",cache:!1,requireLogin:!0,stateGroup:"task-edit",title:"Task_Edit"}).state("/task/note",{url:"/task/note/:id?focusMe",views:{header:{controller:"taskHeaderController",templateUrl:"html/views/shared/_task_header.html"},main:{controller:"noteTaskController",templateUrl:"html/views/partials/task/note.html"}},state:"task",cache:!1,requireLogin:!0,stateGroup:"task-edit",title:"Task_Notes"}).state("/task/my-feed",{url:"/task/my-feed",views:{header:{controller:"listHeaderController",templateUrl:"html/views/shared/_list_header.html"},main:{controller:"taskMyFeedController",templateUrl:"html/views/partials/task/my-feed.html"}},cache:!1,requireLogin:!0,title:"My_Feeds"})}])}).call(this);
(function(){app.controller("addFilterController",["$rootScope","$scope","labelService","project","filterService","discardChange","dbEnums","guidGenerator","message","sharedData","taskService","userModel","roleValidators","$state",function(e,s,t,i,l,r,a,n,o,c,f,d,g,u){s.isAllAssigneeSelected=function(){for(var e=!0,t=0;t<s.assignees.length;t++)e=e&&s.assignees[t].checked;return s.filter.allAssignees=e,s.filter.allAssignees},s.isAllLabelSelected=function(){for(var e=!0,t=0;t<s.labels.length;t++)e=e&&s.labels[t].checked;return s.filter.allLabels=e,s.filter.allLabels},s.isAllPrioritySelected=function(){for(var e=!0,t=0;t<s.priorities.length;t++)e=e&&s.priorities[t].checked;return s.filter.allPriorities=e,s.filter.allPriorities},s.isAllProjectSelected=function(){for(var e=!0,t=0;t<s.projects.length;t++)e=e&&s.projects[t].checked;return s.filter.allProjects=e,s.filter.allProjects},s.selectAllAssignees=function(){for(var e=0;e<s.assignees.length;e++)s.assignees[e].checked=s.filter.allAssignees},s.selectAllLabels=function(){for(var e=0;e<s.labels.length;e++)s.labels[e].checked=s.filter.allLabels},s.selectAllPriorities=function(){for(var e=0;e<s.priorities.length;e++)s.priorities[e].checked=s.filter.allPriorities},s.selectAllProjects=function(){for(var e=0;e<s.projects.length;e++)s.projects[e].checked=s.filter.allProjects},s.getProjects=function(){s.projects=[],i.getAll().then(function(e){e&&(e.splice(0,0,c.inbox),e.forEach(function(e){s.projects.push({checked:!1,project:e})}))})},s.getAssignees=function(){s.assignees=[],i.getAllProjectsUsers().then(function(e){e&&(e.forEach(function(e){s.assignees.push({checked:!1,assignee:e})}),s.assignees=d.meTopOnList(s.assignees,"assignee"))})},s.getPriorities=function(){s.priorities=[];for(var e in f.priorities)s.priorities.push({checked:!1,priority:f.priorities[e]})},s.getLabels=function(){s.labels=[],t.getAll().then(function(e){e&&e.forEach(function(e){s.labels.push({checked:!1,label:e})})})},s.save=function(){if(s.form.$submitted=!0,s.form.$valid){var t=d.getLoggedInUser();g.checkUserRole(t,a.USER_ROLES.CUSTOM_FILTERS,{},!0).then(function(){s.filter.id=n.getId(),s.filter.userId=d.getLoggedInId(),s.filter.projects=s.filter.allProjects?[]:l.setProjects(s.projects),s.filter.assignees=s.filter.allAssignees?[]:l.setAssignees(s.assignees),s.filter.priorities=s.filter.allPriorities?[]:l.setPriorities(s.priorities),s.filter.labels=s.filter.allLabels?[]:l.setLabels(s.labels),s.filter.status=a.status.active,s.filter.date_created=new Date,s.filter.date_modified=new Date,l.addOrUpdate(s.filter).then(function(t){t&&(s.form.$setPristine(),s.form.$setUntouched(),s.filter={},e.$emit("toast-message",o.successMessages.FILTER_SAVED),r.updateDiscardedBeforeSave(),u.go("/filter/details",{id:t.id}))})})}},s.start=function(){s.fields=angular.copy(l.fields),s.dueDates=l.dueDates,s.filter={allProjects:!1,allAssignees:!1,allPriorities:!1,allLabels:!1},e.title="Add Filter",s.getProjects(),s.getAssignees(),s.getPriorities(),s.getLabels(),e.$emit("basic:header",null,null,s,!0,null,!0),r.savePrevious(s,s.filter)},s.toggleMenu=function(e){switch(e){case"project":s.fields.project=!s.fields.project;break;case"assignees":s.fields.assignees=!s.fields.assignees;break;case"priority":s.fields.priority=!s.fields.priority;break;case"label":s.fields.label=!s.fields.label;break;case"dueDate":s.fields.dueDate=!s.fields.dueDate}},s.start(),s.$on("$stateChangeStart",function(e,t,i){r.changeState(e,t,i,s.filter)})}])}).call(this);
(function(){app.controller("editFilterController",["$rootScope","$state","$scope","$stateParams","project","taskService","labelService","filterService","message","sharedData","userModel","discardChange","dbEnums","roleValidators",function(e,i,t,s,r,l,a,n,o,c,f,d,g,u){t.isAllAssigneeSelected=function(){for(var e=!0,i=0;i<t.assignees.length;i++)e=e&&t.assignees[i].checked;return t.filter.allAssignees=e,t.filter.allAssignees},t.isAllLabelSelected=function(){for(var e=!0,i=0;i<t.labels.length;i++)e=e&&t.labels[i].checked;return t.filter.allLabels=e,t.filter.allLabels},t.isAllPrioritySelected=function(){for(var e=!0,i=0;i<t.priorities.length;i++)e=e&&t.priorities[i].checked;return t.filter.allPriorities=e,t.filter.allPriorities},t.isAllProjectSelected=function(){for(var e=!0,i=0;i<t.projects.length;i++)e=e&&t.projects[i].checked;return t.filter.allProjects=e,t.filter.allProjects},t.selectAllAssignees=function(){for(var e=0;e<t.assignees.length;e++)t.assignees[e].checked=t.filter.allAssignees},t.selectAllLabels=function(){for(var e=0;e<t.labels.length;e++)t.labels[e].checked=t.filter.allLabels},t.selectAllPriorities=function(){for(var e=0;e<t.priorities.length;e++)t.priorities[e].checked=t.filter.allPriorities},t.selectAllProjects=function(){for(var e=0;e<t.projects.length;e++)t.projects[e].checked=t.filter.allProjects},t.getProjects=function(e,i){t.projects=[],r.getAll().then(function(s){s&&(s.splice(0,0,c.inbox),s.forEach(function(s){for(var r=!!i,l=0;l<e.length;l++)if(s.id===e[l]._id){r=!0;break}t.projects.push({checked:r,project:s})}))})},t.getAssignees=function(e,i){t.assignees=[],r.getAllProjectsUsers().then(function(s){s&&(s.forEach(function(s){for(var r=!!i,l=0;l<e.length;l++)if(s._id===e[l]._id){r=!0;break}t.assignees.push({checked:r,assignee:s})}),t.assignees=f.meTopOnList(t.assignees,"assignee"))})},t.getPriorities=function(e,i){t.priorities=[];for(var s in l.priorities){for(var r=l.priorities[s],a=!!i,n=0;n<e.length;n++)if(r.name==e[n].name){a=!0;break}t.priorities.push({checked:a,priority:r})}},t.getLabels=function(e,i){t.labels=[],a.getAll().then(function(s){s&&s.forEach(function(s){for(var r=!!i,l=0;l<e.length;l++)if(s.id===e[l]._id){r=!0;break}t.labels.push({checked:r,label:s})})})},t.save=function(){if(t.form.$submitted=!0,t.form.$valid)if(d.isChanged(t.project)){var s=f.getLoggedInUser();u.checkUserRole(s,g.USER_ROLES.CUSTOM_FILTERS,{},!0).then(function(){t.filter.projects=n.setProjects(t.projects),t.filter.assignees=n.setAssignees(t.assignees),t.filter.priorities=n.setPriorities(t.priorities),t.filter.labels=n.setLabels(t.labels),n.addOrUpdate(t.filter).then(function(s){s&&(e.$emit("toast-message",o.successMessages.FILTER_EDITED),e.$emit("filterList-update"),d.updateDiscardedBeforeSave(),i.go("/filter/details",{id:t.filter.id}))})})}else d.updateDiscardedBeforeSave(),i.go("/filter/details",{id:t.filter.id})},t.start=function(){n.findById(s.id).then(function(s){s?(t.fields=angular.copy(n.fields),t.dueDates=n.dueDates,t.filter=s,e.title=t.filter.name,t.getProjects(t.filter.projects,t.filter.allProjects),t.getAssignees(t.filter.assignees,t.filter.allAssignees),t.getPriorities(t.filter.priorities,t.filter.allPriorities),t.getLabels(t.filter.labels,t.filter.allLabels),e.$emit("basic:header",i.current.state,t.filter,t,!0),d.savePrevious(t,t.filter)):c.home()})},t.toggleMenu=function(e){switch(e){case"project":t.fields.project=!t.fields.project;break;case"assignees":t.fields.assignees=!t.fields.assignees;break;case"priority":t.fields.priority=!t.fields.priority;break;case"label":t.fields.label=!t.fields.label;break;case"dueDate":t.fields.dueDate=!t.fields.dueDate}},t.start(),t.$on("$stateChangeStart",function(e,i,s){d.changeState(e,i,s,t.filter)})}])}).call(this);
(function(){app.controller("addLabelController",["$rootScope","$scope","$ionicModal","discardChange","userModel","guidGenerator","dbEnums","sharedData","labelService","message",function(e,a,l,t,o,s,n,d,i,r){a.selectColor=function(e){a.label.color=e},a.saveKeyEnter=function(e){console.log("sds"),13==e.keyCode&&a.save()},a.save=function(){a.form.$submitted=!0,a.form.$valid&&(a.label.id=s.getId(),a.label.userId=o.getLoggedInId(),a.label.tasks=[],a.label.status=n.status.active,a.label.date_created=new Date,a.label.date_modified=new Date,i.addOrUpdate(a.label).then(function(l){l&&(a.form.$setPristine(),a.form.$setUntouched(),a.label={},e.$emit("toast-message",r.successMessages.LABEL_SAVED),e.$emit("labelList-update"),t.updateDiscardedBeforeSave(),d.home())}))},a.start=function(){a.label={},a.colors=d.colorsCodes(),e.title="Add Label",e.$emit("basic:header",null,null,a,!0,null,!0),t.savePrevious(a,a.label),l.fromTemplateUrl("html/views/modals/colour_codes.html",function(e){a.modal=e},{scope:a,animation:"scale-in"})},a.start(),e.$on("$stateChangeStart",function(e,l,o){a.modal.remove(),t.changeState(e,l,o,a.label)})}])}).call(this);
(function(){app.controller("editLabelController",["$rootScope","$state","$scope","$ionicModal","$stateParams","labelService","sharedData","message","discardChange",function(e,a,t,o,l,s,n,i,c){t.selectColor=function(e){t.label.color=e},t.saveKeyEnter=function(e){13==e.keyCode&&t.save()},t.save=function(){t.form.$submitted=!0,t.form.$valid&&(c.isChanged(t.label)?s.addOrUpdate(t.label).then(function(a){a&&(e.$emit("toast-message",i.successMessages.LABEL_EDITED),e.$emit("labelList-update"),c.updateDiscardedBeforeSave(),n.home())}):(c.updateDiscardedBeforeSave(),n.home()))},t.start=function(){s.findById(l.id).then(function(o){o?(t.label=o,e.title=t.label.name,t.colors=n.colorsCodes(),e.$emit("basic:header",a.current.state,t.label,t,!0),c.savePrevious(t,t.label)):n.home()}),o.fromTemplateUrl("html/views/modals/colour_codes.html",function(e){t.modal=e},{scope:t,animation:"scale-in"})},t.start(),e.$on("$stateChangeStart",function(e,a,o){t.modal.remove(),c.changeState(e,a,o,t.label)})}])}).call(this);
(function(){app.controller("forgotPasswordController",["$scope","user",function(s,e){s.change=function(){s.alert=null},s.showMessage=function(e){s.alert={title:e.title,msg:e.message,success:e.success}},s.start=function(){s.credentials={}},s.submit=function(t){t.$valid&&e.forgotPassword(s.credentials).then(function(e){s.alert=null,e.error&&(s.showMessage(e.message),t.$setPristine(),t.$setUntouched(),s.credentials={})})},s.start()}])}).call(this);
(function(){app.controller("loginController",["$scope","$stateParams","$state","$ionicLoading","TodoZuDB","user","sharedData","message","userModel","pushNotification","connectivity","$timeout","$q","$rootScope",function(e,i,t,n,o,s,c,a,r,l,d,g,u,f){e.credentials={},e.isReady=!1,e.showMessage=function(i){e.alert={title:i.title,msg:i.message,success:i.success}},e.login=function(){o.dropDatabase(),e.credentials.email&&e.credentials.password&&(e.credentials.deviceInfo=e.credentials.deviceInfo||{},e.credentials.deviceInfo.uid=r.getDeviceUniqueId(),e.credentials.deviceInfo.device_type=ionic.Platform.platform(),e.credentials.deviceInfo.device_token=r.getDeviceToken(),n.show(),f.isLoginProgress=!0,s.login(e.credentials).then(function(i){e.alert={},i.error?e.showMessage(i.message):(c.home(),f.$emit("connect-socket"),f.$emit("login-success"))}).finally(function(){f.isLoginProgress=!1,g(function(){n.hide()},200)}))},e.start=function(){d.checkConnection()&&(e.credentials.deviceInfo={uid:r.getDeviceUniqueId(),device_type:ionic.Platform.platform(),device_token:r.getDeviceToken()});var i=r.getRequestLoginEmail();i&&(e.credentials.email=i,r.removeRequestLoginEmail()),e.alert=a.getAlert(),a.clearAlert()},e.start()}])}).call(this);
(function(){app.controller("registerController",["$scope","$rootScope","user","userModel","message","$stateParams",function(e,s,t,r,a,o){e.showMessage=function(s){e.alert={title:s.title,msg:s.message,success:s.success}},e.submit=function(s){s.$valid&&t.register(e.user).then(function(t){e.alert={},t.error&&(e.showMessage(t.message),s.$setPristine(),s.$setUntouched(),e.user={})})},e.start=function(){e.user={};var t=r.getRequestLoginEmail();t&&(e.user.email=t,r.removeRequestLoginEmail()),e.alert=a.getAlert(),a.clearAlert(),o.accountDeleted&&s.$emit("toast-message",a.successMessages.ACCOUNT_DELETED)},e.start()}])}).call(this);
(function(){app.controller("resetPasswordController",["$scope","user","$stateParams",function(s,e,t){s.resetAlert=function(){s.alert=null},s.showMessage=function(e){s.alert={title:e.title,msg:e.message,success:e.success}},s.start=function(){s.credentials={token:t.id}},s.submit=function(t){t.$valid&&e.resetPassword(s.credentials).then(function(e){s.resetAlert(),e.error&&(s.showMessage(e.message),t.$setPristine(),t.$setUntouched(),s.start())})},s.start(),s.resetpassword=function(){e.resetpassword(s.resetpasswordform).then(function(e){s.submitted=!1,s.alertbox=!0,s.alertTitle=e.title,s.alertMsg=e.msg,s.success=e.status,s.resetpasswordform.$setPristine()})}}])}).call(this);
(function(){app.controller("addProjectController",["$rootScope","$state","$scope","$ionicModal","userModel","discardChange","project","guidGenerator","dbEnums","sharedData","message","$q","roleValidators",function(e,t,o,a,r,s,n,c,d,i,l,m,g){o.openModal=function(){o.modal.show()},o.selectColor=function(e){o.project.color=e},o.saveKeyEnter=function(e){13==e.keyCode&&o.save()},o.save=function(){if(o.form.$submitted=!0,o.form.$valid){o.project.id=c.getId(),o.project.status=d.status.active,o.project.date_created=new Date,o.project.date_modified=new Date,o.project.updatedBy=r.getLoggedInUser(),o.project.users=[{_id:r.getLoggedInId(),lastName:r.getLoggedInLastName(),firstName:r.getLoggedInFirstName(),displayName:r.getLoggedInName(),displayShortName:r.getLoggedInShortName(),avatar:r.getAvatar(),isAdmin:!0,email:r.getLoggedInEmail(),role:d.projectUserRole.admin,status:d.status.active}];var t=r.getLoggedInUser(),a=m(function(e,o){return g.checkUserRole(t,d.USER_ROLES.ACTIVE_PROJECTS,{user:t},!0).then(e,o)});a.then(function(){n.addOrUpdate(o.project).then(function(t){t&&(o.form.$setPristine(),o.form.$setUntouched(),o.project={},e.$emit("toast-message",l.successMessages.PROJECT_SAVED),e.$emit("projectList-update"),s.updateDiscardedBeforeSave(),i.home())})})}},o.start=function(){o.project={},o.colors=i.colorsCodes(),e.title="Add Project",e.$emit("basic:header",null,null,o,!0,null,!0),s.savePrevious(o,o.project),a.fromTemplateUrl("html/views/modals/colour_codes.html",function(e){o.modal=e},{scope:o,animation:"scale-in"})},o.start(),o.$on("$stateChangeStart",function(e,t,a){o.modal.remove(),s.changeState(e,t,a,o.project)})}])}).call(this);
(function(){app.controller("editProjectController",["$rootScope","$state","$scope","$ionicModal","$stateParams","userModel","$timeout","sharedData","project","message","discardChange",function(e,o,t,a,r,c,s,n,d,i,l){t.openModal=function(){t.modal.show()},t.selectColor=function(e){t.project.color=e,t.project.border="none"},t.saveKeyEnter=function(e){13==e.keyCode&&t.save()},t.save=function(){t.form.$submitted=!0,t.form.$valid&&(l.isChanged(t.project)?(t.project.updatedBy=c.getLoggedInUser(),d.addOrUpdate(t.project,!0).then(function(o){o&&(e.$emit("toast-message",i.successMessages.PROJECT_EDITED),e.$emit("projectList-update"),l.updateDiscardedBeforeSave(),n.home())})):(l.updateDiscardedBeforeSave(),n.home()))},t.start=function(){d.findById(r.id).then(function(a){a?(t.project=a,e.title=t.project.name,t.colors=n.colorsCodes(),e.$emit("basic:header",o.current.state,t.project,t,!0),l.savePrevious(t,t.project)):n.home()}),a.fromTemplateUrl("html/views/modals/colour_codes.html",function(e){t.modal=e},{scope:t,animation:"scale-in"})},t.start(),t.$on("$stateChangeStart",function(e,o,a){t.modal.remove(),l.changeState(e,o,a,t.project)})}])}).call(this);
(function(){app.controller("inviteProjectController",["$rootScope","$scope","$state","$ionicPopup","$stateParams","project","sharedData","message","stringService","dbEnums","userModel","roleValidators",function(e,t,n,i,o,s,r,a,c,d,l,p){function u(e){for(var n=null,i=0;i<t.allUsers.length;i++)if(t.allUsers[i].email==e){n=t.allUsers[i];break}n||(n={email:e,displayName:e,displayShortName:c.firstLetter(e)});var o=s.getProjectAdmin(t.project)._id===l.getLoggedInId();return n.isInviterAdmin=o,n.invitedBy=l.getLoggedInId(),n.role=o?d.projectUserRole.pending:d.projectUserRole.approval,n.invitationPending=!0,n.isAdmin=!1,n}function g(e,t){for(var n=0;n<e.users.length;n++)if(e.users[n].email===t)return!0;return!1}function m(n,i){switch(n){case f.send:s.sendInvitation(t.project,u(t.invitation.email)).then(function(){t.form.$setPristine(),t.form.$setUntouched(),t.invitation={}});break;case f.resend:var o={projectId:t.project.id,user:i};s.reSendInvitation(o).then(function(t){e.$emit("toast-message",t.message)});break;case f.cancel:s.deleteUser(t.project,i).then(function(){e.$emit("toast-message",a.successMessages.PROJECT_INVITATION_CANCELLED)});break;case f.remove:s.deleteUser(t.project,i).then(function(){e.$emit("toast-message",a.successMessages.PROJECT_USER_DELETED)})}}var f={send:"send",resend:"resend",cancel:"cancel",remove:"remove"};t.invitationPopUp=function(e,n,o){i.show({title:n.title,template:n.message,scope:t,buttons:[{text:c.NO,type:"btn-no",onTap:function(){return t.form.$submitted=!1,!0}},{text:c.YES,type:"btn-yes",onTap:function(){m(e,o)}}]})},t.save=function(){if(t.form.$submitted=!0,t.form.$valid)if(t.invitation.email=t.selectedUser?t.selectedUser.originalObject.email:t.form.iEmail.$$rawModelValue,console.log(t.invitation.email),g(t.project,t.invitation.email))t.form.$setPristine(),t.form.$setUntouched(),t.invitation={},e.$emit("toast-message",a.errorMessages.EMAIL_ALREADY_EXISTS);else{var n=l.getLoggedInUser();p.checkUserRole(n,d.USER_ROLES.MAX_USERS_PROJECT,{project:t.project},!0).then(function(){var e=s.getProjectUserById(t.project,l.getLoggedInId());t.invitationPopUp(f.send,e.isAdmin?a.infoMessages.PROJECT_INVITATION_SENT_BY_ADMIN:a.infoMessages.PROJECT_INVITATION_SENT_BY_USER)})}},t.deleteUser=function(e){t.invitationPopUp(f.remove,a.infoMessages.PROJECT_USER_DELETED,e)},t.reSendInvitation=function(e){t.invitationPopUp(f.resend,a.infoMessages.PROJECT_INVITATION_RESENT,e)},t.deleteInvitation=function(e){t.invitationPopUp(f.cancel,a.infoMessages.PROJECT_INVITATION_CANCELLED,e)},t.start=function(){s.findById(o.id).then(function(i){i?(t.project=i,t.project.users=l.adminTopOnList(t.project.users),t.invitation={},e.title="Invite: "+t.project.name,t.loginId=l.getLoggedInId(),t.canDeleteUser=s.canDeleteUser(i,l.getLoggedInUser()),e.$emit("basic:header",n.current.state,t.project,t,!0,"Send")):r.home()}),s.getAllProjectsUsers().then(function(e){t.allUsers=e})},t.start();var I=e.$on("projectList-update",function(){s.findById(o.id).then(function(e){e&&(t.project=e)})});t.$on("$destroy",function(){I()}),t.searchInputFocus=function(){var e=l.getLoggedInUser();e&&p.checkUserRole(e,d.USER_ROLES.MAX_USERS_PROJECT,{project:t.project,invitedUser:invitedUser},!0)}}])}).call(this);
(function(){app.controller("viewUsersProjectController",["$rootScope","$scope","$state","$ionicPopup","$stateParams","project","sharedData","message","stringService","userModel",function(e,t,n,s,o,i,r,c,a,p){function d(n,s){switch(n){case u.send:i.sendInvitation(t.project,getInvitedUser(t.invitation.email)).then(function(){t.form.$setPristine(),t.form.$setUntouched(),t.invitation={}});break;case u.resend:var o={projectId:t.project.id,user:s};i.reSendInvitation(o).then(function(t){e.$emit("toast-message",t.message)});break;case u.cancel:i.deleteUser(t.project,s).then(function(){e.$emit("toast-message",c.successMessages.PROJECT_INVITATION_CANCELLED)});break;case u.remove:i.deleteUser(t.project,s).then(function(){e.$emit("toast-message",c.successMessages.PROJECT_USER_DELETED)})}}var u={send:"send",resend:"resend",cancel:"cancel",remove:"remove"};t.invitationPopUp=function(e,n,o){s.show({title:n.title,template:n.message,scope:t,buttons:[{text:a.NO,type:"btn-no",onTap:function(){return!0}},{text:a.YES,type:"btn-yes",onTap:function(){d(e,o)}}]})},t.deleteUser=function(e){t.invitationPopUp(u.remove,c.infoMessages.PROJECT_USER_DELETED,e)},t.reSendInvitation=function(e){t.invitationPopUp(u.resend,c.infoMessages.PROJECT_INVITATION_RESENT,e)},t.deleteInvitation=function(e){t.invitationPopUp(u.cancel,c.infoMessages.PROJECT_INVITATION_CANCELLED,e)},t.start=function(){i.findById(o.id).then(function(s){s?(t.project=s,t.project.users=p.adminTopOnList(t.project.users),e.title="Users: "+t.project.name,t.loginId=p.getLoggedInId(),t.canDeleteUser=i.canDeleteUser(s,p.getLoggedInUser()),e.$emit("basic:header",n.current.state,t.project,t)):r.home()}),i.getAllProjectsUsers().then(function(e){t.allUsers=e})},t.start();var l=e.$on("projectList-update",function(){i.findById(o.id).then(function(e){e&&(t.project=e)})});t.$on("$destroy",function(){l()})}])}).call(this);
(function(){app.controller("aboutSettingController",["$rootScope","$scope","$state","$window","CONSTANT",function(t,o,i,n,e){o.redirectTo=function(t){i.transitionTo(t)},o.openWebsite=function(){n.open(o.websiteURL,"_blank")},o.start=function(){o.title="About",o.websiteURL=e.website,o.version=e.version;var i=ionic.Platform.platform();o.currentPlatform="ios"==i?"iOS":_.capitalize(ionic.Platform.platform()),o.currentPlatformVersion=ionic.Platform.version(),t.$emit("basic:header",null,null,o,!1,null,!0)},o.start()}])}).call(this);
(function(){app.controller("accountSettingController",["$rootScope","$scope","$state","$ionicModal","user","settingsService","stringService","message","userModel","dbEnums","connectivity","$ionicLoading",function(e,o,t,a,n,l,s,r,c,i,d,u){function m(){o.userProfile={name:c.getLoggedInName(),email:c.getLoggedInEmail(),displayShortName:c.getLoggedInShortName(),avatar:c.getAvatar()}}function g(){o.dropdowns={profile:!0,account:!0}}function f(){a.fromTemplateUrl("html/views/modals/settings/account/account_delete_failure.html",function(e){o.accountDeleteFailureModal=e,o.accountDeleteFailureModal.show()},{scope:o,animation:"scale-in"})}function p(e){var t=!1;o.accountDeleteValidateModel=o.accountDeleteValidateModel||{},o.accountDeleteValidateModel.$error={},_.each(e.reasons,function(e){o.accountDeleteValidateModel.$error[e.key]=e.value,"password"==e.key&&(t=!0)}),t||(o.accountDeleteFailureReasons=e.reasons,f())}o.openUserNameModal=function(){o.userNameModel={firstName:c.getLoggedInFirstName(),lastName:c.getLoggedInLastName()},a.fromTemplateUrl("html/views/modals/settings/account/user_name_update.html",function(e){o.userNameModal=e,o.userNameModal.show()},{scope:o,animation:"scale-in"})},o.closeUserNameModal=function(e){e.preventDefault(),o.userNameModal.remove()},o.updateUserName=function(){o.userNameModal.remove(),l.updateUserName(o.userNameModel).then(function(o){e.$emit("toast-message",o.msg)})},o.openUserEmailModal=function(){o.userEmailModel={email:c.getLoggedInEmail(),password:s.EMPTY},a.fromTemplateUrl("html/views/modals/settings/account/user_email_update.html",function(e){o.userEmailModal=e,o.userEmailModal.show()},{scope:o,animation:"scale-in"})},o.closeUserEmailModal=function(e){e.preventDefault(),o.userEmailModal.remove()},o.updateUserEmail=function(){o.userEmailModal.remove(),l.updateEmail(o.userEmailModel).then(function(o){e.$emit("toast-message",o.msg)})},o.openUserPasswordModal=function(){o.userPasswordModel={},a.fromTemplateUrl("html/views/modals/settings/account/user_password_update.html",function(e){o.userPasswordModal=e,o.userPasswordModal.show()},{scope:o,animation:"scale-in"})},o.closeUserPasswordModal=function(e){e.preventDefault(),o.userPasswordModal.remove()},o.updateUserPassword=function(){o.userPasswordModal.remove(),l.updatePassword(o.userPasswordModel).then(function(o){o.error||(c.setRequestLoginEmail(c.getLoggedInEmail()),n.clearAll(),t.go("/login")),e.$emit("toast-message",o.msg)})},o.redirectTo=function(e){t.transitionTo(e)},o.toggleDropdown=function(e){o.dropdowns[e]=!o.dropdowns[e]},o.logout=function(){n.logout()},o.start=function(){o.title="My Account",g(),m(),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!1),e.$emit("basic:header",null,null,o,!1,null,!0)},o.start();var v=e.$on("userInfo-update",function(){m(),t.reload()}),w=function(){a.fromTemplateUrl("html/views/modals/settings/account/account_delete_warning.html",function(e){o.accountDeleteWarning=e,o.accountDeleteWarning.show()},{scope:o,animation:"scale-in"})};o.closeDeleteAccountModal=function(e){e.preventDefault(),o.accountDeleteWarning.remove()},o.deleteAccountValidate=function(e){e.preventDefault(),o.accountDeleteWarning.remove(),o.accountDeleteValidateModel={deleteText:"",password:"",DELETE_VALIDATION_REGEX:i.keys.DELETE_VALIDATION_REGEX},o.accountDeleteValidateModel.$error={},a.fromTemplateUrl("html/views/modals/settings/account/account_delete_validate_form.html",function(e){o.accountDeleteValidateForm=e,o.accountDeleteValidateForm.show()},{scope:o,animation:"scale-in"})},o.closeDeleteAccountValidateModal=function(e){e.preventDefault(),o.accountDeleteValidateForm.remove()},o.checkValidDeleteAccount=function(o){if(o.preventDefault(),d.isConnected()){var t={};t.userId=c.getLoggedInId(),u.show(),l.validateDeleteAccount(t).then(function(e){u.hide(),console.log("---- result from validate deleting account---");var o=e?e.data.response:void 0;console.log(o),o.result?w():p(o)},function(e){u.hide(),console.log("----error while deleting account-----"),console.log(e)})}else e.$emit("toast-message",r.errorMessages.CONNECTION_REQUIRED)},o.deleteAccount=function(a){if(a.preventDefault(),d.isConnected()){var s=o.accountDeleteValidateModel;s.userId=c.getLoggedInId(),u.show(),l.deleteAccount(s).then(function(e){u.hide(),console.log("---- result from deleting account---");var a=e?e.data.response:void 0;console.log(a),a.result?(o.accountDeleteValidateForm.remove(),n.clearAll(),t.go("/register",{accountDeleted:!0,reload:!0,notify:!1})):p(a)},function(e){u.hide(),console.log("----error while deleting account-----"),console.log(e)}).finally(function(){})}else e.$emit("toast-message",r.errorMessages.CONNECTION_REQUIRED)},o.$on("$stateChangeStart",function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!0)}),o.$on("$destroy",v)}])}).call(this);
(function(){app.controller("generalSettingController",["$rootScope","$scope","$state","$ionicModal","settingsService","discardChange","message",function(t,e,n,a,s,o,i){function l(){e.dropdowns={general:!0,dates:!0}}function r(){a.fromTemplateUrl("html/views/modals/settings/general/default_view.html",function(t){e.settingsDefaultViewModal=t},{scope:e,animation:"scale-in"}),a.fromTemplateUrl("html/views/modals/settings/general/float_button.html",function(t){e.settingsFloatButtonModal=t},{scope:e,animation:"scale-in"}),a.fromTemplateUrl("html/views/modals/settings/general/start_day.html",function(t){e.settingsStartDayModal=t},{scope:e,animation:"scale-in"}),a.fromTemplateUrl("html/views/modals/settings/general/date_format.html",function(t){e.settingsDateFormatModal=t},{scope:e,animation:"scale-in"}),a.fromTemplateUrl("html/views/modals/settings/general/time_format.html",function(t){e.settingsTimeFormatModal=t},{scope:e,animation:"scale-in"})}function g(){e.generalSettings=s.getSettings(),o.savePrevious(e,e.generalSettings)}e.redirectTo=function(t){n.transitionTo(t)},e.toggleDropdown=function(t){e.dropdowns[t]=!e.dropdowns[t]},e.setDefaultView=function(t){e.generalSettings.default_view=t},e.setFloatButton=function(t){e.generalSettings.float_button=t},e.setStartDay=function(t){e.generalSettings.start_day=t},e.setDateFormat=function(t){e.generalSettings.date_format=t},e.setTimeFormat=function(t){e.generalSettings.time_format=t},e.save=function(){o.isChanged(e.generalSettings)?s.update(e.generalSettings).then(function(){e.discarded=!0,t.$emit("toast-message",i.successMessages.SETTINGS_SAVED),o.updateDiscardedBeforeSave(),n.go("/settings")}):(o.updateDiscardedBeforeSave(),n.go("/settings"))},e.start=function(){e.title="General",l(),r(),g(),e.defaultViews=s.defaultViews,e.floatButtons=s.floatButtons,e.startDays=s.startDays,e.dateFormats=s.dateFormats,e.timeFormats=s.timeFormats,t.$emit("basic:header",null,null,e,!0,null,!0)},e.start();var m=t.$on("settings-update",function(){g()});e.$on("$destroy",m),e.$on("$stateChangeStart",function(t,n,a){o.changeState(t,n,a,e.generalSettings)})}])}).call(this);
(function(){app.controller("indexSettingController",["$rootScope","$scope","$state","settingsService",function(t,n,e,i){n.redirectTo=function(t){e.transitionTo(t)},n.start=function(){n.title="Settings",n.list=i.items,t.$emit("basic:header",null,null,n,!1,null,!0)},n.start()}])}).call(this);
(function(){app.controller("notificationsSettingController",["$rootScope","$scope","$state","settingsService","message","discardChange","userModel","dbEnums","roleValidators",function(e,t,n,s,o,i,a,c,g){function r(){t.dropdowns={tasks:!0,projects:!0}}function d(){t.settings=s.getSettings(),i.savePrevious(t,t.settings)}t.emailChangeDisabled=!0,t.toggleDropdown=function(e){t.dropdowns[e]=!t.dropdowns[e]},t.save=function(){i.isChanged(t.settings)?s.update(t.settings).then(function(){e.$emit("toast-message",o.successMessages.SETTINGS_SAVED),i.updateDiscardedBeforeSave(),n.go("/settings")}):(i.updateDiscardedBeforeSave(),n.go("/settings"))},t.start=function(){var n=a.getLoggedInUser();t.title="Notifications",d(),r(),e.$emit("basic:header",null,null,t,!0,null,!0),g.checkUserRole(n,c.USER_ROLES.EMAIL_NOTIFICATIONS,{},!1).then(function(){t.emailChangeDisabled=!1},function(e){"LICENSE"==e.key})},t.start();var l=e.$on("settings-update",function(){d()});t.$on("$destroy",l),t.$on("$stateChangeStart",function(e,n,s){i.changeState(e,n,s,t.settings)}),t.emailClick=function(e){if(t.emailChangeDisabled){var n=a.getLoggedInUser();g.checkUserRole(n,c.USER_ROLES.EMAIL_NOTIFICATIONS,{},!0)}}}])}).call(this);
(function(){app.controller("reminderSettingController",["$rootScope","$scope","settingsService","$ionicModal","date","$state","message","reminderService","discardChange","roleValidators","dbEnums","userModel","$q","DEFAULTS",function(n,e,i,t,a,o,s,l,r,c,d,m,h,u){function f(){e.dropdowns={reminder:!0}}function C(){e.settings=i.getSettings(),r.savePrevious(e,e.settings)}function g(){t.fromTemplateUrl("html/views/modals/settings/reminder/auto-reminder-notification-channels.html",function(n){e.autoReminderNotificationChannelsModal=n},{scope:e,animation:"scale-in"}),t.fromTemplateUrl("html/views/modals/settings/reminder/auto-reminder-time.html",function(n){e.autoReminderTimeModal=n},{scope:e,animation:"scale-in"}),t.fromTemplateUrl("html/views/modals/settings/reminder/others-reminder-notification-channels.html",function(n){e.othersReminderNotificationChannelsModal=n},{scope:e,animation:"scale-in"}),t.fromTemplateUrl("html/views/modals/settings/reminder/task-create-reminder-notification-channels.html",function(n){e.taskCreateReminderNotificationChannelsModal=n},{scope:e,animation:"scale-in"})}e.isEmailEnabled=!1,e.channelClicked=function(n){var e=h(function(e,i){if("Email"==n.title&&0==n.value){var t=m.getLoggedInUser();c.checkUserRole(t,d.USER_ROLES.EMAIL_NOTIFICATIONS,{},!0).then(e,i)}else e()});e.then(function(){n.value=!n.value,n.notified=!n.value})},e.openAutoReminderNotificationChannelsModal=function(){e.notificationChannels=angular.copy(e.settings.reminder.autoReminder.channels),e.settings.reminder.autoReminder.enable&&e.autoReminderNotificationChannelsModal.show()},e.openOthersReminderNotificationChannelsModal=function(){e.notificationChannels=angular.copy(e.settings.reminder.othersReminderNotificationChannels),e.othersReminderNotificationChannelsModal.show()},e.openAutoReminderTimeModal=function(){e.settings.reminder.autoReminder.enable&&e.autoReminderTimeModal.show()},e.setAutoReminderNotificationChannels=function(){(e.notificationChannels.email.value||e.notificationChannels.push.value)&&(e.settings.reminder.autoReminder.channels=angular.copy(e.notificationChannels),e.notificationChannels=angular.copy(l.notificationChannels),e.autoReminderNotificationChannelsModal.hide())},e.setAutoReminderTime=function(n){e.settings.reminder.autoReminder.time=n},e.setOthersReminderNotificationChannels=function(){(e.notificationChannels.email.value||e.notificationChannels.push.value)&&(e.settings.reminder.othersReminderNotificationChannels=angular.copy(e.notificationChannels),e.notificationChannels=angular.copy(l.notificationChannels),e.othersReminderNotificationChannelsModal.hide())},e.openTaskCreateReminderNotificationChannelsModal=function(){e.notificationChannels=angular.copy(e.settings.reminder.taskCreateReminderNotificationChannels||u.defaultSettings.taskCreateReminderNotificationChannels),e.taskCreateReminderNotificationChannelsModal.show()},e.setTaskCreateReminderNotificationChannels=function(){(e.notificationChannels.email.value||e.notificationChannels.push.value)&&(e.settings.reminder.taskCreateReminderNotificationChannels=angular.copy(e.notificationChannels),e.notificationChannels=angular.copy(l.notificationChannels),e.taskCreateReminderNotificationChannelsModal.hide())},e.toggleDropdown=function(n){e.dropdowns[n]=!e.dropdowns[n]},e.save=function(){r.isChanged(e.settings)?i.update(e.settings).then(function(){n.$emit("toast-message",s.successMessages.SETTINGS_SAVED),r.updateDiscardedBeforeSave(),o.go("/settings")}):(r.updateDiscardedBeforeSave(),o.go("/settings"))},e.start=function(){e.title="Reminders";var i=m.getLoggedInUser();c.checkUserRole(i,d.USER_ROLES.EMAIL_NOTIFICATIONS,{},!1).then(function(){e.isEmailEnabled=!0}),f(),g(),C(),e.date=a,e.autoReminderTime=angular.copy(l.timeDuration),e.notificationChannels=angular.copy(l.notificationChannels),n.$emit("basic:header",null,null,e,!0,null,!0)},e.start(),e.$on("$stateChangeStart",function(n,i,t){r.changeState(n,i,t,e.settings)})}])}).call(this);
(function(){app.controller("testSettingController",["$rootScope","$scope","settingsService","$ionicModal",function(t,e,l,n){e.start=function(){e.title="Test",t.$emit("basic:header",null,null,e,!0,null,!0)},e.start()}])}).call(this);
(function(){app.controller("basicHeaderController",["$rootScope","$state","$ionicHistory","$scope","$ionicPopover","$ionicLoading","$ionicSideMenuDelegate","$ionicPopup","sharedData","project","labelService","filterService","user","rightMenuService","notificationService","navigationService","userModel",function(e,o,t,n,i,c,r,a,u,p,l,s,f,v,h,m,$){function d(){i.fromTemplateUrl("html/views/popovers/top_right_popover.html",{scope:g}).then(function(e){g.popover=e}),i.fromTemplateUrl("html/views/popovers/notification_popover.html",{scope:g}).then(function(e){g.notificationBar=e})}var g=n,N={},b=null;n.items=[],$.isAuthenticated()&&h.getNoOfUnseen().then(function(e){n.NoNN=e}),g.buttonClicked=function(e){e&&e.stopPropagation(),b.save()},g.toggleMenu=function(){return r.toggleLeft()},g.menuItemClicked=function(e,o){g.popover.hide(),v.itemClicked(e,N,g,o)},g.back=function(){m.goBack()},g.home=function(){u.home()};var S=e.$on("basic:header",function(e,o,t,n,i,c,r){N=t,g.buttonEnabled=i,g.hasBackButton=r,g.buttonTitle=c||"Save",d(),v.setMenu(o,t),g.menus=v.getMenu(),b=n}),k=e.$on("NoNN-update",function(e,o){n.NoNN=o,n.$$phase||n.$apply()});g.$on("$destroy",function(){S(),k()})}])}).call(this);
(function(){app.controller("listHeaderController",["$rootScope","$scope","$state","$ionicSideMenuDelegate","date","sortService","platformService","$ionicPopover","rightMenuService","sharedData","notificationService","taskService","dbEnums","userModel","taskListView",function(e,t,s,i,o,a,c,n,r,u,l,f,h,d,p){function m(){n.fromTemplateUrl("html/views/popovers/top_right_popover.html",{scope:$}).then(function(e){$.popover=e}),n.fromTemplateUrl("html/views/popovers/notification_popover.html",{scope:$}).then(function(e){$.notificationBar=e})}function v(t){t?1==t?e.numberOfTasks="1 task":e.numberOfTasks=t+" tasks":e.numberOfTasks="No tasks"}var $=t,k={},b={};$.sortService=a,t.searchBar={searchText:"",isVisible:!1},d.isAuthenticated()&&l.getNoOfUnseen().then(function(e){t.NoNN=e}),t.items=[],$.home=function(){u.home()},$.menuItemClicked=function(e,t){$.popover.hide(),r.itemClicked(e,k,$,t)},$.openNotificationBar=function(e){r.openNotificationBar(e,$)},$.save=function(){b&&b.save()},$.searchStart=function(){t.focused=!0,e.$emit("search:start",t.focused),e.$emit("search:tasks",t.searchBar.searchText),""==t.searchBar.searchText&&p.clearAllSelected()},$.sendSearchText=function(s){t.focused||(t.focused=!0,e.$emit("search:start",t.focused)),e.$emit("search:tasks",s)},$.searchOutOfFocus=function(s){t.focused=!1,e.$emit("search:start",(s||"").length>0)},$.clearClicked=function(){t.searchBar.searchText="",t.focused=!1,e.$emit("search:start",!1),t.searchBar.isVisible=!1},$.taskAdd=function(){s.current.state==u.STATE.PROJECT&&f.addProjectToTaskObject(k),s.go("/task/add")},$.toggleMenu=function(){return i.toggleLeft()},$.toggleSearchBar=function(s){t.searchBar.isVisible?t.searchOutOfFocus(s):(e.$emit("search:start",!0),e.$emit("search:tasks",""),p.clearAllSelected()),t.searchBar.isVisible=!t.searchBar.isVisible};var T=e.$on("task:header-taskList",function(e,t,s,i,o){k=i,v(s),m(),r.setMenu(t,i),$.menus=r.getMenu(),$.disabledOptions=o,a.setAll(void 0,void 0,t).then(function(){}),$.disabledOptions=c.isMobileDevice()||o}),S=e.$on("list:header-scope",function(e,t){b=t,$.disableModification=t.taskObject.status==h.status.complete}),g=e.$on("NoNN-update",function(e,s){t.NoNN=s,t.$$phase||t.$apply()}),N=e.$watch("selectedFilterView",function(e,t){});$.$on("$destroy",function(){T(),S(),g(),N()})}])}).call(this);
(function(){app.controller("leftMenuController",["$scope","$rootScope","$state","$ionicPopup","$ionicScrollDelegate","$ionicHistory","project","labelService","sharedData","message","filterService","stringService","sortService","taskListView","$q","$timeout","userModel","roleValidators","dbEnums",function(e,t,n,o,i,s,c,l,r,u,a,f,d,g,h,p,E,v,m){function L(){T&&(T(),T=null)}function _(){L(),T=t.$on("projectList-update",function(){console.log("projectList-update called"),c.getAll().then(function(t){e.activeProjects=t}),c.getAllArchived().then(function(t){e.archiveProjects=t}),c.getAllProjectsUsers().then(function(t){e.assignees=t})})}function A(){var e=E.getLoggedInUser();return v.checkUserRole(e,[m.USER_ROLES.LABELS],{label:null,user:e},!0)}function R(e){var t=E.getLoggedInUser(),n=h(function(n,o){v.checkUserRole(t,m.USER_ROLES.CUSTOM_FILTERS,{user:t},!e).then(n,o)});return n}function I(e){var t=E.getLoggedInUser(),n=h(function(n,o){v.checkUserRole(t,m.USER_ROLES.MY_FEEDS,{user:t},!e).then(n,o)});return n}e.canUserFilter=!1,e.selectedId=void 0,e.leftMenuKey=void 0,e.child_menu_key=void 0,e.redirect=function(t){switch(e.selectedId=void 0,e.leftMenuKey=void 0,s.nextViewOptions({disableAnimate:!0}),t){case"myFeed":I().then(function(){n.go("/task/my-feed")});break;default:d.setFilterTypeByValue(t),d.setAll(void 0,void 0,t).then(function(){n.go("/task/list/",{type:t,id:null})})}},e.edit=function(e,t){function o(){s.nextViewOptions({disableAnimate:!0});var o="/"+e+"/edit";n.go(o,{id:t})}"filter"==e?R().then(o):"label"==e?A().then(o):o()},e.set_parent_selected=function(t){if(e.child_menu_key!=e.leftMenuKey&&(e.selectedId=void 0),console.log(e.leftMenuKey+" left"),console.log(e.child_menu_key+" child"),e.leftMenuKey==t)return{fontWeight:"bold"}},e.set_child_selected=function(t,n){if(console.log("ok-1"),e.child_menu_key=n,console.log(e.child_menu_key+" selected"),e.selectedId==t)return{fontWeight:"bold"}},e.details=function(t,o){function i(){var e="/"+t+"/details";s.nextViewOptions({disableAnimate:!0});var i=t!=r.LEFT_MENU_KEYS.FILTER;d.setAll(o,i,t).then(function(){n.go(e,{id:o})})}e.selectedId=o,e.leftMenuKey=t,"filter"==t?R().then(i):i()},e.archive=function(n){var i=u.infoMessages.PROJECT_ARCHIVED_CONFIRMATION;o.show({title:i.title,template:i.message,scope:e,buttons:[{text:f.NO,onTap:function(){return!0}},{text:f.YES,onTap:function(){c.archive(n).then(function(e){e&&(t.$emit("toast-message",u.successMessages.PROJECT_ARCHIVED),t.$emit("projectList-update"))})}}]})},e.unArchive=function(n){var i=u.infoMessages.PROJECT_UNARCHIVED_CONFIRMATION;o.show({title:i.title,template:i.message,scope:e,buttons:[{text:f.NO,onTap:function(){return!0}},{text:f.YES,onTap:function(){c.unArchive(n).then(function(e){e&&(t.$emit("toast-message",u.successMessages.PROJECT_UNARCHIVED),t.$emit("projectList-update"))})}}]})},e.removeLabel=function(n){var i=u.infoMessages.LABEL_DELETE_CONFIRMATION;o.show({title:i.title,template:i.message,scope:e,buttons:[{text:f.NO,onTap:function(){return!0}},{text:f.YES,onTap:function(){l.delete(n).then(function(e){e&&(t.$emit("toast-message",u.successMessages.LABEL_DELETED),t.$emit("labelList-update"))})}}]})},e.removeFilter=function(n){var i=u.infoMessages.FILTER_DELETE_CONFIRMATION;o.show({title:i.title,template:i.message,scope:e,buttons:[{text:f.NO,onTap:function(){return!0}},{text:f.YES,onTap:function(){a.delete(n).then(function(e){e&&(t.$emit("toast-message",u.successMessages.FILTER_DELETED),t.$emit("filterList-update"))})}}]})},e.setDropdowns=function(){e.dropdowns={project:!1,assignee:!1,filter:!1,label:!1}},e.setSettings=function(){e.settings={project:!1,assignee:!1,filter:!1,label:!1}},e.toggleDropdown=function(t){e.leftMenuKey=t,e.selectedId=void 0,e.dropdowns[t]=!e.dropdowns[t],i.resize()},e.start=function(){e.setDropdowns(),e.setSettings(),e.leftMenuSingleItems=r.leftMenuSingleItems(),c.getAll().then(function(t){e.activeProjects=t}),c.getAllArchived().then(function(t){e.archiveProjects=t}),l.getAll().then(function(t){e.labels=t}),a.getAll().then(function(t){e.filters=t,R(!0).then(function(){e.canUserFilter=!0})}),c.getAllProjectsUsers().then(function(t){e.assignees=t})},e.start(),e.onReorder=function(t,n,o){var i=h.defer(),s=angular.copy(e.activeProjects),l=s.splice(t,1);return s.splice(n,0,l[0]),L(),c.reorder(s,function(){_()}),e.activeProjects=s,i.resolve(),i.promise};var T;_();var S=t.$on("taskList-update",function(){c.getAll().then(function(t){e.activeProjects=t})}),M=t.$on("labelList-update",function(){l.getAll().then(function(t){e.labels=t})}),O=t.$on("filterList-update",function(){a.getAll().then(function(t){e.filters=t})}),b=t.$on("left-menu:selected",function(t,n){e.selected=n});e.$on("$destroy",function(){T(),S(),M(),O(),b()}),e.addLabel=function(e){A().then(function(){n.go("/label/add")})},e.addProject=function(){var e=E.getLoggedInUser(),t=h(function(t,n){v.checkUserRole(e,m.USER_ROLES.ACTIVE_PROJECTS,{user:e},!0).then(t,n)});t.then(function(){n.go("/project/add")})},e.addFilter=function(){R().then(function(){n.go("/filter/add")})}}])}).call(this);
(function(){app.controller("addTaskController",["$q","$scope","$rootScope","$ionicModal","$ionicPopup","$timeout","$state","taskService","dueService","stringService","headerService","guidGenerator","dbEnums","reminderService","sharedData","project","user","labelService","date","message","userModel","roleValidators","settingsService","popupService",function(e,t,a,s,r,n,c,i,o,d,u,l,m,f,k,b,g,p,j,O,h,v,S,y){function D(e){var a=!1;return t.taskObject.watchers&&t.taskObject.watchers.forEach(function(t){t.watcher._id===e._id&&(a=t.checked)}),a}function E(){i.setTaskObject(t.taskObject)}function M(){N=!0,i.clearTaskObject()}function T(){s.fromTemplateUrl("html/views/modals/tasks/projects.html",function(e){t.projectModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/tasks/assignees.html",function(e){t.userModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/tasks/priorities.html",function(e){t.priorityModal=e},{scope:t,animation:"scale-in"}),s.fromTemplateUrl("html/views/modals/tasks/due_date.html",function(e){t.dueDateModal=e},{scope:t,animation:"scale-in"})}function I(){b.getAll().then(function(e){e&&(e.splice(0,0,k.inbox),t.projects=e)})}function w(){var e=t.taskObject.labels||[];t.taskObject.labels=[],p.getAll().then(function(a){a&&a.forEach(function(a){var s=_.find(e,function(e){return a.id==e.label.id});t.taskObject.labels.push({checked:!!s&&s.checked,label:a})})})}function R(){t.priorities=i.priorities,t.taskObject.priority=3}function A(){var e;t.taskObject.reminders.forEach(function(a){a.date_created=new Date(a.date_created),e=f.getScheduledTime(a,t.taskObject.recurrence.due_date),a.invalid=j.isPast(e)||t.taskObject.recurrence.due_date&&j.isAfter(e,t.taskObject.recurrence.due_date),1==a.time.id&&(a.time.title=j.getDateTime(a.time.value))})}function U(e){var a=h.getLoggedInUser();if(e.recurrence&&e.recurrence.due_date&&e.assignee&&e.assignee._id==a._id){var s=i.addAutoReminder(e.recurrence.due_date);if(s){var r=_.find(e.reminders,function(e){return e.auto});r||(e.reminders.push(s),t.dropdowns.reminders=!0,A())}}else _.remove(e.reminders,function(e){return e.auto})}function $(){t.projectModal&&t.projectModal.remove(),t.userModal&&t.userModal.remove(),t.priorityModal&&t.priorityModal.remove(),t.dueDateModal&&t.dueDateModal.remove()}var N=!1;t.dropdowns={watchers:!1,labels:!1,reminders:!0},t.isEmailEnabled=!1,t.defaultReminderChannels=null,t.toggleMenu=function(e){t.dropdowns[e]=!t.dropdowns[e]},t.tabFocus=function(e){9==e.keyCode&&(3==e.target.tabIndex?t.userModal.show():4==e.target.tabIndex?t.toggleMenu("watchers"):5==e.target.tabIndex?t.priorityModal.show():6==e.target.tabIndex?t.toggleMenu("labels"):7==e.target.tabIndex?t.dueDateModal.show():8==e.target.tabIndex&&t.toggleMenu("reminders"))},t.setAssignees=function(){var a=e.defer();return t.assignees=[],t.taskObject.project.id?b.findById(t.taskObject.project.id).then(function(e){e.users.forEach(function(e){e.status===m.status.active&&t.assignees.push(e)}),t.assignees=h.meTopOnList(t.assignees),t.assignees.unshift({_id:0,displayName:"Unassigned"}),a.resolve(t.assignees)}):(t.assignees.push({_id:0,displayName:"Unassigned"}),a.resolve(t.assignees)),a.promise},t.setWatchers=function(e){var a=[];t.taskObject.watchers.length&&!e||(t.taskObject.project.id?b.findById(t.taskObject.project.id).then(function(e){e.users.forEach(function(e){t.taskObject.assignee._id!==e._id&&e.status===m.status.active&&a.push({checked:D(e),watcher:e})}),a=h.meTopOnList(a,"watcher"),console.log(a),t.taskObject.watchers=angular.copy(a)}):t.taskObject.watchers=angular.copy(a))},t.setReminders=function(e,a){var s=[];if(t.taskObject.reminders.length){if(e){var r=angular.copy(t.assignees);r.splice(0,1),t.taskObject.reminders.forEach(function(e){if(r.length){for(var t=0;t<r.length;t++)if(e.assignee._id==r[t]._id){s.push(e);break}}else e.assignee._id==h.getLoggedInId()&&s.push(e)})}else a&&t.taskObject.reminders.forEach(function(e){(e.time.id||!e.time.id&&t.taskObject.recurrence.due_date)&&s.push(e)});t.taskObject.reminders=angular.copy(s),A()}},t.setDueDate=function(){t.taskObject.recurrence={},t.taskObject.hasDueDate=!0,t.dueDateSummary=d.EMPTY,t.setReminders(!1,!0)},t.updateProject=function(e,a){function s(){t.taskObject.project={id:e.id,name:e.name,color:e.color},(r||a)&&(t.taskObject.assignee={},t.setAssignees().then(function(){t.setReminders(!0,!1)}),t.setWatchers(!0))}var r=t.taskObject.project.id!=e.id;if(r&&!a){var n=h.getLoggedInUser();v.checkUserRole(n,m.USER_ROLES.ACTIVE_TASKS,{project:e},!0).then(function(){s()})}else s()},t.updateAssignee=function(e){t.taskObject.assignee={_id:e._id,displayName:e.displayName,displayShortName:e.displayShortName,email:e.email,avatar:e.avatar},t.setWatchers(!0),U(t.taskObject)},t.updatePriority=function(e){t.taskObject.priority=e},t.updateDueDate=function(e){switch(e){case"TODAY":t.taskObject.recurrence={due_date:j.getDateOnly(j.today())};break;case"TOMORROW":t.taskObject.recurrence={due_date:j.getDateOnly(j.tomorrow())};break;case"WEEK":t.taskObject.recurrence={due_date:j.getDateOnly(j.nextWeek())};break;case"MONTH":t.taskObject.recurrence={due_date:j.getDateOnly(j.nextMonth())};break;case"NO_DATE":t.dueDateModal.show();break;case"CUSTOM_DATE":t.taskObject.recurrence={due_date:t.taskObject.recurrence.due_date}}t.taskObject.hasDueDate=!0,t.dueDateSummary=o.getSummary(t.taskObject.recurrence),U(t.taskObject),t.setReminders(!1,!0)},t.addReminder=function(e){e&&(t.taskObject.reminders.push(t.reminderObject),t.dropdowns.reminders=!0,A()),t.reminderObject={}},t.removeReminder=function(e){var a=O.infoMessages.REMINDER_DELETE_CONFIRMATION;r.show({title:a.title,template:a.message,scope:t,buttons:[{text:d.NO,onTap:function(){return!0}},{text:d.YES,onTap:function(){for(var a=0;a<t.taskObject.reminders.length;a++)if(t.taskObject.reminders[a].id==e){t.taskObject.reminders.splice(a,1);break}A()}}]})},t.getRecurrenceModel=function(e){e?(t.taskObject.recurrence=e,t.taskObject.hasDueDate=!0,t.taskObject.recurrence=o.setDueDate(t.taskObject.recurrence),t.dueDateSummary=o.getSummary(t.taskObject.recurrence),t.setReminders(!1,!0)):n(function(){t.dueDateModal.show()})},t.saveKeyEnter=function(e){13==e.keyCode&&t.save()},t.save=function(){t.form.$submitted=!0,t.form.$valid&&i.add(t.taskObject).then(function(e){e&&(M(),a.$emit("toast-message",O.successMessages.TASK_SAVED),k.taskHome(t.taskObject))})},t.discardPopup=function(e,t){y.discard(a).then(function(a){return!a||(M(),void c.go(e.name,t))})},t.start=function(){t.taskObject=i.getTaskObject();var e=h.getLoggedInUser();v.checkUserRole(e,m.USER_ROLES.EMAIL_NOTIFICATIONS,{},!1).then(function(){t.isEmailEnabled=!0}),v.checkUserRole(e,m.USER_ROLES.ACTIVE_TASKS,{project:t.taskObject.project},0!=t.taskObject.project.id).then(null,function(){}).finally(function(){var e=S.getSettings();t.defaultReminderChannels=e.reminder.taskCreateReminderNotificationChannels,t.reminderObject={},t.title="Add Task",a.addUrl="#/task/add",a.noteUrl="#/task/note/",I(),t.setAssignees(),w(),t.setWatchers(),R(),t.dueDateSummary=o.getSummary(t.taskObject.recurrence),t.loginId=h.getLoggedInId(),t.userId=h.getLoggedInId(),T(),u.setAddTaskHeader(t),a.$emit("task:header"),a.taskSaved&&n(function(){t.save(),a.taskSaved=!1})})},t.start();var L=a.$on("$stateChangeStart",function(e,a,s){t.taskObject&&(E(t.taskObject),"/task/note"!==a.name?!N&&i.taskObjectHasValue()?(e.preventDefault(),t.discardPopup(a,s)):(M(),$()):$())});t.$on("$destroy",function(){C(),L()});var C=a.$on("projectList-update",function(){t.taskObject.project.id&&b.findById(t.taskObject.project.id).then(function(e){e&&t.updateProject(e,!0)})})}])}).call(this);
(function(){app.controller("defaultViewController",["$rootScope","$scope","$ionicTabsDelegate","taskListView",function(e,t,o,l){function n(t){o.select(t),e.default.edit=!t}e.default={edit:!0},t.toggleTab=function(t){var o=e.$broadcast("default:tabswitch");o.defaultPrevented?o.promise&&o.promise.then(function(e){e&&n(t)}):n(t)};var a=e.$on("task:bulkCompleted",function(){l.clearAllSelected(),l.setDefaultView()});t.$on("$destroy",function(){a()})}])}).call(this);
(function(){app.controller("editTaskController",["$q","$rootScope","$scope","$state","$ionicModal","$stateParams","$timeout","toastr","connectivity","taskService","dueService","labelService","stringService","headerService","reminderService","historyService","sharedData","project","user","date","dbEnums","message","$ionicPopup","userModel","taskListView","popupService","$ionicTabsDelegate","$ionicLoading","uiHelperService","$ionicScrollDelegate","navigationService","roleValidators","settingsService",function(e,t,a,s,r,n,c,i,o,d,u,l,m,f,k,p,b,g,h,O,j,v,T,y,M,S,D,E,w,I,R,A,$){function N(e){var t=!1;return a.taskObject.watchers&&a.taskObject.watchers.forEach(function(a){a.watcher._id===e._id&&(t=a.checked)}),t}function U(){a.taskObject.assignee=d.getAssignee(a.taskObject)||{}}function C(){var e=[];a.taskObject.users.forEach(function(t){t.role!==j.taskUserRole.assignee&&e.push({checked:t.getNotification,watcher:t})}),e=y.meTopOnList(e,"watcher"),a.taskObject.watchers=angular.copy(e)}function L(){a.taskObject.labels=[],l.getAll().then(function(e){e&&e.forEach(function(e){a.taskObject.labels.push({checked:l.isTaskExists(K,e),label:e})})})}function F(){g.getAll().then(function(e){e&&(e.splice(0,0,b.inbox),a.projects=e)})}function V(){var e;a.taskObject.reminders.forEach(function(t){t.date_created=new Date(t.date_created),e=k.getScheduledTime(t,a.taskObject.recurrence.due_date),t.invalid=O.isPast(e)||a.taskObject.recurrence.due_date&&O.isAfter(e,a.taskObject.recurrence.due_date),1==t.time.id&&(t.time.title=O.getDateTime(t.time.value))})}function x(e){void 0!==q&&!angular.equals(q,a.taskObject)&&t.rightDefaultViewVisible&&e.preventDefault()}function H(e){D.select(e)}var P,B,K,W,q,Y,G=!1,Y=a.histories=[];a.canSeeHistory=!0,a.licenseError={},P=0,B=20,a.dropdowns={watchers:!1,labels:!1,reminders:!0},a.isEmailEnabled=!1,a.defaultReminderChannels=null,a.taskComplete=function(){var e={name:s.current.name,params:{id:K}};d.bulkCompleteRequest([a.taskObject],!1,e),W&&M.setDefaultView(),b.home()},a.setFavourites=function(){var e={isFavourite:!a.isFavourite,taskIds:[a.taskObject.id]};d.bulkFavourites(e).then(function(e){e?t.$emit("toast-message",v.successMessages.TASK_ADD_TO_FAVOURITE):t.$emit("toast-message",v.successMessages.TASK_REMOVE_FROM_FAVOURITE),a.isFavourite=e})},a.toggleMenu=function(e){a.dropdowns[e]=!a.dropdowns[e]},a.setAssignees=function(){var t=e.defer();return a.assignees=[],a.taskObject.project.id?g.findById(a.taskObject.project.id).then(function(e){e.users.forEach(function(e){e.status===j.status.active&&a.assignees.push(e)}),a.assignees=y.meTopOnList(a.assignees),a.assignees.unshift({_id:0,displayName:"Unassigned"}),t.resolve(a.assignees)}):(a.assignees.push({_id:0,displayName:"Unassigned"}),t.resolve(a.assignees)),t.promise},a.setReminders=function(e,t){var s=[],r=angular.copy(a.taskObject.reminders);if(r.length){if(e){a.prevReminders.forEach(function(e){_.some(a.taskObject.reminders,e)||r.push(e)});var n=angular.copy(a.assignees);n.splice(0,1),r.forEach(function(e){if(n.length){for(var t=0;t<n.length;t++)if(e.assignee._id==n[t]._id){s.push(e);break}}else e.assignee._id==y.getLoggedInId()&&s.push(e)})}else t&&r.forEach(function(e){(e.time.id||!e.time.id&&a.taskObject.recurrence.due_date)&&s.push(e)});a.taskObject.reminders=angular.copy(s),V()}},a.setWatchers=function(e,t){var s=[];a.taskObject.watchers.length&&!e||(a.taskObject.project.id?g.findById(a.taskObject.project.id).then(function(e){e.users.forEach(function(e){a.taskObject.assignee._id!==e._id&&e.status===j.status.active&&s.push({checked:N(e),watcher:e})}),s=y.meTopOnList(s,"watcher"),a.taskObject.watchers=angular.copy(s),t&&t()}):(a.taskObject.watchers=angular.copy(s),t&&t()))},a.setDueDate=function(){a.taskObject.recurrence={},a.taskObject.hasDueDate=!0,a.dueDateSummary=m.EMPTY,a.setReminders(!1,!0)},a.createModals=function(){r.fromTemplateUrl("html/views/modals/tasks/projects.html",function(e){a.projectModal=e},{scope:a,animation:"scale-in"}),r.fromTemplateUrl("html/views/modals/tasks/assignees.html",function(e){a.userModal=e},{scope:a,animation:"scale-in"}),r.fromTemplateUrl("html/views/modals/tasks/priorities.html",function(e){a.priorityModal=e},{scope:a,animation:"scale-in"}),r.fromTemplateUrl("html/views/modals/tasks/due_date.html",function(e){a.dueDateModal=e},{scope:a,animation:"scale-in"})},a.updateProject=function(e,s){var r=a.taskObject.project.id!=e.id,n=!1;void 0!==q&&!angular.equals(q,a.taskObject)&&t.rightDefaultViewVisible&&(n=!0),a.taskObject.project={id:e.id,name:e.name,color:e.color},(r||s)&&(a.taskObject.assignee={},a.setAssignees().then(function(){a.setReminders(!0,!1),a.setWatchers(!0,function(){s&&!n&&(q=a.taskObject)})}))},a.updateAssignee=function(e){a.taskObject.assignee={_id:e._id,displayName:e.displayName,displayShortName:e.displayShortName,email:e.email,avatar:e.avatar},a.setWatchers(!0)},a.updatePriority=function(e){a.taskObject.priority=e},a.updateDueDate=function(e){var t=a.taskObject.recurrence.due_date?new Date(a.taskObject.recurrence.due_date):null;switch(e){case"TODAY":a.taskObject.recurrence={due_date:O.getDateOnly(O.today())};break;case"TOMORROW":a.taskObject.recurrence={due_date:O.getDateOnly(O.tomorrow())};break;case"WEEK":a.taskObject.recurrence={due_date:O.getDateOnly(O.nextWeek())};break;case"MONTH":a.taskObject.recurrence={due_date:O.getDateOnly(O.nextMonth())};break;case"NO_DATE":a.dueDateModal.show();break;case"CUSTOM_DATE":a.taskObject.recurrence={due_date:a.taskObject.recurrence.due_date}}"NO_DATE"!=e&&(a.taskObject.hasDueDate=!0,a.taskObject.recurrence&&a.taskObject.recurrence.due_date&&(a.taskObject.recurrence.due_date=new Date(a.taskObject.recurrence.due_date),t&&"CUSTOM_DATE"!==e&&(a.taskObject.recurrence.due_date.setHours(t.getHours()),a.taskObject.recurrence.due_date.setMinutes(t.getMinutes()),a.taskObject.recurrence.due_date.setSeconds(t.getSeconds()),a.taskObject.recurrence.due_date.setMilliseconds(t.getMilliseconds()))),a.dueDateSummary=u.getSummary(a.taskObject.recurrence),a.setReminders(!1,!0))},a.addReminder=function(e){e&&(a.taskObject.reminders.push(a.reminderObject),a.dropdowns.reminders=!0,V()),a.reminderObject={}},a.removeReminder=function(e){var t=v.infoMessages.REMINDER_DELETE_CONFIRMATION;T.show({title:t.title,template:t.message,scope:a,buttons:[{text:m.NO,onTap:function(){return!0}},{text:m.YES,onTap:function(){for(var t=0;t<a.taskObject.reminders.length;t++)if(a.taskObject.reminders[t].id==e){a.taskObject.removeReminders.push(e),a.taskObject.reminders.splice(t,1),V();break}}}]})},a.getRecurrenceModel=function(e){e?(a.recurrence=e,a.taskObject.hasDueDate=!0,a.taskObject.recurrence=u.setDueDate(a.taskObject.recurrence),a.dueDateSummary=u.getSummary(a.taskObject.recurrence),a.setReminders(!1,!0)):a.dueDateModal.show()},a.saveKeyEnter=function(e){13==e.keyCode&&a.save()},a.tabFocus=function(e){13==e.keyCode&&(2==e.target.tabIndex?a.projectModal.show():3==e.target.tabIndex?a.userModal.show():4==e.target.tabIndex?a.toggleMenu("watchers"):5==e.target.tabIndex?a.priorityModal.show():6==e.target.tabIndex?a.toggleMenu("labels"):7==e.target.tabIndex?a.dueDateModal.show():8==e.target.tabIndex&&a.toggleMenu("reminders"))},a.save=function(){a.form.$submitted=!0,a.form.$valid&&d.update(a.taskObject,q).then(function(e){return e&&t.$emit("toast-message",v.successMessages.TASK_EDITED),Y=!0,W?(M.clearAllSelected(),void c(function(){w.focusTo(a.taskObject.id,I.$getByHandle("tasksScrollHandle"),{offsetTop:20})})):void R.goBack({focusedTaskId:a.taskObject.id})})},a.discardPopup=function(e,r){S.discard(t).then(function(t){return!t||(G=!0,d.clearTaskObject(),a.projectModal&&a.projectModal.remove(),a.userModal&&a.userModal.remove(),a.priorityModal&&a.priorityModal.remove(),a.dueDateModal&&a.dueDateModal.remove(),M.setDefaultView(),s.go(e.name,r),void 0)})},a.start=function(){function e(e){e?(a.createModals(),a.taskObject=e,a.disableModification=e.status==j.status.complete,a.taskObject.removeReminders=[],a.reminderObject={},F(),U(),a.setAssignees(),C(),L(),V(),a.taskObject.prevRecurrence=angular.copy(e.recurrence),a.prevReminders=angular.copy(e.reminders),a.dueDateSummary=u.getSummary(a.taskObject.recurrence),a.priorities=d.priorities,a.loginId=y.getLoggedInId(),W?t.$emit("list:header-scope",a):(f.setEditTaskHeader(a,K),t.$emit("task:header",s.current.state,e),a.date_created=O.getDateTime(a.taskObject.date_created)),a.isFavourite=d.isFavourite(a.taskObject,a.loginId),c(function(){a.taskObject.prevRecurrence=angular.copy(e.recurrence),q=angular.copy(a.taskObject),n.showType&&"reopen"==n.showType&&E.hide()},800)):b.home()}Y=!1,W=!!n.type,K=n.id,W||(a.title="Edit Task",a.addUrl="#/task/edit/"+K,a.noteUrl="#/task/note/"+K);var r=$.getSettings();a.defaultReminderChannels=r.reminder.taskCreateReminderNotificationChannels;var i=y.getLoggedInUser();A.checkUserRole(i,j.USER_ROLES.EMAIL_NOTIFICATIONS,{},!1).then(function(){a.isEmailEnabled=!0}),A.checkUserRole(i,j.USER_ROLES.TASK_HISTORY,{},!1).then(function(){},function(e){a.canSeeHistory=!1,a.licenseError=v.infoMessages.TASK_HISTORY}),n.showType&&"reopen"==n.showType&&E.show(),d.findActiveTaskById(K).then(function(a){a?e(a):t.closedTask?e(t.closedTask):d.getTaskFromServer(K).then(function(a){a?e(a):t.$emit("toast-message",v.errorMessages.TASK_NOT_FOUND)},function(e){t.$emit("toast-message",e.msg)})})},a.start(),a.$on("$stateChangeStart",function(e,t,s){G||Y||!q||angular.equals(q,a.taskObject)?(a.projectModal&&a.projectModal.remove(),a.userModal&&a.userModal.remove(),a.priorityModal&&a.priorityModal.remove(),a.dueDateModal&&a.dueDateModal.remove(),M.setDefaultView()):(e.preventDefault(),a.discardPopup(t,s))}),a.$on("beforeTaskListSelectionChange",function(e,t,a,s){x(e)}),a.loadMore=function(){o.isConnected()?p.getHistoriesByTaskId(K,P,B).then(function(e){e.length?(e.forEach(function(e){e.icon=b.EVENT_ICONS[e.key],e.type==j.status.reopened&&(e.icon=b.EVENT_ICONS[e.type.toUpperCase()]),e.date_modified=O.getDateTime(e.date_modified),a.histories.push(e)}),P+=B):a.noMoreItemsAvailable=!0,a.$broadcast("scroll.infiniteScrollComplete")}):a.noMoreItemsAvailable=!0};var z=t.$on("task:update-favourite",function(e,t){a.isFavourite=t});a.$on("default:tabswitch",function(e){x(e),e.defaultPrevented&&(e.promise=S.discard(t),e.promise.then(function(e){G=e}))}),a.$on("$destroy",function(){z(),J()}),a.toggleTab=function(e){var a=t.$broadcast("default:tabswitch");a.defaultPrevented?a.promise&&a.promise.then(function(t){t&&H(e)}):H(e)};var J=t.$on("projectList-update",function(){a.taskObject.project.id&&g.findById(a.taskObject.project.id).then(function(e){e&&a.updateProject(e,!0)})});a.selectLabel=function(e,t){var s=y.getLoggedInUser();console.log("label "+t.label.name+" : "+t.checked),t.checked&&A.checkUserRole(s,j.USER_ROLES.LABELS_ASSIGN,{labels:[t],task:a.taskObject},!0).then(function(){},function(e){c(function(){t.checked=!t.checked})})},a.copyTask=function(e){d.copyTask(e).then(function(e){d.setTaskObject(e),s.go("/task/add")})}}])}).call(this);
(function(){app.controller("noteTaskController",["$rootScope","$scope","$stateParams","$ionicScrollDelegate","$state","$ionicModal","userModel","$ionicPopup","$timeout","stringService","taskService","dbEnums","headerService","guidGenerator","noteService","date","sharedData","message","connectivity","$location","uiHelperService","popupService","roleValidators","CONSTANT","$q",function(e,t,o,s,n,a,i,c,d,l,r,u,g,f,m,p,k,I,h,E,T,N,O,S,b){function v(){a.fromTemplateUrl("html/views/modals/file_upload.html",function(e){t.fileUploadModal=e},{scope:t,animation:"scale-in"}),a.fromTemplateUrl("html/views/modals/progress_bar.html",function(e){t.progressBarModal=e},{scope:t,animation:"scale-in"})}t.selected=[],t.noteIds=[],console.log("note task controller"),t.canUploadFile=!1,t.loadingText="Uploading...",t.openFileUpload=function(){var o=i.getLoggedInUser();console.log("file uploading...."),console.log(o),O.checkUserRole(o,u.USER_ROLES.FILE_UPLOAD,{},!0).then(function(){h.isConnected()?t.fileUploadModal.show():e.$emit("toast-message",I.errorMessages.CONNECTION_REQUIRED)})},t.resetTaskObject=function(){t.note={},r.clearTaskObject()},t.noteListFormat=function(){t.taskObject.notes.forEach(function(e){e.dateModified=p.getDateTime(e.date_modified),e.selected=!1})},t.setNoteForm=function(){t.note={id:f.getId(),updatedBy:i.getLoggedInUser(),description:l.EMPTY,status:u.status.active,editable:!1,position:-1},t.selected=[],t.noteIds=[],t.isSelect=!1},t.editForm=function(){t.note=angular.copy(t.selected[0]),t.note.editable=!0,t.isSelect=!1},t.editNote=function(){var o={taskId:t.taskId,note:t.note};m.edit(o).then(function(t){e.$emit("toast-message",I.successMessages.NOTE_EDITED)})},t.addNote=function(){var o={taskId:t.taskId,note:t.note};m.add(o).then(function(o){d(function(){t.$broadcast("scroll.refreshComplete"),d(function(){s.$getByHandle("noteScroll").scrollBottom(!0)})},200),e.$emit("toast-message",I.successMessages.NOTE_SAVED)})},t.save=function(){r.setTaskObject(t.taskObject),t.taskObject.name?r.add(t.taskObject).then(function(o){o&&(t.resetTaskObject(),e.$emit("toast-message",I.successMessages.TASK_SAVED),k.home())}):(e.taskSaved=!0,n.go("/task/add"))},t.saveNote=function(){t.note.description&&(t.note.date_modified=Date.now(),t.taskId&&(t.note.editable?t.editNote():t.addNote()),t.taskId||(t.note.dateModified=p.getDateTime(t.note.date_modified),t.taskObject.notes.push(t.note)))},t.$on("taResize",function(e,t){d(function(){var e=document.body.querySelector(".bar-stable");if(t){var o=t[0].offsetHeight;if(e){var s=o+10;s=s>44?s:44,e.style.height=s+"px"}}})}),t.setFooterPermission=function(){for(var e=t.selected.length>1,o=t.selected[0].isFile,s=0;s<t.selected.length;s++){var n=t.selected[s].updatedBy._id===i.getLoggedInId();if(!n)break}t.copyPermission=!o&&!e,t.editPermission=!o&&!e&&n,t.deletePermission=n},t.clicked=function(e,o){var s=t.selected.indexOf(e);s>-1?(t.selected.splice(s,1),t.noteIds.splice(s,1),e.selected=!1,e.position=-1):(t.selected.push(e),t.noteIds.push(e.id),e.position=o,e.selected=!0),t.selected.length<=0?t.setNoteForm():(t.isSelect=!0,t.setFooterPermission())},t.start=function(){function a(a){a?(t.taskObject=a,t.title=a.name,t.disableModification=a.status==u.status.complete,t.setNoteForm(),t.noteListFormat(),e.$emit("task:header",n.current.state,a),d(function(){if(a.notes.length>0){var e=a.notes[a.notes.length-1].id;o.focusMe?(e=o.focusMe,T.focusTo(e,s.$getByHandle("noteScroll"))):T.scrollTo(e,s.$getByHandle("noteScroll"))}},200)):k.home()}e.rightDefaultViewVisible&&e.$emit("set-page","Task_Notes");var c=i.getLoggedInUser();O.checkUserRole(c,u.USER_ROLES.FILE_UPLOAD,{},!1).then(function(){t.canUploadFile=!0}),o.id?(t.taskId=o.id,t.addUrl="#/task/edit/"+o.id,t.noteUrl="#/task/note/"+o.id,r.findActiveTaskById(t.taskId).then(function(o){o?a(o):e.closedTask?a(e.closedTask):r.getTaskFromServer(t.taskId).then(function(t){t?a(t):e.$emit("toast-message",I.errorMessages.TASK_NOT_FOUND)},function(t){e.$emit("toast-message",t.msg)})})):(t.title="Add Note",t.taskObject=r.getTaskObject(),t.addUrl="#/task/add",t.noteUrl="#/task/note/",t.setNoteForm(),t.noteListFormat(),e.$emit("task:header")),v(),g.setTaskNoteHeader(t,o.id)},t.start(),t.uploadNoteFile=function(o){var n={file:o,id:f.getId(),updatedBy:i.getLoggedInUser(),parent:t.taskId},a=b(function(e,t){var s=i.getLoggedInUser();O.checkUserRole(s,u.USER_ROLES.FILE_STORAGE_MAX,{file:o},!0).then(e,t)});a.then(function(){t.progressBarModal.show(),m.uploadNote(n).then(function(o){o.error||(t.setNoteForm(),t.noteListFormat(),s.$getByHandle("noteScroll").scrollBottom(!0)),o&&o.results&&o.results.errors&&"LICENSE"==o.results.errors.key?N.roleWarning(null,o.results.errors).then(function(){window.cordova?$window.open(encodeURI(S.upgradeUrl),"_system","location=no"):$window.open(S.upgradeUrl,"_blank"),console.log("UPGRADE code goes here")},function(){console.log("UPGRADE CANCEL code goes here")}):e.$emit("toast-message",o.msg),t.progressBarModal.hide()})},function(t){!t||t.key&&"LICENSE"==t.key||e.$emit("toast-message",results.msg)})},t.onFileSelected=function(e){if(t.fileUploadModal.hide(),console.log(e),console.log("getting files..."),e&&e.length){var o=e[0],s=i.getLoggedInUser();O.checkUserRole(s,u.USER_ROLES.FILE_UPLOAD_SIZE,{file:o},!0).then(function(){for(var o=0;o<e.length;o++){var s=e[o];t.uploadNoteFile(s)}})}},t.deleteNote=function(){var o;o=t.selected[1]?I.infoMessages.MULTIPLE_NOTES_DELETE_CONFIRMATION:t.selected[0].isFile?I.infoMessages.SINGLE_FILE_DELETE_CONFIRMATION:I.infoMessages.SINGLE_NOTE_DELETE_CONFIRMATION,c.show({title:o.title,template:o.message,scope:t,buttons:[{text:l.NO,onTap:function(){return!0}},{text:l.YES,onTap:function(){if(t.taskId){t.note=angular.copy(t.selected[0]);var o={taskId:t.taskId,noteIds:t.noteIds};console.log(t.noteIds),m.delete(o).then(function(t){e.$emit("toast-message",I.successMessages.NOTE_DELETED)})}else{var s=t.taskObject.notes.indexOf(t.selected[0]);s>-1&&t.taskObject.notes.splice(s,1),t.setNoteForm(),t.noteListFormat(),t.selected=[],t.noteIds=[],t.isSelect=!1}}}]})},t.discardPopup=function(e,o){c.show({template:I.infoMessages.DISCARD_CHANGE.message,title:I.infoMessages.DISCARD_CHANGE.title,scope:t,buttons:[{text:l.NO,onTap:function(){return!0}},{text:l.YES,onTap:function(){t.resetTaskObject(),n.go(e.name,o)}}]})},t.copyNote=function(){e.$emit("toast-message",I.successMessages.NOTE_COPIED),t.copiedNote=angular.copy(t.selected[0].description),t.selected=[],t.noteIds=[],t.isSelect=!1,t.noteListFormat()};var L=e.$on("taskList-update",function(){r.findById(t.taskId).then(function(e){e&&(t.taskObject=e,t.setNoteForm(),t.noteListFormat())})});t.$on("$stateChangeStart",function(e,o,s){"/task/add"===o.name||"/task/edit"===o.name?r.setTaskObject(t.taskObject):(!t.taskId&&r.taskObjectHasValue()||t.note.description)&&(e.preventDefault(),t.discardPopup(o,s))}),t.toggleTab=function(t){var o=e.$broadcast("default:tabswitch");o.defaultPrevented?o.promise&&o.promise.then(function(e){e&&switchTab(t)}):switchTab(t)},t.$on("$destroy",L)}])}).call(this);
(function(){app.controller("taskFooterController",["$rootScope","$state","$scope","$ionicPopup","$ionicModal","$timeout","$ionicPopover","stringService","message","taskListView","taskService","rightMenuService","date","dbEnums","$ionicLoading","sharedData",function(e,t,s,a,o,n,c,r,u,i,l,d,g,m,f,k){function p(t,s){var a={recurrence:O.taskObject.recurrence,taskIds:i.getTaskIds()};l.bulkDueDateUpdate(a,t,s).then(function(){e.$emit("toast-message",u.successMessages.TASK_DUE_DATE_UPDATED),i.clearAllSelected()})}function T(){O.menus=d.getBottomMenu(),c.fromTemplateUrl("html/views/popovers/bottom_right_popover.html",{scope:O,animation:"slide-in-right"}).then(function(e){O.popover=e})}var O=s;O.toggleMenu=function(){return s.showMenu=!s.showMenu},O.bulkFavourites=function(){var t={isFavourite:!O.isFavourite,taskIds:i.getTaskIds()};l.bulkFavourites(t).then(function(t){t?e.$emit("toast-message",u.successMessages.TASK_ADD_TO_FAVOURITE):e.$emit("toast-message",u.successMessages.TASK_REMOVE_FROM_FAVOURITE)})},O.bulkComplete=function(){l.bulkCompleteRequest(i.getSelected()).then(function(){i.clearAllSelected()})},O.delete=function(){a.show({title:u.infoMessages.TASK_DELETE_CONFIRMATION.title,template:u.infoMessages.TASK_DELETE_CONFIRMATION.message,scope:O,buttons:[{text:r.NO,onTap:function(){return!0}},{text:r.YES,onTap:function(){var t=i.getSelected();return t.length>0&&l.delete(t,function(){i.clearAllSelected(),e.$emit("toast-message",u.successMessages.TASK_DELETED)}),!0}}]})},O.openModal=function(){O.taskObject={recurrence:{}},O.dueDateModal.show()},O.updateDueDate=function(e,t){switch(t=t||{date:!1,time:!1},e){case"TODAY":s.taskObject.recurrence={due_date:g.getDateOnly(g.today())},t.date=!0;break;case"TOMORROW":s.taskObject.recurrence={due_date:g.getDateOnly(g.tomorrow())},t.date=!0;break;case"WEEK":s.taskObject.recurrence={due_date:g.getDateOnly(g.nextWeek())},t.date=!0;break;case"MONTH":s.taskObject.recurrence={due_date:g.getDateOnly(g.nextMonth())},t.date=!0;break;case"NO_DATE":s.dueDateModal.show();break;case"CUSTOM_DATE":s.taskObject.recurrence={due_date:s.taskObject.recurrence.due_date}}"NO_DATE"!==e&&p(!t.time,!t.date)},O.getRecurrenceModel=function(e){e?(O.taskObject.recurrence=e,p()):n(function(){s.dueDateModal.show()})},O.start=function(){o.fromTemplateUrl("html/views/modals/tasks/due_date.html",function(e){O.dueDateModal=e},{scope:O,animation:"scale-in"}),T()},O.start(),O.$on("$stateChangeSuccess",function(){s.dueDateModal&&s.dueDateModal.remove(),i.clearAllSelected()});var h=e.$on("task-footer-toggle",function(){O.isFavourite=i.isAllFavourite(),e.singleSelect?s.selectedTask=i.getSingleSelected():s.selectedTask={},s.isForComplete=!1;var t=i.getSelected();t&&t.length>0&&angular.forEach(t,function(e,t){if("complete"==e.status)return s.isForComplete=!0,!1})}),D=e.$on("task:update-favourite",function(e,t){O.isFavourite=t});O.$on("$destroy",function(){h(),D()}),s.bulkReopen=function(){var t=i.getSelected(),s=[];angular.forEach(t,function(e){e.status==m.status.complete&&s.push(e)}),s.length>0&&(f.show(),l.unCompleteTasks(t).then(function(){i.clearAllSelected(),e.$emit("toast-message",u.successMessages.TASK_UNCOMPLETED),e.$emit("pull-from-server"),i.setDefaultView(),k.taskHome(s[0],s[0].id)},function(t){e.$emit("toast-message",t.msg)}).finally(function(){f.hide()}))}}])}).call(this);
(function(){app.controller("taskHeaderController",["$rootScope","$state","$scope","$ionicPopover","rightMenuService","headerService","user","sharedData","stringService","notificationService","dbEnums","$ionicHistory","navigationService","userModel",function(e,t,a,o,n,i,s,r,c,d,p,u,k,v){function f(){o.fromTemplateUrl("html/views/popovers/top_right_popover.html",{scope:l,animation:"slide-in-right"}).then(function(e){l.popover=e}),o.fromTemplateUrl("html/views/popovers/notification_popover.html",{scope:l}).then(function(e){l.notificationBar=e})}var l=a;l.type=c.EMPTY;var h={};a.items=[],v.isAuthenticated()&&d.getNoOfUnseen().then(function(e){a.NoNN=e}),l.menuItemClicked=function(e,t){l.popover.hide(),n.itemClicked(e,h,l,t)},l.start=function(){f(),n.setMenu(l.type),l.menus=n.getMenu(),l.createButtonName=i.taskHeader.createButtonName,l.createButtonLink=i.taskHeader.createButtonLink,l.noteButtonLink=i.taskHeader.noteButtonLink,l.taskObject=i.taskHeader.taskObject,l.taskId=i.taskHeader.taskId,l.createType=i.taskHeader.createType,l.addTab=i.taskHeader.addTab,l.noteTab=i.taskHeader.noteTab,l.isSaved=i.taskHeader.isSaved,l.disableModification=h&&h.status==p.status.complete},l.save=function(){i.activeScope?i.activeScope.save():t.go("/task/add")},l.back=function(){k.goBack()};var m=e.$on("task:header",function(e,t,a){l.type=t,h=a,l.start()}),g=e.$on("NoNN-update",function(e,t){a.NoNN=t,a.$$phase||a.$apply()});l.$on("$destroy",function(){m(),g()}),l.changeView=function(e,a){"task-add"==e?t.go("/task/add"):"task-edit"==e?t.go("/task/edit",{id:a}):"note"==e&&t.go("/task/note",{id:a})}}])}).call(this);
(function(){app.controller("taskListController",["$rootScope","$scope","$stateParams","$state","$timeout","sortService","stringService","filterService","sharedData","date","taskService","taskListView","$ionicLoading","labelService","project","dbEnums","settingsService","platformService","userModel","$ionicScrollDelegate","message","uiHelperService","asyncStackService","$q","$ionicLoading","$location","roleValidators",function(e,t,o,s,n,c,a,l,i,r,u,d,f,m,p,g,h,k,T,S,y,v,b,C,f,$,A){function E(){n(function(){var e=$.search().focusMe;e?v.focusTo(e,S.$getByHandle("tasksScrollHandle"),{offsetTop:20}):o.focusedTaskId&&v.focusTo(o.focusedTaskId,S.$getByHandle("tasksScrollHandle"),{offsetTop:20})},200)}function L(t){R=!0,u.removeFromBulkCompleteList(t),e.$emit("bulk-complete:response",R)}function j(){w(),U=e.$on("taskList-update",function(){t.getAll(t.type,t.object)})}function w(){U&&(U(),U=null)}function I(){var o={};if(o=angular.extend(o,K),t.canSearchCompleted||(o.limit=10),console.log(JSON.stringify(t.searchText)),t.startSearching){if(!t.searchText||t.searchText.name==a.EMPTY){console.log("cancelling search completed load");var s=C.defer();return t.completedLists=[],K.skip=0,t.$broadcast("scroll.infiniteScrollComplete"),s.reject(),s.promise}o.filter=t.searchText}return t.startSearching&&delete o.project,console.log(JSON.stringify(o)),t.searchingCompletedTasks=!0,u.getCompletedTasks(o).then(function(e){e=e||[],e.forEach(function(e){e.due=r.getDateOnly(e.recurrence.due_date)||new Date("01-01-2050"),e.recurrence.due_time=r.getTime(e.recurrence.due_date),e.isOverdued=r.isPastDay(e.recurrence.due_date),e.assignee=u.getAssignee(e),e.isComplete="complete"===e.status}),e.length>0?(t.completedLists=t.completedLists.concat(e),K.skip+=e.length,t.noMoreCompletedItemsAvailable=!1):t.noMoreCompletedItemsAvailable=!0,n(function(){t.searchingCompletedTasks=!1,S.resize(),t.$broadcast("scroll.infiniteScrollComplete"),e.length>0&&v.scrollTo(e[0].id,S.$getByHandle("tasksScrollHandle"),{offsetTop:100,animate:!0},function(){})},200)},function(o){t.searchingCompletedTasks=!1,t.$broadcast("scroll.infiniteScrollComplete"),o.msg&&e.$emit("toast-message",o.msg)}).finally(function(){})}function M(e){function o(){if(t.showCompleted)return t.searchingCompletedTasks=!1,t.noMoreCompletedItemsAvailable=!1,K.skip=0,t.completedLists=[],S.resize(),console.info("skip search : ",e),!(!t.isCompletedEnabled||t.startSearching&&!t.canSearchCompleted)&&I()}var s=N.stack(o);s.promise.then(function(){})}function B(){var e=T.getLoggedInUser();A.checkUserRole(e,g.USER_ROLES.SEARCH,{},!1).then(function(){M(!1)},function(){M(!0)})}function O(e){var t=[];return e.forEach(function(e){t.push(e.name)}),t}function P(){D(),W=e.$on("userInfo-sortOrder",function(){t.getAll(t.type,t.object)})}function D(){W&&(W(),W=null)}function H(e,o){t.completeListVisible=!0;var s=T.getLoggedInUser();A.checkUserRole(s,g.USER_ROLES.SEARCH,{},o).then(function(){t.canSearchCompleted=!0,e&&(t.isCompletedEnabled=!0)},function(){e||(t.isCompletedEnabled=!1)})}var R=!1;t.showCompleted=!1,t.noMoreCompletedItemsAvailable=!1,t.completeListVisible=!1,t.canSearchCompleted=!1,t.isCompletedEnabled=!0,t.searchingCompletedTasks=!1;var x,K={skip:0,limit:25},N=b.createStacker();t.clicked=function(e,o){d.clicked(e,t.type,o?o.shiftKey||window.fixes&&window.fixes.shiftKey:k.isMobileDevice())},t.complete=function(t,o,s){o.stopPropagation(),console.log("item status : "+t.name+"   "+t.status);var c=t.status==g.status.complete;s?n(function(){R||e.$emit("bulk-complete:response",!1),R=!1},3e3):t.status=c?g.status.active:g.status.complete,c?u.removeFromBulkCompleteList(t):u.bulkCompleteRequest([t],s).then(function(){d.clearAllSelected()})},t.getAll=function(c,a){if(s.current.state==i.STATE.CLOSED){var l=o.tasks?o.tasks.split(","):[];return u.getTasksByIds(l).then(function(s){return s&&s.length?(t.taskList=s,e.$emit("task:header-taskList",t.type,s.length,t.object),n(function(){e.$emit("update-sticky")},200),void 0):u.getCompletedTasks({tasks:o.tasks}).then(function(o){t.taskList=o,e.$emit("task:header-taskList",t.type,o.length,t.object)},function(t){e.$emit("toast-message",t.msg)}).finally(function(){})})}return u.getTasksByType(c,a).then(function(o){t.taskList=o,e.$emit("task:header-taskList",t.type,o.length,t.object),n(function(){e.$emit("update-sticky")},200)})},t.pull=function(){var o=e.$on("pull-from-server-complete",function(){t.$broadcast("scroll.refreshComplete"),o()});e.$emit("pull-from-server")},t.redirectToEdit=function(t,o){d.setDefaultView(),o&&o.status==g.status.complete?e.closedTask=o:delete e.closedTask,s.go("/task/edit",{id:t})},t.start=function(){switch(x=!!o.type,t.searchingCompletedTasks=!1,s.current.state){case i.STATE.ASSIGNEE:p.getUserFromAllProjects(o.id).then(function(n){n?(t.object=n,t.type=s.current.state,e.title=n.displayName,t.getAll(t.type,t.object).then(E),K.assignee=o.id,H(!1,!1)):i.home()});break;case i.STATE.FILTER:l.findById(o.id).then(function(o){o?(t.object=o,t.type=s.current.state,e.title=o.name,t.getAll(t.type,t.object).then(E)):i.home()});break;case i.STATE.LABEL:m.findById(o.id).then(function(o){o?(t.object=o,t.type=s.current.state,e.title=o.name,t.getAll(t.type,t.object).then(E)):i.home()});break;case i.STATE.PROJECT:p.findById(o.id).then(function(n){n?(t.object=n,e.title=n.name,t.type=s.current.state,t.getAll(t.type,t.object).then(E),K.project=o.id,H(!0,!1)):i.home()});break;case i.STATE.TASK:t.object=null,t.type=o.type,e.$emit("left-menu:selected",t.type),e.title=u.TASK_TYPE_NAME[t.type],t.getAll(t.type,t.object).then(E);break;case i.STATE.CLOSED:t.object=null,t.type="closed",e.$emit("left-menu:selected",t.type),e.title=u.TASK_TYPE_NAME[t.type],f.show(),t.getAll(t.type,t.object).finally(function(){f.hide()})}T.isAuthenticated()&&(t.allFloatButtons=h.getSettings().float_button?parseInt(h.getSettings().float_button.value):null),t.hasRightMenu=!1,t.hasFooter=!1,t.priorities=u.priorities,e.returnState=s.current,e.returnParams=o,d.clearAllSelected(),n(function(){},100)},t.taskAdd=function(){s.current.state==i.STATE.PROJECT&&u.addProjectToTaskObject(t.object),s.go("/task/add")},t.undoTaskComplete=function(e){L(e)},T.isAuthenticated()&&t.start();var U;j();var F,V=e.$on("task-footer-toggle",function(){t.hasFooter=d.isSelected()}),Y=e.$on("search:start",function(e,o){o?(F=!!t.showCompleted,t.startSearching=o,t.getAll(a.EMPTY),B(!0),console.log(o),S.$getByHandle("tasksScrollHandle").scrollTo(0,0)):(n(function(){t.showCompleted=F,F=null,t.startSearching=o,B()},500),t.getAll(t.type,t.object),t.searchText={name:a.EMPTY},console.log(o))}),J=e.$on("search:tasks",function(e,o){t.searchText={name:o},console.log("search text: ",o),console.log("startSearching: ",t.startSearching),B()}),q=e.$on("task:list-sorted",function(e){t.getAll(t.type,t.object)}),z=e.$on("$stateChangeStart",function(){e.$emit("left-menu:selected",null)});t.$on("$destroy",function(){w(),V(),J(),Y(),q(),N.clear(),W(),G(),Q(),z()}),t.clearRecentTask=function(){console.log("unsetting recentTaskId"),e.recentTaskId=void 0,console.log("unset recentTaskId")},t.loadMoreCompleted=function(e){var t=N.stack(I,[],this);t.promise.then(function(){console.log("load more")})},t.$watch("showCompleted",function(e,o){console.log("showCompleted change : "+e),e!==o&&(e===!1?(t.completedLists=[],t.noMoreCompletedItemsAvailable=!1,K.skip=0):e&&M())}),t.showHideCompleted=function(e){t.showCompleted=!t.showCompleted};var G=e.$on("task-complete",function(){M()});t.unCompleteTask=function(t){console.log(t.status),f.show(),u.unCompleteTasks(t).then(function(t){e.$emit("toast-message",y.successMessages.TASK_UNCOMPLETED),e.$emit("pull-from-server"),x&&d.setDefaultView(),i.taskHome(t[0],t[0].id)},function(o){o&&o.msg&&e.$emit("toast-message",o.msg),t.status=g.status.complete}).finally(function(){f.hide()})};var Q=e.$on("task-reopen",function(e,o){o=o||[],o.forEach(function(e){t.completedLists.forEach(function(o,s){if(o.id==e.id)return t.completedLists.splice(s,1),n(function(){console.log("focusing on task "+e.id),v.focusTo(e.id,S.$getByHandle("tasksScrollHandle"),{offsetTop:20,focusMeBackgroundSelector:".item-content"})},300),!1})})});t.completedLists=[],t.onReorder=function(e,o,s){var n=C.defer();console.log(arguments);var a=O(t.taskList);return console.log("--------old list-------"),console.log(a.join(",")),T.get(function(l){var i=c.getSortType(),r=c.getOrder().value,d=angular.copy(t.taskList);w(),u.moveTask(d,e,o,s,l,i.showDateBar,i,r).then(function(e){e=e||{};var o=e.tasks;o?(_.each(o,function(e){u.setTaskProps(e)}),e.requireSort&&(o=u.sortTasks(o,i,r,l)),t.taskList=o,console.log("--------New list-------"),a=O(o),console.log(a.join(",")),n.resolve()):n.reject()},n.reject).finally(function(){j()})}),n.promise},t.completedLists.forEach(function(e){e.due=r.getDateOnly(e.recurrence.due_date)||new Date("01-01-2050"),e.recurrence.due_time=r.getTime(e.recurrence.due_date),e.isOverdued=r.isPastDay(e.recurrence.due_date),e.assignee=u.getAssignee(e)}),t.checkScrolling=function(){console.info("scrolling"),window.cordova&&cordova.plugins&&cordova.plugins.Keyboard&&cordova.plugins.Keyboard.close()};var W;P()}])}).call(this);
(function(){app.controller("taskMyFeedController",["$rootScope","$q","$scope","taskService","connectivity","date","$ionicLoading","settingsService","project","sharedData","historyService","dbEnums","asyncStackService","$timeout",function(e,t,n,o,a,i,s,c,l,r,d,u,p,k){function f(){return a.isConnected()?d.getAllHistories(m,v,n.taskIds,n.projectIds).then(function(t){s.hide(),t.length?(t.forEach(function(e){e.icon=r.EVENT_ICONS[e.key],e.type==u.status.reopened&&(e.icon=r.EVENT_ICONS[e.type.toUpperCase()]),e.dateTime=i.getDateTime(e.date_modified),n.items.push(e)}),m+=v):n.noMoreItemsAvailable=!0,e.$broadcast("scroll.infiniteScrollComplete")}):(n.noMoreItemsAvailable=!0,void s.hide())}n.noMoreItemsAvailable=!1;var y=p.createStacker(),m=0,v=20;n.loadMore=function(){y.stack(f)},n.items=[],n.start=function(){n.title="My feeds",n.type="myFeed",s.show(),e.$emit("left-menu:selected",n.type),o.taskCount().then(function(t){e.$emit("task:header-taskList",n.type,t,null,!0)}),n.allFloatButtons=c.getSettings().float_button?parseInt(c.getSettings().float_button.value):null},n.start(),n.$on("$destroy",function(){S(),y.clear()});var S=e.$on("$stateChangeStart",function(){e.$emit("left-menu:selected",null)});n.getLink=function(e){var t="";return t="NOTE"==e.key?"#/task/note/"+e.task.id+("deleted"!=e.type?"?focusMe="+e.value.id:""):"complete"==e.type?"#/task/closed?tasks="+e.task.id:e.key==u.keys.TASK_DELETE?"javascript:void(0)":"#/task/edit/"+e.task.id+("reopen"==e.type?"?type=reopen":"")}}])}).call(this);
(function(){app.directive("activeHeader",function(){var t;return t={restrict:"A",require:["activeHeader"],controller:function(t){this.tabCheck=function(e){return e==="#"+t.path()}},compile:function(){return{pre:function(t,e,r,n){t.ah=n[0]}}}}})}).call(this);
!function(){app.directive("attachFocus",["$rootScope","$timeout",function(t,c){return{restrict:"A",link:function(o,n,i){var u=t.$on("attach-focus",function(t,o){o===i.attachFocus&&$(n).is(":visible")&&c(function(){$(n).is(":button")?$(n).click():$(n).focus()})});o.$on("$destroy",function(){u()})}}}])}();
(function(){function e(e,n){e+="";var t=["pdf"],i=[],a=[];"android"==n?a=a.concat(t):"ios"==n&&(a=a.concat(i));var l=e.lastIndexOf(".");if(l<0)return!0;var c=e.substr(l+1,3);return!(a.indexOf(c.toLowerCase())>-1)}app.directive("tdzAttachmentViewer",["$ionicModal","platformService","CONSTANT","authService",function(n,t,i,a){return{scope:{fileName:"=",fileUrl:"="},transclude:!0,require:"^tdzAttachmentViewer",template:'<div class="attachment-content"><div ng-if="isAnImage" style="height:auto"><img ng-src="{{fullFileUrl}}" class="attachment-thumbnail" ng-click="openAttachment($event)"/></br></div><span class="icon tdzicon-attach attachment-icon-left" ng-if="!isAnImage">&nbsp;<br/></span><div ng-click="openAttachment($event)" class="all-wrapped attachment-filename">{{fileName}}</div><ng-transclude></ng-transclude></div>',controller:["$scope",function(e){var n=this;n.isAnImage=function(e){var n=["jpg","gif","png","jpeg"],t=e.substring(e.lastIndexOf(".")+1).toLowerCase();return n.indexOf(t)!==-1},e.$watch("fileName",function(t,i){t!==i&&(e.isAnImage=n.isAnImage(t))}),e.$watch("fileUrl",function(n,t){if(n){var l=a.getAccessToken();e.fullFileUrl=i.file_handler_link+"/attachment?x-access-token="+l+"&url="+n}}),e.isAnImage=n.isAnImage(e.fileName)}],link:function(t,i,a,l){function c(){n.fromTemplateUrl("html/directives/shared/attachment-viewer.html",function(e){t.modal=e,t.modal.show()},{scope:t,animation:"scale-in"})}var o=l;t.openAttachment=function(e){return e.stopPropagation(),o.isAnImage(t.fileName)?(t.src=t.fullFileUrl,void c()):void t.openFile()},t.openFile=function(){if(window.cordova){console.log("opening file ::: "+t.fullFileUrl);var n=(e(t.fullFileUrl,"android"),t.fullFileUrl);window.open(encodeURI(n),"_system","location=no")}else window.open(t.fullFileUrl,"_blank")}}}}])}).call(this);
(function(){app.directive("autoFocus",["$timeout",function(o){return{restrict:"A",link:function(n,i,u){if(n.$eval(u.autoFocus)!==!1){var c=i[0];o(function(){c.focus(),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&window.cordova.plugins.Keyboard.show()},300)}}}}]),app.directive("focusInput",["$timeout",function(o){return{link:function(n,i,u){o(function(){i[0].focus(),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.show()},300)}}}])}).call(this);
(function(){app.directive("tdzAvatar",function(){var t;return t={restrict:"E",templateUrl:"html/directives/shared/avatar.html",scope:{imageSrc:"@",shortName:"@",position:"@"},replace:!0,link:function(t,i,a){t.url=t.imageSrc,t.name=t.shortName,"right"==t.position?t.itemPosition="avatar-right":t.itemPosition="avatar-left"}}})}).call(this);
!function(){app.directive("clockPicker",["date",function(e){return{restrict:"EA",require:"ngModel",scope:{datetime:"=ngModel"},link:function(n,t,o,c){$(t).clockpicker({autoclose:!1,donetext:"",appendTo:$(t),placement:"none",stayOpen:!0,change:function(n){console.log(n);var t=((n+"").split(":"),e.getTimeFromString(n));c.$setViewValue(t),console.log(t)}}),c.$render=function(){var n=$(t).data("clockpicker"),o=e.getUnFormattedTimeString(c.$modelValue);n.setClock(o)}}}}])}();
(function(){app.directive("confirmInput",function(){return{require:"ngModel",scope:{confirmInput:"=confirmInput"},link:function(n,t,i,r){n.$watch("confirmInput",function(){return r.$setValidity("confirmed",n.confirmInput===t.val())}),t.bind("propertychange keyup change paste",function(){return n.$apply(function(){return r.$setValidity("confirmed",n.confirmInput===t.val())})})}}})}).call(this);
(function(){app.directive("copyToClipboard",["$window",function(o){function c(o){i.val(o),n.append(i),i[0].select();try{var c=document.execCommand("copy");if(!c)throw c}catch(c){window.cordova&&cordova.plugins.clipboard.copy(o)}i.remove()}var n=angular.element(o.document.body),i=angular.element("<textarea/>");return i.css({position:"fixed",opacity:"0"}),{restrict:"A",link:function(o,n,i){n.bind("click",function(o){c(i.copyToClipboard)})}}}])}).call(this);
(function(){function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}app.directive("dateBar",["date",function(t){var a;return a={restrict:"E",scope:{date:"=",previousDate:"=",index:"="},link:function(a,i,r,n){function d(r){a.hasDateBar=!1;var n=new Date(e(a.date)?parseFloat(a.date):a.date);if(a.previousDate){var d=new Date(e(a.previousDate)?parseFloat(a.previousDate):a.previousDate);(n.getDate()!=d.getDate()||n.getMonth()!=d.getMonth()&&n.getFullYear()!=d.getFullYear())&&(a.hasDateBar=!0,a.display=a.date?t.getMomentDate(n):"No Date")}else(a.date||0==a.index)&&(a.hasDateBar=!0,a.display=a.date?t.getMomentDate(n):"No Date");return"Invalid date"==a.display,a.hasDateBar?i[0].outerHTML='<ion-item  class="item-divider item  date-bar">'+a.display+"</ion-item>":i[0].outerHTML="<div></div>",a.$on("$destroy",function(){window.dateBarDirectives--}),r}window.dateBarDirectives=window.dateBarDirectives||0,window.dateBarDirectives++,d()}}}])}).call(this);
!function(e){"use strict";"function"==typeof define&&define.amd?define(["angular","moment"],e):"object"==typeof exports?module.exports=e(require("angular"),require("moment")):e(window.angular,window.moment)}(function(e,t){"use strict";e.module("ui.bootstrap.datetimepicker",[]).constant("dateTimePickerConfig",{dropdownSelector:null,minView:"day",startView:"day"}).directive("datetimepicker",["$log","dateTimePickerConfig","settingsService",function(a,r,i){function n(){var e=new Date;this.utcDateValue=e.getTime(),this.selectable=!0,this.localDateValue=function(){return this.utcDateValue+localOffset};var t=["utcDateValue","localDateValue","display","active","today","selectable","past","future"];for(var a in arguments[0])t.indexOf(a)>=0&&(this[a]=arguments[0][a])}var d=function(t){var r=["startView","minView","minuteStep","dropdownSelector"];for(var i in t)if(r.indexOf(i)<0)throw"invalid option: "+i;var n=["day","month","year"];if(n.indexOf(t.startView)<0)throw"invalid startView value: "+t.startView;if(n.indexOf(t.minView)<0)throw"invalid minView value: "+t.minView;if(n.indexOf(t.minView)>n.indexOf(t.startView))throw"startView must be greater than minView";if(null!==t.dropdownSelector&&!e.isString(t.dropdownSelector))throw"dropdownSelector must be a string";null===t.dropdownSelector||"undefined"!=typeof jQuery&&"function"==typeof jQuery().dropdown||(a.error("Please DO NOT specify the dropdownSelector option unless you are using jQuery AND Bootstrap.js. Please include jQuery AND Bootstrap.js, or write code to close the dropdown in the on-set-time callback. \n\nThe dropdownSelector configuration option is being removed because it will not function properly."),delete t.dropdownSelector)};return{restrict:"E",require:"ngModel",template:'<div class="datetimepicker table-responsive"><table class="table table-striped  {{ data.currentView }}-view">   <thead>       <tr>           <th class="left-arrow" data-ng-click="changeView(data.currentView, data.leftDate, $event)" data-ng-show="data.leftDate.selectable"><i class="tdzicon-back"/></th>           <th class="switch" colspan="5" data-ng-show="data.previousViewDate.selectable" data-ng-click="changeView(data.previousView, data.previousViewDate, $event)">{{ data.previousViewDate.display }}</th>           <th class="right-arrow" data-ng-click="changeView(data.currentView, data.rightDate, $event)" data-ng-show="data.rightDate.selectable"><i class="tdzicon-forward"/></th>       </tr>       <tr>           <th class="dow" data-ng-repeat="day in data.dayNames" >{{ day }}</th>       </tr>   </thead>   <tbody>       <tr data-ng-if="data.currentView !== \'day\'" >           <td colspan="7" >              <span    class="{{ data.currentView }}"                        data-ng-repeat="dateObject in data.dates"                         data-ng-class="{active: dateObject.active, past: dateObject.past, future: dateObject.future, disabled: !dateObject.selectable}"                        data-ng-click="changeView(data.nextView, dateObject, $event)">{{ dateObject.display }}</span>            </td>       </tr>       <tr data-ng-if="data.currentView === \'day\'" data-ng-repeat="week in data.weeks">           <td data-ng-repeat="dateObject in week.dates"                data-ng-click="changeView(data.nextView, dateObject, $event)"               class="day"                data-ng-class="{active: dateObject.active,today: dateObject.today ,past: dateObject.past, future: dateObject.future, disabled: !dateObject.selectable}" >{{ dateObject.display }}</td>       </tr>   </tbody></table></div>',scope:{onSetTime:"&",beforeRender:"&"},replace:!0,link:function(a,o,u,s){var c={};u.datetimepickerConfig&&(c=a.$parent.$eval(u.datetimepickerConfig));var l={};e.extend(l,r,c),d(l);var w=function(e){var a=10*parseInt(t.utc(e).year()/10,10);return t.utc(e).year(a).startOf("year")},f={year:function(e){for(var a=t.utc(e).startOf("year"),r=10*parseInt(a.year()/10,10),i=t.utc(w(e)).subtract(1,"year").startOf("year"),d=s.$modelValue?t(s.$modelValue).year():0,o={currentView:"year",nextView:"year"===l.minView?"setTime":"month",previousViewDate:new n({utcDateValue:null,display:r+"-"+(r+9)}),leftDate:new n({utcDateValue:t.utc(i).subtract(9,"year").valueOf()}),rightDate:new n({utcDateValue:t.utc(i).add(11,"year").valueOf()}),dates:[]},u=0;u<12;u+=1){var c=t.utc(i).add(u,"years"),f={utcDateValue:c.valueOf(),display:c.format("YYYY"),past:c.year()<r,future:c.year()>r+9,active:c.year()===d};o.dates.push(new n(f))}return o},month:function(e){for(var a=t.utc(e).startOf("year"),r=w(e),i=s.$modelValue?t(s.$modelValue).format("YYYY-MMM"):0,d={previousView:"year",currentView:"month",nextView:"month"===l.minView?"setTime":"day",previousViewDate:new n({utcDateValue:r.valueOf(),display:a.format("YYYY")}),leftDate:new n({utcDateValue:t.utc(a).subtract(1,"year").valueOf()}),rightDate:new n({utcDateValue:t.utc(a).add(1,"year").valueOf()}),dates:[]},o=0;o<12;o+=1){var u=t.utc(a).add(o,"months"),c={utcDateValue:u.valueOf(),display:u.format("MMM"),active:u.format("YYYY-MMM")===i};d.dates.push(new n(c))}return d},day:function(e){for(var a=t.utc(e),r=t.utc(a).startOf("month"),d=t.utc(a).startOf("year"),o=t.utc(a).endOf("month"),u=parseInt(i.getSettings().start_day.value),c=r.day(),l=7,w=u>c?l+c-u:c-u,f=t.utc(r).subtract(Math.abs(w),"days"),p=s.$modelValue?t(s.$modelValue).format("YYYY-MMM-DD"):"",V=t().format("YYYY-MMM-DD"),v={previousView:"month",currentView:"day",nextView:"setTime",previousViewDate:new n({utcDateValue:d.valueOf(),display:r.format("MMMM - YYYY")}),leftDate:new n({utcDateValue:t.utc(r).subtract(1,"months").valueOf()}),rightDate:new n({utcDateValue:t.utc(r).add(1,"months").valueOf()}),dayNames:[],weeks:[]},m=0;m<7;m+=1)v.dayNames.push(t.utc().weekday((u+m)%l).format("dd"));for(var y=0;y<6;y+=1){for(var h={dates:[]},D=0;D<7;D+=1){var g=t.utc(f).add(7*y+D,"days"),b={utcDateValue:g.valueOf(),display:g.format("D"),active:g.format("YYYY-MMM-DD")===p,today:g.format("YYYY-MMM-DD")===V,past:g.isBefore(r),future:g.isAfter(o)};h.dates.push(new n(b))}v.weeks.push(h)}return v},setTime:function(e){var t=new Date(e),r=new Date(t.getTime()+6e4*t.getTimezoneOffset()),i=s.$modelValue;return s.$setViewValue(r),l.dropdownSelector&&jQuery(l.dropdownSelector).dropdown("toggle"),a.onSetTime({newDate:r,oldDate:i}),f[l.startView](e)}},p=function(e){var a=e?t(e).toDate():new Date;return a.getTime()-6e4*a.getTimezoneOffset()};a.changeView=function(e,t,r){if(r&&(r.stopPropagation(),r.preventDefault()),e&&t.utcDateValue>-(1/0)&&t.selectable&&f[e]){var i=f[e](t.utcDateValue),n=[];if(i.weeks)for(var d=0;d<i.weeks.length;d+=1)for(var o=i.weeks[d],u=0;u<o.dates.length;u+=1){var s=o.dates[u];n.push(s)}a.beforeRender({$view:i.currentView,$dates:i.dates||n,$leftDate:i.leftDate,$upDate:i.previousViewDate,$rightDate:i.rightDate}),a.data=i}},s.$render=function(){a.changeView(l.startView,new n({utcDateValue:p(s.$viewValue)}))}}}}])});
(function(){app.directive("tdzDatetimepicker",["$timeout","$ionicModal",function(e,t){return{require:"ngModel",scope:{ngModel:"=",canClearDate:"@",callback:"&"},link:function(a,i,d){function n(){r=!1,u=!1;var e=a.ngModel?new Date(a.ngModel):(new Date).setHours(0,0,0,0);a.datepicker={date:a.ngModel?new Date(a.ngModel):null,time:new Date(e)},l=a.$watch("datepicker.date",function(e,t){e!=t&&(r=!0,console.log("date changed to : "+e))}),o=a.$watch("datepicker.time",function(e,t){e!=t&&(u=!0,console.log("time changed to : "+e))})}function c(){l&&l(),o&&o()}a.currentTab="date";var o,l,r=!1,u=!1;i.on("click",function(){n(),t.fromTemplateUrl("html/directives/shared/datetimepicker.html",function(e){a.modal=e,a.modal.show()},{scope:a,animation:"scale-in"})}),a.discardDate=function(){a.datepicker.date=void 0},a.discardTime=function(){a.datepicker.time=new Date(a.datepicker.time.setHours(0,0,0,0))},a.save=function(){void 0!==a.datepicker.date||u?(null===a.datepicker.date&&u&&(a.datepicker.date=new Date),a.datepicker.time=new Date(a.datepicker.time),a.datepicker.date=new Date(a.datepicker.date),a.ngModel=new Date(a.datepicker.date.getFullYear(),a.datepicker.date.getMonth(),a.datepicker.date.getDate(),a.datepicker.time.getHours(),a.datepicker.time.getMinutes())):a.ngModel=void 0,c(),e(function(){a.modal.remove(),a.callback({value:r||u||void 0===a.datepicker.date?"CUSTOM_DATE":"NO_DATE",fieldsChanged:{date:r,time:u}})})},a.close=function(){c(),e(function(){a.modal.remove(),a.callback({value:"NO_DATE",fieldsChanged:{date:!1,time:!1}})})}}}}])}).call(this);
!function(){app.directive("disableSwipe",["$ionicGesture",function(e){return{restrict:"A",link:function(n,t,o){function i(e){var n=e.gesture.direction;if(console.log("gesture event"),console.log(arguments),"left"==n)return console.log("cancelling gesture left"),e.preventDefault(),!1}var r=e.on("swipe",i,t);n.$on("$destroy",function(){e.off(r,"swipe",i)})}}}])}();
(function(){app.directive("displayUserName",["userModel",function(e){return{restrict:"E",replace:!0,scope:{user:"="},transclude:!0,template:"<span>{{name}} <ng-transclude></ng-transclude> </span>",link:function(n,a,r){var s=e.getLoggedInId();n.$watch("user",function(){n.name=n.user._id==s?"Me ":n.user.displayName+" "})}}}])}).call(this);
(function(){app.directive("sortable",["$ionicGesture","$ionicScrollDelegate","$timeout",function(e,t,o){return{restrict:"A",link:function(o,n,i){function r(e,t,o,n){var i,r,s="",a=o[e];if(e<o.length)if(e>0){var l=o[e-1],c=$(l).position().top+$(l).height()+1,f=$(a).position().top+1;t-c<f-t?(s="insertAfter",r=l,i=n.index(r)):(s="insertBefore",r=a,i=n.index(r))}else s="insertBefore",r=a,i=n.index(a);else s="insertAfter",a=o[e-1],r=a,i=n.index(a);return{closestIndex:i,relativeCard:r,positionToInsert:s}}var s,a,l,c,f,d,u,p,g={draggable:i.draggable?i.draggable:".card",duration:200},h=null,v=null,x=0,m=0,I=!1,b=function(e){return $("<div></div>").css({height:e+"px",marginTop:(c>0?-m:-1)+"px"}).addClass("placeholder")},T=function(e){if(h=angular.element(e.target).closest(g.draggable),h.length||(h=null),h){a=n.find(g.draggable),l=c=a.index(h);var t=h.position(),o=e.gesture.touches[0].clientY;x=o-t.top-n.offset().top,h.css({position:"absolute",zIndex:1e3,left:t.left+"px",top:t.top+"px",width:h.outerWidth()+"px"}).addClass("dragging"),s=a.not(".dragging");var i=o-x-n.offset().top,$=r(l,i,s,a);f=$.closestIndex,d=f,m=parseInt(h.css("marginTop"))+1,u=h.outerHeight()+m,v=b(u),v.insertAfter(h),G(),p=setInterval(j,20)}},C=e.on("hold",T,n),A=function(e){if(h){e.stopPropagation(),z=e.touches?e.touches[0].clientY:e.clientY;var t=z-x-n.offset().top;h.css("top",t+"px");var o,i,l=0;s.each(function(e){var n=$(this).position().top;if(t>n&&(l=e+1,o=n,e>0)){var r=s[e-1];i=$(r).position().top+$(r).height()}});if(!I&&l!==c){c=l;var d=v;v=b(1);var p=r(l,t,s,a);p&&(v[p.positionToInsert](p.relativeCard),f=p.closestIndex),I=!0,setTimeout(function(){v&&(v.css("height",u+"px"),d.css("height",1),setTimeout(function(){d.remove(),I=!1},g.duration))},50)}}},y=e.on("touchmove",A,n),B=e.on("mousemove",A,n),Y=function(e){function t(e){h.css({position:"",zIndex:"",left:"",top:"",width:""}).removeClass("dragging"),e?v.replaceWith(h):v.remove(),v=null,h=null}h&&(clearInterval(p),l===c&&d==f||!i.sorted?t():(o.$fromIndex=l,o.$toIndex=c,o.$closestIndex=f,o.$apply(function(){var e=o[i.sorted],n=e(l,c,f);n&&n.then?n.then(function(){t(!0)},function(){t()}):t()})))},w=e.on("release",Y,n);o.$on("$destroy",function(){e.off(C,"hold",T),e.off(y,"touchmove",A),e.off(B,"mousemove",A),e.off(w,"release",Y),p&&clearInterval(p)});var z,H,P,S,W=80,k=.2,D=t,G=function(){z=-1;var e=n.closest(".scroll"),o=e.parent();H=o.height(),P=o.position().top,S=e.height()-H,$(o).attr("delegate-handle")&&(D=t.$getByHandle($(o).attr("delegate-handle")))},j=function(){var e=0;if(z>=0&&z<P+W?e=z-(P+W):z>=0&&z>H-W&&(e=z-(H-W)),0!==e){var t=D.getScrollPosition().top+k*e;t<0?t=0:t>S&&(t=S),D.scrollTo(0,t,!1)}}}}}])}).call(this);
(function(){app.directive("select2",["$timeout","$parse",function(e,i){return{restrict:"AC",require:"ngModel",scope:{placeholder:"@"},link:function(i,t,n){e(function(){t.select2({minimumResultsForSearch:1/0,placeholder:i.placeholder}),t.select2Initialized=!0});var c=function(){t.select2Initialized&&e(function(){t.trigger("change")})},l=function(){t.select2Initialized&&e(function(){t.select2("destroy"),t.select2({minimumResultsForSearch:1/0,placeholder:i.placeholder})})};if(i.$watch(n.ngModel,c),n.ngOptions){var a=n.ngOptions.match(/ in ([^ ]*)/)[1];i.$watch(a,l)}n.ngDisabled&&i.$watch(n.ngDisabled,c)}}}])}).call(this);
(function(){app.constant("msdElasticConfig",{append:""}),app.directive("msdElastic",["$timeout","$window","msdElasticConfig",function(e,t,o,r){"use strict";return{require:"ngModel",restrict:"A, C",link:function(o,n,i,a){function l(){var e=m;h=p,x=getComputedStyle(p),angular.forEach(C,function(t){e+=t+":"+x.getPropertyValue(t)+";"}),w.setAttribute("style",e)}function s(){var t,r,n,i,a;h!==p&&l(),c||(c=!0,w.value=p.value+y,w.style.overflowY=p.style.overflowY,t=""===p.style.height?"auto":parseInt(p.style.height,10),r=getComputedStyle(p).getPropertyValue("width"),"px"===r.substr(r.length-2,2)&&(i=parseInt(r,10)-P.width,w.style.width=i+"px"),n=w.scrollHeight,n>E?(n=E,a="scroll"):n<$&&(n=$),n+=P.height,p.style.overflowY=a||"hidden",t!==n&&(p.style.height=n+"px",o.$emit("elastic:resize",g)),o.$emit("taResize",g),e(function(){c=!1},1))}function d(){c=!1,s()}var p=n[0],g=n;if("TEXTAREA"===p.nodeName&&t.getComputedStyle){g.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var u=p.value;p.value="",p.value=u;var h,c,y=i.msdElastic?i.msdElastic.replace(/\\n/g,"\n"):r.append,b=angular.element(t),m="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",f=angular.element('<textarea tabindex="-1" style="'+m+'"/>').data("elastic",!0),w=f[0],x=getComputedStyle(p),v=x.getPropertyValue("resize"),V="border-box"===x.getPropertyValue("box-sizing")||"border-box"===x.getPropertyValue("-moz-box-sizing")||"border-box"===x.getPropertyValue("-webkit-box-sizing"),P=V?{width:parseInt(x.getPropertyValue("border-right-width"),10)+parseInt(x.getPropertyValue("padding-right"),10)+parseInt(x.getPropertyValue("padding-left"),10)+parseInt(x.getPropertyValue("border-left-width"),10),height:parseInt(x.getPropertyValue("border-top-width"),10)+parseInt(x.getPropertyValue("padding-top"),0)+parseInt(x.getPropertyValue("padding-bottom"),0)+parseInt(x.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},z=parseInt(x.getPropertyValue("min-height"),10),I=parseInt(x.getPropertyValue("height"),10),$=Math.max(z,I)-P.height,E=parseInt(x.getPropertyValue("max-height"),10),C=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];g.data("elastic")||(E=E&&E>0?E:9e4,w.parentNode!==document.body&&angular.element(document.body).append(w),g.css({resize:"none"===v||"vertical"===v?"none":"horizontal"}).data("elastic",!0),"onpropertychange"in p&&"oninput"in p?p.oninput=p.onkeyup=s:p.oninput=s,b.bind("resize",d),o.$watch(function(){return a.$modelValue},function(e){d()}),o.$on("elastic:adjust",function(){l(),d()}),e(s),o.$on("$destroy",function(){f.remove(),b.unbind("resize",d)}))}}}}])}).call(this);
(function(){app.directive("favouriteButton",function(){var t;return t={restrict:"AE",replace:!0,templateUrl:"html/directives/shared/favourite_button_directive.html",scope:{favourited:"@"},controller:function(t){var e;e=function(){return t.favourited=!t.favourited},t.buttonClicked=e}}})}).call(this);
!function(){app.directive("fixShiftKey",[function(){return{restrict:"A",link:function(i,n,e){function o(i){16==i.keyCode&&(window.fixes=window.fixes||{},window.fixes.shiftKey=!0)}function w(i){16==i.keyCode&&window.fixes&&delete window.fixes.shiftKey}$(window).on("keydown",o),$(window).on("keyup",w)}}}])}();
(function(){app.directive("focusMe",["$parse","$ionicScrollDelegate","$location","$timeout",function(o,e,n,c){return{restrict:"AE",link:function(o,t,a){function i(){if(!r){var o=n.search().focusMe;if(void 0!==o){var c=$("#"+o);if(c.length>0){var t=c.position(),i=t.top,f=t.left;a.focusMeOffsetTop&&(i-=parseInt(a.focusMeOffsetTop)),e.scrollTo(f,i),r=!0;var l=c;return a.focusMeBackgroundSelector&&(l=$(a.focusMeBackgroundSelector,c)),void l.animate({backgroundColor:"#e5eff7"},"fast").animate({backgroundColor:"none"},"fast").animate({backgroundColor:"#e5eff7"},"fast").animate({backgroundColor:"none"},"fast").promise().then(function(){console.log("animation complete"),console.log(c)})}console.log("element with id "+n.search().focusMe+"not found")}}}console.log("focus me called");var f,r=!1;a.watch?o.$watch(a.watch,function(o,e){void 0!==o&&(f&&c.cancel(f),f=c(function(){i()},200))}):i()}}}])}).call(this);
(function(){app.directive("tdzImagepicker",["$ionicModal","$rootScope","message","$ionicLoading","Cropper","$timeout","settingsService","userModel","guidGenerator",function(e,n,t,o,i,a,c,d,l){return{require:"ngModel",scope:{ngModel:"="},link:function(t,r,s,u){function m(){e.fromTemplateUrl("html/directives/shared/image_picker.html",function(e){t.modal=e,t.modal.show()},{scope:t,animation:"scale-in"})}function g(){t.$broadcast(t.showEvent)}t.width=300;var h,f=!1;r.on("click",function(){t.dataUrl=t.ngModel,a(m())}),t.clear=function(){t.dataUrl=null,h=null,f=!0},t.close=function(){t.dataUrl=null,t.modal.remove()},t.onFileSelected=function(e){e&&e.length&&i.encode(h=e[0]).then(function(e){t.dataUrl=e,a(g)})},t.uploadAndSave=function(){h?(o.show(),i.crop(h,data).then(function(e){return i.scale(e,{width:t.width})}).then(function(e){e.name=h.name;var t={parent:d.getLoggedInId(),id:l.getId(),file:e};c.uploadAvatar(t).then(function(e){n.$emit("toast-message",e.msg),o.hide()})})):f&&c.removeAvatar({userId:d.getLoggedInId(),avatar:null}).then(function(e){n.$emit("toast-message",e.msg),o.hide()}),t.close()},t.showEvent="show",t.hideEvent="hide",t.options={maximize:!0,aspectRatio:1,guides:!1,crop:function(e){data=e}}}}}])}).call(this);
app.directive("leftMenuEdit",["$timeout",function(t){return{restrict:"A",link:function(i,n,e){var u=n[0];n.bind("blur",function(){n.attr("disabled",!0)}),i.$watch(e.leftMenuEdit,function(i){i&&t(function(){n.removeAttr("disabled"),u.focus()})})}}}]);
(function(){app.directive("ngShiftEnter",function(){return function(n,i,t){var e={16:!1,13:!1};i.bind("keydown",function(i){i.which in e&&(e[i.which]=!0,e[16]&&e[13]&&(n.$apply(function(){n.$eval(t.ngShiftEnter,{event:i})}),i.preventDefault()))}),i.bind("keyup",function(n){n.which in e&&(e[n.keyCode]=!1)})}})}).call(this);
(function(){app.directive("notificationChannels",["userModel","stringService",function(n,e){return{restrict:"E",replace:!0,scope:{channels:"=",assignee:"="},template:"<span>{{channelList}}</span>",link:function(s,a,i){s.$watch("channels",function(){var a=[],i=n.getLoggedInId();s.channels.email.value&&a.push(s.channels.email.title),s.channels.push.value&&a.push(s.channels.push.title),a=a.join(", ");var t=a.lastIndexOf(",");t!=-1&&(a=a.substring(0,t)+" and "+a.substring(t+1)),a=a.replace(/, $/," and "),s.assignee?s.assignee._id!=i?s.channelList=e.EMPTY:s.channelList=a+": ":s.channelList=a})}}}])}).call(this);
!function(){app.directive("passwordValidation",["$q","user","connectivity",function(n,e,i){return{require:"ngModel",link:function(r,t,o,c){c.$asyncValidators.password=function(r,t){if(c.$isEmpty(r)||!i.isConnected())return $.when();var o=n.defer();return e.validatePassword(r).then(function(n){n?o.resolve():o.reject()},function(n){o.reject()}),o.promise}}}}])}();
(function(){app.directive("tdzRecurrencepicker",["$timeout","$ionicModal","settingsService","date","dueService",function(e,r,c,n,a){return{require:"ngModel",scope:{ngModel:"=",callback:"&"},link:function(t,i,o){function u(){t.recurrencePicker={isRecurring:!0,repeat:t.ngModel.repeat||a.REPEAT_KEY.DAILY,every:t.ngModel.every||1,starts_on:t.ngModel.starts_on||new Date,repeatBy:t.ngModel.repeatBy||0,repeatOn:d(),repeatEnd:t.ngModel.repeatEnd||{id:0,end:null,occurrence:null,remainingOccurrence:null}},t.repeats=a.REPEAT_ITEMS,t.repeatByList=a.REPEAT_BY_ITEMS,t.repeatByList[t.recurrencePicker.repeatBy].checked=!0,t.start_on_display=n.getDateTime(t.recurrencePicker.starts_on),t.updateSummary()}function d(){var e=c.getSettings().start_day.value,r=angular.copy(a.REPEAT_ON_ITEMS);t.ngModel.repeatOn&&_.each(r,function(e){var r=_.find(t.ngModel.repeatOn||[],function(r){return r.title==e.title});r&&(e.checked=r.checked)});for(var n=angular.copy(r),i=0;i<e;i++)r.push(n[i]);return r.splice(0,e),r}function l(){r.fromTemplateUrl("html/directives/shared/repeat.html",function(e){t.repeatModal=e},{scope:t,animation:"scale-in"}),r.fromTemplateUrl("html/directives/shared/repeat_every.html",function(e){t.repeatEveryModal=e},{scope:t,animation:"scale-in"}),r.fromTemplateUrl("html/directives/shared/recurrence_picker.html",function(e){t.modal=e,t.modal.show()},{scope:t,animation:"scale-in"})}function p(){t.repeatEveryModal.remove(),t.repeatModal.remove(),t.modal.remove()}i.on("click",function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!1),u(),l()}),t.save=function(){var r={isRecurring:!0,repeat:t.recurrencePicker.repeat,every:t.recurrencePicker.every,starts_on:t.recurrencePicker.starts_on||new Date,repeatEnd:t.recurrencePicker.repeatEnd};t.recurrencePicker.repeat===a.REPEAT_KEY.WEEKLY&&(r.repeatOn=t.recurrencePicker.repeatOn),t.recurrencePicker.repeat===a.REPEAT_KEY.MONTHLY&&(r.repeatBy=t.recurrencePicker.repeatBy,r.weekNumber=t.recurrencePicker.weekNumber),t.ngModel=angular.copy(r),p(),e(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!0),t.callback({model:t.ngModel})})},t.close=function(){p(),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.disableScroll(!0),t.callback()},t.setStartOn=function(e){e&&(t.start_on_display=n.getDateTime(t.recurrencePicker.starts_on),t.updateSummary())},t.setEndDate=function(e){e&&(t.end_display=n.getDateTime(t.recurrencePicker.repeatEnd.end),t.setRepeatEnd())},t.setRepeat=function(e){t.recurrencePicker.repeat=e,t.updateSummary(),t.repeatModal.hide()},t.setRepeatEvery=function(e){t.recurrencePicker.every=e,t.updateSummary(),t.repeatEveryModal.hide()},t.setRepeatBy=function(){if(t.recurrencePicker.repeatBy){var e=new Date;e.setDate(1);for(var r=0;r<7&&e.getDay()!=t.recurrencePicker.starts_on.getDay();r++)e.setDate(e.getDate()+1);t.recurrencePicker.weekNumber=(t.recurrencePicker.starts_on.getDate()-e.getDate())/7}t.updateSummary()},t.setRepeatEnd=function(){switch(t.recurrencePicker.repeatEnd.id){case 0:t.recurrencePicker.repeatEnd={id:0,end:null,occurrence:null,remainingOccurrence:null};break;case 1:t.recurrencePicker.repeatEnd={id:1,end:null,occurrence:t.recurrencePicker.repeatEnd.occurrence,remainingOccurrence:t.recurrencePicker.repeatEnd.occurrence};break;case 2:t.recurrencePicker.repeatEnd={id:2,end:t.recurrencePicker.repeatEnd.end,occurrence:null,remainingOccurrence:null}}console.log(t.recurrencePicker.repeatEnd),t.updateSummary()},t.updateSummary=function(){t.summary=a.getSummary(t.recurrencePicker),t.recurrencePicker.repeatEnd&&t.recurrencePicker.repeatEnd.end&&(t.end_display=n.getDateTime(t.recurrencePicker.repeatEnd.end))}}}}])}).call(this);
(function(){app.directive("stickyHeader",["$ionicPosition","$compile","$rootScope",function(e,t,n){return{restrict:"A",require:"^$ionicScroll",link:function(o,i,l,a){var r,s=angular.element(a.element),c=ionic.Platform.isIOS()?90:ionic.Platform.isAndroid()?70:5,f=function(e,t){for(var n=e.getElementsByTagName("textarea"),o=t.getElementsByTagName("textarea"),i=e.getElementsByTagName("select"),l=t.getElementsByTagName("select"),a=0,r=n.length;a<r;++a)o[a].value=n[a].value;for(var a=0,r=i.length;a<r;++a)l[a].value=i[a].value},u=function(n){r=n.clone().css({position:"absolute",top:e.position(s).top+"px",left:0,right:0}),l.ionStickyClass=l.ionStickyClass?l.ionStickyClass:"assertive",f(n[0],r[0]),r[0].className+=" "+l.ionStickyClass,r.removeAttr("ng-repeat-start").removeAttr("ng-if"),s.parent().append(r),t(r)(o)},g=function(){r&&r.remove(),r=null};o.$on("$destroy",function(){g(),angular.element(a.element).off("scroll")});var m,p=ionic.throttle(function(t){for(var n=null,o=[],l=i[0].getElementsByClassName("item-divider"),a=0;a<l.length;++a)o.push(angular.element(l[a]));for(var a=0;a<o.length;++a)if(e.offset(o[a]).top-o[a].prop("offsetHeight")<c&&(a===o.length-1||e.offset(o[a+1]).top-(o[a].prop("offsetHeight")+o[a+1].prop("offsetHeight"))>c)){n=o[a][0];break}(m!=n||t)&&(g(),m=n,null!=n&&u(angular.element(n)))},200);s.on("scroll",function(e){p()}),n.$on("update-sticky",function(){p(!0)})}}}])}).call(this);
(function(){app.directive("tdzReminderpicker",["$timeout","$ionicModal","settingsService","userModel","date","guidGenerator","reminderService","message","$q","dbEnums","roleValidators",function(e,i,n,a,r,t,d,o,l,m,s){return{require:"ngModel",scope:{ngModel:"=",assignees:"=",dueDate:"=",callback:"&",isEmailEnabled:"=",defaultReminderChannels:"="},link:function(c,u,f){function h(){i.fromTemplateUrl("html/directives/shared/tdz-reminderpicker/reminder.html",function(e){c.modal=e,c.modal.show()},{scope:c,animation:"scale-in"}),i.fromTemplateUrl("html/directives/shared/tdz-reminderpicker/assignees.html",function(e){c.userModal=e},{scope:c,animation:"scale-in"}),i.fromTemplateUrl("html/directives/shared/tdz-reminderpicker/notification-channels.html",function(e){c.notificationChannelModal=e},{scope:c,animation:"scale-in"}),i.fromTemplateUrl("html/directives/shared/tdz-reminderpicker/reminder-time.html",function(e){c.reminderTimeModal=e},{scope:c,animation:"scale-in"})}function g(){c.reminder=c.ngModel||E,c.noDueDate=!c.dueDate,c.isDifferentUser=!1,c.valid=!0,c.notificationChannels=angular.copy(c.defaultReminderChannels||d.notificationChannels),c.isEmailEnabled||(c.notificationChannels.email.value=!1,c.notificationChannels.email.notified=!0,c.notificationChannels.push.value=!0,c.notificationChannels.push.notified=!1),c.reminderTime=d.timeDuration,c.reminder.assignee=C,c.reminder.notificationChannels=angular.copy(c.notificationChannels),c.users=angular.copy(c.assignees),c.users.splice(0,1),c.users.length||c.users.push(a.getLoggedInUser())}function v(){c.reminder.dateTime=new Date;var e=new Date(T.reminder.defaultTime);c.reminder.dateTime.setHours(e.getHours()),c.reminder.dateTime.setMinutes(e.getMinutes())}function p(){var e=moment(new Date);if(c.valid=!!c.reminder.time,c.validationError=o.errorMessages.REMINDER_TIME_REQUIRED,c.valid&&1==c.reminder.time.id&&e.diff(c.reminder.time.value)>R)c.valid=!1,c.validationError=o.errorMessages.REMINDER_TIME_VALIDATION_ERROR_FOR_FIXED;else if(c.valid&&0==c.reminder.time.id){var i=d.getScheduledTime(c.reminder,c.dueDate);r.isAfter(i,e)||(c.valid=!1,c.validationError=o.errorMessages.REMINDER_TIME_VALIDATION_ERROR_FOR_RELATIVE)}}var E={},R=-12e4,M=null,T=n.getSettings(),C=a.getLoggedInUser();u.on("click",function(){g(),h(),v()}),c.addChannels=function(){(c.notificationChannels.email.value||c.notificationChannels.push.value)&&(c.reminder.notificationChannels=angular.copy(c.notificationChannels),c.notificationChannelModal.hide())},c.channelClicked=function(e){var i=l(function(i,n){if("Email"==e.title&&0==e.value){var r=a.getLoggedInUser();s.checkUserRole(r,m.USER_ROLES.EMAIL_NOTIFICATIONS,{},!0).then(i,n)}else i()});i.then(function(){e.value=!e.value,e.notified=!e.value})},c.openNotificationChannelModal=function(){c.notificationChannels=angular.copy(c.reminder.notificationChannels),c.notificationChannelModal.show()},c.updateAssignee=function(e){c.reminder.assignee=e,c.isDifferentUser=C._id!=e._id},c.updateReminderDate=function(e){"CUSTOM_DATE"==e?(c.reminder.time.id=1,c.reminder.time.value=angular.copy(c.reminder.dateTime),c.reminder.time.title=r.getDateTime(c.reminder.time.value),M=angular.copy(c.reminder.time),v(),p()):c.reminder.time=angular.copy(M)},c.updateReminderTime=function(e){e?(c.reminder.time=angular.copy(e),c.reminder.time.id=0,M=angular.copy(c.reminder.time),p()):c.reminder.time=angular.copy(M),c.reminderTimeModal.hide()},c.save=function(){p(),c.valid&&(c.reminder.id=t.getId(),c.reminder.updatedBy=a.getLoggedInUser(),c.reminder.date_created=new Date,c.ngModel=c.reminder,e(function(){c.modal.remove(),c.callback({newReminder:!0})}))},c.close=function(){c.modal.remove(),c.callback({newReminder:!1})},c.$watch("reminder.time.id",function(e){0!=e&&1!=e||(c.valid=!0)})}}}])}).call(this);
(function(){app.directive("tdzTimepicker",["$timeout","$ionicModal",function(e,n){return{require:"ngModel",scope:{ngModel:"=",canClearDate:"@",callback:"&"},link:function(i,c,o){function l(){i.picker={time:i.ngModel?new Date(i.ngModel):new Date}}c.on("click",function(){l(),n.fromTemplateUrl("html/directives/shared/timepicker.html",function(e){i.modal=e,i.modal.show()},{scope:i,animation:"scale-in"})}),i.save=function(){i.ngModel=new Date(i.picker.time),e(function(){i.modal.remove(),i.callback({newTime:!0})})},i.close=function(){i.modal.remove(),i.callback({newTime:!1})}}}}])}).call(this);
(function(){app.directive("uiTimepicker",["moment",function(t){return{restrict:"EA",require:"ngModel",scope:{datetime:"=ngModel"},replace:!0,template:"<div></div>",link:function(a,e,r){function n(a){return"AM"===t(a).format("A")}function i(){c=d=f-v.right-v.left-v.top-v.bottom,o=p=c/2,g=.2*c,m.outerRadius(c/2),m.innerRadius(c/2*.85)}function s(e,r,n,i){var s=Math.min((y-x)/(M-x),1),d=Math.min(360*s,360)*Math.PI/180;m.endAngle(d),e.attr("d",m);var o=360*y/M,p=c/2-5,l=p*Math.cos((o-90)*Math.PI/180),h=p*Math.sin((o-90)*Math.PI/180);r.attr("cx",l).attr("cy",h);var u=t(a.datetime).hours(),f=u>=12?u-12:u,v=t(a.datetime).minutes(),g=""+f+":";v<10&&(g+="0"),g+=v,n.text(g),i.text(t(a.datetime).format("A"))}var c,d,o,p,l=d3.select(e[0]),m=d3.svg.arc().startAngle(0*(Math.PI/180)).endAngle(360*(Math.PI/180)),h=245,u=h,f=h,v={top:15,right:10,bottom:10,left:15},g=10,x=1,M=720,y=1,k=!1;l.each(function(e){i();var r=d3.select(this).selectAll("svg").data([e]),l=r.enter().append("svg").attr("class","x1-timepicker-svg").append("g").attr("transform","translate("+v.left+","+v.top+")");r.attr("width",h).attr("height",u);var f=l.append("g").attr("class","x1-timepicker-component"),x=(f.append("circle").attr("class","x1-timepicker-inner").attr("transform","translate("+o+","+p+")").attr("cx",0).attr("cy",0).attr("r",c/2),f.append("path").attr("transform","translate("+o+","+p+")").attr("d",m),l.append("g").attr("class","x1-timepicker-arcs")),A=x.append("path").attr("class","arc").attr("transform","translate("+o+","+p+")").attr("d",m),I=l.append("g").attr("class","x1-timepicker-labels"),P=I.append("text").attr("class","time").attr("x",o).attr("y",p+g/3).attr("width",c).style("font-size",1.4*g+"px"),F=I.append("text").attr("class","ampm").attr("cursor","pointer").attr("x",o).attr("y",c/1.4+g/3).attr("width",c).style("font-size",.6*g+"px").on("click",function(){var e=n(a.datetime),r=e?12:-12;k=!e,a.datetime=t(a.datetime).add(r,"hour").toDate(),d3.select(this).text(t(a.datetime).format("A")),a.$apply()}),b=d3.behavior.drag().on("drag",function(){var e=d3.event.x,r=d3.event.y,n=(Math.PI*c,0),i=0,o=e-c/2,p=d/2-r,l=(p-i)/(o-n),m=Math.abs(Math.atan(l)/(Math.PI/180)),h=0;o>0&&p>=0?h=90-m:o>=0&&p<0?h=90+m:o<0&&p<=0?h=270-m:o<=0&&p>0&&(h=270+m),y=M*(h/360);var u=Math.floor(y/60);u=k?u:u+12,a.datetime=t(a.datetime).set("hour",u).set("minute",y%60).set("second",0).toDate(),a.$apply(function(){s(A,w,P,F)})}),w=l.append("g").append("circle").attr("class","x1-timepicker-handler").attr("cursor","pointer").attr("transform","translate("+o+","+p+")").attr("cx",0).attr("cy",0).attr("r",18).attr("fill","#FFFFFF").call(b),$=function(a){var e=t(a).hours(),r=e>=12?e-12:e,n=t(a).minutes();y=60*r+n,s(A,w,P,F)};$(a.datetime),k=n(a.datetime),a.$watch("datetime",function(t,a){$(t)})})}}}])}).call(this);
(function(){app.service("filterService",["$q","$window","$rootScope","labelService","date","filterModel","dbEnums","message","sync",function(e,r,t,n,a,i,s,o,c){function u(e,r){for(var t=0;t<r.length;t++)if(e.project.id===r[t]._id)return!0;return!1}function d(e,r){for(var t=null,n=0;n<e.users.length;n++)if(e.users[n].role===s.taskUserRole.assignee&&e.users[n]._id||0==e.project.id&&e.users[n].role==s.taskUserRole.admin){t=e.users[n];break}for(var a=0;a<r.length;a++)if(t&&t._id===r[a]._id)return!0;return!1}function l(e,r){for(var t=0;t<r.length;t++)if(e.priority===r[t].number)return!0;return!1}function f(e,r){var t=!1;return r.forEach(function(r){n.findById(r._id).then(function(r){r&&n.isTaskExists(e,r)&&(t=!0)})}),t}function h(e,r){var t=!1;switch(r){case _.dueDates[0]:e.recurrence.due_date||(t=!0);break;case _.dueDates[1]:a.isPastDay(e.recurrence.due_date)&&(t=!0);break;case _.dueDates[2]:a.isToday(e.recurrence.due_date)&&(t=!0);break;case _.dueDates[3]:a.isTomorrow(e.recurrence.due_date)&&(t=!0);break;case _.dueDates[4]:a.isInNextNDays(e.recurrence.due_date,2)&&(t=!0);break;case _.dueDates[5]:a.isInNextNDays(e.recurrence.due_date,3)&&(t=!0);break;case _.dueDates[6]:a.isInNextNDays(e.recurrence.due_date,5)&&(t=!0);break;case _.dueDates[7]:a.isInNextNDays(e.recurrence.due_date,7)&&(t=!0);break;case _.dueDates[8]:a.isInNextNDays(e.recurrence.due_date,14)&&(t=!0);break;case _.dueDates[9]:a.isInNextNMonths(e.recurrence.due_date,1)&&(t=!0);break;case _.dueDates[10]:a.isInNextNMonths(e.recurrence.due_date,6)&&(t=!0);break;case _.dueDates[11]:a.isInNextNYears(e.recurrence.due_date,1)&&(t=!0)}return t}function p(e,r){return r.allProjects||!r.allProjects&&0==r.projects.length||u(e,r.projects)}function v(e,r){return r.allAssignees||!r.allAssignees&&0==r.assignees.length||d(e,r.assignees)}function m(e,r){return r.allPriorities||!r.allPriorities&&0==r.priorities.length||l(e,r.priorities)}function b(e,r){return r.allLabels||!r.allLabels&&0==r.labels.length||f(e,r.labels)}function y(e,r){return!r.due_date||h(e,r.due_date)}var _=this;_.addOrUpdate=function(r){var t=e.defer();return c.add(s.collections.Filter,r,s.events.Filter.addOrUpdate),i.addOrUpdate(r,function(e,r){t.resolve(r)}),t.promise},_.findById=function(r){var t=e.defer();return i.findById(r,function(e,r){t.resolve(r)}),t.promise},_.getAll=function(){var r=e.defer();return i.getAll(function(e,t){r.resolve(t)}),r.promise},_.delete=function(r){var t=e.defer();return c.add(s.collections.Filter,r,s.events.Filter.delete),i.delete(r.id,function(e,r){t.resolve(r)}),t.promise},_.removeProjectFromAllFilters=function(e){i.getAll(function(r,t){t.forEach(function(r){r.projects.forEach(function(t,n){t._id==e.id&&r.projects.splice(n,1)})}),i.bulkUpdate(t,function(){})})},_.updateItem=function(e){e.status===s.status.active?i.addOrUpdate(e,function(e,r){}):e.status===s.status.deleted&&i.delete(e.id,function(e,r){})},_.setProjects=function(e){var r=[];return e.forEach(function(e){e.checked&&r.push({_id:e.project.id,name:e.project.name,color:e.project.color})}),r},_.setAssignees=function(e){var r=[];return e.forEach(function(e){e.checked&&r.push({_id:e.assignee._id,displayName:e.assignee.displayName,displayShortName:e.assignee.displayShortName,email:e.assignee.email,avatar:e.assignee.avatar})}),r},_.setPriorities=function(e){var r=[];return e.forEach(function(e){e.checked&&r.push({name:e.priority.name,number:e.priority.number,color:e.priority.color})}),r},_.setLabels=function(e){var r=[];return e.forEach(function(e){e.checked&&r.push({_id:e.label.id,name:e.label.name,color:e.label.color})}),r},_.isTaskExists=function(e,r){var t=p(e,r),n=v(e,r),a=m(e,r),i=b(e,r),s=y(e,r);return t&&n&&a&&i&&s},_.fields=[{project:!1,people:!1,priority:!1,label:!1,dueDate:!1}],_.dueDates=["No date","Overdue","Today","Tomorrow","Within 2 days","Within 3 days","Within 5 days","Within 1 week","Within 2 weeks","Within 1 month","Within 6 months","Within 1 year"]}])}).call(this);
(function(){app.service("historyService",["$q","$http","taskService","connectivity","API","RESPONSE_CODE","message","userModel",function(e,r,s,o,t,i,n,a){var l=this;l.getAllHistories=function(s,l){var c=e.defer();if(o.isConnected()){var u={skip:s,limit:l,userId:a.getLoggedInId()};r.post(t.history.GET.all,u).success(function(e){e.response_code===i.SUCCESS?c.resolve(e.data):e.response_code===i.ERROR&&c.resolve({error:!0,msg:n.errorMessages[e.errors.value],results:e})}).error(function(e){c.resolve({error:!0,msg:n.errorMessages.GENERAL,results:e})})}else c.resolve({error:!0,msg:n.errorMessages.CONNECTION_REQUIRED});return c.promise},l.getHistoriesByTaskId=function(s,a,l){var c=e.defer();if(o.isConnected()){var u={skip:a,limit:l,taskIds:[s]};r.post(t.history.GET.historiesByTask,u).success(function(e){e.response_code===i.SUCCESS?c.resolve(e.data):e.response_code===i.ERROR&&c.resolve({error:!0,msg:n.errorMessages[e.errors.value],results:e})}).error(function(e){c.resolve({error:!0,msg:n.errorMessages.GENERAL,results:e})})}else c.resolve({error:!0,msg:n.errorMessages.CONNECTION_REQUIRED});return c.promise}}])}).call(this);
(function(){app.service("labelService",["$rootScope","$q","sharedData","sync","dbEnums","roleValidators","labelModel","userModel",function(e,t,n,a,s,i,l,d){var o=this;o.addOrUpdate=function(e){var n=t.defer(),o=d.getLoggedInUser();return i.checkUserRole(o,[s.USER_ROLES.LABELS],{label:e,user:o},!0).then(function(){console.log("lbl added "+e.name),a.add(s.collections.Label,e,s.events.Label.addOrUpdate),l.addOrUpdate(e,function(e,t){n.resolve(t)})},n.reject),n.promise},o.addTaskToLabels=function(e,t){e.forEach(function(e){if(e.checked&&!o.isTaskExists(t,e.label))e.label.tasks.push(t),l.addOrUpdate(e.label,function(e,t){});else if(!e.checked&&o.isTaskExists(t,e.label)){var n=e.label.tasks.indexOf(t);e.label.tasks.splice(n,1),l.addOrUpdate(e.label,function(e,t){})}})},o.addLabelsOnTask=function(e,n){return t(function(a,s){var i=t(function(e,t){e()});_.each(e,function(e){o.isTaskExists(n.id,e)||(i=i.then(function(){return t(function(t,a){e.tasks.push(n.id),l.addOrUpdate(e,function(e,n){t()})})}))}),i.then(a,s)})},o.delete=function(e){var n=t.defer();return a.add(s.collections.Label,e,s.events.Label.delete),l.delete(e.id,function(e,t){n.resolve(t)}),n.promise},o.findById=function(e){var n=t.defer();return l.findById(e,function(e,t){n.resolve(t)}),n.promise},o.getAll=function(){var e=t.defer();return l.getAll(function(t,n){e.resolve(n)}),e.promise},o.isTaskExists=function(e,t){for(var n=0;n<t.tasks.length;n++)if(t.tasks[n]==e)return!0;return!1},o.removeTaskFromAllLabels=function(e){l.getAll(function(t,n){n.forEach(function(t){t.tasks.forEach(function(n,a){n==e.id&&t.tasks.splice(a,1)})}),l.bulkUpdate(n,function(){})})},o.updateItem=function(e){e.status===s.status.active?l.addOrUpdate(e,function(e,t){}):e.status===s.status.deleted&&l.delete(e.id,function(e,t){})},o.reOrderLabelList=function(e,t){}}])}).call(this);
(function(){app.service("noteService",["$http","$q","$rootScope","taskModel","Upload","sync","dbEnums","connectivity","RESPONSE_CODE","message","API","userModel",function(e,o,s,t,r,n,d,a,i,c,l,u){function f(e,o){for(var s=0;s<e.length;s++)if(e[s].id==o){e.splice(s,1);break}return e}var p=this;p.add=function(e){var s=o.defer();return t.findById(e.taskId,function(o,r){e.note.date_modified=new Date,r.notes.push(e.note),n.add(d.collections.Task,{task:r,note:e.note},d.events.Task.addNote),t.addOrUpdate(r,function(e,o){s.resolve(o)})}),s.promise},p.edit=function(e){var s=o.defer();return t.findById(e.taskId,function(o,r){for(var a=0;a<r.notes.length;a++)if(r.notes[a].id===e.note.id){r.notes[a].description=e.note.description,r.notes[a].date_modified=new Date;break}n.add(d.collections.Task,{task:r,note:e.note},d.events.Task.updateNote),t.addOrUpdate(r,function(e,o){s.resolve(o)})}),s.promise},p.delete=function(e){var s=o.defer();return t.findById(e.taskId,function(o,r){e.noteIds.forEach(function(e){r.notes=angular.copy(f(r.notes,e))}),r.date_modified=Date.now(),n.add(d.collections.Task,{task:r,noteIds:e.noteIds,updatedBy:u.getLoggedInUser()},d.events.Task.deleteNote),t.addOrUpdate(r,function(e,o){s.resolve(o)})}),s.promise},p.uploadNote=function(e){var t=o.defer();return a.isConnected()?r.upload({url:l.task.uploadNote,fields:e,file:e.file}).progress(function(e){var o=parseFloat(e.loaded),t=parseFloat(e.total);s.progressPercentage=100*(o/(2*t)),console.log(s.progressPercentage)}).success(function(e){console.log(e),e.response_code==i.SUCCESS?(s.progressPercentage=100,t.resolve({error:!1,msg:c.successMessages.ATTACHMENT_ADDED})):e.response_code===i.ERROR&&t.resolve({error:!0,msg:c.errorMessages[e.errors.value],results:e})}).error(function(e){t.resolve({error:!0,msg:c.errorMessages.GENERAL,results:e})}):t.resolve({error:!0,msg:c.errorMessages.CONNECTION_REQUIRED}),t.promise}}])}).call(this);
(function(){app.service("notificationService",["$rootScope","$q","$http","API","RESPONSE_CODE","message","connectivity","userModel","notificationModel",function(e,o,r,s,n,t,i,c,f){var u=this;u.getAllNotificationsByUserId=function(e,f){var u=o.defer();if(i.isConnected()){var a={skip:e,limit:f,userId:c.getLoggedInId()};r.post(s.notification.getByUserId,a).success(function(e){e.response_code===n.SUCCESS?u.resolve(e.data):e.response_code===n.ERROR&&u.resolve({error:!0,msg:t.errorMessages[e.errors.value],results:e})}).error(function(e){u.resolve({error:!0,msg:t.errorMessages.GENERAL,results:e})})}else u.resolve({error:!0,msg:t.errorMessages.CONNECTION_REQUIRED});return u.promise},u.getNotifications=function(){var e=o.defer();return f.getAll(function(o,r){e.resolve(r)}),e.promise},u.getNoOfUnseen=function(){var e=o.defer();return f.getNoOfUnseen(function(o,r){e.resolve(r)}),e.promise},u.seenNotifications=function(){i.isConnected()&&r.post(s.notification.seen,{userId:c.getLoggedInId()}),f.bulkSeen(function(){})}}])}).call(this);
(function(){app.service("project",["$http","$rootScope","$q","$state","RESPONSE_CODE","connectivity","message","API","sharedData","dbEnums","guidGenerator","projectModel","sync","userModel","filterService","taskService","userRoleValidator","roleValidators",function(e,r,t,o,s,n,d,i,c,u,a,l,f,v,g,p,I,j){var m=this;m.addOrUpdate=function(e,r){var o=t.defer();v.getLoggedInUser();return f.add(u.collections.Project,{project:e,update:r},u.events.Project.addOrUpdate),l.addOrUpdate(e,function(e,r){o.resolve(r)}),o.promise},m.archive=function(e){e.users.forEach(function(e){e._id===v.getLoggedInId()&&(e.status=u.status.archived)});var r=t.defer();return f.add(u.collections.Project,{userId:v.getLoggedInId(),project:e},u.events.Project.archive),l.addOrUpdate(e,function(e,t){r.resolve(t)}),r.promise},m.delete=function(e){var r=t.defer();return e.updatedBy=v.getLoggedInUser(),f.add(u.collections.Project,e,u.events.Project.delete),l.delete(e.id,function(t,o){g.removeProjectFromAllFilters(e),p.removeTasksByProjectId(e),r.resolve()}),r.promise},m.deleteUser=function(e,r){e.users.forEach(function(e,t,o){e.email===r.email&&o.splice(t,1)});var o=t.defer();return f.add(u.collections.Project,{deletedUser:r,projectId:e.id},u.events.Project.deleteUser),l.addOrUpdate(e,function(e,r){o.resolve(r)}),o.promise},m.findById=function(e){var r=t.defer();return l.findById(e,function(e,t){r.resolve(t)}),r.promise},m.getAll=function(){var e=t.defer();return l.getAll(function(r,t){e.resolve(t)}),e.promise},m.getAllArchived=function(){var e=t.defer();return l.getAllArchived(function(r,t){e.resolve(t)}),e.promise},m.getAllProjectsUsers=function(){var e=[],r=[],o=t.defer();return l.getAll(function(t,s){s.forEach(function(t){for(var o=0;o<t.users.length;o++){var s=t.users[o];r[s._id]||(e.push(s),r[s._id]=!0)}}),o.resolve(e)}),o.promise},m.getUserFromAllProjects=function(e){var r=t.defer();return m.getAllProjectsUsers().then(function(t){for(var o=null,s=0;s<t.length;s++)if(t[s]._id==e){o=t[s];break}r.resolve(o)}),r.promise},m.getProjectUserById=function(e,r){for(var t=0;t<e.users.length;t++)if(e.users[t]._id===r)return e.users[t]},m.getProjectAdmin=function(e){for(var r=0;r<e.users.length;r++)if(e.users[r].isAdmin)return e.users[r]},m.getUserRole=function(e,r){for(var t=0;t<e.users.length;t++)if(e.users[t]._id===r)return e.users[t].role},m.left=function(e){var r=t.defer();return f.add(u.collections.Project,{userId:v.getLoggedInId(),project:e},u.events.Project.left),l.delete(e.id,function(t,o){g.removeProjectFromAllFilters(e),p.removeTasksByProjectId(e),r.resolve()}),r.promise},m.reorder=function(e,r){e.forEach(function(e,r){e.users.forEach(function(e){e._id==v.getLoggedInId()&&e.status===u.status.active&&(e.order=r)})}),f.add(u.collections.Project,{projects:e,userId:v.getLoggedInId()},u.events.Project.reorder),l.bulkUpdate(e,!0,r)},m.reSendInvitation=function(r){var o=t.defer();return n.isConnected()?e.post(i.project.reSendInvitation,r).success(function(e){e.response_code===s.SUCCESS?o.resolve({error:!1,message:d.successMessages.PROJECT_INVITATION_RESENT}):e.response_code===s.ERROR&&o.resolve({error:!0,message:d.errorMessages[e.errors.value]})}).error(function(){o.resolve({error:!0,message:d.errorMessages.CONNECTION_ERROR})}):o.resolve({error:!0,message:d.errorMessages.CONNECTION_ERROR}),o.promise},m.sendInvitation=function(e,r){var o=t.defer();return delete r.accessToken,delete r.accessTokenExpired,delete r.approvalToken,e.users.push(r),f.add(u.collections.Project,{projectId:e.id,invitedUser:r},u.events.Project.sendInvitation),l.addOrUpdate(e,function(e,r){o.resolve(r)}),o.promise},m.unArchive=function(e){e.users.forEach(function(e){e._id===v.getLoggedInId()&&(e.status=u.status.active)});var r=t.defer();return f.add(u.collections.Project,{userId:v.getLoggedInId(),project:e},u.events.Project.unArchive),l.addOrUpdate(e,function(e,t){r.resolve(t)}),r.promise},m.updateItem=function(e){e.status===u.status.deleted?l.delete(e.id,function(e,r){}):l.addOrUpdate(e,function(e,r){})},m.canDeleteProject=function(e){var r=v.getLoggedInUser();if(!e||!r)return!1;var t=_.find(e.users,function(e){if(e._id&&e._id==r._id)return!0});return!!t&&(t.role==u.projectUserRole.admin&&e.users.length<=1)},m.canDeleteUser=function(e,r){if(!r||!e||e.users.length<=0)return!1;var t=_.find(e.users,function(e){if(e._id&&e._id==r._id)return!0});return!!t&&t.role==u.projectUserRole.admin}}])}).call(this);
!function(){app.service("roleValidators",["$q","projectModel","popupService","CONSTANT","dbEnums","userModel","taskModel","labelModel","helperService","$window","connectivity","userModelHelper",function(e,n,t,r,i,o,u,c,s,a,f,l){function d(n,t){return e(function(e,r){var o=u.getTaskUserByRole(t,i.taskUserRole.assignee);o&&n._id==o._id?r({shouldSkip:!0}):e()})}function v(n,t,r){var i=e.defer(),u=o.getUserFeatures(),c=e(function(e,n){e()});return c=c.then(function(e){return L(u,t)}).then(i.resolve,function(e){e&&e.shouldSkip?i.resolve():i.reject(e)}),i.promise}function g(n){return e(function(e,t){h(n).then(function(n){n?e():t({shouldSkip:!0})},t)})}function h(n){return e(function(e,t){u.findById(n.id,function(r,i){if(r)t(r);else if(i){var o=i.project.id!=n.project.id;e(o)}else e(!0)})})}function p(n,t){return e(function(e,r){c.getAll(function(i,o){if(i)r(i);else{var u=_.filter(o,function(e){return(e.tasks||[]).indexOf(t)>=0}),c=_.map(u,function(e){return e.id}),s=_.map(n||[],function(e){return e.id}),a=!1;_.each(s,function(e){var n=_.indexOf(c,e)>=0;if(!n)return a=!0,!1}),e(a)}})})}function k(n,t){return e(function(e,r){var o=s.getUserByRole(t.users,i.taskUserRole.assignee);o?u.findById(t.id,function(c,s){if(c)r(c);else if(s){var a=u.getTaskUserByRole(s,i.taskUserRole.assignee);a?s.project.id!=t.project.id?e():a._id!=o._id&&o._id!=n._id?e():r({shouldSkip:!0}):e()}else e()}):r({shouldSkip:!0})})}function m(t,r,i){return e(function(e,o){t&&"LICENSE"==t.key&&t.isLicense?0==i.id?(t.skipUpgrade=!0,e(t)):n.findById(i.id,function(n,i){var o=S(r,i);t.skipUpgrade=!o,e(t)}):e(err)})}function S(e,n){var t=0==n.id;if(t)return!0;var r=_.find(n.users,function(e){return e.isAdmin});return!r||r._id==e._id}function U(t,r){var i=o.getUserFeatures();return e(function(e,u){0==t.id?L(i,r).then(function(n){e({project:t,config:n})},u):n.findById(t.id,function(n,t){if(!n){var c=o.getLoggedInUser(),s=S(c,t),a=E(i);return L(s?a:t.licenseConfigs,r).then(function(n){e({project:t,config:n})},u)}u(n)})})}function E(e){var n={};return _.each(e,function(e,t){n[t]=e.config}),n}function y(e,n,t,r){var i=o.getAllFeatures(),u=i[t],c=r?u.message_other:u.message;c=c||"";var s=j(e);return c=R(s,c),{key:"LICENSE",message:c,name:u.name,feature_key:t,isLicense:!0,skipUpgrade:u.skipUpgrade}}function R(e,n){return _.each(e,function(e,t){n=n.replace("{"+t+"}",e)}),n}function j(e){return{firstName:e.firstName,lastName:e.lastName,email:e.email,displayName:e.displayName}}function L(n,t){var r=e.defer(),i=n[t];if(console.log("previous one",i),i)r.resolve(i);else{var u=o.getAllFeatures(),c=u[t];console.log("********"),console.log(c);var s={key:"LICENSE",message:c.message,name:c.name,feature_key:t,isLicense:!0};console.log("last one...",s),r.reject(s)}return r.promise}function A(n){return e(function(e,t){u.getAll(function(r,o){if(r)t(r);else{var u=_.filter(o,function(e){return n&&e.project.id==n.id&&e.status==i.status.active});e(u)}})})}var C=this;C.checkUserRole=function(n,i,o,u){return e(function(t,r){"string"==typeof i&&(i=[i]);var u=e(function(e,n){e()});_.each(i,function(t){u=u.then(function(){return e(function(r,i){var u=_.filter(x,function(e){return e.key==t});console.log("this is a validators"),console.log("validator",u);var c=e(function(e,n){e()});_.each(u,function(e){c=c.then(function(){return e.validate(n,t,o)})}),c.then(r,i)})})}),u.then(t,r)}).then(null,function(n){return e(function(e,i){n&&n.key&&"LICENSE"==n.key&&u&&t.roleWarning(null,n).then(function(){window.cordova?a.open(encodeURI(r.upgradeUrl),"_system","location=no"):a.open(r.upgradeUrl,"_blank"),console.log("UPGRADE code goes here")},function(){console.log("UPGRADE CANCEL code goes here")}),i(n)})})};var x=[{key:"active_projects",validate:function(t,r,u){var c,s=e.defer(),a=o.getUserFeatures(),f=e(function(e,n){e()});return f=f.then(function(){return L(a,r)}).then(function(r){return c=r,e(function(e,o){n.getUserCreatedActiveProjects(t._id,function(n,u){n?o(n):"*"!==r.config.max&&u.length+1>r.config.max?o(y(t,r,i.USER_ROLES.ACTIVE_PROJECTS)):e()})})}).then(s.resolve,s.reject),s.promise}},{key:"active_tasks",validate:function(n,t,r){return e(function(t,o){var u=r.task,c=r.project||(u?u.project:null),a=e(function(e,n){u?g(u).then(e,n):e()});a.then(function(){return e(function(t,r){U(c,i.USER_ROLES.ACTIVE_TASKS).then(function(t){return e(function(e,r){var o=t.project,u=t.config;return"*"!==u.max?A(o).then(function(t){if(t.length+1>u.max){var c=S(n,o),a=s.getUserByRole(o.users,i.projectUserRole.admin);r(y(a,u,i.USER_ROLES.ACTIVE_TASKS,!c))}else e()},r):void e()})}).then(t,r)})}).then(t,function(e,r){e&&e.shouldSkip?t(r):m(e,n,c).then(o)})})}},{key:"assignee_project",validate:function(n,t,r){return e(function(t,o){var c=r.task,a=c.project;k(n,c).then(function(){return d(n,c).then(function(){U(a,i.USER_ROLES.ASSIGNEE_PROJECT).then(function(t){return e(function(e,r){var o=t.project,a=t.config;return"*"!==a.max?A(o).then(function(t){var f=_.filter(t,function(e){if(e.id==c.id)return!1;var t=u.getTaskUserByRole(e,i.taskUserRole.assignee);return e.status==i.status.active&&t&&t._id!=n._id});if(f.length+1>a.max){var l=S(n,o),d=s.getUserByRole(o.users,i.projectUserRole.admin);r(y(d,a,i.USER_ROLES.ASSIGNEE_PROJECT,!l))}else e()},r):void e()})}).then(function(e){t(e)},function(e){m(e,n,a).then(o)})})},null).then(null,function(e){e&&e.shouldSkip?t():o(e)})})}},{key:"max_users_project",validate:function(n,t,r){return e(function(t,o){var u="object"==typeof r.project?r.project:{id:r.project},c=r.invitedUser;c?c.invitedBy:n;U(u,i.USER_ROLES.MAX_USERS_PROJECT).then(function(t){return e(function(e,r){var o=t.project,u=t.config;if("*"!==u.max){var c=o.users.length;if(c+1>u.max){var a=S(n,o),f=s.getUserByRole(o.users,i.projectUserRole.admin);r(y(f,u,i.USER_ROLES.MAX_USERS_PROJECT,!a))}else e()}else e()})}).then(function(e){t(e)},function(e){m(e,n,u).then(o)})})}},{key:"labels",validate:function(n,t,r){var u,s=e.defer(),a=o.getUserFeatures(),f=r.label,l=e(function(e,n){e()});return l=l.then(function(){return L(a,t)}).then(function(t){return u=t,e(function(e,r){"*"!==t.config.max?c.getAll(function(o,u){if(o)r(o);else{var c=f?_.find(u,function(e){return e.id==f.id}):null;c?r(y(n,t.config,i.USER_ROLES.LABELS,!1)):u.length+1>t.config.max?r(y(n,t.config,i.USER_ROLES.LABELS,!1)):e()}}):e()})}).then(s.resolve,s.reject),s.promise}},{key:"labels_assign",validate:function(n,t,r){var i=e.defer(),u=r.labels||[],c=r.task,s=o.getUserFeatures(),a=_.filter(u,function(e){return e.checked}),f=_.map(a,function(e){return e.label}),l=e(function(e,n){e()});return l=l.then(function(){return p(f,c.id)}),l=l.then(function(n){return n?L(s,t):e(function(e,n){n({shouldSkip:!0})})}).then(i.resolve,function(e){e&&e.shouldSkip?i.resolve():i.reject(e)}),i.promise}},{key:"email_notifications",validate:function(n,t,r){var i=e.defer(),u=o.getUserFeatures(),c=e(function(e,n){e()});return c=c.then(function(e){return L(u,t)}).then(i.resolve,function(e){e&&e.shouldSkip?i.resolve():i.reject(e)}),i.promise}},{key:"custom_filters",validate:function(e,n,t){return v(e,n,t)}},{key:"search",validate:function(e,n,t){return v(e,n,t)}},{key:"file_upload",validate:function(e,n,t){return v(e,n,t)}},{key:"file_upload_size",validate:function(n,t,r){var i=e.defer(),u=r.file,c=o.getUserFeatures();console.log("file upload user features",s);var s,a=e(function(e,n){e()});return a=a.then(function(){return L(c,t)}).then(function(r){return s=r,console.log("top top",r),e(function(e,i){if("*"!==r.config.max){var o=u.size/1024/1024;console.log("file length...........sfsdfsdfsdf"),console.log(o),o>r.config.max?i(y(n,r.config,t,!1)):e()}else e()})}).then(i.resolve,i.reject),i.promise}},{key:"file_storage_max",validate:function(n,t,r){var i,u=e.defer(),c=r.file,s=o.getUserFeatures(),a=e(function(e,n){e()});return a=a.then(function(){return e(function(e,r){i=s[t],i?l.getLoggedInUserTotalStorage().then(function(o){if("*"!==i.config.max){var u=o+c.size,s=u/1024/1024;s>i.config.max?r(y(n,i.config,t,!1)):e()}else e()},r):e()})}).then(u.resolve,u.reject),u.promise}},{key:"my_feeds",validate:function(e,n,t){return v(e,n,t)}},{key:"task_history",validate:function(e,n,t){return v(e,n,t)}}];C.validate=function(n,t,r,i,o){var u=_.filter(x,function(e){return e.key==t}),c=e(function(e,n){e()});_.each(u,function(t){c=c.then(function(){var o=e.defer();return t.validate(n,r,i).then(function(){o.resolve()},function(e){e.isValidation?o.reject({result:!1,type:"validation",validationResult:e}):o.reject(e)}),o.promise})}),c.then(function(){o()},function(e){o(e)})},C.applyFeatureOnProjects=function(e,n,t){var r=["active_tasks","assignee_project","users_project"],i=o.getUserFeatures();_.each(n,function(e){e.licenseConfigs={},_.each(r,function(n){var t=i[n];t&&(e.licenseConfigs[n]=t.config)})}),t()}}])}();
(function(){app.service("settingsService",["$http","$rootScope","$state","$q","$window","API","RESPONSE_CODE","Upload","userModel","settingsModel","dbEnums","message","sync","connectivity","DEFAULTS",function(e,s,r,t,o,n,i,a,l,u,c,d,g,v,m){var E=this;E.items=[{title:"General",url:"/settings/general",icon:"tdzicon-tick"},{title:"My Account",url:"/settings/account",icon:"tdzicon-task-visibility"},{title:"Reminders",url:"/settings/reminder",icon:"tdzicon-reminder"},{title:"Notifications",url:"/settings/notifications",icon:"tdzicon-notifications"},{title:"About",url:"/settings/about",icon:"tdzicon-logo"}],E.defaultViews=[{title:"Inbox",value:"inbox"},{title:"Today",value:"today"},{title:"Next 7 days",value:"next7days"},{title:"Overdue",value:"overdue"},{title:"Favourites",value:"favourites"},{title:"All Tasks",value:""}],E.floatButtons=[{title:"Add task",value:0},{title:"Show all",value:1}],E.startDays=[{title:"Saturday",value:6},{title:"Sunday",value:0},{title:"Monday",value:1}],E.dateFormats=[{title:"dd mmm yyyy",value:0},{title:"mmm dd yyyy",value:1}],E.timeFormats=[{title:"12 hour",value:0},{title:"24 hour",value:1}],E.removeAvatar=function(s){var r=t.defer();return v.isConnected()?e.post(n.settings.removeAvatar,s).success(function(e){e.response_code===i.SUCCESS?r.resolve({error:!1,msg:d.successMessages.PROFILE_IMAGE_UPDATED}):e.response_code===i.ERROR&&r.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}).error(function(e){r.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}):r.resolve({error:!0,msg:d.errorMessages.CONNECTION_REQUIRED}),r.promise},E.update=function(e){var s=t.defer();return g.add(c.collections.Settings,{settings:e,userId:l.getLoggedInId()},c.events.Settings.update),u.addOrUpdate(e,function(){s.resolve()}),s.promise},E.updateEmail=function(s){var r=t.defer();return v.isConnected()?e.post(n.settings.updateEmail,s).success(function(e){e.response_code===i.SUCCESS?r.resolve({error:!1,msg:d.successMessages.EMAIL_UPDATE_REQUEST}):e.response_code===i.ERROR&&r.resolve({error:!0,msg:d.errorMessages[e.errors.value],results:e})}).error(function(e){r.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}):r.resolve({error:!0,msg:d.errorMessages.CONNECTION_REQUIRED}),r.promise},E.updateItem=function(e){u.addOrUpdate(e,function(){})},E.updatePassword=function(s){var r=t.defer();return v.isConnected()?e.post(n.settings.updatePassword,s).success(function(e){e.response_code===i.SUCCESS?r.resolve({error:!1,msg:d.successMessages.PASSWORD_UPDATED}):e.response_code===i.ERROR&&r.resolve({error:!0,msg:d.errorMessages[e.errors.value],results:e})}).error(function(e){r.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}):r.resolve({error:!0,msg:d.errorMessages.CONNECTION_REQUIRED}),r.promise},E.updateUserName=function(s){var r=t.defer();return v.isConnected()?e.post(n.settings.updateUserName,s).success(function(e){e.response_code===i.SUCCESS?r.resolve({error:!1,msg:d.successMessages.NAME_UPDATED}):e.response_code===i.ERROR&&r.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}).error(function(e){r.resolve({error:!0,msg:d.errorMessages.GENERAL,results:e})}):r.resolve({error:!0,msg:d.errorMessages.CONNECTION_REQUIRED}),r.promise},E.uploadAvatar=function(e){var s=t.defer();return v.isConnected()?a.upload({url:n.settings.uploadAvatar,fields:e,file:e.file}).success(function(e){console.log(e),e.response_code==i.SUCCESS?s.resolve({error:!1,msg:d.successMessages.PROFILE_IMAGE_UPDATED}):e.response_code===i.ERROR&&s.resolve({error:!0,msg:d.errorMessages[e.errors.value],results:e})}).error(function(){s.resolve({error:!0,msg:d.errorMessages.GENERAL,results:results})}):s.resolve({error:!0,msg:d.errorMessages.CONNECTION_REQUIRED}),s.promise},E.updateSort=function(e){var s=t.defer();return g.add(c.collections.Settings,{sort:e.sort,userId:l.getLoggedInId()},c.events.Settings.sortUpdate),u.addOrUpdate(e,function(){s.resolve()}),s.promise},E.getSettings=function(){var e=JSON.parse(o.localStorage.getItem("settings"));return!e||!e.reminder||e.reminder.taskCreateReminderNotificationChannels&&e.reminder.taskCreateReminderNotificationChannels.email.title||(e.reminder.taskCreateReminderNotificationChannels=m.defaultSettings.taskCreateReminderNotificationChannels),e},E.deleteAccount=function(s){var r=t.defer();return e.post(n.settings.deleteAccount,s).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},E.validateDeleteAccount=function(s){var r=t.defer();return e.post(n.settings.checkForDelete,s).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}])}).call(this);
(function(){app.service("taskService",["$q","$rootScope","$http","API","RESPONSE_CODE","connectivity","taskModel","sortService","labelService","userModel","filterService","guidGenerator","dbEnums","date","sync","dueService","message","toastService","$timeout","$ionicListDelegate","$state","sharedData","reminderModel","settingsService","helperService","roleValidators",function(e,r,t,n,s,a,u,i,o,c,d,l,f,g,v,m,p,k,h,T,I,y,E,A,S,U){function R(e){r.recentTaskId=e}function D(e,r,t,n){var s={_id:e._id,displayName:e.displayName,displayShortName:e.displayShortName,email:e.email,avatar:e.avatar,getNotification:r,role:t,favourite:!1};return n&&(s.isAdmin=!0),s}function C(e,r){if(e.recurrence.due_date||r.recurrence.due_date){if(e.recurrence.due_date){if(r.recurrence.due_date){var t=moment(e.recurrence.due_date),n=moment(r.recurrence.due_date);return t<n?-1:t>n?1:0}return-1}return 1}return 0}function b(e,r){return e.priority==r.priority?0:e.priority<r.priority?1:-1}function O(e,r,t,n,s){var a=c.getTaskCustomOrders(),u=L(e,r,t,a,n,s);return u}function L(e,r,t,n,s,a){var u=_.find(n||[],function(r){return e.id==r.taskId}),i=_.find(n||[],function(e){return r.id==e.taskId});return u||i?u?i?u.order-i.order:-1:1:0}var w,j,B=this,N=angular.copy(y.BASIC_TASK),M=[];B.addAutoReminder=function(e){var r=A.getSettings(),t=null;return r.reminder.autoReminder.enable&&e&&(t={id:l.getId(),assignee:c.getLoggedInUser(),date_created:new Date,updatedBy:c.getLoggedInUser(),notificationChannels:r.reminder.autoReminder.channels,time:{id:0,title:r.reminder.autoReminder.time.title,value:r.reminder.autoReminder.time.value},auto:!0}),t},B.priorities={0:{name:"Priority 1",color:"#1775d2",number:0},1:{name:"Priority 2",color:" #6C6C6C",number:1},2:{name:"Priority 3",color:"#BABABA",number:2},3:{name:"Priority 4",number:3}},B.CHANNELS={EMAIL:"email",MOBILE:"mobile",WEB:"web"},B.TASK_TYPE_NAME={inbox:"Inbox",today:"Today",next7days:"Next 7 Days",overdue:"Overdue",watching:"Watching",favourites:"Favourites",closed:"Closed"},B.add=function(r){var t=e.defer();r.id=l.getId(),r.status=f.status.active,r.date_created=new Date,r.date_modified=new Date,r.updatedBy=c.getLoggedInUser();var n=[];if(r.assignee._id){var s=c.getLoggedInId()===r.assignee._id;n.push(D(r.assignee,!0,f.taskUserRole.assignee,s))}if(r.watchers.forEach(function(e){if(e.watcher._id){var r=c.getLoggedInId()===e.watcher._id,t=r||e.checked,s=r?f.taskUserRole.admin:f.taskUserRole.watcher;n.push(D(e.watcher,t,s,r))}}),!n.length){var a=c.getLoggedInUser();n.push(D(a,!0,f.taskUserRole.admin,!0))}r.users=angular.copy(n);var i=c.getLoggedInUser();return U.checkUserRole(i,[f.USER_ROLES.ACTIVE_TASKS,f.USER_ROLES.ASSIGNEE_PROJECT],{task:r,user:i,project:r.project},!0).then(function(){console.log("license check successful"),delete r.assignee,delete r.watchers,r.labels&&o.addTaskToLabels(r.labels,r.id);var e=r.labels;delete r.labels,v.add(f.collections.Task,{task:r,labels:e},f.events.Task.add),u.addOrUpdate(r,function(e,n){R(r.id),t.resolve(n)})},function(e){console.log("license check error"),console.log(e),t.reject(e)}),t.promise},B.copyTask=function(r){return e(function(t,n){var s=c.getLoggedInUser(),a=angular.copy(r);a.notes=[],delete a._id,delete a.id,a.id=l.getId(),a.status=f.status.active,a.date_created=new Date,a.date_modified=new Date,a.updatedBy=s,a.name=f.keys.COPY_TASK_PREFIX+a.name;var u=[],i=r.users||[];_.each(i,function(e){var r=e._id==s._id,t=e.role,n=D(e,e.getNotification,t,r);n.favourite=!!r&&n.favourite,u.push(n)}),a.users=u;var d=[],g=e(function(e,t){o.getAll().then(function(t){t?(t.forEach(function(e){var t=o.isTaskExists(r.id,e);t&&d.push({checked:!0,label:e})}),e()):e()},t)});g.then(function(){a.reminders=a.reminders||[],t(a)},n)})},B.bulkDueDateUpdate=function(r,t,n){var s=e.defer();return u.getSelected(r.taskIds,function(e,a){a&&B.updateDueDate(a,r.recurrence,t,n).then(s.resolve,s.reject)}),s.promise},B.updateDueDate=function(r,t,n,s){var a=e.defer();return _.each(r,function(e){var r=e.recurrence&&e.recurrence.due_date?new Date(e.recurrence.due_date):null;e.recurrence=angular.copy(t),e.recurrence&&e.recurrence.due_date&&(e.recurrence.due_date=new Date(e.recurrence.due_date)),n&&r&&e.recurrence.due_date&&(e.recurrence.due_date.setHours(r.getHours()),e.recurrence.due_date.setMinutes(r.getMinutes()),e.recurrence.due_date.setSeconds(r.getSeconds()),e.recurrence.due_date.setMilliseconds(r.getMilliseconds())),s&&r&&e.recurrence.due_date&&(e.recurrence.due_date.setFullYear(r.getFullYear()),e.recurrence.due_date.setMonth(r.getMonth()),e.recurrence.due_date.setDate(r.getDate())),e.updatedBy=c.getLoggedInUser()}),u.bulkUpdate(r,function(){a.resolve(!0)}),v.add(f.collections.Task,{taskList:r},f.events.Task.bulkDueDateUpdate),a.promise},B.bulkFavourites=function(t){var n=e.defer();return u.getSelected(t.taskIds,function(e,s){s&&(s.forEach(function(e){for(var r=0;r<e.users.length;r++)if(e.users[r]._id===c.getLoggedInId()){e.users[r].favourite=t.isFavourite;break}}),v.add(f.collections.Task,{isFavourite:t.isFavourite,taskIds:t.taskIds,userId:c.getLoggedInId()},f.events.Task.bulkFavourites),u.bulkUpdate(s,function(){r.$emit("task:update-favourite",t.isFavourite),n.resolve(t.isFavourite)}))}),n.promise},B.reminderDeleted=function(r,t){var n,s=e.defer();return u.findById(r,function(e,r){for(var a=0;a<r.reminders.length;a++)if(r.reminders[a].id==t){n=angular.copy(r.reminders[a]),r.reminders.splice(a,1);break}n?(v.add(f.collections.Task,{task:r,reminder:n},f.events.Task.deleteReminder),u.addOrUpdate(r,function(e,r){s.resolve(r)})):s.resolve()}),s.promise},B.reminderExecuted=function(r,t){var n,s=e.defer();return u.findById(r,function(e,r){for(var a=0;a<r.reminders.length;a++)if(r.reminders[a].id==t){n=r.reminders[a],n.notificationChannels.push.notified=!0;break}v.add(f.collections.Task,{task:r,reminder:n},f.events.Task.deleteReminder),u.addOrUpdate(r,function(e,r){s.resolve(r)})}),s.promise},B.removeTasksByProjectId=function(e){u.getAll(function(r,t){t.forEach(function(r){r.project.id==e.id&&u.delete(r.id,function(e,t){o.removeTaskFromAllLabels(r)})})})},B.update=function(r,t){var n=e.defer();if(angular.equals(r,t))n.resolve(void 0);else{r.updatedBy=c.getLoggedInUser();var s=[];if(r.assignee){var a=c.getLoggedInId()===r.assignee._id;s.push(D(r.assignee,!0,f.taskUserRole.assignee,a))}if(r.watchers.forEach(function(e){if(e.watcher._id){var r=c.getLoggedInId()===e.watcher._id,t=e.checked,n=r?f.taskUserRole.admin:f.taskUserRole.watcher;s.push(D(e.watcher,t,n,r))}}),!s.length){var i=c.getLoggedInUser();s.push(D(i,!0,f.taskUserRole.admin,!0))}r.users=angular.copy(s);var d=c.getLoggedInUser();U.checkUserRole(d,[f.USER_ROLES.ACTIVE_TASKS,f.USER_ROLES.ASSIGNEE_PROJECT],{task:r,user:d,project:r.project},!0).then(function(){delete r.assignee,delete r.watchers,r.labels&&o.addTaskToLabels(r.labels,r.id);var e=r.labels;delete r.labels,_.isEqual(r.prevRecurrence,r.recurrence)||(r.recurrence=m.setDueDate(r.recurrence)),delete r.prevRecurrence,r.removeReminders.forEach(function(e){E.delete(e,function(){})}),r.date_modified=new Date,v.add(f.collections.Task,{task:r,labels:e},f.events.Task.update),u.addOrUpdate(r,function(e,t){R(r.id),n.resolve(t)})},n.reject)}return n.promise},B.updateItem=function(e){e.status===f.status.deleted?u.delete(e.id,function(e,r){}):u.addOrUpdate(e,function(e,r){})},B.findActiveTaskById=function(r){var t=e.defer();return u.findActiveTaskById(r,function(e,r){t.resolve(r)}),t.promise},B.findById=function(r){var t=e.defer();return u.findById(r,function(e,r){t.resolve(r)}),t.promise},B.getAll=function(){var r=e.defer();return u.getAll(function(e,t){r.resolve(t)}),r.promise},B.getTasksByIds=function(r){var t=e.defer();return u.getAllByPredicate(function(e){var t=_.find(r,function(r){return r==e.id});return t},function(e,r){t.resolve(r)}),t.promise},B.taskCount=function(){var r=e.defer();return u.getAll(function(e,t){r.resolve(t.length)}),r.promise},B.setTaskObject=function(e){N=e},B.getTaskObject=function(){return w&&(N.project=w),N},B.clearTaskObject=function(){N=angular.copy(y.BASIC_TASK),w=void 0},B.taskObjectHasValue=function(){return N.name||N.notes.length},B.getTasksByType=function(t,n){var s=[],a=e.defer();return B.getAll().then(function(e){e.forEach(function(e){var r=angular.copy(e);console.log("task...",r),B.taskType[t](e,n)&&(e.due=g.getDateOnly(e.recurrence.due_date)||new Date("01/01/2050"),e.recurrence.due_time=g.getTime(e.recurrence.due_date),e.due_time=g.getTime(e.recurrence.due_date),e.isOverdued=g.isPastDay(e.recurrence.due_date),e.assignee=B.getAssignee(e),console.log("conversion..",e),s.push(e))});var u=i.getSortType();u=u||i.DEFAULT_SORT;var o=i.getOrder().value;r.showDateBar=!!u&&u.showDateBar,c.get(function(e){s=B.sortTasks(s,u,o,e),a.resolve(s)})}),a.promise},B.isUserAnAdmin=function(e,r){for(var t=0;t<e.users.length;t++)if(e.users[t]._id===r&&e.users[t].isAdmin)return!0;return!1},B.isUserAnAssignee=function(e,r){if(!e.project.id&&B.isUserAnAdmin(e,r))return!0;for(var t=0;t<e.users.length;t++)if(e.users[t].role===f.taskUserRole.assignee&&e.users[t]._id===r)return!0;return!1},B.getTaskUserByRole=function(e,r){var t=_.find(e.users,function(e){return e.role===r});return t},B.isUserAWatcher=function(e,r){for(var t=0;t<e.users.length;t++)if(e.users[t].getNotification&&e.users[t]._id===r)return!0;return!1},B.isFavourite=function(e,r){for(var t=0;t<e.users.length;t++)if(e.users[t]._id===r)return e.users[t].favourite;return!1},B.getAssignee=function(e){for(var r=0;r<e.users.length;r++)if(e.users[r].role===f.taskUserRole.assignee)return e.users[r];return null},B.taskType={inbox:function(e){return!e.project.id&&e.status==f.status.active},today:function(e){return g.isToday(e.recurrence.due_date)&&B.isUserAnAssignee(e,c.getLoggedInId())&&e.status==f.status.active},next7days:function(e){return g.isInNextNDays(e.recurrence.due_date,8)&&B.isUserAnAssignee(e,c.getLoggedInId())&&e.status==f.status.active},overdue:function(e){return g.isPastDay(e.recurrence.due_date)&&B.isUserAnAssignee(e,c.getLoggedInId())&&e.status==f.status.active},watching:function(e){return B.isUserAWatcher(e,c.getLoggedInId())&&e.status==f.status.active},favourites:function(e){return B.isFavourite(e,c.getLoggedInId())&&e.status==f.status.active},assignee:function(e,r){return r&&B.isUserAnAssignee(e,r._id)&&e.status==f.status.active},label:function(e,r){return r&&o.isTaskExists(e.id,r)&&e.status==f.status.active},filter:function(e,r){return r&&d.isTaskExists(e,r)&&e.status==f.status.active},project:function(e,r){return r&&e.project.id==r.id&&e.status==f.status.active},closed:function(e){return e.status==f.status.closed},"":function(e){return e.status==f.status.active}},B.addProjectToTaskObject=function(e){e&&(w={id:e.id,name:e.name,color:e.color})},B.getActiveReminders=function(e){var r=[];return e.reminders&&e.reminders.forEach(function(t){var n=B.isReminderActive(e,t);n&&r.push(t)}),r},B.countActiveReminders=function(e){var r=B.getActiveReminders(e);return r.length},B.isReminderActive=function(e,r){var t=(S.getScheduledTime(r,e.recurrence.due_date),!1),n=!0,s=!0;return r.notificationChannels.email&&r.notificationChannels.email.value&&!r.notificationChannels.email.notified&&(n=!1),r.notificationChannels.push&&r.notificationChannels.push.value&&!r.notificationChannels.push.notified&&(s=!1),s&&n||(t=!0),t},B.getCompletedTasks=function(r){var u=angular.extend({limit:25,skip:0},r),i=e.defer();a.isConnected()?t.get(n.task.GET.getCompleted,{params:u}).success(function(e){e.response_code===s.SUCCESS?(e.data.completedTasks.forEach(function(e){e.due=g.getDateOnly(e.recurrence.due_date)||new Date("01-01-2050"),e.recurrence.due_time=g.getTime(e.recurrence.due_date),e.due_time=g.getTime(e.recurrence.due_date),e.isOverdued=g.isPastDay(e.recurrence.due_date),e.assignee=B.getAssignee(e)}),i.resolve(e.data.completedTasks)):e.response_code===s.ERROR&&i.reject({error:!0,msg:p.errorMessages[e.errors.value],results:e})}).error(function(e){i.reject({error:!0,msg:p.errorMessages.GENERAL,results:e})}):i.reject({error:!0,msg:p.errorMessages.CONNECTION_REQUIRED});var o=i.promise;return o},B.unCompleteTasks=function(u){var i=e.defer(),o=_.isArray(u)?u:[u],d=o,l=c.getLoggedInUser(),g=e(function(e,r){e()});return _.each(o,function(e){g=g.then(function(){return U.checkUserRole(l,f.USER_ROLES.ACTIVE_TASKS,{project:e.project,user:l},!0)})}),g.then(function(){return e(function(e,i){a.isConnected()?t.post(n.task.unCompleteTasks,d).success(function(t){t.response_code===s.SUCCESS?B.addTaskFromServer(t.data.tasks).then(function(){e(t.data.tasks?t.data.tasks:u),r.$emit("task-reopen",t.data.tasks)},i):i({error:!0,msg:p.errorMessages[t.errors.value],results:t})}).error(function(e){i({error:!0,msg:p.errorMessages.GENERAL,results:e})}):i({error:!0,msg:p.errorMessages.CONNECTION_REQUIRED})})}).then(i.resolve,i.reject),i.promise},B.addTaskFromServer=function(r){var t=e.defer();return u.bulkUpdate(r,function(e,n){e&&t.reject(e),t.resolve(r)},t.reject),t.promise},B.getTaskFromServer=function(r){var s=e.defer();return a.isConnected()?t.get(n.task.GET.view+r).then(function(e){s.resolve(e.data.data.task)},function(e){s.reject({error:!0,msg:p.errorMessages.GENERAL})}):s.reject({error:!0,msg:p.errorMessage.CONNECTION_REQUIRED}),s.promise},B.moveTask=function(r,t,n,s,a,u,i,o){var c,d,l=e.defer(),f=r[t],g=!1,v=r;t<n?(c=r[n],n+1<r.length&&(d=r[n+1])):t>n?(d=r[n],n-1>=0&&(c=r[n-1])):t<s?(c=r[n-1],n+1<r.length&&(d=r[n+1])):t>s&&(d=r[n-1],n-1>=0&&(c=r[n-1]));var m;if(u){var p=r[s],k=B.areDateGroupEqual(f,p);if(!k){var _=f.recurrence;m=_&&_.due_date?new Date(_.due_date):null,f.recurrence=angular.copy(p.recurrence),f.recurrence&&f.recurrence.due_date&&(f.recurrence.due_date=new Date(f.recurrence.due_date),f.recurrence.due_date.setHours(0),f.recurrence.due_date.setMinutes(0),f.recurrence.due_date.setSeconds(0),f.recurrence.due_date.setMilliseconds(0)),g=!0}}var h=1,T=-1;if(c){var I=i&&"plan"==i.value?1:B.compareTasks(f,c,a,g,i,o);h=I}if(d){var I=i&&"plan"==i.value?-1:B.compareTasks(f,d,a,g,i,o);T=I}var y=h>=0&&T<=0;return y||"priority"!=i.value||(t<n?y=h>=0:t>n&&(y=T<=0)),y?(console.log("step 2"),e(function(e,r){g?(m&&f.recurrence&&f.recurrence.due_date&&(f.recurrence.due_date.setHours(m.getHours()),f.recurrence.due_date.setMinutes(m.getMinutes()),f.recurrence.due_date.setSeconds(m.getSeconds()),f.recurrence.due_date.setMilliseconds(m.getMilliseconds())),console.log("step 3"),B.updateDueDate([f],f.recurrence).then(function(){e()},r)):e()}).then(function(){var e=!1;g||(v.splice(t,1),v.splice(n,0,f),e=!0,l.resolve({tasks:v})),console.log("step 4"),B.saveTaskCustomOrder(f,c,d,a,i,o).then(function(){console.log("step 5"),e||l.resolve({tasks:v,requireSort:!0})},function(){e||l.reject()})})):l.resolve({tasks:null}),l.promise},B.saveTaskCustomOrder=function(r,t,n,s,a,u){var i=e.defer();return B.getAll().then(function(e){e.forEach(function(e){e.due=g.getDateOnly(e.recurrence.due_date)||new Date("01-01-2050"),e.recurrence.due_time=g.getTime(e.recurrence.due_date),e.due_time=g.getTime(e.recurrence.due_date)});var o=B.sortTasks(e,a,u,s),d=_.findIndex(o,function(e){return e.id==r.id}),l=t?_.findIndex(o,function(e){return e.id==t.id}):-1,m=n?_.findIndex(o,function(e){return e.id==n.id}):-1,p=o.splice(d,1)[0];l>=0?d>l?o.splice(l+1,0,p):o.splice(l,0,p):m>=0&&(d>m?o.splice(m,0,p):o.splice(m-1,0,p));var k=[],h=1;_.each(o,function(e){k.push({taskId:e.id,order:h++})}),console.log("sorted task"),console.log(_.map(o,function(e){return e.name}).join(" , ")),c.setTaskCustomOrders(k),v.add(f.collections.User,{user:s,taskCustomOrder:k},f.events.Task.moveTaskOrder),i.resolve()}),i.promise},B.sortTasks=function(e,r,t,n){var s;if("plan"==r.value)s=e.sort(function(e,s){var a=O(e,s,n,r,t);return a});else{s=e.sort(function(e,s){var a=O(e,s,n,r,t);return a});var a="asc"==t?"desc":"asc",u="priority"==r.value?a:t;s="priority"==r.value?_.orderBy(s,["priority","due","due_time"],[a,t,t]):_.orderBy(s,[r.value,"due","due_time","priority"],[u,u,u,"asc"])}return s},B.customOrderCompareTasks=function(e,r,t,n,s){if(!e&&!r)return 0;if(!e)return-1;if(!r)return 1;var a;a=C(e,r);var u="date compare result "+a;if(0==a){var i=b(e,r);if(u=u+";;;priority compare result "+i,0==i){var o=O(e,r,t);return u=u+";;;custom order compare result "+o,o}return i*("asc"==s?1:-1)}return a*("asc"==s?1:-1)},B.compareTasks=function(e,r,t,n,s,a){if(null==e&&null==r)return 0;if(null==e)return-1;if(null==r)return 1;var u=a;"due"==s.value&&(u="desc");var i;i=C(e,r);var o=b(e,r);return"priority"!=s.value||n?0!=i||n?i*("asc"==a?1:-1):o*("asc"==u?1:-1):0==o?i*("asc"==a?1:-1):o*("asc"==u?1:-1)},B.areDateGroupEqual=function(e,r){var t=e.recurrence.due_date,n=r.recurrence.due_date,s=C(e,r);if(s){var a=g.getDateGroupHeader(t),u=g.getDateGroupHeader(n);return a==u}return!0},B.bulkCompleteRequest=function(t,n,s){var a=e.defer();if(r.rightDefaultViewVisible&&r.$emit("task:bulkCompleted"),t){M=M||[];M.length>0;M=M.concat(t),n?a.resolve():(k.openTaskCompleteToast(),j=s,_.each(t,function(e){u.delete(e.id,!0)}),r.$emit("taskList-update"),a.resolve())}else a.resolve();return a.promise},B.removeFromBulkCompleteList=function(e){M=M||[],_.remove(M,function(r){return r.id==e.id}),u.addOrUpdate(e,function(){})},r.$on("bulk-complete:response",function(e,t){if(t)_.each(M,function(e){e.status=f.status.active,u.addOrUpdate(e,!0,function(){})}),r.$emit("taskList-update"),console.log("undo bulk complete "),console.log(_.map(M,function(e){return e.name})),j&&I.go(j.name,j.params),T.closeOptionButtons();else{var n=[];M.length&&(M.forEach(function(e){n.push(e.id)}),B.bulkComplete(M).then(function(){}),console.log("---completing tasks--"),console.log(_.map(M,function(e){return e.name})))}M=[]}),B.bulkComplete=function(r){var t=e.defer();if(r){var n=new Date;r.forEach(function(e){e.recurrence=m.setDueDate(e.recurrence,n),e.status=e.recurrence.isRecurring?f.status.active:f.status.complete,e.date_modified=n,e.updatedBy=c.getLoggedInUser()}),v.add(f.collections.Task,{taskList:r,userId:c.getLoggedInId()},f.events.Task.bulkComplete),u.bulkUpdate(r,function(){t.resolve(!0)})}return t.promise},B.setTaskProps=function(e){return e.due=g.getDateOnly(e.recurrence.due_date)||new Date("01-01-2050"),e.recurrence.due_time=g.getTime(e.recurrence.due_date),e.isOverdued=g.isPastDay(e.recurrence.due_date),e.assignee=B.getAssignee(e),e},B.delete=function(e,r){var t=_.map(e,function(e){return e.id}),n=c.getLoggedInUser();v.add(f.collections.Task,{taskIds:t,updatedBy:n},f.events.Task.delete),_.each(t,function(e){u.delete(e,function(){r()})})},B.sendProjectAdminInvitation=function(e){}}])}).call(this);
!function(){app.service("userRoleValidator",["$q","userModel","roleValidators","popupService","CONSTANT","$window",function(e,o,r,n,s,l){var t=this;t.checkUserRole=function(t,a,i,c){var u=e.defer();u.resolve();var v=o.getUserFeatures(),p=v[a],d=o.getAllFeatures();if(p)r.validate(t,a,p,i,function(e){e&&e.type&&"validation"==e.type&&c&&n.roleWarning(null,e).then(function(){l.open(s.website,"blank"),console.log("UPGRADE code goes here")},function(){console.log("UPGRADE CANCEL code goes here")}),e?u.reject(e):u.resolve()});else{var g=d[a];u.reject({result:!1,type:"role",reasons:[{key:"license",value:{name:g.name,message:g.message}}]})}return u.promise}}])}();
!function(){app.service("userModelHelper",["$q","$http","connectivity","API","userModel","RESPONSE_CODE",function(e,r,s,o,t,a){var n=this;n.getLoggedInUserTotalStorage=function(){return e(function(e,n){if(s.isConnected()){var g=t.getLoggedInUser();r.post(o.user.totalStorage,{userId:g._id}).then(function(r){var s=r.data;s.response_code===a.SUCCESS?e(s.data.totalSize):s.response_code===a.ERROR&&defer.resolve({error:!0,message:message.errorMessages[s.errors.value]})},n)}else defer.resolve({error:!0,message:message.errorMessages.CONNECTION_ERROR})})}}])}();
(function(){app.service("user",["$http","$q","$window","$state","$rootScope","$ionicLoading","API","connectivity","socket","message","RESPONSE_CODE","sharedData","notificationModel","projectModel","sync","TodoZuDB","labelModel","filterModel","taskModel","settingsModel","userModel","sortService","taskListView",function(e,s,r,o,t,n,i,a,c,l,u,g,d,f,p,v,R,O,m,E,C,I,_){function N(e){var o=s.defer();return r.localStorage.setItem("timestamp",new Date),v.createInstances().then(function(){C.addOrUpdate(e.userInfo,function(){}),e.taskCustomOrders&&C.setTaskCustomOrders(e.taskCustomOrders),C.setToken(e.token,function(){}),E.addOrUpdate(e.settings,function(){}),e.settings.filterView&&E.setAllFilterViews(e.settings.filterView),e.settings.sortOption&&E.setAllSortOptions(e.settings.sortOption),e.features&&C.saveUserFeatures(e.features),e.licenseFeatures&&C.saveAllFeatures(e.licenseFeatures),f.bulkUpdate(e.projects,function(){}),R.bulkUpdate(e.labels,function(){}),O.bulkUpdate(e.filters,function(){}),m.bulkUpdate(e.tasks,function(){}),d.bulkUpdate(e.notifications,function(){}),e.api_version&&r.localStorage.setItem("x-api-version",e.api_version),o.resolve(!0)}),o.promise}var S=this;S.register=function(r){var t=s.defer();return a.isConnected()?(n.show(),e.post(i.user.register,r).success(function(e){n.hide(),e.response_code===u.SUCCESS?(C.setRequestLoginEmail(r.email),l.setAlert(l.successMessages.CONFIRM_EMAIL_ADDRESS),o.go("/login")):e.response_code===u.ERROR&&(console.log(e),t.resolve({error:!0,message:l.errorMessages[e.errors.value]}))}).error(function(e){n.hide(),t.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR})})):t.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR}),t.promise},S.forgotPassword=function(r){var t=s.defer();return a.isConnected()?e.post(i.user.forgotPassword,r).success(function(e){e.response_code===u.SUCCESS?(l.setAlert(l.successMessages.FORGOT_PASSWORD_EMAIL_SENT),C.setRequestLoginEmail(e.data.email),o.go("/login")):e.response_code===u.ERROR&&(console.log(e),t.resolve({error:!0,message:l.errorMessages[e.errors[0].value]}))}).error(function(e){t.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR})}):t.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR}),t.promise},S.resetPassword=function(r){var t=s.defer();return a.isConnected()?e.post(i.user.resetPassword,r).success(function(e){console.log(e),e.response_code===u.SUCCESS?(S.clearAll(),l.setAlert(l.successMessages.RESET_PASSWORD_CONFIRMATION),C.setRequestLoginEmail(e.data.email),o.go("/login")):e.response_code===u.ERROR&&t.resolve({error:!0,message:l.errorMessages[e.errors.value]})}).error(function(e){t.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR})}):t.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR}),t.promise},S.login=function(r){var o=s.defer();return a.isConnected()?e.post(i.user.login,r).success(function(e){console.log("user login...."),console.log(e),e.response_code===u.SUCCESS?N(e.data).then(function(e){I.setAll().then(function(){o.resolve({success:e})})}):e.response_code===u.ERROR&&o.resolve({error:!0,message:l.errorMessages[e.errors.value]})}).error(function(){o.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR})}):o.resolve({error:!0,message:l.errorMessages.CONNECTION_ERROR}),o.promise},S.logout=function(s,r){if(n.show(),C.getDeviceUniqueId()){var a={userId:C.getLoggedInId(),uid:C.getDeviceUniqueId(),device_token:C.getDeviceToken()};e.post(i.user.logout,a).success(function(e){200===e.response_code?(S.clearAll(),t.$emit("logoff-success"),s&&r?o.go("/login",{returnUrl:s,params:r}):o.go("/login"),n.hide()):500===e.response_code&&t.$emit("show-message","general","error")}).error(function(e){n.hide()})}else S.clearAll(),n.hide(),t.$emit("logoff-success"),s&&r?o.go("/login",{returnUrl:s,params:r}):o.go("/login")},S.clearAll=function(){_.clearFilterView(),c.disconnect(),C.clearSession(),v.dropDatabase()},S.validatePassword=function(r,o){var t=s.defer();return data={password:r,userId:C.getLoggedInId()},e.post(i.user.validatePassword,data).success(function(e){200===e.response_code?t.resolve(e.data.result):t.resolve(!1)}).error(function(e){t.reject(e)}),t.promise},S.registerDeviceInfo=function(){var r=s.defer(),o={userId:C.getLoggedInId()};return o.deviceInfo={uid:C.getDeviceUniqueId(),device_type:ionic.Platform.platform(),device_token:C.getDeviceToken()},e.post(i.user.registerDeviceInfo,o).then(function(e){r.resolve()},function(e){r.reject(e)}),r.promise},S.logoutListener=t.$on("logout",function(e,s,r){S.logout(s,r)})}])}).call(this);
!function(){app.service("asyncStackService",["$q",function(e){function t(){function t(t,n,r,c){var i=t,o=n;r=r||this;var u=this,a=!1,s=e.defer();u.promise=s.promise,u.execute=function(){try{var e=i.apply(r,o);e.then?e.then(function(){a=!0,c.removeMe(u),s.resolve()},function(e){a=!0,c.removeMe(u),s.reject(e)}):(a=!0,c.removeMe(u),s.resolve())}catch(e){a=!0,c.removeMe(u),s.reject()}}}function n(){!i&&c.length>0&&(i=c.shift(),i.execute())}var r=this,c=[],i=null;r.stack=function(e,i,o){var u=new t(e,i,o||r,r);c.push(u);try{return n(),u}catch(e){throw c.pop(),e}},r.removeMe=function(e){c.shift(),i=null,n()},r.clear=function(){c.splice(0,c.length)}}var n=this;n.createStacker=function(){return new t}}])}(this);
app.service("authInterceptor",["$window","$window","$q","TodoZuDB",function(e,e,t,o){this.request=function(t){var o=e.localStorage.getItem("token");o&&(t.headers=t.headers||{},t.headers["x-access-token"]=o);var r=JSON.parse(e.localStorage.getItem("socketInfo")||"{}");return r.id&&(t.headers["x-socket-id"]=r.id),t}}]);
!function(){app.service("authService",["$window",function(e){var t=this;t.getAccessToken=function(){var t=e.localStorage.getItem("token");return t}}])}();
(function(){app.service("sharedData",["$state","settingsService",function(o,e){var t=this;t.EVENT_ICONS={ASSIGNEE:"tdzicon-people",CREATE:"tdzicon-plus-circled",DUE:"tdzicon-calendar-empty",FILE:"tdzicon-attach",NOTE:"tdzicon-note",PRIORITY:"tdzicon-priorities",PROJECT:"tdzicon-square",REMINDER:"tdzicon-reminder",STATUS:"tdzicon-tick",TITLE:"tdzicon-mini-task-desc",USER_JOINED:"tdzicon-square",USER_LEFT:"tdzicon-square",USER_REMOVED:"tdzicon-square",WATCHER:"tdzicon-viewer",REOPEN:"tdzicon-tick-circle",TASK_DELETE:"tdzicon-delete",ROLE_CHANGED:"tdzicon-square"},t.colorsCodes=function(){return[{color:"#457AAE"},{color:"#B65988"},{color:"#19BD9B"},{color:"#2ECD71"},{color:"#3598DC"},{color:"#9A59B5"},{color:"#34495E"},{color:"#26517C"},{color:"#AE4474"},{color:"#17A086"},{color:"#27AE5F"},{color:"#2A80B9"},{color:"#8F44AD"},{color:"#2D3E50"},{color:"#F5DB62"},{color:"#D45B7E"},{color:"#F2C40F"},{color:"#E77E22"},{color:"#E84C3D"},{color:"#ECF0F1"},{color:"#A3B1B2"},{color:"#F4CD16"},{color:"#D92F5E"},{color:"#F39C11"},{color:"#D25400"},{color:"#BF3A2B"},{color:"#BEC3C7"},{color:"#7E8C8D"}]},t.STATE={ASSIGNEE:"assignee",FILTER:"filter",LABEL:"label",PROJECT:"project",TASK:"task",CLOSED:"closed"},t.home=function(){var t=e.getSettings();o.go("/task/list/",{type:t.default_view.value})},t.taskHome=function(e,t){if(e.project.id){var c={id:e.project.id};t&&(c.focusMe=t),o.go("/project/details",c)}else{var c={type:"inbox"};t&&(c.focusMe=t),o.go("/task/list/",c)}},t.inbox={id:"",color:"",hasBorder:!0,name:"Inbox",users:[]},t.BASIC_TASK={project:{id:0,name:"Inbox"},hasDueDate:!1,recurrence:{},assignee:{},watchers:[],labels:[],notes:[],reminders:[]},t.LEFT_MENU_KEYS={ASSIGNEE:"assignee",FAVOURITES:"favourites",INBOX:"inbox",FILTER:"filter",LABEL:"label",MY_FEEDS:"myFeed",NEXT_7_DAY:"next7days",OVERDUE:"overdue",PROJECT:"project",TODAY:"today",WATCHING:"watching"},t.leftMenuSingleItems=function(){return[{title:"Inbox",value:"inbox",icon:"tdzicon-inbox"},{title:"Today",value:"today",icon:"tdzicon-today"},{title:"Next 7 Days",value:"next7days",icon:"tdzicon-next7days"},{title:"Overdue",value:"overdue",icon:"tdzicon-overdue"},{title:"My Feeds",value:"myFeed",icon:"ion-ios-pulse"},{title:"Watching",value:"watching",icon:"tdzicon-viewer"},{title:"Favourites",value:"favourites",icon:"tdzicon-favourites"}]}}])}).call(this);
(function(){app.service("date",["settingsService","stringService","moment","platformService",function(e,t,a,n){function r(e){return(e<10?"0":"")+e}var s=this;s.getDate=function(e){return"tomorrow"===e?s.tomorrow():"today"===e?s.today():"week"===e?s.nextWeek():"month"===e?s.nextMonth():e.setHours(0,0,0,0)},s.getDateOnly=function(e){return void 0==e||""==e?e:(e=new Date(e),e.setHours(0,0,0,0))},s.today=function(){return a().startOf("day")},s.tomorrow=function(){return a().add("days",1).startOf("day")},s.nextWeek=function(){return a().add("days",7).startOf("day")},s.nextMonth=function(){return a().add("months",1).startOf("day")},s.isToday=function(e){if(!e)return!1;e=new Date(e);var t=new Date;return e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()&&e.getDate()==t.getDate()},s.isTomorrow=function(e){if(void 0==e||""==e)return!1;e=new Date(e);var t=new Date;return e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()&&e.getDate()==t.getDate()+1},s.isYesterday=function(e){if(void 0==e||""==e)return!1;e=new Date(e);var t=new Date;return e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()&&e.getDate()==t.getDate()-1},s.isInNextNDays=function(e,t){if(!e)return!1;e=new Date(e);var a=new Date;a.setHours(0,0,0,0);var n=new Date;return n.setDate(a.getDate()+t),n.setHours(0,0,0,0),e>=a&&e<n},s.isInNextNMonths=function(e,t){if(!e)return!1;e=new Date(e);var a=new Date;a.setHours(0,0,0,0);var n=new Date;return n.setMonth(a.getMonth()+t),n.setHours(0,0,0,0),e>=a&&e<=n},s.isInNextNYears=function(e,t){if(!e)return!1;e=new Date(e);var a=new Date;a.setHours(0,0,0,0);var n=new Date;return n.setFullYear(a.getFullYear()+t),n.setHours(0,0,0,0),e>=a&&e<=n},s.isInRange=function(e,t,n){var r=a.range(new Date(e),new Date(t));return r.contains(new Date(n))},s.isPastDay=function(e){if(void 0==e||""==e)return!1;e=new Date(e);var t=new Date;return!(s.isToday(e)&&!e.getHours()&&!e.getMinutes())&&e<t},s.updateSummary=function(e,t){var a=new Date;e.starts_on=new Date(e.starts_on);var n="";if(n=e.every<=1?e.repeat.type:"Every "+e.every+" "+e.repeat.title,2==e.repeat.id){var r=0,o="";n+=" on ";for(var i=0;i<t.length;i++)t[i].checked&&(r++,o+=t[i].title+", ");o=7==r?"all days":r>0?o.replace(/,\s*$/,""):s.week[a.getDay()],n+=o}else 3==e.repeat.id?n+=e.by?" on the "+s.weekPrefixes[e.weekNumber]+" "+s.week[e.starts_on.getDay()]:" on day "+e.starts_on.getDate():4==e.repeat.id&&(n+=" on "+s.month[e.starts_on.getMonth()]+" "+e.starts_on.getDate());return e.starts_on=new Date(e.starts_on),(e.starts_on.getHours()||e.starts_on.getMinutes())&&(n+=s.timeFormat(e.starts_on)),1==e.repeatEnd.id&&e.repeatEnd.occurrence?n+=", "+e.repeatEnd.occurrence+" times":2==e.repeatEnd.id&&e.repeatEnd.end&&(n+=" until "+s.dateTimeFormat(e.repeatEnd.end)),n},s.month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s.week=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s.weekPrefixes=["First","Second","Third","Fourth","Fifth"],s.repeats=[{id:0,type:"No repeat",title:"No repeat"},{id:1,type:"Daily",title:"days"},{id:2,type:"Weekly",title:"weeks"},{id:3,type:"Monthly",title:"months"},{id:4,type:"Yearly",title:"years"}],s.repeatOnList=[{checked:!1,code:"S",title:"Sunday"},{checked:!1,code:"M",title:"Monday"},{checked:!1,code:"T",title:"Tuesday"},{checked:!1,code:"W",title:"Wednesday"},{checked:!1,code:"T",title:"Thursday"},{checked:!1,code:"F",title:"Friday"},{checked:!1,code:"S",title:"Saturday"}],s.repeatByList=[{checked:!1,code:0,name:"day of the month"},{checked:!1,code:1,name:"day of the week"}],s.TIME_FORMAT=["hh:mm A","HH:mm"],s.DATE_FORMAT=["DD MMM YYYY","MMM DD, YYYY"],s.getDateTime=function(n){var r=t.EMPTY;n=new Date(n);var o=s.DATE_FORMAT[parseInt(e.getSettings().date_format.value)];return(n.getHours()||n.getMinutes())&&(r=" @ "+s.TIME_FORMAT[parseInt(e.getSettings().time_format.value)]),a(n).calendar(null,{lastDay:"[Yesterday]"+r,sameDay:"[Today]"+r,nextDay:"[Tomorrow]"+r,nextWeek:o+r,lastWeek:o+r,sameElse:o+r})},s.getDateTimeFromNow=function(e){e=new Date(e);var t=new Date,n=t.getFullYear()!=e.getFullYear();return t.setDate(t.getDate()-1),a(e).diff(a(t))>1?a(e).fromNow(!0):n?a(e).format("D MMM YYYY"):a(e).format("D MMM")},s.getTime=function(n){n=new Date(n);var r=e.getSettings();if(r&&n.getHours()||n.getMinutes()){var o=s.TIME_FORMAT[parseInt(r.time_format.value)];return a(n).format(o)}return t.EMPTY},s.getMomentDate=function(t){var r=s.DATE_FORMAT[parseInt(e.getSettings().date_format.value)],o=a(new Date(t)),i=a().diff(o,"days");n.isMobileDevice();return o.year()===a().year()&&(r=r.replace(new RegExp("y","gi"),"")),r=r.replace("dd","d").replace("DD","D"),o.calendar(null,{lastDay:'[Yesterday] [&nbsp;<span class="date-value">]'+r+"[</span>]",sameDay:'[Today] [&nbsp;<span class="date-value">]'+r+"[</span>]",nextDay:'[Tomorrow] [&nbsp;<span class="date-value">]'+r+"[</span>]",nextWeek:'ddd [&nbsp;<span class="date-value">]'+r+"[</span>]",lastWeek:'[Last] dddd [&nbsp;<span class="date-value">]'+r+"[</span>]",sameElse:(i>0?"["+i+" days ago &nbsp;":"[")+'<span class="date-value '+(i>0?"previous-day":"future-day")+'">]'+r+"[</span>]"})},s.getDateGroupHeader=function(e){return e?s.getMomentDate(e):"No Date"},s.isPast=function(e){var t=a(new Date);return e=a(new Date(e)),t.diff(e)>0},s.isAfter=function(e,t){return e=a(new Date(e)),t=a(new Date(t)),e.diff(t)>1},s.getUnFormattedTimeString=function(e){var t=e,a=t?new Date(t):new Date;t||(a.setHours(0),a.setMinutes(0),a.setMinutes(0),a.setMilliseconds(0));var n=r(a.getHours())+":"+r(a.getMinutes());return n},s.getTimeFromString=function(e){var t=(e+"").split(":"),a=new Date;return t.length>1&&(a.setHours(t[0]),a.setMinutes(t[1]),a.setSeconds(0),a.setMilliseconds(0)),a}}])}).call(this);
(function(){app.service("discardChange",["$ionicPopup","$state","message","stringService",function(e,n,t,a){var i,s,o,u=this;u.savePrevious=function(e,n){s=!1,i=e,o=angular.copy(n)},u.discardPopup=function(o,u){e.show({template:t.infoMessages.DISCARD_CHANGE.message,title:t.infoMessages.DISCARD_CHANGE.title,scope:i,buttons:[{text:a.NO,onTap:function(){return!0}},{text:a.YES,onTap:function(){s=!0,n.go(o.name,u)}}]})},u.updateDiscardedBeforeSave=function(){s=!0},u.isChanged=function(e){return!angular.equals(o,e)},u.changeState=function(e,n,t,a){!s&&u.isChanged(a)&&(e.preventDefault(),u.discardPopup(n,t))}}])}).call(this);
(function(){app.service("dueService",["date","stringService",function(e,t){function a(e,t,a){switch(t.due_date=e,t.repeatEnd.id){case 1:a&&t.repeatEnd.remainingOccurrence--,t.isRecurring=!!t.repeatEnd.remainingOccurrence;break;case 2:var r=new Date(t.repeatEnd.end);r.setDate(r.getDate()+1),r.setHours(0,0,0,0),t.isRecurring=e<r}return t}var r=this;r.REPEAT_BY_ITEMS=[{checked:!1,code:0,name:"day of the month"},{checked:!1,code:1,name:"day of the week"}],r.REPEAT_ITEMS={DAILY:{title:"Daily",plural:"days"},WEEKLY:{title:"Weekly",plural:"weeks"},MONTHLY:{title:"Monthly",plural:"months"},YEARLY:{title:"Yearly",plural:"years"}},r.REPEAT_KEY={DAILY:"DAILY",WEEKLY:"WEEKLY",MONTHLY:"MONTHLY",YEARLY:"YEARLY"},r.REPEAT_ON_ITEMS=[{checked:!1,code:"S",title:"Sunday"},{checked:!1,code:"M",title:"Monday"},{checked:!1,code:"T",title:"Tuesday"},{checked:!1,code:"W",title:"Wednesday"},{checked:!1,code:"T",title:"Thursday"},{checked:!1,code:"F",title:"Friday"},{checked:!1,code:"S",title:"Saturday"}],r.getSummary=function(a){if(a.isRecurring){var n=new Date;a.starts_on=new Date(a.starts_on);var s="";if(s=!a.every||a.every<=1?r.REPEAT_ITEMS[a.repeat].title:"Every "+a.every+" "+r.REPEAT_ITEMS[a.repeat].plural,a.repeat===r.REPEAT_KEY.WEEKLY){var c=0,d="";s+=" on ";for(var E=0;E<a.repeatOn.length;E++)a.repeatOn[E].checked&&(c++,d+=a.repeatOn[E].title+", ");d=7==c?"all days":c>0?d.replace(/,\s*$/,""):e.week[n.getDay()],s+=d}else a.repeat==r.REPEAT_KEY.MONTHLY?s+=a.repeatBy?" on the "+e.weekPrefixes[a.weekNumber]+" "+e.week[a.starts_on.getDay()]:" on day "+a.starts_on.getDate():a.repeat==r.REPEAT_KEY.YEARLY&&(s+=" on "+e.month[a.starts_on.getMonth()]+" "+a.starts_on.getDate());return(a.starts_on.getHours()||a.starts_on.getMinutes())&&(s+=" @ "+e.getTime(a.starts_on)),1==a.repeatEnd.id&&a.repeatEnd.occurrence?s+=", "+a.repeatEnd.occurrence+" times":2==a.repeatEnd.id&&a.repeatEnd.end&&(s+=" until "+e.getDateTime(a.repeatEnd.end)),s}return a.due_date?e.getDateTime(a.due_date):t.EMPTY},r.setDueDate=function(e,t){if(!e.isRecurring)return e;var n;e.starts_on=new Date(e.starts_on),e.due_date=new Date(e.due_date);var s;switch(t?(s=t<e.due_date?new Date(e.due_date):new Date(t),n=e.every):(s=new Date(e.starts_on),n=0),e.repeat){case r.REPEAT_KEY.DAILY:s.setDate(s.getDate()+n);break;case r.REPEAT_KEY.WEEKLY:var c,d=new Date(s),E=!1;c=n?7:14;var i=d.getDay()+1;for(d.setDate(d.getDate()+1);i<c;){if(e.repeatOn[d.getDay()].checked){E=!0,s=d;break}d.setDate(d.getDate()+1),i++}if(!E){var o=new Date(s);for(o.setDate(o.getDate()+7*n-o.getDay()),g=0;g<7;g++){if(e.repeatOn[o.getDay()].checked){s=o;break}o.setDate(o.getDate()+1)}}break;case r.REPEAT_KEY.MONTHLY:var D=s.getMonth()+1*n;s.setMonth(D);var u=new Date(e.starts_on);if(e.repeatBy){s.setDate(1);for(var g=0;g<7&&s.getDay()!=u.getDay();g++)s.setDate(s.getDate()+1);s.setDate(s.getDate()+7*e.weekNumber),s.getMonth()>D&&s.setDate(s.getDate()-7)}else s.setDate(u.getDate());break;case r.REPEAT_KEY.YEARLY:s.setFullYear(s.getFullYear()+1*n),s.setDate(e.starts_on.getDate())}return s.setHours(e.starts_on.getHours()),s.setMinutes(e.starts_on.getMinutes()),a(s,e,t)}}])}).call(this);
!function(){app.service("gAnalytics",["ANALYTICS_CONFIG","platformService","$state","$rootScope","userModel",function(e,t,a,n,i){function o(e){var t=e||a.current.title||a.current.url;e||"/task/list/"!=a.current.name||(t="next7days"==a.params.type?"Next7Days_Filters_Task_List":_.capitalize(a.params.type)+"_Filters_Task_List"),r&&window.cordova?window.ga.trackView(t):(ga("set","page",t),ga("send","pageview"))}function s(){var e,t=i.isAuthenticated();e=t?i.getLoggedInEmail():null,r&&window.cordova?window.ga.setUserId(e):ga("set","userId",e)}var c=this,r=t.isMobileDevice();c.init=function(){r&&window.cordova?(window.ga.startTrackerWithId(e.MOBILE_ID),console.log("analytics registered mobile")):(ga("create",e.WEB_ID,"auto"),ga("send","pageview"),console.log("analytics registered web")),n.$on("$stateChangeSuccess",function(){o()}),n.$on("login-success",function(){s()}),n.$on("logoff-success",function(){s()}),n.$on("set-page",function(e,t){o(t)}),s()}}])}();
(function(){app.service("guidGenerator",function(){var t=this;t.getId=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(32).substring(1)}return t()+t()+t()+t()+t()+t()+t()+t()}})}).call(this);
(function(){app.service("headerService",function(){var t=this;t.activeScope=null,t.taskHeader={},t.setAddTaskHeader=function(e){t.activeScope=e,t.taskHeader={title:"Add Task",taskObject:e.taskObject,taskId:null,createType:"add",createButtonName:"Add Task",createButtonLink:"#/task/add",noteButtonLink:"#/task/note/",addTab:!0,isSaved:!0}},t.setEditTaskHeader=function(e,a){t.activeScope=e,t.taskHeader={title:"Edit Task",taskObject:e.taskObject,taskId:a,createType:"edit",createButtonName:"Edit Task",createButtonLink:"#/task/edit/"+a,noteButtonLink:"#/task/note/"+a,addTab:!0,isSaved:!0}},t.setTaskNoteHeader=function(e,a){t.activeScope=e,t.taskHeader={title:"Add Note",taskObject:e.taskObject,taskId:a,createType:a?"edit":"add",createButtonName:a?"Edit Task":"Add Task",createButtonLink:a?"#/task/edit/"+a:"#/task/add",noteButtonLink:a?"#/task/note/"+a:"#/task/note/",noteTab:!0,isSaved:!a}}})}).call(this);
!function(){app.service("helperService",["date",function(e){var t=this;t.getScheduledTime=function(e,i){var u;return e.time.id?u=new Date(e.time.value):(u=new Date(i),u.setMinutes(u.getMinutes()-t.timeDuration[e.time.value].minutes)),u},t.getUserByRole=function(e,t){var i=_.find(e,function(e){return e.role==t&&e._id});return i},t.timeDuration=[{title:"5 minutes before",value:0,minutes:5},{title:"15 minutes before",value:1,minutes:15},{title:"30 minutes before",value:2,minutes:30},{title:"1 hour before",value:3,minutes:60},{title:"2 hours before",value:4,minutes:120},{title:"3 hours before",value:5,minutes:180},{title:"6 hours before",value:6,minutes:360},{title:"12 hours before",value:7,minutes:720},{title:"1 day before",value:8,minutes:1440}]}])}();
!function(){app.service("httpAllInterceptor",["$rootScope","$window","$q","TodoZuDB","userModel","message","$timeout",function(e,o,i,n,r,t,a){function s(i){try{var n=i.headers();if(n["x-api-version"]){console.log("api version : "+n["x-api-version"]);var r=n["x-api-version"],t=parseInt((n["x-api-version"]||"").replace(/\./g,"")),a=o.localStorage.getItem("x-api-version");if(a){var s=parseInt((o.localStorage.getItem("x-api-version")||"").replace(/\./g,""));s!=t&&e.$emit("api-version-changed",r)}else o.localStorage.setItem("x-api-version",r)}}catch(e){console.log("Error in version check"),console.log(e)}finally{return i}}this.response=function(e){return i(function(o,i){try{o(e)}finally{a(function(){r.isAuthenticated()&&s(e)})}})}}])}();
(function(){app.service("localNotification",["$rootScope","$cordovaVibration","$state",function(o,i,t){}])}).call(this);
!function(){app.service("loggingService",["$rootScope","userModel","$window",function(o,n,l){function i(){if(n.isAuthenticated()){var o=n.getLoggedInUser(),i={payload:{person:o}};o&&l.Rollbar&&l.Rollbar.configure(i)}}function r(){l.Rollbar&&l.Rollbar.configure({payload:{person:null}})}var c=this;c.init=function(){l.cordova&&l.Rollbar?(l.Rollbar.init(),console.log("cordova rollbar initialized")):(console.log("cordova rollbar not found"),l.cordova&&console.log(l.cordova.plugins)),l.cordova||(i(),o.$on("login-success",function(){i()}),o.$on("logoff-success",function(){r()}))}}])}();
(function(){app.service("message",["CONSTANT",function(e){var s=this;s.errorMessages={ACTIVATION_ERROR:{title:"Activation error",message:"Please activate your account by clicking on the link we have sent via email before attempting login.",success:!1},CONNECTION_ERROR:{title:"No internet connection",message:"No internet connection detected.<br/> Please check connectivity then try again.",success:!1},CONNECTION_REQUIRED:{title:"Internet connection required",message:"Internet connection required.",success:!1},DATABASE_ERROR:{title:"Database error",message:"Database Error or no database connection.",success:!1},EMAIL_ALREADY_EXISTS:{title:"Email address already exists",message:"The email address submitted already exists. Please use another address then try again.",success:!1},EMAIL_ALREADY_VERIFIED:{title:"Email address already verified",message:"Your email address has already been verified and your TodoZu account setup is complete.<br> Please login below using your registered credentials.",success:!1},EMAIL_NOT_FOUND:{title:"Email address does not exist",message:"This email address does not match our records.",success:!1},EMAIL_NOT_VERIFIED:{title:"Account verification incomplete",message:"Password reset is not authorised until your email address is verified. Please check your email account for the verification link sent. Follow the instructions to verify that you are the owner of this registered email address before trying to reset password.",success:!1},EMAIL_REQUIRED:{title:"Email address required",message:"No email address provided.",success:!1},GENERAL:{title:"Something went wrong",message:"Something went wrong.",success:!1},INVALID_TOKEN:{title:"Invalid token",message:"The provided token is invalid or has already expired.",success:!1},LOGIN_FAILED_EMAIL_NOT_VERIFIED:{title:"Email not verified",message:"Your email address has not yet been verified.",success:!1},LOGIN_FAILED:{title:"Login failed",message:"The email address or password you entered is incorrect.",success:!1},MAX_FILE_SIZE_EXCEEDED:{title:"File exceeds maximum size (5MB)",message:"File exceeds maximum size (5MB).",success:!1},NO_FILE:{title:"No such file exists",message:"No such file exists.",success:!1},PASSWORD_MISMATCH:{title:"Password mismatch",message:"You have provided an incorrect password.",success:!1},REMINDER_TIME_REQUIRED:{title:"Reminder time required",message:"Reminder time required.",success:!1},REMINDER_TIME_VALIDATION_ERROR_FOR_FIXED:{title:"Reminder time validation error for fixed date time",message:"Time of reminder must be more than 2 minutes from now.",success:!1},REMINDER_TIME_VALIDATION_ERROR_FOR_RELATIVE:{title:"Reminder time validation error for relative date time",message:"Reminder must be set to a time in the future.",success:!1},USER_NOT_FOUND:{title:"User not found",message:"User not found.",success:!1},TASK_NOT_FOUND:{title:"Task not found",message:"Task not found",success:!1},PROJECT_ADMIN_INVITATION_INVALID_PROJECT_USER:{title:"Invalid project user",message:"User with the email is not a valid project user.",success:!1},LINK_EXPIRED:{title:"Link expired",message:"This link has expired.<br/>Please contact the project administrator to arrange for another invitation to be sent."},LINK_USED:{title:"Link used",message:"This link has already been used.<br/>Please contact the project administrator to arrange for another invitation to be sent."},INVALID_TOKEN_MSG:{title:"Invalid token",message:"The token provided is invalid."}},s.successMessages={ATTACHMENT_ADDED:{title:"Attachment added",message:"Attachment added.",success:!0},CONNECTION_ESTABLISHED:{title:"Connection established",message:"Connection established.",success:!0},CONFIRM_EMAIL_ADDRESS:{title:"Confirm email address",message:"Almost there! We have sent a confirmation message to your registered email address.<br/> <br/>Click the link in the email to confirm your account registration.",success:!0},EMAIL_UPDATED:{title:"Email updated",message:"Email address updated.",success:!0},EMAIL_UPDATE_REQUEST:{title:"Please check your new email address and follow the prompts",message:"Please check your new email address and follow the prompts.",success:!0},EMAIL_VERIFIED:{title:"Email address verified",message:"Congratulations! Your email address is verified and your TodoZu account setup is complete.<br/><br/> Please login below using your registered credentials.",success:!0},FILTER_EDITED:{title:"Filter updated",message:"Filter updated successfully.",success:!0},FILTER_DELETED:{title:"Filter deleted",message:"Filter deleted successfully.",success:!0},FILTER_SAVED:{title:"Filter saved",message:"Filter saved successfully.",success:!0},FORGOT_PASSWORD_EMAIL_SENT:{title:"Email sent (password reset)",message:"An email has been sent with a link to reset your password. Please check your email and follow the instructions.",success:!0},LABEL_EDITED:{title:"Label updated",message:"Label updated successfully.",success:!0},LABEL_DELETED:{title:"Label deleted",message:"Label deleted successfully.",success:!0},LABEL_SAVED:{title:"Label saved",message:"Label saved successfully.",success:!0},NAME_UPDATED:{title:"Name updated",message:"Your name has been updated successfully.",success:!0},NOTE_COPIED:{title:"Note copied to clipboard",message:"Note copied successfully.",success:!0},NOTE_DELETED:{title:"Note deleted",message:"Note deleted successfully.",success:!0},NOTE_EDITED:{title:"Note updated",message:"Note updated successfully.",success:!0},NOTE_SAVED:{title:"Note saved",message:"Note saved successfully.",success:!0},PASSWORD_RESET_REQUEST:{title:"Email sent (password reset)",message:"An email has been sent with a link to reset your password. Please check your email and follow the instructions.",success:!0},PASSWORD_UPDATED:{title:"Password updated",message:"Password updated successfully.",success:!0},PASSWORD_RESET:{title:"Password reset successful",message:"Congratulations! You have successfully updated your password. Please login below.",success:!0},PROFILE_IMAGE_UPDATED:{title:"Profile image updated",message:"Profile image updated.",success:!0},PROJECT_ARCHIVED:{title:"Project archived",message:"Project archived successfully.",success:!0},PROJECT_DELETED:{title:"Project deleted",message:"Project deleted successfully.",success:!0},PROJECT_EDITED:{title:"Project updated",message:"Project updated successfully.",success:!0},PROJECT_INVITATION_APPROVAL_ACCEPT:{title:"New user approved",message:"New user approved successfully.",success:!0},PROJECT_INVITATION_APPROVAL_REJECTED:{title:"New user request rejected",message:"New user request rejected.",success:!0},PROJECT_INVITATION_CANCELLED:{title:"Invitation cancelled",message:"Invitation cancelled.",success:!0},PROJECT_INVITATION_RESENT:{title:"Invitation resent",message:"Invitation resent.",success:!0},PROJECT_ADMIN_INVITATION_SENT:{title:"Project admin request sent",message:"Project admin request sent",success:!0},PROJECT_ADMIN_INVITATION_SENT:{title:"Project admin request sent",message:"Project admin request sent",success:!0},PROJECT_JOINED:{title:"Project joined",message:"You have successfully joined.",success:!0},PROJECT_LEFT:{title:"You have left project",message:"You have successfully left.",success:!0},PROJECT_SAVED:{title:"Project saved",message:"Project saved successfully.",success:!0},PROJECT_UNARCHIVED:{title:"Project unarchived",message:"Project unarchived successfully.",success:!0},PROJECT_USER_DELETED:{title:"User removed",message:"User removed successfully.",success:!0},REMINDER_ADDED:{title:"Reminder added",message:"Reminder added successfully.",success:!0},REMINDER_DELETED:{title:"Reminder deleted",message:"Reminder deleted successfully.",success:!0},RESET_PASSWORD_CONFIRMATION:{title:"Password reset successful",message:"Congratulations! You have successfully updated your password. Please login below.",success:!0},SETTINGS_SAVED:{title:"Settings saved",message:"Settings saved successfully.",success:!0},TASK_ADD_TO_FAVOURITE:{title:"Added to favourites",message:"Added to favourites successfully.",success:!0},TASK_COMPLETED:{title:"Task completed",message:"Task completed successfully.",success:!0},TASK_UNCOMPLETED:{title:"Task re-opened",message:"Task re-opened successfully.",success:!0},TASK_DUE_DATE_UPDATED:{title:"Task due date updated",message:"Task due date updated successfully.",success:!0},TASK_EDITED:{title:"Task updated",message:"Task updated successfully.",success:!0},TASK_REMOVE_FROM_FAVOURITE:{title:"Removed from favourites",message:"Removed from favourites.",success:!0},TASK_SAVED:{title:"Task saved",message:"Task saved successfully.",success:!0},TASK_DELETED:{title:"Task deleted",message:"Task deleted.",success:!0},ACCOUNT_DELETED:{title:"Account deleted.",message:"Account deleted.",success:!0}},s.infoMessages={DISCARD_CHANGE:{title:"Discard changes",message:"Are you sure you want to discard changes without saving?"},FILTER_DELETE_CONFIRMATION:{title:"Delete filter",message:"Are you sure you want to delete this filter?"},LABEL_DELETE_CONFIRMATION:{title:"Delete label",message:"Labels attached to existing tasks will be permanently detached. Are you sure you want to delete this label?"},LINK_TO_TASK_CONFIRMATION:{title:"Link to task",message:"NOTE:<br> Only users with access to the Project to which this task is assigned will be able to view the task via the above link."},MULTIPLE_NOTES_DELETE_CONFIRMATION:{title:"Delete",message:"Are you sure you want to delete the selected notes and attachments?"},NO_DUE_DATE_SET:{title:"No due date / time set",message:"Due: -"},PROJECT_ARCHIVED_CONFIRMATION:{title:"Archive project",message:"Are you sure you want to archive this project?"},PROJECT_DELETED_CONFIRMATION:{title:"Delete project",message:"<strong>WARNING!</strong> You are about to permanently delete this project. ALL TASKS in this project will also be permanently deleted. Are you sure you want to continue?"},PROJECT_DELETED_DISALLOWED:{title:"Delete project - Disallowed",message:"To delete this project, first remove all active project users then try again."},PROJECT_USER_DELETED:{title:"Remove user",message:"Are you sure you want to remove this user from this project?"},PROJECT_INVITATION_SENT_BY_ADMIN:{title:"Invite user",message:"Are you sure you want to send an invitation and grant this user access to this project?"},PROJECT_INVITATION_SENT_BY_USER:{title:"Invite user",message:"Your invitation request will be sent to the project admin for approval. Continue?"},PROJECT_INVITATION_RESENT:{title:"Resend invitation",message:"Are you sure you want to resend this invitation?"},PROJECT_INVITATION_CANCELLED:{title:"Cancel invitation",message:"Are you sure you want to cancel this invitation?"},PROJECT_LEFT_CONFIRMATION:{title:"Leave project",message:"Are you sure you want to leave this project?"},PROJECT_ADMIN_REQUEST_CONFIRMATION:{title:"Change project admin",message:"<strong>WARNING!</strong> You are about to invite another user to become the administrator of this project.<br/><br/>By doing this, you will loose all your existing admin permissions for this project and will be able to access the project only as a regular user.<br/><br/>This action cannot be reversed without the approval of the new project admin.<br/><br/>Are you sure you want to continue?"},PROJECT_UNARCHIVED_CONFIRMATION:{title:"Unarchive project",message:"Are you sure you want to unarchive this project?"},PROJECT_ADMIN_REQUEST_APPROVED:{title:"Project admin request approved",message:"Project admin request approved",success:!0},PROJECT_ADMIN_REQUEST_REJECTED:{title:"Project admin request rejected",message:"Project admin request rejected",success:!1},REMINDER_DELETE_CONFIRMATION:{title:"Delete reminder",message:"Are you sure you want to delete this reminder?"},SINGLE_NOTE_DELETE_CONFIRMATION:{title:"Delete note",message:"Are you sure you want to delete this note?"},SINGLE_FILE_DELETE_CONFIRMATION:{title:"Delete attachment",message:"Are you sure you want to delete this attachment?"},TASK_DELETE_CONFIRMATION:{title:"Delete task",message:"Are you sure you want to delete this task? Note that all task details, notes, attachments and history will be permanently deleted for all users."},TASK_HISTORY:{title:"Task history",message:"<p>The 'Task History' feature is a change log of each task and shows updates by user, date/time and change type. This feature is not available on your current license type.</p><p><a href='"+e.upgradeUrl+"' target='_blank'> Click here</a> to upgrade your license.</p>",success:!1},API_VERSION_CHANGE:{title:"TodoZu: Logout required",message:"Important updates have been applied to the TodoZu service. You are required to logout and login again for these changes to take effect.",success:!1}};var t={};s.setAlert=function(e){t={title:e.title,msg:e.message,success:e.success}},s.getAlert=function(){return t},s.clearAlert=function(){t={}}}])}).call(this);
!function(){app.service("navigationService",["$ionicHistory","$state","sharedData",function(a,t,e){function i(e){var n,s=0;if(!e.backViewId)return{view:e,count:s};n=a.getViewById(e.backViewId);var u=t.get(e.stateName),o=t.get(n.stateName);if(!u||!o)return{view:e,count:s};var c=e,v=!0;if(o.skipNavigation&&r.isMatchingParams(n.stateParams,o.skipParams)||(c=n,s=1,v=!1),u.stateGroup&&o.stateGroup&&u.stateGroup==o.stateGroup||v){var f=i(n);c=f.view,f.view!=n&&(s+=f.count+(o.skipNavigation?1:0))}return{view:c,count:s}}var r=this;r.isMatchingParams=function(a,t){if(!a||!t)return!1;if(0==_.size(a)&&_.size(t)>0||0==_.size(t)&&_.size(a)>0)return!1;var e=!0,i=a||{};return _.each(t,function(a,r){if(Array.isArray(t[r])){var n=!1;return _.each(t[r],function(a,e){if(t[r][e]==i[r])return n=!0,!1}),e=n}if(t[r]!==i[r])return e=!1,!1}),e},r.goBack=function(r){var n=a.currentView(),s=i(n),u=s.view;n!=u?(r&&(u.stateParams=angular.extend(u.stateParams,r)),a.nextViewOptions({disableBack:!0}),t.go(u.stateName,u.stateParams)):e.home()}}])}();
(function(){app.service("connectivity",["$rootScope","$timeout","message",function(n,e,t){var o=this;o.checkConnection=function(){return navigator.connection?!("none"==navigator.connection.type):navigator.onLine},o.isConnected=function(){return navigator.onLine},o.startMonitor=function(){n.connected=!0,window.addEventListener("online",function(o){n.connected=!0,n.$emit("toast-message",t.successMessages.CONNECTION_ESTABLISHED),e(function(){n.$emit("network-connected"),n.$emit("connect-socket"),n.$emit("push-to-server",!0)},500)},!1),window.addEventListener("offline",function(e){n.connected=!1,n.$emit("network-disconnected"),n.$emit("disconnect-socket"),n.$emit("toast-message",t.errorMessages.CONNECTION_ERROR)},!1),document.addEventListener("resume",function(){e(function(){n.$emit("network-connected"),n.$emit("push-to-server",!0)},500)},!1)}}])}).call(this);
(function(){app.service("platformService",function(){var i=this,t=ionic.Platform.platform();i.isMobileDevice=function(){return"android"===t||"ios"===t},i.getPlatform=function(){return t}})}).call(this);
!function(){app.service("popupService",["$ionicPopup","$q","stringService","message","$rootScope","$ionicModal",function(e,n,o,t,i,s){var a=this;a.discard=function(i){var s=n.defer();return e.show({template:t.infoMessages.DISCARD_CHANGE.message,title:t.infoMessages.DISCARD_CHANGE.title,scope:i,buttons:[{text:o.NO,onTap:function(){s.resolve(!1)}},{text:o.YES,onTap:function(){s.resolve(!0)}}]}),s.promise},a.roleWarning=function(e,o){var t,a=n.defer(),r=e?e.$new():i.$new();return r.cancel=function(){t.remove(),a.reject()},r.upgrade=function(){t.remove(),a.resolve()},r.validationResult=o,s.fromTemplateUrl("html/views/modals/validations/role_validation_popup.html",function(e){t=e,t.show()},{scope:r,animation:"scale-in"}),a.promise};var r=!1;a.apiVersionChanged=function(n){r||(r=!0,e.alert({title:t.infoMessages.API_VERSION_CHANGE.title,content:t.infoMessages.API_VERSION_CHANGE.message,buttons:[{text:o.OK,onTap:function(){r=!1,n&&n()}}]}))}}])}();
(function(){app.service("pushNotification",["$rootScope","$state","$q","$window","platformService","userModel","PUSH_NOTIFICATION_CONFIG","$timeout","toastr","$ionicLoading","$ionicPopup","stringService",function(e,i,o,n,t,s,r,a,l,c,u,d){function I(e){console.log(e);var i=e.additionalData;e.isActive?u.alert({title:i.title,content:e.message,buttons:[{text:d.CLOSE,onTap:function(){f(i,e.isActive)}}]}):f(i,e.isActive)}function v(e){console.log(e);var i=e.data;f(i,e.isActive)}function f(o,n){console.log("push notification data"),console.log(o);var t=e.$on("pull-from-server-complete",function(){t(),a(function(){n||c.hide(),n||i.go(o.state,o.params)},300)});e.$emit("pull-from-server"),n||c.show()}function p(){notify.PERMISSION_DEFAULT!=notify.permissionLevel()&&notify.PERMISSION_DENIED!=notify.permissionLevel()||notify.requestPermission(function(){})}var g,D=this;D.initialized=!1,D.init=function(){var e=o.defer();if(t.isMobileDevice())g=window.plugins.OneSignal,g.init(r.APP_ID,{googleProjectNumber:r.GOOGLE_PROJECT_NUMBER},I),D.initialized=!0,e.resolve();else{g=window.OneSignal||[];var i={appId:r.APP_ID,notificationClickHandlerMatch:"origin"};location.protocol.indexOf("https")<0&&(i.subdomainName=r.SUB_DOMAIN_NAME),g.push(["init",i]),g.push(["addListenerForNotificationOpened",v]),g.push(["isPushNotificationsEnabled",function(e){e||g.push(["registerForPushNotifications"])}]),p(),D.initialized=!0,e.resolve()}return e.promise},D.getDeviceUniqueId=function(){var e=o.defer();return console.log(new Date),g&&(t.isMobileDevice()?g.getIds(function(i){console.log("getIdsAvailable:\nUserID: "+i.userId+"\nRegistration ID: "+i.pushToken),console.log(new Date),s.setDeviceUniqueId(i.userId),s.setDeviceToken(i.pushToken),e.resolve({userId:i.userId,device_token:i.pushToken})}):g.push(["getIdsAvailable",function(i){console.log("getIdsAvailable:\nUserID: "+i.userId+"\nRegistration ID: "+i.registrationId),console.log(new Date),s.setDeviceUniqueId(i.userId),s.setDeviceToken(i.registrationId),e.resolve({userId:i.userId,device_token:i.registrationId})}])),e.promise}}])}).call(this);
(function(){app.service("reminderService",["$cordovaLocalNotification","$rootScope","$state","taskService","date","reminderModel","$interval","message","userModel","dbEnums","$q","CONSTANT",function(e,i,t,n,d,r,a,o,s,u,c,l){function f(i,t,n){p[t.id]?e.update({id:p[t.id].UID,at:n,text:i.recurrence.due_date?"Due: "+d.getDateTime(i.recurrence.due_date):o.infoMessages.NO_DUE_DATE_SET.message,title:"Reminder: "+i.name}).then(function(){console.log("The notification has updated")}):(t.UID=g(),E[t.UID]=!0,p[t.id]=t,e.schedule({id:t.UID,icon:"res://ic_stat_onesignal_default",at:n,text:i.recurrence.due_date?"Due: "+d.getDateTime(i.recurrence.due_date):o.infoMessages.NO_DUE_DATE_SET.message,title:"Reminder: "+i.name,data:JSON.stringify({taskId:i.id,reminderId:t.id})}).then(function(){console.log("The notification has been set")}))}function m(e,i,t){i.taskId=e.id,i.scheduleTime=t,r.addOrUpdate(i,function(){})}function g(){var e;do e=parseInt(1e7*Math.random());while(E[e]);return e}function h(){return("android"===T||"ios"===T)&&window.cordova}function v(){s.isAuthenticated()&&r.getAll(function(e,i){var t=new Date,a=new Date;a.setMinutes(t.getMinutes()+1),i.forEach(function(e){d.isInRange(t,a,e.scheduleTime)&&n.findById(e.taskId).then(function(i){var t,a="Reminder: "+i.name;t=i.recurrence.due_date?"Due:  "+d.getDateTime(i.recurrence.due_date):o.infoMessages.NO_DUE_DATE_SET.message,console.log("Reminder: Task - "+i.name+" :::: Reminder id - "+e.id),I(e,a,t),n.reminderDeleted(i.id,e.id),r.delete(e.id,function(){})})})})}function I(e,i,t){console.log(i+" :::: Reminder id - "+e.id);({state:"/task/edit",params:e.taskId});notify.createNotification(i,{body:t,icon:l.iconUrl}),R.play()}function D(e){var i=s.getLoggedInId();e.reminders.forEach(function(t){if(i==t.assignee._id){var a=k.getScheduledTime(t,e.recurrence.due_date);d.isPast(a)&&t.notificationChannels.push.value&&(console.log("cleaning up reminder for task : "+e.name),n.reminderDeleted(e.id,t.id),r.delete(t.id,function(){}))}})}var T=ionic.Platform.platform(),p=[],k=this,E=[],R=new Audio("media/sound/notification.mp3");k.notificationChannels={email:{title:"Email",value:!0,notified:!1},push:{title:"Push",value:!1,notified:!0}},k.timeDuration=[{title:"0 minutes before",value:9,minutes:0},{title:"5 minutes before",value:0,minutes:5},{title:"15 minutes before",value:1,minutes:15},{title:"30 minutes before",value:2,minutes:30},{title:"1 hour before",value:3,minutes:60},{title:"2 hours before",value:4,minutes:120},{title:"3 hours before",value:5,minutes:180},{title:"6 hours before",value:6,minutes:360},{title:"12 hours before",value:7,minutes:720},{title:"1 day before",value:8,minutes:1440}],k.init=function(){h()&&e.registerPermission()},k.getScheduledTime=function(e,i){var t;return e.time.id?t=new Date(e.time.value):(t=new Date(i),t.setMinutes(t.getMinutes()-k.timeDuration[e.time.value].minutes)),t},k.addReminder=function(e,i){var t=k.getScheduledTime(i,e.recurrence.due_date);!d.isPast(t)&&i.notificationChannels.push.value&&(h()?f(e,i,t):m(e,i,t))},k.deleteReminder=function(i,t){if(h()){if(!p[t.id])return;e.clear(p[t.id].UID).then(function(){})}else r.delete(t.id,function(){})},k.deleteRemindersByTaskId=function(i){var t=c.defer();if(h()){for(var n in p)if(p.hasOwnProperty(n)&&p[n].taskId==i){if(!p[reminder.id])return;e.clear(p[n].UID).then(function(){})}t.resolve()}else r.deleteRemindersByTaskId(i,function(){t.resolve()});return t.promise},i.$on("reminder:setReminders",function(e,i){var t=s.getLoggedInId();i.status==u.status.active?k.deleteRemindersByTaskId(i.id).then(function(){i.reminders.forEach(function(e){t==e.assignee._id&&k.addReminder(i,e)})}):i.reminders.forEach(function(e){t==e.assignee._id&&k.deleteReminder(i,e)})}),h()?(window.cordova.plugins.notification.local.on("trigger",function(i){console.log("reminder triggered.");var t=JSON.parse(i.data);n.reminderDeleted(t.taskId,t.reminderId),r.delete(t.reminderId,function(){}),e.clear(i.id).then(function(){})}),i.$on("$cordovaLocalNotification:click",function(i,d,a){var o=JSON.parse(d.data);n.reminderDeleted(o.taskId,o.reminderId).then(function(){t.go("/task/edit",{id:o.taskId})}),r.delete(o.reminderId,function(){}),e.clear(d.id).then(function(){})})):a(v,6e4),k.cleanUpReminders=function(){n.getAll().then(function(e){_.forEach(e,function(e){e.status==u.status.active&&D(e)})})}}])}).call(this);
(function(){app.service("rightMenuService",["$rootScope","$state","project","user","dbEnums","message","sharedData","date","notificationService","userModel","$ionicPopup","stringService","CONSTANT","$ionicModal","$ionicLoading","roleValidators","sync","RESPONSE_CODE","connectivity","$http","API",function(e,t,s,o,i,n,a,r,c,E,l,T,u,p,I,m,R,d,f,O,N){function g(t,o){l.show({title:n.infoMessages.PROJECT_ARCHIVED_CONFIRMATION.title,template:n.infoMessages.PROJECT_ARCHIVED_CONFIRMATION.message,scope:o,buttons:[{text:T.NO,type:"btn-no",onTap:function(){return!0}},{text:T.YES,type:"btn-yes",onTap:function(){s.archive(t).then(function(){e.$emit("toast-message",n.successMessages.PROJECT_ARCHIVED),a.home()})}}]})}function h(e,t){t.copy=function(){t.copyTaskLinkModal.remove()},p.fromTemplateUrl("html/views/modals/copy-task-link.html",function(s){t.copyTaskLinkModal=s,t.link=u.app_link+"/#/task/edit/"+e.id,t.modalTitle=n.infoMessages.LINK_TO_TASK_CONFIRMATION.title,t.modalDescription=n.infoMessages.LINK_TO_TASK_CONFIRMATION.message,t.copyTaskLinkModal.show()},{scope:t,animation:"scale-in"})}function S(e,t){var o=E.getLoggedInUser(),i=s.canDeleteProject(e,o);i?A(e,t):l.show({title:n.infoMessages.PROJECT_DELETED_DISALLOWED.title,template:n.infoMessages.PROJECT_DELETED_DISALLOWED.message,scope:t,buttons:[{text:T.OK,type:"btn-ok",onTap:function(){return!0}}]})}function A(t,o){l.show({title:n.infoMessages.PROJECT_DELETED_CONFIRMATION.title,template:n.infoMessages.PROJECT_DELETED_CONFIRMATION.message,scope:o,buttons:[{text:T.NO,type:"btn-no",onTap:function(){return!0}},{text:T.YES,type:"btn-yes",onTap:function(){s.delete(t).then(function(){e.$emit("toast-message",n.successMessages.PROJECT_DELETED),a.home()})}}]})}function C(t,o){l.show({title:n.infoMessages.PROJECT_LEFT_CONFIRMATION.title,template:n.infoMessages.PROJECT_LEFT_CONFIRMATION.message,scope:o,buttons:[{text:T.NO,type:"btn-no",onTap:function(){return!0}},{text:T.YES,type:"btn-yes",onTap:function(){s.left(t).then(function(){e.$emit("toast-message",n.successMessages.PROJECT_LEFT),a.home()})}}]})}function L(e,t,s,o,n){function a(e){var t=[];return e.length>0&&(e.forEach(function(e){e.date=r.getDateTimeFromNow(e.date_created),e.isProject?e.redirectTo=e.isProjectDeleted?"#/":"#/project/details/"+e.project.id:e.isNote?e.redirectTo="#/task/note/"+e.task.id+"?focusMe="+(e.note?e.note.id:""):e.isCompleted?e.redirectTo="#/task/closed?tasks="+e.task.id:e.redirectTo="#/task/edit/"+e.task.id,e.task&&e.task.status&&e.task.status==i.status.deleted&&(e.redirectTo="javascript:void(0)"),e.isNote&&e.isCompleted,e.markAsUnread=!e.seen,t.push(e)}),t=_.orderBy(t,"date_created","desc"),c.items.concat(t),t.forEach(function(e){c.items.push(e)})),t}var c=this;c.skip=0,this.limit=25,c.initialData=n||[],c.items=[],this.loadMore=function(){console.log("loadMore : "+moment().format("hh:mm:ss:sss")),0===c.skip?(c.initialData.length>0?(a(c.initialData),c.skip+=c.initialData.length):c.noMoreItemsAvailable=!0,o.$broadcast("scroll.infiniteScrollComplete"),console.log("loadMore ends : "+moment().format("hh:mm:ss:sss"))):t.getAllNotificationsByUserId(c.skip,c.limit).then(function(e){e.length?(a(e),c.skip+=e.length):c.noMoreItemsAvailable=!0,console.log("loadMore ends : "+moment().format("hh:mm:ss:sss")),o.$broadcast("scroll.infiniteScrollComplete")})},this.loadMore()}function M(t){var s=e.$new();l.show({title:n.infoMessages.PROJECT_ADMIN_REQUEST_CONFIRMATION.title,template:n.infoMessages.PROJECT_ADMIN_REQUEST_CONFIRMATION.message,scope:s,buttons:[{text:T.NO,type:"btn-no",onTap:function(){return!0}},{text:T.YES,type:"btn-yes",onTap:function(){v(t)}}]})}function v(t){var s=e.$new();s.project=t,s.sendProjectAdminRequest=k.sendProjectAdminRequest,s.removeProjectAdminRequestDetailModal=D,s.model={},p.fromTemplateUrl("html/views/modals/project/project_admin_request_details.html",function(e){J=e,s.project=t,J.show()},{scope:s,animation:"scale-in"})}function D(e){J.remove(),e.preventDefault()}var k=this,P={DELETE:"DELETE",REMINDER:"REMINDER"},b={ARCHIVE:"ARCHIVE",DELETE:"DELETE",EDIT:"EDIT",HELP:"HELP",INVITE_USERS:"INVITE_USERS",LEAVE:"LEAVE",LINK:"LINK",LOGOUT:"LOGOUT",NOTIFICATION:"NOTIFICATION",REFRESH:"REFRESH",SEARCH:"SEARCH",SETTINGS:"SETTINGS",VIEW_USERS:"VIEW_USERS",PROJECT_ADMIN_REQUEST:"PROJECT_ADMIN_REQUEST"},y=[],U={FILTER:"filter",LABEL:"label",PROJECT:"project",TASK:"task"};k.getMenu=function(){return y},k.getBottomMenu=function(){return[{title:"Reminder",value:P.REMINDER},{title:"Delete",value:P.DELETE}]},k.itemClicked=function(s,n,a,r){switch(s.value){case b.ARCHIVE:g(n,a);break;case b.DELETE:s.type==U.FILTER||s.type==U.LABEL||s.type==U.PROJECT&&S(n,a);break;case b.EDIT:var c;s.type==U.FILTER?c="/filter/edit":s.type==U.LABEL?c="/label/edit":s.type==U.PROJECT&&(c="/project/edit"),t.go(c,{id:n.id});break;case b.HELP:break;case b.INVITE_USERS:var l=E.getLoggedInUser();m.checkUserRole(l,i.USER_ROLES.MAX_USERS_PROJECT,{project:n.id},!0),t.go("/project/invite",{id:n.id});break;case b.LEAVE:C(n,a);break;case b.LINK:h(n,a);break;case b.LOGOUT:o.logout();break;case b.NOTIFICATION:k.openNotificationBar(r,a);break;case b.REFRESH:I.show();var T=e.$on("pull-from-server-complete",function(){T(),I.hide()});e.$emit("push-to-server",!0);break;case b.SEARCH:e.$emit("attach-focus","search-box");break;case b.SETTINGS:t.go("/settings");break;case b.VIEW_USERS:t.go("/project/users",{id:n.id});break;case b.PROJECT_ADMIN_REQUEST:M(n)}},k.openNotificationBar=function(e,t){moment();c.getNotifications().then(function(s){if(t.items=[],s.length){var o=new L(t.notificationBar,c,e,t,s);t.notification=o,t.notificationBar.show(e).then(function(){}),c.seenNotifications()}})},k.setMenu=function(e,t){if(y=[{title:"Refresh",value:b.REFRESH},{title:"Notifications",value:b.NOTIFICATION,isNotification:!0},{title:"Settings",value:b.SETTINGS}],e)switch(e){case U.FILTER:break;case U.LABEL:break;case U.PROJECT:y.push({title:"Edit project",value:b.EDIT,type:U.PROJECT}),y.push({title:"View users",value:b.VIEW_USERS}),y.push({title:"Invite user to project",value:b.INVITE_USERS}),y.push({title:"Archive project",value:b.ARCHIVE});var o=t?s.getUserRole(t,E.getLoggedInId()):T.EMPTY;t?t.users:[];if(o==i.projectUserRole.admin){var n={title:"Make another user Project Admin",value:b.PROJECT_ADMIN_REQUEST,type:U.PROJECT};y.push(n);var a={title:"Delete project",value:b.DELETE,type:U.PROJECT,disabled:!s.canDeleteProject(t)};y.push(a)}else y.push({title:"Leave project",value:b.LEAVE,type:U.PROJECT});break;case U.TASK:y.push({title:"Link to task",value:b.LINK,type:U.TASK})}y.push({title:"Help",value:b.HELP}),y.push({title:"Logout",value:b.LOGOUT})};var J;k.sendProjectAdminRequest=function(t,s,o){var i=_.find(s.users,function(e){return e.email==o.email});if(!i)return l.alert({title:n.errorMessages.PROJECT_ADMIN_INVITATION_INVALID_PROJECT_USER.title,content:n.errorMessages.PROJECT_ADMIN_INVITATION_INVALID_PROJECT_USER.message,buttons:[{text:T.OK,onTap:function(){return!1}}]}),!1;J.remove();var a=E.getLoggedInUser();a.password=o.password;var r={project:s,user:a,newAdmin:o.email};f.isConnected()?O.post(N.project.adminInvitation,r).success(function(t){t.response_code===d.SUCCESS?e.$emit("toast-message",n.successMessages.PROJECT_ADMIN_INVITATION_SENT):t.response_code===d.ERROR&&t.errors.message&&e.$emit("toast-message",{title:t.errors.message})}).error(function(t){e.$emit("toast-message",{title:t.message})}):e.$emit("toast-message",n.errorMessages.CONNECTION_ERROR),console.log(s)}}])}).call(this);
(function(){app.service("orientation",["$rootScope","screenSize",function(i,n){var o=this;o.setOrientation=function(){ionic.Platform.isIPad()||ionic.Platform.isIOS()||ionic.Platform.isAndroid()},window.addEventListener("orientationchange",function(){i.desktop=n.is("md,lg"),i.mobile=n.is("xs, sm")},!1)}])}).call(this);
(function(){app.service("socket",["$rootScope","$state","dbEnums","toastService","labelService","CONSTANT","taskService","project","userModel","notificationModel","filterService","settingsService","message","$window","taskModel",function(e,t,n,o,s,c,a,i,d,u,l,r,f,p,m){var k,g=this;g.connect=function(){k=io.connect(c.api_link,{forceNew:!0,query:"userId="+d.getLoggedInId()}),g.enableAllListeners()},g.disconnect=function(){k&&k.disconnect()},g.enableAllListeners=function(){k.on("connect",function(){p.localStorage.setItem("socketInfo",JSON.stringify({id:k.id})),console.log(k)}),k.on("disconnect",function(){p.localStorage.removeItem("socketInfo")}),k.on(g.socketEventNames.user.userUpdated,function(e){d.addOrUpdate(e,function(){})}),k.on(g.socketEventNames.user.userSessionTimeOut,function(t){d.setRequestLoginEmail(t.email),e.$emit("logout",null,null),e.$emit("toast-message",f.successMessages.PASSWORD_UPDATED)}),k.on(g.socketEventNames.project.projectUpdated,function(e){i.updateItem(e)}),k.on(g.socketEventNames.project.projectDeleted,function(e){console.log(e.name),e.status=n.status.deleted,i.updateItem(e)}),k.on(g.socketEventNames.project.projectLeft,function(e){e.status=n.status.deleted,i.updateItem(e)}),k.on(g.socketEventNames.task.taskUpdated,function(e){a.updateItem(e)}),k.on(g.socketEventNames.task.taskCompleted,function(t){console.log("Completed"),a.updateItem(t),e.$emit("task-complete")}),k.on(g.socketEventNames.label.labelUpdated,function(e){s.updateItem(e)}),k.on(g.socketEventNames.filter.filterUpdated,function(e){l.updateItem(e)}),k.on(g.socketEventNames.settings.settingsUpdated,function(e){r.updateItem(e)}),k.on(g.socketEventNames.notification.foreground,function(e,t,n){o.openNotificationToast(e,t,n)}),k.on(g.socketEventNames.notification.notify,function(e){u.addOrUpdate(e,function(){})}),k.on(g.socketEventNames.notification.seen,function(){u.bulkSeen(function(){})}),k.on(g.socketEventNames.user.taskOrderChanged,function(e){d.changeTaskSortOrder(e,function(){})}),k.on(g.socketEventNames.task.taskDeleted,function(e){m.delete(e.id)})},g.socketEventNames={user:{userUpdated:"user:updated",userSessionTimeOut:"user:sessionTimeOut",taskOrderChanged:"user:taskOrderChanged"},project:{projectUpdated:"project:updated",projectDeleted:"project:deleted",projectLeft:"project:left"},label:{labelUpdated:"label:updated",labelDeleted:"label:deleted"},filter:{filterUpdated:"filter:updated",filterDeleted:"filter:deleted"},task:{taskUpdated:"task:updated",taskCompleted:"task:completed",taskDeleted:"task:deleted"},settings:{settingsUpdated:"settings:updated"},notification:{foreground:"foreground-push-notification",notify:"notify",seen:"seen"}},g.getClientId=function(){return k.id},e.$on("connect-socket",function(){d.isAuthenticated()&&g.connect()}),e.$on("disconnect-socket",function(){g.disconnect()})}])}).call(this);
(function(){app.service("sortService",["$window","stringService","filterService","$rootScope","$q","$state","settingsService","sync","dbEnums","userModel",function(e,t,r,n,o,a,i,s,l,u){function S(e,t){s.add(l.collections.Settings,{sortOption:t,sortKey:e,userId:u.getLoggedInId()},l.events.Settings.sortUpdate)}function c(e){var t=f.SORTS,r=_.find(t,function(t,r){return t.value==e});return r}function T(e){var t=_.find(f.ORDERS,function(t,r){return t.value==e});return t}var f=this;f.DEFAULT_ORDER={name:"DESC",value:"desc"},f.DEFAULT_SORT={name:"Due date",value:"due",showDateBar:!0},f.FILTER_TYPE={DEFAULT:"Filter",CUSTOM:"My Filters"},f.FILTERS=[{name:"Inbox",value:"inbox",type:f.FILTER_TYPE.DEFAULT},{name:"Today",value:"today",type:f.FILTER_TYPE.DEFAULT},{name:"Next 7 days",value:"next7days",type:f.FILTER_TYPE.DEFAULT},{name:"Overdue",value:"overdue",type:f.FILTER_TYPE.DEFAULT},{name:"Favourites",value:"favourites",type:f.FILTER_TYPE.DEFAULT},{name:"Watching",value:"watching",type:f.FILTER_TYPE.DEFAULT}],f.SORTS=[{name:"Due date",value:"due",showDateBar:!0},{name:"Priority",value:"priority",showDateBar:!1},{name:"My order",value:"custom",showDateBar:!0},{name:"Plan view",value:"plan",showDateBar:!1}],f.ORDERS=[{name:"Ascending",value:"asc"},{name:"Descending",value:"desc"}],f.getFilterByValue=function(e){for(var t=0;t<f.FILTERS.length;t++)if(f.FILTERS[t].value==e)return f.FILTERS[t];return null},f.getFilterType=function(){return JSON.parse(e.localStorage.getItem("filterType"))},f.getOrder=function(){var e=f.getSortOptionByKey((n.sorts||{}).key||"project"),t=T(e.order);return t},f.getSortType=function(){var e=f.getSortOptionByKey((n.sorts||{}).key||"project"),t=c(e.sort);return t},f.setAll=function(e,t,r){var n=o.defer();return f.setAllFilters(e,t).then(function(){n.resolve()}),n.promise},f.setAllFilters=function(e,t){var a=o.defer(),i=[];return r.getAll().then(function(r){i={list:angular.copy(f.FILTERS)},r.forEach(function(r){var n={name:r.name,value:r.id,type:f.FILTER_TYPE.CUSTOM};i.list.indexOf(n)<=-1&&(i.list.push(n),e!=n.value||t||(i.select=n))}),i.select||t||(i.select=f.getFilterType()),n.filters=i,a.resolve()}),a.promise},f.setAllSorts=function(e){var t=f.getSortOptionByKey(e),r=f.getSortOrdersByKey(e),o=c(t.sort);n.sorts={list:r,select:o,key:e}},f.setAllOrders=function(e){var t=f.getSortOptionByKey(e),r=T(t.order);n.orders={list:f.ORDERS,select:r,key:e}},f.setDefault=function(e,t){f.setFilterTypeByValue(e),t||(f.setOrder(f.DEFAULT_ORDER),f.setSortType(f.DEFAULT_SORT))},f.setFilterTypeByValue=function(e){f.setFilterType(f.getFilterByValue(e))},f.setFilterType=function(r){r=r||t.EMPTY,e.localStorage.setItem("filterType",JSON.stringify(r))},f.setOrder=function(e){var t=i.getSettings();t.sort=t.sort||{},t.sort.order=e.value,i.updateSort(t)},f.setSortType=function(e){var t=i.getSettings();t.sort=t.sort||{},t.sort.sortType=e.value,i.updateSort(t)},n.changeFilter=function(e){switch(f.setFilterType(e),e.type){case f.FILTER_TYPE.DEFAULT:a.go("/task/list/",{type:e.value});break;case f.FILTER_TYPE.CUSTOM:a.go("/filter/details",{id:e.value})}},n.changeOrder=function(e){f.setOrder(e),n.$emit("task:list-sorted")},n.changeSort=function(e){f.setSortType(e),n.$emit("task:list-sorted")},n.$on("$stateChangeSuccess",function(e,t,r,n,o){if(u.isAuthenticated()){var a=t.sortKey;"list"==a&&(a=r.type),a&&(f.setAllSorts(a),f.setAllOrders(a))}}),f.getSortOptionByKey=function(t){var r=e.localStorage.getItem("sortOptions")||"{}",n=JSON.parse(r),o=n[t];return o||(o={sort:f.DEFAULT_SORT_TYPES[t],order:"asc"},n[t]=o,e.localStorage.setItem("sortOptions",JSON.stringify(n)),S(t,o)),o},f.setSortOptionByKey=function(t,r){var n=JSON.parse(e.localStorage.getItem("sortOptions")||"{}");n[t]=r,e.localStorage.setItem("sortOptions",JSON.stringify(n)),S(t,r)},n.changeSortValue=function(e,t){var r=f.getSortOptionByKey(e);r.sort=t,f.setSortOptionByKey(e,r),n.$emit("task:list-sorted")},n.changeSortOrder=function(e,t){var r=f.getSortOptionByKey(e);r.order=t,f.setSortOptionByKey(e,r),n.$emit("task:list-sorted")},f.getSortOrdersByKey=function(e){var t=f.SORT_ORDERS_LIST[e];return t||(t=f.SORT_ORDERS_LIST.default),t},f.DEFAULT_SORT_TYPES={inbox:"due",today:"due",next7days:"due",overdue:"due",watching:"due",favourites:"due",closed:"due",project:"plan",assignee:"due",label:"due",filter:"due"},f.SORT_ORDERS_LIST={inbox:_.filter(f.SORTS,function(e,t){return"plan"!=e.value}),today:_.filter(f.SORTS,function(e,t){return"plan"!=e.value}),next7days:_.filter(f.SORTS,function(e,t){return"plan"!=e.value}),overdue:_.filter(f.SORTS,function(e,t){return"plan"!=e.value}),watching:_.filter(f.SORTS,function(e,t){return"plan"!=e.value}),favourites:_.filter(f.SORTS,function(e,t){return"plan"!=e.value}),closed:_.filter(f.SORTS,function(e,t){return"plan"!=e.value}),project:f.SORTS,assignee:_.filter(f.SORTS,function(e,t){return"plan"!=e.value}),label:_.filter(f.SORTS,function(e,t){return"plan"!=e.value}),filter:_.filter(f.SORTS,function(e,t){return"plan"!=e.value}),filter:_.filter(f.SORTS,function(e,t){return"plan"!=e.value})}}])}).call(this);
(function(){app.service("stringService",function(){var t=this;t.CLOSE="CLOSE",t.COPY_LINK="COPY LINK",t.NO="NO",t.YES="YES",t.EMPTY="",t.OK="OK",t.CANCEL="CANCEL",t.UPGRADE="UPGRADE",t.firstLetter=function(t){return t.charAt(0).toUpperCase()},t.capitalizeFirstLetter=function(r){return r?r[0].toUpperCase()+r.substr(1):t.EMPTY}})}).call(this);
(function(){app.service("taskListView",["$rootScope","taskService","userModel","platformService","$state","$timeout","$window","popupService","$q","dbEnums","sync",function(e,t,i,l,s,r,n,a,c,o,f){function d(t,i){r(function(){l.isMobileDevice()||(e.rightDefaultViewVisible=!0,e.default={edit:!0},s.go("/task/list/",{type:i,id:t.id},{notify:!1}))})}function u(e,t){f.add(o.collections.Settings,{filterView:t,filterKey:e,userId:i.getLoggedInId()},o.events.Settings.filterViewUpdate)}var g=this,w=!1;g.clearAllSelected=function(){g.setSelected(),e.rightDefaultViewVisible=!1,e.default={edit:!1},e.selectedItems={},w=!1,e.multipleSelect=e.singleSelect=!1,e.$emit("task-footer-toggle")},g.clicked=function(t,i,l){function s(t,i,l){var s=g.getSelected();e.rightDefaultViewVisible=!1,e.default={edit:!1};var n=i;if(e.selectedItems||(e.selectedItems={}),t.status==o.status.complete?e.closedTask=t:delete e.closedTask,l){var a=g.findIndex(s,t);a>-1?(s.splice(a,1),delete e.selectedItems[t.id]):(s.push(t),e.selectedItems[t.id]=!0),g.setSelected(s),g.singleSelect()&&d(s[0],n)}else{var c=g.singleSelect()&&s[0].id==t.id;s.forEach(function(t){delete e.selectedItems[t.id]}),s=[],c||(s.push(t),e.selectedItems[t.id]=!0,d(t,n)),g.setSelected(s)}e.multipleSelect=s.length>1,e.singleSelect=1==s.length,e.$emit("task-footer-toggle"),r.resolve(!0)}var r=c.defer(),n=e.$broadcast("beforeTaskListSelectionChange",t,i,l);return n.defaultPrevented?void a.discard(e).then(function(e){e?s(t,i,l):r.resolve(!1)}):(s(t,i,l),r.promise)},g.findIndex=function(e,t){for(var i=0;i<e.length;i++)if(e[i].id==t.id)return i;return-1},g.getSingleSelected=function(){var e=g.getSelected();return g.singleSelect()?e[0]:{}},g.getTaskIds=function(){var e=g.getSelected(),t=[];return e.forEach(function(e){t.push(e.id)}),t},g.isAllFavourite=function(){var e=g.getSelected(),l=!0;return e.forEach(function(e){l=l&&t.isFavourite(e,i.getLoggedInId())}),l},g.isSelected=function(){var e=g.getSelected();return e.length},g.multipleSelect=function(){var e=g.getSelected();return e.length>1},g.singleSelect=function(){var e=g.getSelected();return 1==e.length},g.setDefaultView=function(){e.rightDefaultViewVisible=!1,e.default={edit:!0}},g.setSelected=function(e){var t=e||[];n.localStorage.setItem("selected",JSON.stringify(t))},g.getSelected=function(){return JSON.parse(n.localStorage.getItem("selected"))},g.setAllFilterViews=function(e){n.localStorage.setItem("filterViews",JSON.stringify(e))},g.setFilterView=function(e,t){var i=JSON.parse(n.localStorage.getItem("filterViews")||"{}");i[e]=t,n.localStorage.setItem("filterViews",JSON.stringify(i)),u(e,t)},g.getFilterView=function(e){var t=JSON.parse(n.localStorage.getItem("filterViews")||"{}"),i=t[e];return i||(i=t[e]="default",n.localStorage.setItem("filterViews",JSON.stringify(t)),u(e,i)),i=_.find(g.viewTypes,function(e,t){return e.value==i})},g.setSelectedFilterView=function(t){var i=g.getFilterView(t);e.filterView={},e.filterView.select=i,e.filterView.list=g.filterViewTypes[t],e.filterView.key=t},g.clearFilterView=function(){e.filterView={}},g.viewTypes=[{name:"Default",value:"default",isDateView:!1},{name:"Narrow",value:"narrow",isDateView:!1},{name:"Wide",value:"wide",isDateView:!1}],g.filterViewTypes={inbox:g.viewTypes,project:g.viewTypes,assignee:g.viewTypes,filter:g.viewTypes,label:g.viewTypes,today:_.filter(g.viewTypes,{isDateView:!1}),next7days:_.filter(g.viewTypes,{isDateView:!1}),overdue:_.filter(g.viewTypes,{isDateView:!1}),watching:_.filter(g.viewTypes,{isDateView:!1}),favourites:_.filter(g.viewTypes,{isDateView:!1})},g.defaultViewType=_.find(g.viewTypes,{value:"default"}),e.$on("$stateChangeSuccess",function(e,t,l,s,r){if(i.isAuthenticated()){var n="project";g.setSelectedFilterView(n)}})}])}).call(this);
(function(){app.service("toastService",["$rootScope","toastr","toastrConfig","$templateCache","$ionicListDelegate","$ionicLoading","$state","platformService","$timeout",function(t,e,o,s,n,i,a,c,l){function u(){return'<div class = "toast-undo"> <span class="toast-message">Task completed</span> <button class="undo-button" ng-click="undoToast()">UNDO</button></div>'}function r(t,o){l(function(t){return function(){t&&t.isOpened&&e.remove(t.scope.toastId)}}(t),void 0!==o?o:3500)}var p=this,d=!1,m=s.get("directives/toast/toast.html");p.setDefaultToast=function(){s.remove("directives/toast/toast.html"),angular.extend(o,{positionClass:c.isMobileDevice()?"toast-bottom-full-width":"toast-bottom-center",tapToDismiss:!0,timeOut:3e3,preventOpenDuplicates:!0,preventDuplicates:!1,onShown:function(t){console.log("Showing toast - "+(t.scope.message?t.scope.message.toString():"")+"    "+t.scope.toastId)},onHidden:function(t,e){console.log("Hiding toast - "+(e.scope.message?e.scope.message.toString():"")+"    "+e.scope.toastId)}}),s.put("directives/toast/toast.html",m)},p.openTaskCompleteToast=function(){s.remove("directives/toast/toast.html"),angular.extend(o,{positionClass:c.isMobileDevice()?"toast-bottom-full-width":"toast-bottom-center",tapToDismiss:!1,onHidden:function(){t.$emit("bulk-complete:response",d),p.setDefaultToast(),d=!1},preventOpenDuplicates:!0}),s.put("directives/toast/toast.html",u());var n=e.success();r(n,3500)},t.undoToast=function(){d=!0,e.clear()},t.$on("toast-message",function(t,o){p.setDefaultToast();var s;s=o.success?e.success(o.title):e.error(o.title),r(s,3500)}),$(document).on("click","ion-side-menu,ion-header-bar",function(){e.clear()})}])}).call(this);
!function(){app.service("uiHelperService",["$timeout",function(o){var n=this;window.uiLog=[],n.focusTo=function(e,t,i){if(window.uiLog.push("id : "+e),i=$.extend({offsetTop:0,offsetLeft:0},i),void 0!==e){var l=n.scrollTo(e,t,i,function(){window.uiLog.push("in callback");var n=$("#"+e);i.focusMeBackgroundSelector&&(n=$(i.focusMeBackgroundSelector,l)),0==n.length&&(n=l),o(function(){n.animate({backgroundColor:"#e5eff7"},"fast").animate({backgroundColor:"none"},"fast").animate({backgroundColor:"#e5eff7"},"fast").animate({backgroundColor:"none"},"fast").promise().then(function(){console.log("animation complete"),window.uiLog.push("animation complete")})})});l.length>0||console.log("element with id "+e+"not found")}},n.scrollTo=function(n,e,t,i){function l(){function l(){console.log("scrolling now"),window.uiLog.push("scrolling now"),f=window.document.body,c=$("#"+n,f);var l=c.offset(),a=c.parents(".scroll"),s=l.top,u=l.left;if(a.length>0){var r=$(a.get(0)).offset();s=Math.abs(s-r.top),u=Math.abs(u-r.left)}t.offsetTop&&(s-=parseInt(t.offsetTop)),t.offsetLeft&&(u-=parseInt(t.offsetLeft)),e.scrollTo(u,s),i&&(window.uiLog.push("calling callback"),o(i))}if(c.length>0){var a=ionic.debounce(l,800),s=$("img",f);console.log("has images: "+s.length),a(),s.length>0&&$(s).on("load",function(){console.log("load event called in scrollTo"),window.uiLog.push("load event called in scrollTo"),a()})}}if(t=$.extend({offsetTop:0,offsetLeft:0},t),void 0!==n){var f=window.document.body,c=$("#"+n,f);return c.length>0?l():(window.uiLog.push("element not found to scroll to . going for timeout"),o(function(){f=window.document.body,c=$("#"+n,f),l()},2e3)),c}}}])}();
(function(){app.service("filterModel",["$rootScope","TodoZuDB","dbEnums",function(t,e,o){var s=this;s.addOrUpdate=function(o,s){var n=e.getDb().open("todozu-db",e.version);n.onsuccess=function(){var e=n.result,r=e.transaction("filters","readwrite"),i=r.objectStore("filters");i.put(o),s(null,o),e.close(),t.$emit("filterList-update",o)}},s.bulkUpdate=function(o,s){var n=e.getDb().open("todozu-db",e.version);n.onsuccess=function(){for(var e=n.result,r=e.transaction("filters","readwrite"),i=r.objectStore("filters"),u=0;u<o.length;u++)i.put(o[u]);s(),e.close(),t.$emit("filterList-update")}},s.getAll=function(t){var s=[],n=e.getDb().open("todozu-db",e.version);n.onsuccess=function(){var e=n.result,r=e.transaction("filters","readwrite"),i=r.objectStore("filters");i.openCursor().onsuccess=function(e){var n=e.target.result;n?(n.value.status===o.status.active&&s.push(n.value),n.continue()):t(null,s)},e.close()}},s.findById=function(t,o){var s=e.getDb().open("todozu-db",e.version);s.onsuccess=function(){var e=s.result,n=e.transaction("filters","readwrite"),r=n.objectStore("filters");r.get(t).onsuccess=function(t){o(null,t.target.result)},e.close()}},s.delete=function(o,s){var n=e.getDb().open("todozu-db",e.version);n.onsuccess=function(){var e=n.result,r=e.transaction("filters","readwrite"),i=r.objectStore("filters");i.delete(o).onsuccess=function(e){s(null,!0),t.$emit("filterList-update")},e.close()}}}])}).call(this);
(function(){app.service("labelModel",["$rootScope","TodoZuDB","dbEnums",function(e,t,o){var s=this;s.addOrUpdate=function(o,s){var n=t.getDb().open("todozu-db",t.version);n.onsuccess=function(){var t=n.result,l=t.transaction("labels","readwrite"),a=l.objectStore("labels");a.put(o),s(null,o),t.close(),e.$emit("labelList-update",o)}},s.bulkUpdate=function(o,s){var n=t.getDb().open("todozu-db",t.version);n.onsuccess=function(){for(var t=n.result,l=t.transaction("labels","readwrite"),a=l.objectStore("labels"),u=0;u<o.length;u++)a.put(o[u]);s(),t.close(),e.$emit("labelList-update")}},s.getAll=function(e){var s=[],n=t.getDb().open("todozu-db",t.version);n.onsuccess=function(){var t=n.result,l=t.transaction("labels","readwrite"),a=l.objectStore("labels");a.openCursor().onsuccess=function(t){var n=t.target.result;n?(n.value.status===o.status.active&&s.push(n.value),n.continue()):e(null,s)},t.close()}},s.findById=function(e,o){var s=t.getDb().open("todozu-db",t.version);s.onsuccess=function(){var t=s.result,n=t.transaction("labels","readwrite"),l=n.objectStore("labels");l.get(e).onsuccess=function(e){o(null,e.target.result)},t.close()}},s.delete=function(o,s){var n=t.getDb().open("todozu-db",t.version);n.onsuccess=function(){var t=n.result,l=t.transaction("labels","readwrite"),a=l.objectStore("labels");a.delete(o).onsuccess=function(t){s(null,!0),e.$emit("labelList-update")},t.close()}}}])}).call(this);
(function(){app.service("notificationModel",["$rootScope","TodoZuDB",function(t,o){function n(){var t=o.getDb().open("todozu-db",o.version);t.onsuccess=function(){var o=t.result,n=o.transaction("notifications","readwrite"),e=n.objectStore("notifications"),s=e.count();s.onsuccess=function(){var t=s.result-i,o=0;e.openCursor().onsuccess=function(n){var e=n.target.result;e&&(o<t&&e.delete(),o++,e.continue())}},o.close()}}var e=this,i=50;e.addOrUpdate=function(i,s){var c=o.getDb().open("todozu-db",o.version);c.onsuccess=function(){var o=c.result,u=o.transaction("notifications","readwrite"),r=u.objectStore("notifications");i.id=i._id,r.put(i),o.close(),n(),s(null,i),e.getNoOfUnseen(function(o,n){console.log(n),t.$emit("NoNN-update",n)}),t.$emit("notificationList-update",i)}},e.bulkUpdate=function(n,i){var s=o.getDb().open("todozu-db",o.version);s.onsuccess=function(){for(var o=s.result,c=o.transaction("notifications","readwrite"),u=c.objectStore("notifications"),r=0;r<n.length;r++)n[r].id=n[r]._id,u.put(n[r]);i(),o.close(),e.getNoOfUnseen(function(o,n){t.$emit("NoNN-update",n)}),t.$emit("notificationList-update")}},e.bulkSeen=function(n){var i=o.getDb().open("todozu-db",o.version);i.onsuccess=function(){var o=i.result,s=o.transaction("notifications","readwrite"),c=s.objectStore("notifications");c.openCursor().onsuccess=function(o){var i=o.target.result;i?(i.value.seen=!0,c.put(i.value),i.continue()):(n(null),e.getNoOfUnseen(function(o,n){t.$emit("NoNN-update",n)}),t.$emit("notificationList-update"))},o.close()}},e.delete=function(n,e){var i=o.getDb().open("todozu-db",o.version);i.onsuccess=function(){var o=i.result,s=o.transaction("notifications","readwrite"),c=s.objectStore("notifications");c.delete(n).onsuccess=function(o){e(null,!0),t.$emit("notificationList-update")},o.close()}},e.getAll=function(t){var n=[],e=o.getDb().open("todozu-db",o.version);e.onsuccess=function(){var o=e.result,i=o.transaction("notifications","readwrite"),s=i.objectStore("notifications");s.openCursor().onsuccess=function(o){var e=o.target.result;e?(n.push(e.value),e.continue()):t(null,n)},o.close()}},e.getNoOfUnseen=function(t){var n=0,e=o.getDb().open("todozu-db",o.version);e.onsuccess=function(){var o=e.result,i=o.transaction("notifications","readwrite"),s=i.objectStore("notifications");s.openCursor().onsuccess=function(o){var e=o.target.result;e?(e.value.seen||n++,e.continue()):t(null,n)},o.close()}}}])}).call(this);
(function(){app.service("projectModel",["$rootScope","userModel","dbEnums","TodoZuDB","taskModel",function(t,e,o,r,s){var n=this;n.addOrUpdate=function(t,e){var o=r.getDb().open("todozu-db",r.version);o.onsuccess=function(){var r=o.result,n=r.transaction("projects","readwrite"),c=n.objectStore("projects");c.put(t),s.updateProjectInfo(t,function(){}),e(null,t),r.close(),u()}},n.bulkUpdate=function(t,e,o){"function"==typeof e&&(o=e,e=!1);var s=r.getDb().open("todozu-db",r.version);s.onsuccess=function(){for(var r=s.result,n=r.transaction("projects","readwrite"),c=n.objectStore("projects"),a=0;a<t.length;a++)c.put(t[a]);e||u(),o(),r.close()}},n.getAll=function(t){s.getAll(function(s,n){n=n||[];var u=[],c=r.getDb().open("todozu-db",r.version);c.onsuccess=function(){var r=c.result,s=r.transaction("projects","readwrite"),a=s.objectStore("projects");a.openCursor().onsuccess=function(r){var s=r.target.result;s?(s.value.users.forEach(function(t){t._id==e.getLoggedInId()&&t.status===o.status.active&&s.value.status==o.status.active&&(s.value.order=t.order,s.value.tasksCount=0,n.forEach(function(t){t.project&&t.project.id===s.value.id&&(s.value.tasksCount+=1)}),u.push(s.value))}),s.continue()):t(null,_.sortBy(u,"order"))},r.close()}})},n.getUserCreatedActiveProjects=function(t,e){n.getUserCreatedProjects(t,function(t,r){if(t)e(t);else{var s=_.filter(r,function(t){var e=!1;return t.status==o.status.active&&(e=!0),e});e(null,s)}})},n.getUserCreatedProjects=function(t,e){var o=[],s=r.getDb().open("todozu-db",r.version);s.onsuccess=function(){var r=s.result,n=r.transaction("projects","readwrite"),u=n.objectStore("projects");u.openCursor().onsuccess=function(r){var s=r.target.result;s?(s.value.users.forEach(function(e){e._id==t&&1==e.isAdmin&&(s.value.order=e.order,o.push(s.value))}),s.continue()):e(null,_.sortBy(o,"order"))},r.close()}},n.getAllArchived=function(t){var s=[],n=r.getDb().open("todozu-db",r.version);n.onsuccess=function(){var r=n.result,u=r.transaction("projects","readwrite"),c=u.objectStore("projects");c.openCursor().onsuccess=function(r){var n=r.target.result;n?(n.value.users.forEach(function(t){t._id==e.getLoggedInId()&&t.status===o.status.archived&&s.push(n.value)}),n.continue()):t(null,s)},r.close()}},n.findById=function(t,e){var s=r.getDb().open("todozu-db",r.version);s.onsuccess=function(){var r=s.result,n=r.transaction("projects","readwrite"),u=n.objectStore("projects");u.get(t).onsuccess=function(t){t.target.result&&t.target.result.status==o.status.active?e(null,t.target.result):e(null,null)},r.close()}},n.delete=function(t,e){var o=r.getDb().open("todozu-db",r.version);o.onsuccess=function(){var r=o.result,s=r.transaction("projects","readwrite"),n=s.objectStore("projects");n.delete(t).onsuccess=function(t){e(null,!0),u()},r.close()}};var u=ionic.debounce(function(){t.$emit("projectList-update")},200)}])}).call(this);
(function(){app.service("reminderModel",["TodoZuDB",function(e){var n=this;n.addOrUpdate=function(n,r){var t=e.getDb().open("todozu-db",e.version);t.onsuccess=function(){var e=t.result,o=e.transaction("reminders","readwrite"),s=o.objectStore("reminders");s.put(n),r(null,n),e.close()}},n.getAll=function(n){var r=[],t=e.getDb().open("todozu-db",e.version);t.onsuccess=function(){var e=t.result,o=e.transaction("reminders","readwrite"),s=o.objectStore("reminders");s.openCursor().onsuccess=function(e){var t=e.target.result;t?(r.push(t.value),t.continue()):n(null,r)},e.close()}},n.findById=function(n,r){var t=e.getDb().open("todozu-db",e.version);t.onsuccess=function(){var e=t.result,o=e.transaction("reminders","readwrite"),s=o.objectStore("reminders");s.get(n).onsuccess=function(e){r(null,e.target.result)},e.close()}},n.delete=function(n,r){var t=e.getDb().open("todozu-db",e.version);t.onsuccess=function(){var e=t.result,o=e.transaction("reminders","readwrite"),s=o.objectStore("reminders");s.delete(n).onsuccess=function(e){r(null,!0)},e.close()}},n.deleteRemindersByTaskId=function(n,r){var t=e.getDb().open("todozu-db",e.version);t.onsuccess=function(){var e=t.result,o=e.transaction("reminders","readwrite"),s=o.objectStore("reminders");s.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.taskId==n&&t.delete(),t.continue()):r()},e.close()}}}])}).call(this);
(function(){app.service("settingsModel",["$rootScope","$timeout","$window",function(t,e,i){var n=this;n.addOrUpdate=function(n,a){i.localStorage.setItem("settings",JSON.stringify(n)),e(function(){t.$emit("settings-update",n)}),a()},n.get=function(t){var e=JSON.parse(i.localStorage.getItem("settings"));!e||!e.reminder||e.reminder.taskCreateReminderNotificationChannels&&e.reminder.taskCreateReminderNotificationChannels.email.title||(e.reminder.taskCreateReminderNotificationChannels=DEFAULTS.defaultSettings.taskCreateReminderNotificationChannels),t(e)},n.setAllFilterViews=function(t){i.localStorage.setItem("filterViews",JSON.stringify(t))},n.setAllSortOptions=function(t){i.localStorage.setItem("sortOptions",JSON.stringify(t))}}])}).call(this);
(function(){app.service("taskModel",["$window","$rootScope","userModel","TodoZuDB","dbEnums","$timeout",function(t,e,n,o,s,r){var u=this;u.addOrUpdate=function(t,n,s){"function"==typeof n&&(s=n,n=!1);var r=o.getDb().open("todozu-db",o.version);r.onsuccess=function(){var o=r.result,u=o.transaction("tasks","readwrite"),a=u.objectStore("tasks");a.put(t),n||e.$emit("reminder:setReminders",t),s(null,t),o.close(),n||c()}},u.bulkUpdate=function(t,n){var s=o.getDb().open("todozu-db",o.version);s.onsuccess=function(){for(var o=s.result,r=o.transaction("tasks","readwrite"),u=r.objectStore("tasks"),a=0;a<t.length;a++)u.put(t[a]),e.$emit("reminder:setReminders",t[a]);n(),o.close(),c()}},u.delete=function(t,n,s){"function"==typeof n&&(s=n,n=!1);var r=o.getDb().open("todozu-db",o.version);r.onsuccess=function(){var o=r.result,u=o.transaction("tasks","readwrite"),c=u.objectStore("tasks");c.delete(t).onsuccess=function(t){s&&s(null,!0),n||e.$emit("taskList-update")},o.close()}},u.findActiveTaskById=function(t,e){var n=o.getDb().open("todozu-db",o.version);n.onsuccess=function(){var o=n.result,r=o.transaction("tasks","readwrite"),u=r.objectStore("tasks");u.get(t).onsuccess=function(t){t.target.result.status==s.status.active?e(null,t.target.result):e(null,null)},o.close()}},u.findById=function(t,e){var n=o.getDb().open("todozu-db",o.version);n.onsuccess=function(){var o=n.result,s=o.transaction("tasks","readwrite"),r=s.objectStore("tasks");r.get(t).onsuccess=function(t){e(null,t.target.result)},o.close()}},u.getAll=function(t){var e=[],n=o.getDb().open("todozu-db",o.version);n.onsuccess=function(){var o=n.result,r=o.transaction("tasks","readwrite"),u=r.objectStore("tasks");u.openCursor().onsuccess=function(n){var o=n.target.result;o?(o.value.status===s.status.active&&e.push(o.value),o.continue()):t(null,e)},o.close()}},u.getAllByPredicate=function(t,e){t=t||function(){return!0},e=e||function(){};var n=[],s=o.getDb().open("todozu-db",o.version);s.onsuccess=function(){var o=s.result,r=o.transaction("tasks","readwrite"),u=r.objectStore("tasks");u.openCursor().onsuccess=function(o){var s=o.target.result;s?(t(s.value)&&n.push(s.value),s.continue()):e(null,n)},o.close()}},u.getAllIds=function(t){var e=[],n=o.getDb().open("todozu-db",o.version);n.onsuccess=function(){var o=n.result,s=o.transaction("tasks","readwrite"),r=s.objectStore("tasks");r.openCursor().onsuccess=function(n){var o=n.target.result;o?(e.push(o.value.id),o.continue()):t(null,e)},o.close()}},u.getSelected=function(t,e){var n=[],s=o.getDb().open("todozu-db",o.version);s.onsuccess=function(){var o=s.result,r=o.transaction("tasks","readwrite"),u=r.objectStore("tasks");u.openCursor().onsuccess=function(o){var s=o.target.result;s?(t.indexOf(s.value.id)>-1&&n.push(s.value),s.continue()):e(null,n)},o.close()}},u.updateProjectInfo=function(t,e){u.getAll(function(n,o){return n?void e(n):(_.each(o,function(e){e.project&&e.project.id===t.id&&(e.project.name=t.name,e.project.color=t.color)}),void u.bulkUpdate(o,e))})},u.getTaskUserByRole=function(t,e){var n=_.find(t.users,function(t){return t.role===e&&t._id});return n};var c=ionic.debounce(function(){e.$emit("taskList-update")},500)}])}).call(this);
(function(){app.service("userModel",["$rootScope","$timeout","$window","dbEnums",function(e,t,r,a){function o(e,t,r){var a;if(t){for(var o=0;o<e.length;o++)if(e[o][t]._id==r){a=e[o],e.splice(o,1),e.unshift(a);break}}else for(var o=0;o<e.length;o++)if(e[o]._id==r){a=e[o],e.splice(o,1),e.unshift(a);break}return e}var n=this;n.addOrUpdate=function(a,o){r.localStorage.setItem("userInfo",JSON.stringify(a)),t(function(){e.$emit("userInfo-update",a)}),o()},n.clearSession=function(){var e=n.getRequestLoginEmail(),t=n.getDeviceToken(),a=n.getDeviceUniqueId();r.localStorage.clear(),n.setDeviceToken(t),n.setDeviceUniqueId(a),e&&n.setRequestLoginEmail(e)},n.getAvatar=function(){return JSON.parse(r.localStorage.getItem("userInfo")).avatar},n.getDeviceToken=function(){return JSON.parse(r.localStorage.getItem("device_token"))},n.getDeviceUniqueId=function(){return JSON.parse(r.localStorage.getItem("uid"))},n.getLastPullTimestamp=function(){var e=r.localStorage.getItem("timestamp");return e?new Date(e):e},n.getLoggedInName=function(){return JSON.parse(r.localStorage.getItem("userInfo")).firstName+" "+JSON.parse(r.localStorage.getItem("userInfo")).lastName},n.getLoggedInFirstName=function(){return JSON.parse(r.localStorage.getItem("userInfo")).firstName},n.getLoggedInLastName=function(){return JSON.parse(r.localStorage.getItem("userInfo")).lastName},n.getLoggedInShortName=function(){return JSON.parse(r.localStorage.getItem("userInfo")).firstName.charAt(0).toUpperCase()+JSON.parse(r.localStorage.getItem("userInfo")).lastName.charAt(0).toUpperCase()},n.getLoggedInEmail=function(){return JSON.parse(r.localStorage.getItem("userInfo")).email},n.getLoggedInId=function(){var e=JSON.parse(r.localStorage.getItem("userInfo"))||{};return e._id},n.getLoggedInUser=function(){var e=JSON.parse(r.localStorage.getItem("userInfo"));return{_id:e._id,displayName:n.getLoggedInName(),displayShortName:n.getLoggedInShortName(),email:e.email,avatar:e.avatar}},n.getRequestLoginEmail=function(){return r.localStorage.getItem("request_login_email")},n.getToken=function(){return r.localStorage.getItem("token")},n.get=function(e){e(JSON.parse(r.localStorage.getItem("userInfo")))},n.getTaskCustomOrders=function(){return JSON.parse(r.localStorage.getItem("taskCustomOrders"))},n.setTaskCustomOrders=function(e){r.localStorage.setItem("taskCustomOrders",JSON.stringify(e))},n.isAuthenticated=function(){return!!r.localStorage.getItem("token")},n.meTopOnList=function(e,t){var r=n.getLoggedInId();return o(e,t,r)},n.adminTopOnList=function(e){var t=_.find(e,function(e){return e.role==a.projectUserRole.admin});return t?o(e,null,t._id):[]},n.removeRequestLoginEmail=function(){r.localStorage.removeItem("request_login_email")},n.setDeviceToken=function(e){r.localStorage.setItem("device_token",JSON.stringify(e))},n.setDeviceUniqueId=function(e){r.localStorage.setItem("uid",JSON.stringify(e))},n.setLastPullTimestamp=function(e){r.localStorage.setItem("timestamp",e)},n.setRequestLoginEmail=function(e){r.localStorage.setItem("request_login_email",e)},n.setToken=function(e,t){r.localStorage.setItem("token",e),t()},n.changeTaskSortOrder=function(t,r){var a=n.getTaskCustomOrders(),o=_.map(t||[],function(e){return{order:e.order,taskId:e.taskId}}),s=_.map(a||[],function(e){return{order:e.order,taskId:e.taskId}}),i=_.isEqual(_.sortBy(s||[],"order"),_.sortBy(o||[],"order"));return i?void r():(n.setTaskCustomOrders(t),r(),void e.$emit("userInfo-sortOrder"))},n.saveUserFeatures=function(e){r.localStorage.setItem("user-features",JSON.stringify(e||{}))},n.getUserFeatures=function(){var e=r.localStorage.getItem("user-features");return JSON.parse(e||"{}")},n.saveAllFeatures=function(e){r.localStorage.setItem("all-features",JSON.stringify(e||{}))},n.getAllFeatures=function(){var e=r.localStorage.getItem("all-features");return JSON.parse(e||"{}")}}])}).call(this);
(function(){app.service("TodoZuDB",["$q","$window",function(e,t){var n,o=this;o.version=1,o.name="todozu-db",o.createDatabase=function(){n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB},o.createInstances=function(){var t=e.defer(),r=n.open(o.name,o.version);return r.onupgradeneeded=function(){var e=r.result,n=e.createObjectStore("changes",{keyPath:"id",autoIncrement:!0});n=e.createObjectStore("filters",{keyPath:"id"}),n=e.createObjectStore("labels",{keyPath:"id"}),n=e.createObjectStore("projects",{keyPath:"id"}),n=e.createObjectStore("tasks",{keyPath:"id"}),n=e.createObjectStore("reminders",{keyPath:"id"}),n=e.createObjectStore("notifications",{keyPath:"id"}),t.resolve(),e.close()},t.promise},o.getDb=function(){return console.log("getting db instance..."),console.log(n),n},o.dropDatabase=function(){return new Promise(function(e,t){var r=n.deleteDatabase(o.name);r.onsuccess=function(t){e(t)},r.onerror=function(e){console.log("error while deleting"),t(e)},r.onblocked=function(e){console.log("blocked, unable to delete"),t(e)}})}}])}).call(this);
(function(){app.service("dbEnums",function(){var e=this;e.collections={Filter:"Filter",Label:"Label",Notification:"Notification",Project:"Project",Settings:"Settings",Task:"Task",User:"User"},e.events={Filter:{addOrUpdate:"addOrUpdate",delete:"delete"},Label:{addOrUpdate:"addOrUpdate",delete:"delete"},Project:{addOrUpdate:"addOrUpdate",archive:"archive",delete:"delete",deleteUser:"deleteUser",left:"left",reorder:"reorder",sendInvitation:"sendInvitation",unArchive:"unArchive",adminInvitation:"adminInvitation"},Settings:{update:"update",sortUpdate:"sortUpdate",filterViewUpdate:"filterViewUpdate"},Task:{add:"add",addNote:"addNote",bulkComplete:"bulkComplete",bulkDueDateUpdate:"bulkDueDateUpdate",bulkFavourites:"bulkFavourites",delete:"delete",deleteNote:"deleteNote",deleteReminder:"deleteReminder",reminderExecuted:"reminderExecuted",update:"update",updateNote:"updateNote",moveTaskOrder:"moveTaskOrder"}},e.keys={ASSIGNEE:"Assignee",CREATE:"Create",DUE:"Due",FILE:"file",NOTE:"Note",PRIORITY:"Priority",PROJECT:"Project",STATUS:"Status",TITLE:"Title",WATCHER:"Watcher",DELETE_VALIDATION_REGEX:/^delete$/i,COPY_TASK_PREFIX:"COPY - ",TASK_DELETE:"TASK_DELETE"},e.projectUserRole={admin:"admin",approval:"waiting for approval",pending:"pending user",user:"user"},e.status={accepted:"accepted",active:"active",approval:"approval",archived:"archived",complete:"complete",deleted:"deleted",inactive:"inactive",pending:"pending",rejected:"rejected",reopened:"reopen"},e.taskUserRole={admin:"admin",assignee:"assignee",user:"user",watcher:"watcher"},e.USER_ROLES={ACTIVE_PROJECTS:"active_projects",ACTIVE_TASKS:"active_tasks",ASSIGNEE_PROJECT:"assignee_project",MAX_USERS_PROJECT:"max_users_project",LABELS:"labels",LABELS_ASSIGN:"labels_assign",EMAIL_NOTIFICATIONS:"email_notifications",CUSTOM_FILTERS:"custom_filters",SEARCH:"search",FILE_UPLOAD:"file_upload",FILE_UPLOAD_SIZE:"file_upload_size",FILE_STORAGE_MAX:"file_storage_max",MY_FEEDS:"my_feeds",TASK_HISTORY:"task_history"}})}).call(this);
(function(){app.service("sync",["$q","$window","$http","$rootScope","API","connectivity","TodoZuDB","$timeout","projectModel","filterModel","labelModel","settingsModel","taskModel","userModel","notificationModel",function(e,t,s,n,o,r,i,c,l,a,u,f,p,d,g){function m(t){var n=e.defer();return r.isConnected()?s.post(o.sync.push,t).success(function(e){n.resolve(!0)}).error(function(e){console.log("pushing error",e),n.resolve(!1)}):n.resolve(!1),n.promise}var v=this,h=!1,b=!1,k=!1;v.clearInstance=function(){var e=i.getDb().open(i.name,i.version);e.onsuccess=function(){var t=e.result,s=t.transaction("changes","readwrite");s.objectStore("changes").clear(),t.close()}},v.add=function(e,t,s){var o={collectionName:e,object:t,type:s,timestamp:Date()},r=i.getDb().open(i.name,i.version);r.onsuccess=function(){var e=r.result,t=e.transaction("changes","readwrite"),s=t.objectStore("changes");s.put(o),h=!0,n.$emit("push-to-server"),e.close()}},n.$on("push-to-server",function(e,t,s){c(function(){if(h&&!b){b=!0;var e=[],o=i.getDb().open(i.name,i.version);o.onsuccess=function(){var r=o.result,i=r.transaction("changes","readwrite"),c=i.objectStore("changes");c.openCursor().onsuccess=function(o){var r=o.target.result;r?(e.push(r.value),r.continue()):m(e).then(function(e){e&&(h=!1,t&&n.$emit("pull-from-server",s),v.clearInstance()),b=!1})},r.close()}}else t&&n.$emit("pull-from-server")},500)}),n.$on("pull-from-server",function(e){if(r.isConnected()&&!h&&!k&&d.isAuthenticated()){k=!0;var t={id:d.getLoggedInId(),timestamp:d.getLastPullTimestamp()};s.post(o.sync.pull,t).success(function(e){console.log("pull success");var t=e.data;d.setLastPullTimestamp(new Date),t.features&&d.saveUserFeatures(t.features),t.licenseFeatures&&d.saveAllFeatures(t.licenseFeatures),t.settings&&(f.addOrUpdate(t.settings,function(){}),t.settings.filterView&&f.setAllFilterViews(t.settings.filterView),t.settings.sortOption&&f.setAllSortOptions(t.settings.sortOption)),t.projects.length&&l.bulkUpdate(t.projects,function(){}),t.labels.length&&u.bulkUpdate(t.labels,function(){}),t.filters.length&&a.bulkUpdate(t.filters,function(){}),t.tasks.length&&p.bulkUpdate(t.tasks,function(){}),t.taskCustomOrders&&t.taskCustomOrders.length&&d.changeTaskSortOrder(t.taskCustomOrders,function(){}),t.notifications&&t.notifications.length>0&&g.bulkUpdate(t.notifications,function(){}),k=!1}).error(function(e){console.log("pull error",e),k=!1}).finally(function(){n.$emit("pull-from-server-complete")})}else n.$emit("pull-from-server-complete")})}])}).call(this);